var knexDB2=function(){"use strict";const Qc=Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"}));var kt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Dc(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){if(this instanceof n){var i=[null];i.push.apply(i,arguments);var a=Function.bind.apply(e,i);return new a}return e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var i=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return r[n]}})}),t}var Ir={exports:{}},Pr={},Lr={},Mt={};Object.defineProperty(Mt,"__esModule",{value:!0});let Fc=class extends Error{};Mt.TimeoutError=Fc;var re={},Br={};Object.defineProperty(Br,"__esModule",{value:!0});class Uc{constructor(e){this._value=e.value,this._error=e.error}value(){return this._value}reason(){return this._error}isRejected(){return!!this._error}isFulfilled(){return!!this._value}}Br.PromiseInspection=Uc,Object.defineProperty(re,"__esModule",{value:!0});const Bs=Br;function Hc(){let r=null,e=null;return{promise:new Promise((n,i)=>{r=n,e=i}),resolve:r,reject:e}}re.defer=Hc;function Vc(){return Date.now()}re.now=Vc;function Wc(r,e){return Math.abs(e-r)}re.duration=Wc;function zc(r){return typeof r>"u"?!0:ks(r)}re.checkOptionalTime=zc;function ks(r){return typeof r=="number"&&r===Math.round(r)&&r>0}re.checkRequiredTime=ks;function Kc(r){return new Promise(e=>setTimeout(e,r))}re.delay=Kc;function Jc(r){return r.then(e=>new Bs.PromiseInspection({value:e})).catch(e=>new Bs.PromiseInspection({error:e}))}re.reflect=Jc;function Gc(r){try{const e=r();return Promise.resolve(e)}catch(e){return Promise.reject(e)}}re.tryPromise=Gc,Object.defineProperty(Lr,"__esModule",{value:!0});const jt=Mt,Yc=re;class Xc{constructor(e){this.timeoutMillis=e,this.deferred=Yc.defer(),this.possibleTimeoutCause=null,this.isRejected=!1,this.promise=Zc(this.deferred.promise,e).catch(t=>(t instanceof jt.TimeoutError&&(this.possibleTimeoutCause?t=new jt.TimeoutError(this.possibleTimeoutCause.message):t=new jt.TimeoutError("operation timed out for an unknown reason")),this.isRejected=!0,Promise.reject(t)))}abort(){this.reject(new Error("aborted"))}reject(e){this.deferred.reject(e)}resolve(e){this.deferred.resolve(e)}}Lr.PendingOperation=Xc;function Zc(r,e){return new Promise((t,n)=>{const i=setTimeout(()=>n(new jt.TimeoutError),e);r.then(a=>{clearTimeout(i),t(a)}).catch(a=>{clearTimeout(i),n(a)})})}var kr={};Object.defineProperty(kr,"__esModule",{value:!0});const Ms=re;class Mr{constructor(e){this.resource=e,this.resource=e,this.timestamp=Ms.now(),this.deferred=Ms.defer()}get promise(){return this.deferred.promise}resolve(){return this.deferred.resolve(void 0),new Mr(this.resource)}}kr.Resource=Mr;const I=Dc(Qc);Object.defineProperty(Pr,"__esModule",{value:!0});const Qt=Lr,eh=kr,X=re,th=I,js=I;let rh=class{constructor(e){if(this.destroyed=!1,this.emitter=new th.EventEmitter,e=e||{},!e.create)throw new Error("Tarn: opt.create function most be provided");if(!e.destroy)throw new Error("Tarn: opt.destroy function most be provided");if(typeof e.min!="number"||e.min<0||e.min!==Math.round(e.min))throw new Error("Tarn: opt.min must be an integer >= 0");if(typeof e.max!="number"||e.max<=0||e.max!==Math.round(e.max))throw new Error("Tarn: opt.max must be an integer > 0");if(e.min>e.max)throw new Error("Tarn: opt.max is smaller than opt.min");if(!X.checkOptionalTime(e.acquireTimeoutMillis))throw new Error("Tarn: invalid opt.acquireTimeoutMillis "+JSON.stringify(e.acquireTimeoutMillis));if(!X.checkOptionalTime(e.createTimeoutMillis))throw new Error("Tarn: invalid opt.createTimeoutMillis "+JSON.stringify(e.createTimeoutMillis));if(!X.checkOptionalTime(e.destroyTimeoutMillis))throw new Error("Tarn: invalid opt.destroyTimeoutMillis "+JSON.stringify(e.destroyTimeoutMillis));if(!X.checkOptionalTime(e.idleTimeoutMillis))throw new Error("Tarn: invalid opt.idleTimeoutMillis "+JSON.stringify(e.idleTimeoutMillis));if(!X.checkOptionalTime(e.reapIntervalMillis))throw new Error("Tarn: invalid opt.reapIntervalMillis "+JSON.stringify(e.reapIntervalMillis));if(!X.checkOptionalTime(e.createRetryIntervalMillis))throw new Error("Tarn: invalid opt.createRetryIntervalMillis "+JSON.stringify(e.createRetryIntervalMillis));const t={create:!0,validate:!0,destroy:!0,log:!0,min:!0,max:!0,acquireTimeoutMillis:!0,createTimeoutMillis:!0,destroyTimeoutMillis:!0,idleTimeoutMillis:!0,reapIntervalMillis:!0,createRetryIntervalMillis:!0,propagateCreateError:!0};for(const n of Object.keys(e))if(!t[n])throw new Error(`Tarn: unsupported option opt.${n}`);this.creator=e.create,this.destroyer=e.destroy,this.validate=typeof e.validate=="function"?e.validate:()=>!0,this.log=e.log||(()=>{}),this.acquireTimeoutMillis=e.acquireTimeoutMillis||3e4,this.createTimeoutMillis=e.createTimeoutMillis||3e4,this.destroyTimeoutMillis=e.destroyTimeoutMillis||5e3,this.idleTimeoutMillis=e.idleTimeoutMillis||3e4,this.reapIntervalMillis=e.reapIntervalMillis||1e3,this.createRetryIntervalMillis=e.createRetryIntervalMillis||200,this.propagateCreateError=!!e.propagateCreateError,this.min=e.min,this.max=e.max,this.used=[],this.free=[],this.pendingCreates=[],this.pendingAcquires=[],this.pendingDestroys=[],this.pendingValidations=[],this.destroyed=!1,this.interval=null,this.eventId=1}numUsed(){return this.used.length}numFree(){return this.free.length}numPendingAcquires(){return this.pendingAcquires.length}numPendingValidations(){return this.pendingValidations.length}numPendingCreates(){return this.pendingCreates.length}acquire(){const e=this.eventId++;this._executeEventHandlers("acquireRequest",e);const t=new Qt.PendingOperation(this.acquireTimeoutMillis);return this.pendingAcquires.push(t),t.promise=t.promise.then(n=>(this._executeEventHandlers("acquireSuccess",e,n),n)).catch(n=>(this._executeEventHandlers("acquireFail",e,n),Ke(this.pendingAcquires,t),Promise.reject(n))),this._tryAcquireOrCreate(),t}release(e){this._executeEventHandlers("release",e);for(let t=0,n=this.used.length;t<n;++t){const i=this.used[t];if(i.resource===e)return this.used.splice(t,1),this.free.push(i.resolve()),this._tryAcquireOrCreate(),!0}return!1}isEmpty(){return[this.numFree(),this.numUsed(),this.numPendingAcquires(),this.numPendingValidations(),this.numPendingCreates()].reduce((e,t)=>e+t)===0}check(){const e=X.now(),t=[],n=this.min-this.used.length,i=this.free.length-n;let a=0;this.free.forEach(o=>{X.duration(e,o.timestamp)>=this.idleTimeoutMillis&&a<i?(a++,this._destroy(o.resource)):t.push(o)}),this.free=t,this.isEmpty()&&this._stopReaping()}destroy(){const e=this.eventId++;return this._executeEventHandlers("poolDestroyRequest",e),this._stopReaping(),this.destroyed=!0,X.reflect(Promise.all(this.pendingCreates.map(t=>X.reflect(t.promise))).then(()=>new Promise((t,n)=>{if(this.numPendingValidations()===0){t();return}const i=setInterval(()=>{this.numPendingValidations()===0&&(js.clearInterval(i),t())},100)})).then(()=>Promise.all(this.used.map(t=>X.reflect(t.promise)))).then(()=>Promise.all(this.pendingAcquires.map(t=>(t.abort(),X.reflect(t.promise))))).then(()=>Promise.all(this.free.map(t=>X.reflect(this._destroy(t.resource))))).then(()=>Promise.all(this.pendingDestroys.map(t=>t.promise))).then(()=>{this.free=[],this.pendingAcquires=[]})).then(t=>(this._executeEventHandlers("poolDestroySuccess",e),this.emitter.removeAllListeners(),t))}on(e,t){this.emitter.on(e,t)}removeListener(e,t){this.emitter.removeListener(e,t)}removeAllListeners(e){this.emitter.removeAllListeners(e)}_tryAcquireOrCreate(){this.destroyed||(this._hasFreeResources()?this._doAcquire():this._shouldCreateMoreResources()&&this._doCreate())}_hasFreeResources(){return this.free.length>0}_doAcquire(){for(;this._canAcquire();){const e=this.pendingAcquires.shift(),t=this.free.pop();if(t===void 0||e===void 0){const i="this.free was empty while trying to acquire resource";throw this.log(`Tarn: ${i}`,"warn"),new Error(`Internal error, should never happen. ${i}`)}this.pendingValidations.push(e),this.used.push(t);const n=new Qt.PendingOperation(this.acquireTimeoutMillis);e.promise.catch(i=>{n.abort()}),n.promise.catch(i=>(this.log("Tarn: resource validator threw an exception "+i.stack,"warn"),!1)).then(i=>{try{i&&!e.isRejected?(this._startReaping(),e.resolve(t.resource)):(Ke(this.used,t),i?this.free.push(t):(this._destroy(t.resource),setTimeout(()=>{this._tryAcquireOrCreate()},0)),e.isRejected||this.pendingAcquires.unshift(e))}finally{Ke(this.pendingValidations,e)}}),this._validateResource(t.resource).then(i=>{n.resolve(i)}).catch(i=>{n.reject(i)})}}_canAcquire(){return this.free.length>0&&this.pendingAcquires.length>0}_validateResource(e){try{return Promise.resolve(this.validate(e))}catch(t){return Promise.reject(t)}}_shouldCreateMoreResources(){return this.used.length+this.pendingCreates.length<this.max&&this.pendingCreates.length<this.pendingAcquires.length}_doCreate(){const e=this.pendingAcquires.slice();this._create().promise.then(()=>(this._tryAcquireOrCreate(),null)).catch(n=>{this.propagateCreateError&&this.pendingAcquires.length!==0&&this.pendingAcquires[0].reject(n),e.forEach(i=>{i.possibleTimeoutCause=n}),X.delay(this.createRetryIntervalMillis).then(()=>this._tryAcquireOrCreate())})}_create(){const e=this.eventId++;this._executeEventHandlers("createRequest",e);const t=new Qt.PendingOperation(this.createTimeoutMillis);return t.promise=t.promise.catch(n=>{throw Ke(this.pendingCreates,t)&&this._executeEventHandlers("createFail",e,n),n}),this.pendingCreates.push(t),nh(this.creator).then(n=>t.isRejected?(this.destroyer(n),null):(Ke(this.pendingCreates,t),this.free.push(new eh.Resource(n)),t.resolve(n),this._executeEventHandlers("createSuccess",e,n),null)).catch(n=>(t.isRejected||(Ke(this.pendingCreates,t)&&this._executeEventHandlers("createFail",e,n),t.reject(n)),null)),t}_destroy(e){const t=this.eventId++;this._executeEventHandlers("destroyRequest",t,e);const n=new Qt.PendingOperation(this.destroyTimeoutMillis);return Promise.resolve().then(()=>this.destroyer(e)).then(()=>{n.resolve(e)}).catch(a=>{n.reject(a)}),this.pendingDestroys.push(n),n.promise.then(a=>(this._executeEventHandlers("destroySuccess",t,e),a)).catch(a=>this._logDestroyerError(t,e,a)).then(a=>{const o=this.pendingDestroys.findIndex(s=>s===n);return this.pendingDestroys.splice(o,1),a})}_logDestroyerError(e,t,n){this._executeEventHandlers("destroyFail",e,t,n),this.log("Tarn: resource destroyer threw an exception "+n.stack,"warn")}_startReaping(){this.interval||(this._executeEventHandlers("startReaping"),this.interval=setInterval(()=>this.check(),this.reapIntervalMillis))}_stopReaping(){this.interval!==null&&(this._executeEventHandlers("stopReaping"),js.clearInterval(this.interval)),this.interval=null}_executeEventHandlers(e,...t){this.emitter.listeners(e).forEach(i=>{try{i(...t)}catch(a){this.log(`Tarn: event handler "${e}" threw an exception ${a.stack}`,"warn")}})}};Pr.Pool=rh;function Ke(r,e){const t=r.indexOf(e);return t===-1?!1:(r.splice(t,1),!0)}function nh(r){return new Promise((e,t)=>{const n=(i,a)=>{i?t(i):e(a)};X.tryPromise(()=>r(n)).then(i=>{i&&e(i)}).catch(i=>{t(i)})})}(function(r,e){Object.defineProperty(e,"__esModule",{value:!0});const t=Pr;e.Pool=t.Pool;const n=Mt;e.TimeoutError=n.TimeoutError,r.exports={Pool:t.Pool,TimeoutError:n.TimeoutError}})(Ir,Ir.exports);var ih=Ir.exports;const Dt=/[\0\b\t\n\r\x1a"'\\]/g,Qs={"\0":"\\0","\b":"\\b","	":"\\t","\n":"\\n","\r":"\\r","":"\\Z",'"':'\\"',"'":"\\'","\\":"\\\\"};function sh(r){return function e(t,n={}){return r(t,e,n)}}function oh(r={}){const e=r.escapeDate||Us,t=r.escapeArray||jr,n=r.escapeBuffer||Fs,i=r.escapeString||Qr,a=r.escapeObject||Ds,o=r.wrap||sh;function s(l,u,h){if(l==null)return"NULL";switch(typeof l){case"boolean":return l?"true":"false";case"number":return l+"";case"object":if(l instanceof Date)l=e(l,u,h);else return Array.isArray(l)?t(l,u,h):Buffer.isBuffer(l)?n(l,u,h):a(l,u,h)}return i(l,u,h)}return o?o(s):s}function Ds(r,e,t){return r&&typeof r.toSQL=="function"?r.toSQL(t):JSON.stringify(r)}function jr(r,e,t){let n="";for(let i=0;i<r.length;i++){const a=r[i];Array.isArray(a)?n+=(i===0?"":", ")+"("+jr(a,e,t)+")":n+=(i===0?"":", ")+e(a,t)}return n}function Fs(r){return"X"+Qr(r.toString("hex"))}function Qr(r,e,t){let n=Dt.lastIndex=0,i="",a;for(;a=Dt.exec(r);)i+=r.slice(n,a.index)+Qs[a[0]],n=Dt.lastIndex;return n===0?"'"+r+"'":n<r.length?"'"+i+r.slice(n)+"'":"'"+i+"'"}function Us(r,e,t={}){const n=t.timeZone||"local",i=new Date(r);let a,o,s,l,u,h,c;if(n==="local")a=i.getFullYear(),o=i.getMonth()+1,s=i.getDate(),l=i.getHours(),u=i.getMinutes(),h=i.getSeconds(),c=i.getMilliseconds();else{const d=ah(n);d!==!1&&d!==0&&i.setTime(i.getTime()+d*6e4),a=i.getUTCFullYear(),o=i.getUTCMonth()+1,s=i.getUTCDate(),l=i.getUTCHours(),u=i.getUTCMinutes(),h=i.getUTCSeconds(),c=i.getUTCMilliseconds()}return Re(a,4)+"-"+Re(o,2)+"-"+Re(s,2)+" "+Re(l,2)+":"+Re(u,2)+":"+Re(h,2)+"."+Re(c,3)}function Re(r,e){for(r=r.toString();r.length<e;)r="0"+r;return r}function ah(r){if(r==="Z")return 0;const e=r.match(/([+\-\s])(\d\d):?(\d\d)?/);return e?(e[1]=="-"?-1:1)*(parseInt(e[2],10)+(e[3]?parseInt(e[3],10):0)/60)*60:!1}var Dr={arrayToList:jr,bufferToString:Fs,dateToString:Us,escapeString:Qr,charsRegex:Dt,charsMap:Qs,escapeObject:Ds,makeEscape:oh};function lh(){this.__data__=[],this.size=0}var uh=lh;function ch(r,e){return r===e||r!==r&&e!==e}var Je=ch,hh=Je;function dh(r,e){for(var t=r.length;t--;)if(hh(r[t][0],e))return t;return-1}var Ft=dh,fh=Ft,ph=Array.prototype,mh=ph.splice;function gh(r){var e=this.__data__,t=fh(e,r);if(t<0)return!1;var n=e.length-1;return t==n?e.pop():mh.call(e,t,1),--this.size,!0}var yh=gh,bh=Ft;function _h(r){var e=this.__data__,t=bh(e,r);return t<0?void 0:e[t][1]}var wh=_h,$h=Ft;function Ch(r){return $h(this.__data__,r)>-1}var vh=Ch,Eh=Ft;function Th(r,e){var t=this.__data__,n=Eh(t,r);return n<0?(++this.size,t.push([r,e])):t[n][1]=e,this}var Ah=Th,Oh=uh,Nh=yh,qh=wh,Rh=vh,Sh=Ah;function Ge(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}Ge.prototype.clear=Oh,Ge.prototype.delete=Nh,Ge.prototype.get=qh,Ge.prototype.has=Rh,Ge.prototype.set=Sh;var Ut=Ge,xh=Ut;function Ih(){this.__data__=new xh,this.size=0}var Ph=Ih;function Lh(r){var e=this.__data__,t=e.delete(r);return this.size=e.size,t}var Bh=Lh;function kh(r){return this.__data__.get(r)}var Mh=kh;function jh(r){return this.__data__.has(r)}var Qh=jh,Dh=typeof kt=="object"&&kt&&kt.Object===Object&&kt,Hs=Dh,Fh=Hs,Uh=typeof self=="object"&&self&&self.Object===Object&&self,Hh=Fh||Uh||Function("return this")(),ue=Hh,Vh=ue,Wh=Vh.Symbol,Se=Wh,Vs=Se,Ws=Object.prototype,zh=Ws.hasOwnProperty,Kh=Ws.toString,mt=Vs?Vs.toStringTag:void 0;function Jh(r){var e=zh.call(r,mt),t=r[mt];try{r[mt]=void 0;var n=!0}catch{}var i=Kh.call(r);return n&&(e?r[mt]=t:delete r[mt]),i}var Gh=Jh,Yh=Object.prototype,Xh=Yh.toString;function Zh(r){return Xh.call(r)}var ed=Zh,zs=Se,td=Gh,rd=ed,nd="[object Null]",id="[object Undefined]",Ks=zs?zs.toStringTag:void 0;function sd(r){return r==null?r===void 0?id:nd:Ks&&Ks in Object(r)?td(r):rd(r)}var xe=sd;function od(r){var e=typeof r;return r!=null&&(e=="object"||e=="function")}var ne=od,ad=xe,ld=ne,ud="[object AsyncFunction]",cd="[object Function]",hd="[object GeneratorFunction]",dd="[object Proxy]";function fd(r){if(!ld(r))return!1;var e=ad(r);return e==cd||e==hd||e==ud||e==dd}var Ht=fd,pd=ue,md=pd["__core-js_shared__"],gd=md,Fr=gd,Js=function(){var r=/[^.]+$/.exec(Fr&&Fr.keys&&Fr.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}();function yd(r){return!!Js&&Js in r}var bd=yd,_d=Function.prototype,wd=_d.toString;function $d(r){if(r!=null){try{return wd.call(r)}catch{}try{return r+""}catch{}}return""}var Gs=$d,Cd=Ht,vd=bd,Ed=ne,Td=Gs,Ad=/[\\^$.*+?()[\]{}|]/g,Od=/^\[object .+?Constructor\]$/,Nd=Function.prototype,qd=Object.prototype,Rd=Nd.toString,Sd=qd.hasOwnProperty,xd=RegExp("^"+Rd.call(Sd).replace(Ad,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Id(r){if(!Ed(r)||vd(r))return!1;var e=Cd(r)?xd:Od;return e.test(Td(r))}var Pd=Id;function Ld(r,e){return r==null?void 0:r[e]}var Bd=Ld,kd=Pd,Md=Bd;function jd(r,e){var t=Md(r,e);return kd(t)?t:void 0}var Ie=jd,Qd=Ie,Dd=ue,Fd=Qd(Dd,"Map"),Ur=Fd,Ud=Ie,Hd=Ud(Object,"create"),Vt=Hd,Ys=Vt;function Vd(){this.__data__=Ys?Ys(null):{},this.size=0}var Wd=Vd;function zd(r){var e=this.has(r)&&delete this.__data__[r];return this.size-=e?1:0,e}var Kd=zd,Jd=Vt,Gd="__lodash_hash_undefined__",Yd=Object.prototype,Xd=Yd.hasOwnProperty;function Zd(r){var e=this.__data__;if(Jd){var t=e[r];return t===Gd?void 0:t}return Xd.call(e,r)?e[r]:void 0}var ef=Zd,tf=Vt,rf=Object.prototype,nf=rf.hasOwnProperty;function sf(r){var e=this.__data__;return tf?e[r]!==void 0:nf.call(e,r)}var of=sf,af=Vt,lf="__lodash_hash_undefined__";function uf(r,e){var t=this.__data__;return this.size+=this.has(r)?0:1,t[r]=af&&e===void 0?lf:e,this}var cf=uf,hf=Wd,df=Kd,ff=ef,pf=of,mf=cf;function Ye(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}Ye.prototype.clear=hf,Ye.prototype.delete=df,Ye.prototype.get=ff,Ye.prototype.has=pf,Ye.prototype.set=mf;var gf=Ye,Xs=gf,yf=Ut,bf=Ur;function _f(){this.size=0,this.__data__={hash:new Xs,map:new(bf||yf),string:new Xs}}var wf=_f;function $f(r){var e=typeof r;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?r!=="__proto__":r===null}var Cf=$f,vf=Cf;function Ef(r,e){var t=r.__data__;return vf(e)?t[typeof e=="string"?"string":"hash"]:t.map}var Wt=Ef,Tf=Wt;function Af(r){var e=Tf(this,r).delete(r);return this.size-=e?1:0,e}var Of=Af,Nf=Wt;function qf(r){return Nf(this,r).get(r)}var Rf=qf,Sf=Wt;function xf(r){return Sf(this,r).has(r)}var If=xf,Pf=Wt;function Lf(r,e){var t=Pf(this,r),n=t.size;return t.set(r,e),this.size+=t.size==n?0:1,this}var Bf=Lf,kf=wf,Mf=Of,jf=Rf,Qf=If,Df=Bf;function Xe(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}Xe.prototype.clear=kf,Xe.prototype.delete=Mf,Xe.prototype.get=jf,Xe.prototype.has=Qf,Xe.prototype.set=Df;var Hr=Xe,Ff=Ut,Uf=Ur,Hf=Hr,Vf=200;function Wf(r,e){var t=this.__data__;if(t instanceof Ff){var n=t.__data__;if(!Uf||n.length<Vf-1)return n.push([r,e]),this.size=++t.size,this;t=this.__data__=new Hf(n)}return t.set(r,e),this.size=t.size,this}var zf=Wf,Kf=Ut,Jf=Ph,Gf=Bh,Yf=Mh,Xf=Qh,Zf=zf;function Ze(r){var e=this.__data__=new Kf(r);this.size=e.size}Ze.prototype.clear=Jf,Ze.prototype.delete=Gf,Ze.prototype.get=Yf,Ze.prototype.has=Xf,Ze.prototype.set=Zf;var zt=Ze;function ep(r,e){for(var t=-1,n=r==null?0:r.length;++t<n&&e(r[t],t,r)!==!1;);return r}var Vr=ep,tp=Ie,rp=function(){try{var r=tp(Object,"defineProperty");return r({},"",{}),r}catch{}}(),Zs=rp,eo=Zs;function np(r,e,t){e=="__proto__"&&eo?eo(r,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):r[e]=t}var Kt=np,ip=Kt,sp=Je,op=Object.prototype,ap=op.hasOwnProperty;function lp(r,e,t){var n=r[e];(!(ap.call(r,e)&&sp(n,t))||t===void 0&&!(e in r))&&ip(r,e,t)}var Jt=lp,up=Jt,cp=Kt;function hp(r,e,t,n){var i=!t;t||(t={});for(var a=-1,o=e.length;++a<o;){var s=e[a],l=n?n(t[s],r[s],s,t,r):void 0;l===void 0&&(l=r[s]),i?cp(t,s,l):up(t,s,l)}return t}var Pe=hp;function dp(r,e){for(var t=-1,n=Array(r);++t<r;)n[t]=e(t);return n}var fp=dp;function pp(r){return r!=null&&typeof r=="object"}var ce=pp,mp=xe,gp=ce,yp="[object Arguments]";function bp(r){return gp(r)&&mp(r)==yp}var _p=bp,to=_p,wp=ce,ro=Object.prototype,$p=ro.hasOwnProperty,Cp=ro.propertyIsEnumerable,vp=to(function(){return arguments}())?to:function(r){return wp(r)&&$p.call(r,"callee")&&!Cp.call(r,"callee")},gt=vp,Ep=Array.isArray,F=Ep,Gt={exports:{}};function Tp(){return!1}var Ap=Tp;Gt.exports,function(r,e){var t=ue,n=Ap,i=e&&!e.nodeType&&e,a=i&&!0&&r&&!r.nodeType&&r,o=a&&a.exports===i,s=o?t.Buffer:void 0,l=s?s.isBuffer:void 0,u=l||n;r.exports=u}(Gt,Gt.exports);var et=Gt.exports,Op=9007199254740991,Np=/^(?:0|[1-9]\d*)$/;function qp(r,e){var t=typeof r;return e=e??Op,!!e&&(t=="number"||t!="symbol"&&Np.test(r))&&r>-1&&r%1==0&&r<e}var Yt=qp,Rp=9007199254740991;function Sp(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=Rp}var Wr=Sp,xp=xe,Ip=Wr,Pp=ce,Lp="[object Arguments]",Bp="[object Array]",kp="[object Boolean]",Mp="[object Date]",jp="[object Error]",Qp="[object Function]",Dp="[object Map]",Fp="[object Number]",Up="[object Object]",Hp="[object RegExp]",Vp="[object Set]",Wp="[object String]",zp="[object WeakMap]",Kp="[object ArrayBuffer]",Jp="[object DataView]",Gp="[object Float32Array]",Yp="[object Float64Array]",Xp="[object Int8Array]",Zp="[object Int16Array]",em="[object Int32Array]",tm="[object Uint8Array]",rm="[object Uint8ClampedArray]",nm="[object Uint16Array]",im="[object Uint32Array]",k={};k[Gp]=k[Yp]=k[Xp]=k[Zp]=k[em]=k[tm]=k[rm]=k[nm]=k[im]=!0,k[Lp]=k[Bp]=k[Kp]=k[kp]=k[Jp]=k[Mp]=k[jp]=k[Qp]=k[Dp]=k[Fp]=k[Up]=k[Hp]=k[Vp]=k[Wp]=k[zp]=!1;function sm(r){return Pp(r)&&Ip(r.length)&&!!k[xp(r)]}var om=sm;function am(r){return function(e){return r(e)}}var zr=am,Xt={exports:{}};Xt.exports,function(r,e){var t=Hs,n=e&&!e.nodeType&&e,i=n&&!0&&r&&!r.nodeType&&r,a=i&&i.exports===n,o=a&&t.process,s=function(){try{var l=i&&i.require&&i.require("util").types;return l||o&&o.binding&&o.binding("util")}catch{}}();r.exports=s}(Xt,Xt.exports);var Kr=Xt.exports,lm=om,um=zr,no=Kr,io=no&&no.isTypedArray,cm=io?um(io):lm,tt=cm,hm=fp,dm=gt,fm=F,pm=et,mm=Yt,gm=tt,ym=Object.prototype,bm=ym.hasOwnProperty;function _m(r,e){var t=fm(r),n=!t&&dm(r),i=!t&&!n&&pm(r),a=!t&&!n&&!i&&gm(r),o=t||n||i||a,s=o?hm(r.length,String):[],l=s.length;for(var u in r)(e||bm.call(r,u))&&!(o&&(u=="length"||i&&(u=="offset"||u=="parent")||a&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||mm(u,l)))&&s.push(u);return s}var so=_m,wm=Object.prototype;function $m(r){var e=r&&r.constructor,t=typeof e=="function"&&e.prototype||wm;return r===t}var yt=$m;function Cm(r,e){return function(t){return r(e(t))}}var oo=Cm,vm=oo,Em=vm(Object.keys,Object),Tm=Em,Am=yt,Om=Tm,Nm=Object.prototype,qm=Nm.hasOwnProperty;function Rm(r){if(!Am(r))return Om(r);var e=[];for(var t in Object(r))qm.call(r,t)&&t!="constructor"&&e.push(t);return e}var ao=Rm,Sm=Ht,xm=Wr;function Im(r){return r!=null&&xm(r.length)&&!Sm(r)}var pe=Im,Pm=so,Lm=ao,Bm=pe;function km(r){return Bm(r)?Pm(r):Lm(r)}var Le=km,Mm=Pe,jm=Le;function Qm(r,e){return r&&Mm(e,jm(e),r)}var Dm=Qm;function Fm(r){var e=[];if(r!=null)for(var t in Object(r))e.push(t);return e}var Um=Fm,Hm=ne,Vm=yt,Wm=Um,zm=Object.prototype,Km=zm.hasOwnProperty;function Jm(r){if(!Hm(r))return Wm(r);var e=Vm(r),t=[];for(var n in r)n=="constructor"&&(e||!Km.call(r,n))||t.push(n);return t}var Gm=Jm,Ym=so,Xm=Gm,Zm=pe;function eg(r){return Zm(r)?Ym(r,!0):Xm(r)}var Be=eg,tg=Pe,rg=Be;function ng(r,e){return r&&tg(e,rg(e),r)}var ig=ng,Zt={exports:{}};Zt.exports,function(r,e){var t=ue,n=e&&!e.nodeType&&e,i=n&&!0&&r&&!r.nodeType&&r,a=i&&i.exports===n,o=a?t.Buffer:void 0,s=o?o.allocUnsafe:void 0;function l(u,h){if(h)return u.slice();var c=u.length,d=s?s(c):new u.constructor(c);return u.copy(d),d}r.exports=l}(Zt,Zt.exports);var lo=Zt.exports;function sg(r,e){var t=-1,n=r.length;for(e||(e=Array(n));++t<n;)e[t]=r[t];return e}var Jr=sg;function og(r,e){for(var t=-1,n=r==null?0:r.length,i=0,a=[];++t<n;){var o=r[t];e(o,t,r)&&(a[i++]=o)}return a}var Gr=og;function ag(){return[]}var uo=ag,lg=Gr,ug=uo,cg=Object.prototype,hg=cg.propertyIsEnumerable,co=Object.getOwnPropertySymbols,dg=co?function(r){return r==null?[]:(r=Object(r),lg(co(r),function(e){return hg.call(r,e)}))}:ug,Yr=dg,fg=Pe,pg=Yr;function mg(r,e){return fg(r,pg(r),e)}var gg=mg;function yg(r,e){for(var t=-1,n=e.length,i=r.length;++t<n;)r[i+t]=e[t];return r}var Xr=yg,bg=oo,_g=bg(Object.getPrototypeOf,Object),er=_g,wg=Xr,$g=er,Cg=Yr,vg=uo,Eg=Object.getOwnPropertySymbols,Tg=Eg?function(r){for(var e=[];r;)wg(e,Cg(r)),r=$g(r);return e}:vg,ho=Tg,Ag=Pe,Og=ho;function Ng(r,e){return Ag(r,Og(r),e)}var qg=Ng,Rg=Xr,Sg=F;function xg(r,e,t){var n=e(r);return Sg(r)?n:Rg(n,t(r))}var fo=xg,Ig=fo,Pg=Yr,Lg=Le;function Bg(r){return Ig(r,Lg,Pg)}var po=Bg,kg=fo,Mg=ho,jg=Be;function Qg(r){return kg(r,jg,Mg)}var mo=Qg,Dg=Ie,Fg=ue,Ug=Dg(Fg,"DataView"),Hg=Ug,Vg=Ie,Wg=ue,zg=Vg(Wg,"Promise"),Kg=zg,Jg=Ie,Gg=ue,Yg=Jg(Gg,"Set"),go=Yg,Xg=Ie,Zg=ue,ey=Xg(Zg,"WeakMap"),ty=ey,Zr=Hg,en=Ur,tn=Kg,rn=go,nn=ty,yo=xe,rt=Gs,bo="[object Map]",ry="[object Object]",_o="[object Promise]",wo="[object Set]",$o="[object WeakMap]",Co="[object DataView]",ny=rt(Zr),iy=rt(en),sy=rt(tn),oy=rt(rn),ay=rt(nn),ke=yo;(Zr&&ke(new Zr(new ArrayBuffer(1)))!=Co||en&&ke(new en)!=bo||tn&&ke(tn.resolve())!=_o||rn&&ke(new rn)!=wo||nn&&ke(new nn)!=$o)&&(ke=function(r){var e=yo(r),t=e==ry?r.constructor:void 0,n=t?rt(t):"";if(n)switch(n){case ny:return Co;case iy:return bo;case sy:return _o;case oy:return wo;case ay:return $o}return e});var nt=ke,ly=Object.prototype,uy=ly.hasOwnProperty;function cy(r){var e=r.length,t=new r.constructor(e);return e&&typeof r[0]=="string"&&uy.call(r,"index")&&(t.index=r.index,t.input=r.input),t}var hy=cy,dy=ue,fy=dy.Uint8Array,vo=fy,Eo=vo;function py(r){var e=new r.constructor(r.byteLength);return new Eo(e).set(new Eo(r)),e}var sn=py,my=sn;function gy(r,e){var t=e?my(r.buffer):r.buffer;return new r.constructor(t,r.byteOffset,r.byteLength)}var yy=gy,by=/\w*$/;function _y(r){var e=new r.constructor(r.source,by.exec(r));return e.lastIndex=r.lastIndex,e}var wy=_y,To=Se,Ao=To?To.prototype:void 0,Oo=Ao?Ao.valueOf:void 0;function $y(r){return Oo?Object(Oo.call(r)):{}}var Cy=$y,vy=sn;function Ey(r,e){var t=e?vy(r.buffer):r.buffer;return new r.constructor(t,r.byteOffset,r.length)}var No=Ey,Ty=sn,Ay=yy,Oy=wy,Ny=Cy,qy=No,Ry="[object Boolean]",Sy="[object Date]",xy="[object Map]",Iy="[object Number]",Py="[object RegExp]",Ly="[object Set]",By="[object String]",ky="[object Symbol]",My="[object ArrayBuffer]",jy="[object DataView]",Qy="[object Float32Array]",Dy="[object Float64Array]",Fy="[object Int8Array]",Uy="[object Int16Array]",Hy="[object Int32Array]",Vy="[object Uint8Array]",Wy="[object Uint8ClampedArray]",zy="[object Uint16Array]",Ky="[object Uint32Array]";function Jy(r,e,t){var n=r.constructor;switch(e){case My:return Ty(r);case Ry:case Sy:return new n(+r);case jy:return Ay(r,t);case Qy:case Dy:case Fy:case Uy:case Hy:case Vy:case Wy:case zy:case Ky:return qy(r,t);case xy:return new n;case Iy:case By:return new n(r);case Py:return Oy(r);case Ly:return new n;case ky:return Ny(r)}}var Gy=Jy,Yy=ne,qo=Object.create,Xy=function(){function r(){}return function(e){if(!Yy(e))return{};if(qo)return qo(e);r.prototype=e;var t=new r;return r.prototype=void 0,t}}(),Ro=Xy,Zy=Ro,eb=er,tb=yt;function rb(r){return typeof r.constructor=="function"&&!tb(r)?Zy(eb(r)):{}}var So=rb,nb=nt,ib=ce,sb="[object Map]";function ob(r){return ib(r)&&nb(r)==sb}var ab=ob,lb=ab,ub=zr,xo=Kr,Io=xo&&xo.isMap,cb=Io?ub(Io):lb,hb=cb,db=nt,fb=ce,pb="[object Set]";function mb(r){return fb(r)&&db(r)==pb}var gb=mb,yb=gb,bb=zr,Po=Kr,Lo=Po&&Po.isSet,_b=Lo?bb(Lo):yb,wb=_b,$b=zt,Cb=Vr,vb=Jt,Eb=Dm,Tb=ig,Ab=lo,Ob=Jr,Nb=gg,qb=qg,Rb=po,Sb=mo,xb=nt,Ib=hy,Pb=Gy,Lb=So,Bb=F,kb=et,Mb=hb,jb=ne,Qb=wb,Db=Le,Fb=Be,Ub=1,Hb=2,Vb=4,Bo="[object Arguments]",Wb="[object Array]",zb="[object Boolean]",Kb="[object Date]",Jb="[object Error]",ko="[object Function]",Gb="[object GeneratorFunction]",Yb="[object Map]",Xb="[object Number]",Mo="[object Object]",Zb="[object RegExp]",e_="[object Set]",t_="[object String]",r_="[object Symbol]",n_="[object WeakMap]",i_="[object ArrayBuffer]",s_="[object DataView]",o_="[object Float32Array]",a_="[object Float64Array]",l_="[object Int8Array]",u_="[object Int16Array]",c_="[object Int32Array]",h_="[object Uint8Array]",d_="[object Uint8ClampedArray]",f_="[object Uint16Array]",p_="[object Uint32Array]",B={};B[Bo]=B[Wb]=B[i_]=B[s_]=B[zb]=B[Kb]=B[o_]=B[a_]=B[l_]=B[u_]=B[c_]=B[Yb]=B[Xb]=B[Mo]=B[Zb]=B[e_]=B[t_]=B[r_]=B[h_]=B[d_]=B[f_]=B[p_]=!0,B[Jb]=B[ko]=B[n_]=!1;function tr(r,e,t,n,i,a){var o,s=e&Ub,l=e&Hb,u=e&Vb;if(t&&(o=i?t(r,n,i,a):t(r)),o!==void 0)return o;if(!jb(r))return r;var h=Bb(r);if(h){if(o=Ib(r),!s)return Ob(r,o)}else{var c=xb(r),d=c==ko||c==Gb;if(kb(r))return Ab(r,s);if(c==Mo||c==Bo||d&&!i){if(o=l||d?{}:Lb(r),!s)return l?qb(r,Tb(o,r)):Nb(r,Eb(o,r))}else{if(!B[c])return i?r:{};o=Pb(r,c,s)}}a||(a=new $b);var p=a.get(r);if(p)return p;a.set(r,o),Qb(r)?r.forEach(function(f){o.add(tr(f,e,t,f,r,a))}):Mb(r)&&r.forEach(function(f,m){o.set(m,tr(f,e,t,m,r,a))});var g=u?l?Sb:Rb:l?Fb:Db,_=h?void 0:g(r);return Cb(_||r,function(f,m){_&&(m=f,f=r[m]),vb(o,m,tr(f,e,t,m,r,a))}),o}var jo=tr,m_=jo,g_=1,y_=4;function b_(r){return m_(r,g_|y_)}var __=b_;function w_(r){return r}var ie=w_;function $_(r,e,t){switch(t.length){case 0:return r.call(e);case 1:return r.call(e,t[0]);case 2:return r.call(e,t[0],t[1]);case 3:return r.call(e,t[0],t[1],t[2])}return r.apply(e,t)}var C_=$_,v_=C_,Qo=Math.max;function E_(r,e,t){return e=Qo(e===void 0?r.length-1:e,0),function(){for(var n=arguments,i=-1,a=Qo(n.length-e,0),o=Array(a);++i<a;)o[i]=n[e+i];i=-1;for(var s=Array(e+1);++i<e;)s[i]=n[i];return s[e]=t(o),v_(r,this,s)}}var T_=E_;function A_(r){return function(){return r}}var Do=A_,O_=Do,Fo=Zs,N_=ie,q_=Fo?function(r,e){return Fo(r,"toString",{configurable:!0,enumerable:!1,value:O_(e),writable:!0})}:N_,R_=q_,S_=800,x_=16,I_=Date.now;function P_(r){var e=0,t=0;return function(){var n=I_(),i=x_-(n-t);if(t=n,i>0){if(++e>=S_)return arguments[0]}else e=0;return r.apply(void 0,arguments)}}var L_=P_,B_=R_,k_=L_,M_=k_(B_),j_=M_,Q_=ie,D_=T_,F_=j_;function U_(r,e){return F_(D_(r,e,Q_),r+"")}var on=U_,H_=Je,V_=pe,W_=Yt,z_=ne;function K_(r,e,t){if(!z_(t))return!1;var n=typeof e;return(n=="number"?V_(t)&&W_(e,t.length):n=="string"&&e in t)?H_(t[e],r):!1}var rr=K_,J_=on,G_=Je,Y_=rr,X_=Be,Uo=Object.prototype,Z_=Uo.hasOwnProperty,ew=J_(function(r,e){r=Object(r);var t=-1,n=e.length,i=n>2?e[2]:void 0;for(i&&Y_(e[0],e[1],i)&&(n=1);++t<n;)for(var a=e[t],o=X_(a),s=-1,l=o.length;++s<l;){var u=o[s],h=r[u];(h===void 0||G_(h,Uo[u])&&!Z_.call(r,u))&&(r[u]=a[u])}return r}),Ho=ew;function tw(r,e){for(var t=-1,n=r==null?0:r.length,i=Array(n);++t<n;)i[t]=e(r[t],t,r);return i}var nr=tw,rw=xe,nw=ce,iw="[object Symbol]";function sw(r){return typeof r=="symbol"||nw(r)&&rw(r)==iw}var ir=sw,Vo=Se,ow=nr,aw=F,lw=ir,uw=1/0,Wo=Vo?Vo.prototype:void 0,zo=Wo?Wo.toString:void 0;function Ko(r){if(typeof r=="string")return r;if(aw(r))return ow(r,Ko)+"";if(lw(r))return zo?zo.call(r):"";var e=r+"";return e=="0"&&1/r==-uw?"-0":e}var cw=Ko,hw=cw;function dw(r){return r==null?"":hw(r)}var Jo=dw,fw=Jo,pw=0;function mw(r){var e=++pw;return fw(r)+e}var Go=mw,we={};let Yo=class extends Error{constructor(e){super(e),this.name="KnexTimeoutError"}};function gw(r,e){return new Promise(function(t,n){const i=setTimeout(function(){n(new Yo("operation timed out"))},e);function a(s){clearTimeout(i),t(s)}function o(s){clearTimeout(i),n(s)}r.then(a,o)})}we.KnexTimeoutError=Yo,we.timeout=gw;function yw(r){r.client.emit("start",r.builder),r.builder.emit("start",r.builder);const e=r.builder.toSQL();return r.builder._debug&&r.client.logger.debug(e),Array.isArray(e)?r.queryArray(e):r.query(e)}function bw(r,e){try{const t=r.builder.toSQL();if(Array.isArray(t)&&e.hasHandler)throw new Error("The stream may only be used with a single query statement.");return r.client.stream(r.connection,t,e.stream,e.options)}catch(t){throw e.stream.emit("error",t),t}}var _w={ensureConnectionCallback:yw,ensureConnectionStreamCallback:bw};const{KnexTimeoutError:Xo}=we,{timeout:ww}=we,{ensureConnectionCallback:$w,ensureConnectionStreamCallback:Cw}=_w;let an;var vw=class jc{constructor(e,t){this.client=e,this.builder=t,this.queries=[],this.connection=void 0}async run(){const e=this;try{const t=await this.ensureConnection($w);return e.builder.emit("end"),t}catch(t){throw e.builder._events&&e.builder._events.error&&e.builder.emit("error",t),t}}stream(e,t){const n=typeof e=="function"&&arguments.length===1,i=n?{}:e,a=n?e:t,o=typeof a=="function";an=an||I.Transform;const s=this.builder.queryContext(),l=new an({objectMode:!0,transform:(h,c,d)=>{d(null,this.client.postProcessResponse(h,s))}});l.on("close",()=>{this.client.releaseConnection(this.connection)});const u=this.ensureConnection(Cw,{options:i,hasHandler:o,stream:l}).catch(h=>{this.connection||l.emit("error",h)});return o?(a(l),u):l}pipe(e,t){return this.stream(t).pipe(e)}async query(e){const{__knexUid:t,__knexTxId:n}=this.connection;this.builder.emit("query",Object.assign({__knexUid:t,__knexTxId:n},e));const i=this,a=this.builder.queryContext();e!==null&&typeof e=="object"&&(e.queryContext=a);let o=this.client.query(this.connection,e);return e.timeout&&(o=ww(o,e.timeout)),o.then(s=>this.client.processResponse(s,i)).then(s=>{const l=this.client.postProcessResponse(s,a);return this.builder.emit("query-response",l,Object.assign({__knexUid:t,__knexTxId:n},e),this.builder),this.client.emit("query-response",l,Object.assign({__knexUid:t,__knexTxId:n},e),this.builder),l}).catch(s=>{if(!(s instanceof Xo))return Promise.reject(s);const{timeout:l,sql:u,bindings:h}=e;let c;return e.cancelOnTimeout?c=this.client.cancelQuery(this.connection):(this.connection.__knex__disposed=s,c=Promise.resolve()),c.catch(d=>{throw this.connection.__knex__disposed=s,Object.assign(d,{message:`After query timeout of ${l}ms exceeded, cancelling of query failed.`,sql:u,bindings:h,timeout:l})}).then(()=>{throw Object.assign(s,{message:`Defined query timeout of ${l}ms exceeded when running query.`,sql:u,bindings:h,timeout:l})})}).catch(s=>{throw this.builder.emit("query-error",s,Object.assign({__knexUid:t,__knexTxId:n,queryContext:a},e)),s})}async queryArray(e){if(e.length===1){const n=e[0];if(!n.statementsProducer)return this.query(n);const i=await n.statementsProducer(void 0,this.connection),a=i.sql.map(u=>({sql:u,bindings:n.bindings})),o=i.pre.map(u=>({sql:u,bindings:n.bindings})),s=i.post.map(u=>({sql:u,bindings:n.bindings}));let l=[];await this.queryArray(o);try{await this.client.transaction(async u=>{const h=new jc(u.client,this.builder);if(h.connection=this.connection,l=await h.queryArray(a),i.check&&(await u.raw(i.check)).length>0)throw new Error("FOREIGN KEY constraint failed")},{connection:this.connection})}finally{await this.queryArray(s)}return l}const t=[];for(const n of e)t.push(await this.queryArray([n]));return t}async ensureConnection(e,t){if(this.builder._connection&&(this.connection=this.builder._connection),this.connection)return e(this,t);let n;try{n=await this.client.acquireConnection()}catch(i){if(!(i instanceof Xo))return Promise.reject(i);throw this.builder&&(i.sql=this.builder.sql,i.bindings=this.builder.bindings),i}try{return this.connection=n,await e(this,t)}finally{await this.client.releaseConnection(n)}}},ln={exports:{}},un,Zo;function Ew(){if(Zo)return un;Zo=1;var r=1e3,e=r*60,t=e*60,n=t*24,i=n*7,a=n*365.25;un=function(h,c){c=c||{};var d=typeof h;if(d==="string"&&h.length>0)return o(h);if(d==="number"&&isFinite(h))return c.long?l(h):s(h);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(h))};function o(h){if(h=String(h),!(h.length>100)){var c=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(h);if(c){var d=parseFloat(c[1]),p=(c[2]||"ms").toLowerCase();switch(p){case"years":case"year":case"yrs":case"yr":case"y":return d*a;case"weeks":case"week":case"w":return d*i;case"days":case"day":case"d":return d*n;case"hours":case"hour":case"hrs":case"hr":case"h":return d*t;case"minutes":case"minute":case"mins":case"min":case"m":return d*e;case"seconds":case"second":case"secs":case"sec":case"s":return d*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return d;default:return}}}}function s(h){var c=Math.abs(h);return c>=n?Math.round(h/n)+"d":c>=t?Math.round(h/t)+"h":c>=e?Math.round(h/e)+"m":c>=r?Math.round(h/r)+"s":h+"ms"}function l(h){var c=Math.abs(h);return c>=n?u(h,c,n,"day"):c>=t?u(h,c,t,"hour"):c>=e?u(h,c,e,"minute"):c>=r?u(h,c,r,"second"):h+" ms"}function u(h,c,d,p){var g=c>=d*1.5;return Math.round(h/d)+" "+p+(g?"s":"")}return un}function Tw(r){t.debug=t,t.default=t,t.coerce=l,t.disable=a,t.enable=i,t.enabled=o,t.humanize=Ew(),t.destroy=u,Object.keys(r).forEach(h=>{t[h]=r[h]}),t.names=[],t.skips=[],t.formatters={};function e(h){let c=0;for(let d=0;d<h.length;d++)c=(c<<5)-c+h.charCodeAt(d),c|=0;return t.colors[Math.abs(c)%t.colors.length]}t.selectColor=e;function t(h){let c,d=null,p,g;function _(...f){if(!_.enabled)return;const m=_,y=Number(new Date),w=y-(c||y);m.diff=w,m.prev=c,m.curr=y,c=y,f[0]=t.coerce(f[0]),typeof f[0]!="string"&&f.unshift("%O");let $=0;f[0]=f[0].replace(/%([a-zA-Z%])/g,(C,T)=>{if(C==="%%")return"%";$++;const N=t.formatters[T];if(typeof N=="function"){const P=f[$];C=N.call(m,P),f.splice($,1),$--}return C}),t.formatArgs.call(m,f),(m.log||t.log).apply(m,f)}return _.namespace=h,_.useColors=t.useColors(),_.color=t.selectColor(h),_.extend=n,_.destroy=t.destroy,Object.defineProperty(_,"enabled",{enumerable:!0,configurable:!1,get:()=>d!==null?d:(p!==t.namespaces&&(p=t.namespaces,g=t.enabled(h)),g),set:f=>{d=f}}),typeof t.init=="function"&&t.init(_),_}function n(h,c){const d=t(this.namespace+(typeof c>"u"?":":c)+h);return d.log=this.log,d}function i(h){t.save(h),t.namespaces=h,t.names=[],t.skips=[];let c;const d=(typeof h=="string"?h:"").split(/[\s,]+/),p=d.length;for(c=0;c<p;c++)d[c]&&(h=d[c].replace(/\*/g,".*?"),h[0]==="-"?t.skips.push(new RegExp("^"+h.slice(1)+"$")):t.names.push(new RegExp("^"+h+"$")))}function a(){const h=[...t.names.map(s),...t.skips.map(s).map(c=>"-"+c)].join(",");return t.enable(""),h}function o(h){if(h[h.length-1]==="*")return!0;let c,d;for(c=0,d=t.skips.length;c<d;c++)if(t.skips[c].test(h))return!1;for(c=0,d=t.names.length;c<d;c++)if(t.names[c].test(h))return!0;return!1}function s(h){return h.toString().substring(2,h.toString().length-2).replace(/\.\*\?$/,"*")}function l(h){return h instanceof Error?h.stack||h.message:h}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}var Aw=Tw;(function(r,e){e.formatArgs=n,e.save=i,e.load=a,e.useColors=t,e.storage=o(),e.destroy=(()=>{let l=!1;return()=>{l||(l=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function n(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+r.exports.humanize(this.diff),!this.useColors)return;const u="color: "+this.color;l.splice(1,0,u,"color: inherit");let h=0,c=0;l[0].replace(/%[a-zA-Z%]/g,d=>{d!=="%%"&&(h++,d==="%c"&&(c=h))}),l.splice(c,0,u)}e.log=console.debug||console.log||(()=>{});function i(l){try{l?e.storage.setItem("debug",l):e.storage.removeItem("debug")}catch{}}function a(){let l;try{l=e.storage.getItem("debug")}catch{}return!l&&typeof process<"u"&&"env"in process&&(l=process.env.DEBUG),l}function o(){try{return localStorage}catch{}}r.exports=Aw(e);const{formatters:s}=r.exports;s.j=function(l){try{return JSON.stringify(l)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}}})(ln,ln.exports);var ae=ln.exports,sr=function(){},Ow=class{constructor(e){this.client=e}now(e){return typeof e=="number"?this.client.raw(`CURRENT_TIMESTAMP(${e})`):this.client.raw("CURRENT_TIMESTAMP")}uuidToBin(e,t=!0){const n=Buffer.from(e.replace(/-/g,""),"hex");return t?Buffer.concat([n.slice(6,8),n.slice(4,6),n.slice(0,4),n.slice(8,16)]):Buffer.concat([n.slice(0,4),n.slice(4,6),n.slice(6,8),n.slice(8,16)])}binToUuid(e,t=!0){const n=Buffer.from(e,"hex");return t?[n.toString("hex",4,8),n.toString("hex",2,4),n.toString("hex",0,2),n.toString("hex",8,10),n.toString("hex",10,16)].join("-"):[n.toString("hex",0,4),n.toString("hex",4,6),n.toString("hex",6,8),n.toString("hex",8,10),n.toString("hex",10,16)].join("-")}},ea=["with","withRecursive","withMaterialized","withNotMaterialized","select","as","columns","column","from","fromJS","fromRaw","into","withSchema","table","distinct","join","joinRaw","innerJoin","leftJoin","leftOuterJoin","rightJoin","rightOuterJoin","outerJoin","fullOuterJoin","crossJoin","where","andWhere","orWhere","whereNot","orWhereNot","whereLike","andWhereLike","orWhereLike","whereILike","andWhereILike","orWhereILike","whereRaw","whereWrapped","havingWrapped","orWhereRaw","whereExists","orWhereExists","whereNotExists","orWhereNotExists","whereIn","orWhereIn","whereNotIn","orWhereNotIn","whereNull","orWhereNull","whereNotNull","orWhereNotNull","whereBetween","whereNotBetween","andWhereBetween","andWhereNotBetween","orWhereBetween","orWhereNotBetween","groupBy","groupByRaw","orderBy","orderByRaw","union","unionAll","intersect","having","havingRaw","orHaving","orHavingRaw","offset","limit","count","countDistinct","min","max","sum","sumDistinct","avg","avgDistinct","increment","decrement","first","debug","pluck","clearSelect","clearWhere","clearGroup","clearOrder","clearHaving","insert","update","returning","del","delete","truncate","transacting","connection","jsonExtract","jsonSet","jsonInsert","jsonRemove","whereJsonObject","orWhereJsonObject","andWhereJsonObject","whereNotJsonObject","orWhereNotJsonObject","andWhereNotJsonObject","whereJsonPath","orWhereJsonPath","andWhereJsonPath","whereJsonSupersetOf","orWhereJsonSupersetOf","andWhereJsonSupersetOf","whereJsonNotSupersetOf","orWhereJsonNotSupersetOf","andWhereJsonNotSupersetOf","whereJsonSubsetOf","orWhereJsonSubsetOf","andWhereJsonSubsetOf","whereJsonNotSubsetOf","orWhereJsonNotSubsetOf","andWhereJsonNotSubsetOf"],Nw=Kt,qw=Je;function Rw(r,e,t){(t!==void 0&&!qw(r[e],t)||t===void 0&&!(e in r))&&Nw(r,e,t)}var ta=Rw;function Sw(r){return function(e,t,n){for(var i=-1,a=Object(e),o=n(e),s=o.length;s--;){var l=o[r?s:++i];if(t(a[l],l,a)===!1)break}return e}}var xw=Sw,Iw=xw,Pw=Iw(),ra=Pw,Lw=pe,Bw=ce;function kw(r){return Bw(r)&&Lw(r)}var Mw=kw,jw=xe,Qw=er,Dw=ce,Fw="[object Object]",Uw=Function.prototype,Hw=Object.prototype,na=Uw.toString,Vw=Hw.hasOwnProperty,Ww=na.call(Object);function zw(r){if(!Dw(r)||jw(r)!=Fw)return!1;var e=Qw(r);if(e===null)return!0;var t=Vw.call(e,"constructor")&&e.constructor;return typeof t=="function"&&t instanceof t&&na.call(t)==Ww}var $e=zw;function Kw(r,e){if(!(e==="constructor"&&typeof r[e]=="function")&&e!="__proto__")return r[e]}var ia=Kw,Jw=Pe,Gw=Be;function Yw(r){return Jw(r,Gw(r))}var Xw=Yw,sa=ta,Zw=lo,e$=No,t$=Jr,r$=So,oa=gt,aa=F,n$=Mw,i$=et,s$=Ht,o$=ne,a$=$e,l$=tt,la=ia,u$=Xw;function c$(r,e,t,n,i,a,o){var s=la(r,t),l=la(e,t),u=o.get(l);if(u){sa(r,t,u);return}var h=a?a(s,l,t+"",r,e,o):void 0,c=h===void 0;if(c){var d=aa(l),p=!d&&i$(l),g=!d&&!p&&l$(l);h=l,d||p||g?aa(s)?h=s:n$(s)?h=t$(s):p?(c=!1,h=Zw(l,!0)):g?(c=!1,h=e$(l,!0)):h=[]:a$(l)||oa(l)?(h=s,oa(s)?h=u$(s):(!o$(s)||s$(s))&&(h=r$(l))):c=!1}c&&(o.set(l,h),i(h,l,n,a,o),o.delete(l)),sa(r,t,h)}var h$=c$,d$=zt,f$=ta,p$=ra,m$=h$,g$=ne,y$=Be,b$=ia;function ua(r,e,t,n,i){r!==e&&p$(e,function(a,o){if(i||(i=new d$),g$(a))m$(r,e,o,t,ua,n,i);else{var s=n?n(b$(r,o),a,o+"",r,e,i):void 0;s===void 0&&(s=a),f$(r,o,s)}},y$)}var _$=ua,w$=on,$$=rr;function C$(r){return w$(function(e,t){var n=-1,i=t.length,a=i>1?t[i-1]:void 0,o=i>2?t[2]:void 0;for(a=r.length>3&&typeof a=="function"?(i--,a):void 0,o&&$$(t[0],t[1],o)&&(a=i<3?void 0:a,i=1),e=Object(e);++n<i;){var s=t[n];s&&r(e,s,n,a)}return e})}var cn=C$,v$=_$,E$=cn,T$=E$(function(r,e,t){v$(r,e,t)}),A$=T$;function O$(r,e,t){var n=-1,i=r.length;e<0&&(e=-e>i?0:i+e),t=t>i?i:t,t<0&&(t+=i),i=e>t?0:t-e>>>0,e>>>=0;for(var a=Array(i);++n<i;)a[n]=r[n+e];return a}var ca=O$,N$=/\s/;function q$(r){for(var e=r.length;e--&&N$.test(r.charAt(e)););return e}var R$=q$,S$=R$,x$=/^\s+/;function I$(r){return r&&r.slice(0,S$(r)+1).replace(x$,"")}var P$=I$,L$=P$,ha=ne,B$=ir,da=0/0,k$=/^[-+]0x[0-9a-f]+$/i,M$=/^0b[01]+$/i,j$=/^0o[0-7]+$/i,Q$=parseInt;function D$(r){if(typeof r=="number")return r;if(B$(r))return da;if(ha(r)){var e=typeof r.valueOf=="function"?r.valueOf():r;r=ha(e)?e+"":e}if(typeof r!="string")return r===0?r:+r;r=L$(r);var t=M$.test(r);return t||j$.test(r)?Q$(r.slice(2),t?2:8):k$.test(r)?da:+r}var F$=D$,U$=F$,fa=1/0,H$=17976931348623157e292;function V$(r){if(!r)return r===0?r:0;if(r=U$(r),r===fa||r===-fa){var e=r<0?-1:1;return e*H$}return r===r?r:0}var W$=V$,z$=W$;function K$(r){var e=z$(r),t=e%1;return e===e?t?e-t:e:0}var pa=K$,J$=ca,G$=rr,Y$=pa,X$=Math.ceil,Z$=Math.max;function eC(r,e,t){(t?G$(r,e,t):e===void 0)?e=1:e=Z$(Y$(e),0);var n=r==null?0:r.length;if(!n||e<1)return[];for(var i=0,a=0,o=Array(X$(n/e));i<n;)o[a++]=J$(r,i,i+=e);return o}var tC=eC,ma=Se,rC=gt,nC=F,ga=ma?ma.isConcatSpreadable:void 0;function iC(r){return nC(r)||rC(r)||!!(ga&&r&&r[ga])}var sC=iC,oC=Xr,aC=sC;function ya(r,e,t,n,i){var a=-1,o=r.length;for(t||(t=aC),i||(i=[]);++a<o;){var s=r[a];e>0&&t(s)?e>1?ya(s,e-1,t,n,i):oC(i,s):n||(i[i.length]=s)}return i}var lC=ya,uC=lC;function cC(r){var e=r==null?0:r.length;return e?uC(r,1):[]}var ba=cC,hC=r=>new Promise(e=>setTimeout(e,r));function dC(r){return typeof r=="string"}function fC(r){return typeof r=="number"}function pC(r){return typeof r=="boolean"}function mC(r){return typeof r>"u"}function gC(r){return typeof r=="object"&&r!==null}function yC(r){return typeof r=="function"}var M={isString:dC,isNumber:fC,isBoolean:pC,isUndefined:mC,isObject:gC,isFunction:yC};const bC=tC,_C=ba,wC=hC,{isNumber:$C}=M;function CC(r,e,t,n=1e3){let i,a=null;if(!$C(n)||n<1)throw new TypeError(`Invalid chunkSize: ${n}`);if(!Array.isArray(t))throw new TypeError(`Invalid batch: Expected array, got ${typeof t}`);const o=bC(t,n),s=l=>a?l(a):r.transaction(l);return Object.assign(Promise.resolve().then(async()=>(await wC(1),s(async l=>{const u=[];for(const h of o)u.push(await l(e).insert(h,i));return _C(u)}))),{returning(l){return i=l,this},transacting(l){return a=l,this}})}var vC=CC;const{EventEmitter:EC}=I,{Migrator:TC}=sr,AC=sr,OC=Ow,_a=ea,NC=A$,qC=vC,{isObject:RC}=M,wa={client:{get(){return this.context.client},set(r){this.context.client=r},configurable:!0},userParams:{get(){return this.context.userParams},set(r){this.context.userParams=r},configurable:!0},schema:{get(){return this.client.schemaBuilder()},configurable:!0},migrate:{get(){return new TC(this)},configurable:!0},seed:{get(){return new AC},configurable:!0},fn:{get(){return new OC(this.client)},configurable:!0}},SC=["raw","batchInsert","transaction","transactionProvider","initialize","destroy","ref","withUserParams","queryBuilder","disableProcessing","enableProcessing"];for(const r of SC)wa[r]={value:function(...e){return this.context[r](...e)},configurable:!0};function xC(r){function e(t,n){return Ca(e.context,t,n)}return $a(e,r),e}function IC(r){const e=r.context||{};Object.assign(e,{queryBuilder(){return this.client.queryBuilder()},raw(){return this.client.raw.apply(this.client,arguments)},batchInsert(t,n,i=1e3){return qC(this,t,n,i)},transaction(t,n){!n&&RC(t)&&(n=t,t=null);const i=Object.assign({},n);return i.userParams=this.userParams||{},i.doNotRejectOnRollback===void 0&&(i.doNotRejectOnRollback=!0),this._transaction(t,i)},_transaction(t,n,i=null){return t?this.client.transaction(t,n,i):new Promise((a,o)=>{this.client.transaction(a,n,i).catch(o)})},transactionProvider(t){let n;return()=>(n||(n=this.transaction(void 0,t)),n)},initialize(t){return this.client.initializePool(t)},destroy(t){return this.client.destroy(t)},ref(t){return this.client.ref(t)},disableProcessing(){this.userParams.isProcessingDisabled||(this.userParams.wrapIdentifier=this.client.config.wrapIdentifier,this.userParams.postProcessResponse=this.client.config.postProcessResponse,this.client.config.wrapIdentifier=null,this.client.config.postProcessResponse=null,this.userParams.isProcessingDisabled=!0)},enableProcessing(){this.userParams.isProcessingDisabled&&(this.client.config.wrapIdentifier=this.userParams.wrapIdentifier,this.client.config.postProcessResponse=this.userParams.postProcessResponse,this.userParams.isProcessingDisabled=!1)},withUserParams(t){const n=PC(r);return this.client&&(n.client=Object.create(this.client.constructor.prototype),NC(n.client,this.client),n.client.config=Object.assign({},this.client.config)),$a(n,n.client),or("query",r,n),or("query-error",r,n),or("query-response",r,n),or("start",r,n),n.userParams=t,n}}),r.context||(r.context=e)}function or(r,e,t){e.listeners(r).forEach(i=>{t.on(r,i)})}function $a(r,e){for(let n=0;n<_a.length;n++){const i=_a[n];r[i]=function(){const a=this.queryBuilder();return a[i].apply(a,arguments)}}Object.defineProperties(r,wa),IC(r),r.client=e,r.userParams={};const t=new EC;for(const n in t)r[n]=t[n];r._internalListeners&&r._internalListeners.forEach(({eventName:n,listener:i})=>{r.client.removeListener(n,i)}),r._internalListeners=[],ar(r,"start",n=>{r.emit("start",n)}),ar(r,"query",n=>{r.emit("query",n)}),ar(r,"query-error",(n,i)=>{r.emit("query-error",n,i)}),ar(r,"query-response",(n,i,a)=>{r.emit("query-response",n,i,a)})}function ar(r,e,t){r.client.on(e,t),r._internalListeners.push({eventName:e,listener:t})}function Ca(r,e,t){const n=r.queryBuilder();return e||r.client.logger.warn("calling knex without a tableName is deprecated. Use knex.queryBuilder() instead."),e?n.table(e,t):n}function PC(r){const e=Object.create(Object.getPrototypeOf(r),Object.getOwnPropertyDescriptors(r)),t={},i=((a,o)=>Ca(t,a,o)).bind(e);return Object.assign(i,r),i.context=t,i}var va=xC;const LC=sr,BC=r=>Object.assign(r,{finally(e){return this.then().finally(e)}});var Ea=Promise.prototype.finally?BC:LC;const{EventEmitter:kC}=I,MC=ae,jC=Go,{callbackify:QC}=I,DC=va,{timeout:Ta,KnexTimeoutError:Aa}=we,FC=Ea,bt=MC("knex:tx");function UC(){return{userParams:{},doNotRejectOnRollback:!0}}const Oa=["read uncommitted","read committed","snapshot","repeatable read","serializable"];let Na=class extends kC{constructor(e,t,n=UC(),i=null){super(),this.userParams=n.userParams,this.doNotRejectOnRollback=n.doNotRejectOnRollback;const a=this.txid=jC("trx");this.client=e,this.logger=e.logger,this.outerTx=i,this.trxClient=void 0,this._completed=!1,this._debug=e.config&&e.config.debug,n.isolationLevel&&this.setIsolationLevel(n.isolationLevel),bt("%s: Starting %s transaction",a,i?"nested":"top level"),this._lastChild=Promise.resolve();const s=(i?i._lastChild:Promise.resolve()).then(()=>this._evaluateContainer(n,t));this._promise=s.then(l=>l),i&&(i._lastChild=s.catch(()=>{}))}isCompleted(){return this._completed||this.outerTx&&this.outerTx.isCompleted()||!1}begin(e){return(this.isolationLevel?this.query(e,`SET TRANSACTION ISOLATION LEVEL ${this.isolationLevel};`):Promise.resolve()).then(()=>this.query(e,"BEGIN;"))}savepoint(e){return this.query(e,`SAVEPOINT ${this.txid};`)}commit(e,t){return this.query(e,"COMMIT;",1,t)}release(e,t){return this.query(e,`RELEASE SAVEPOINT ${this.txid};`,1,t)}setIsolationLevel(e){if(!Oa.includes(e))throw new Error(`Invalid isolationLevel, supported isolation levels are: ${JSON.stringify(Oa)}`);return this.isolationLevel=e,this}rollback(e,t){return Ta(this.query(e,"ROLLBACK",2,t),5e3).catch(n=>{if(!(n instanceof Aa))return Promise.reject(n);this._rejecter(t)})}rollbackTo(e,t){return Ta(this.query(e,`ROLLBACK TO SAVEPOINT ${this.txid}`,2,t),5e3).catch(n=>{if(!(n instanceof Aa))return Promise.reject(n);this._rejecter(t)})}query(e,t,n,i){const a=this.trxClient.query(e,t).catch(o=>{n=2,i=o,this._completed=!0,bt("%s error running transaction query",this.txid)}).then(o=>{if(n===1&&this._resolver(i),n===2){if(i===void 0){if(this.doNotRejectOnRollback&&/^ROLLBACK\b/i.test(t)){this._resolver();return}i=new Error(`Transaction rejected with non-error: ${i}`)}this._rejecter(i)}return o});return(n===1||n===2)&&(this._completed=!0),a}debug(e){return this._debug=arguments.length?e:!0,this}async _evaluateContainer(e,t){return this.acquireConnection(e,n=>{const i=this.trxClient=VC(this,this.client,n),a=this.client.transacting?this.savepoint(n):this.begin(n),o=new Promise((s,l)=>{this._resolver=s,this._rejecter=l});return a.then(()=>HC(this,n,i)).then(s=>{s.executionPromise=o;let l;try{l=t(s)}catch(u){l=Promise.reject(u)}return l&&l.then&&typeof l.then=="function"&&l.then(u=>s.commit(u)).catch(u=>s.rollback(u)),null}).catch(s=>this._rejecter(s)),o})}async acquireConnection(e,t){const n=e&&e.connection,i=n||await this.client.acquireConnection();try{return i.__knexTxId=this.txid,await t(i)}finally{n?bt("%s: not releasing external connection",this.txid):(bt("%s: releasing connection",this.txid),this.client.releaseConnection(i))}}then(e,t){return this._promise.then(e,t)}catch(...e){return this._promise.catch(...e)}asCallback(e){return QC(()=>this._promise)(e),this._promise}};FC(Na.prototype);function HC(r,e,t){const n=DC(t);return n.context.withUserParams=()=>{throw new Error("Cannot set user params on a transaction - it can only inherit params from main knex instance")},n.isTransaction=!0,n.userParams=r.userParams||{},n.context.transaction=function(i,a){return a?a.doNotRejectOnRollback===void 0&&(a.doNotRejectOnRollback=!0):a={doNotRejectOnRollback:!0},this._transaction(i,a,r)},n.savepoint=function(i,a){return n.transaction(i,a)},r.client.transacting?(n.commit=i=>r.release(e,i),n.rollback=i=>r.rollbackTo(e,i)):(n.commit=i=>r.commit(e,i),n.rollback=i=>r.rollback(e,i)),n.isCompleted=()=>r.isCompleted(),n}function VC(r,e,t){const n=Object.create(e.constructor.prototype);n.version=e.version,n.config=e.config,n.driver=e.driver,n.connectionSettings=e.connectionSettings,n.transacting=!0,n.valueForUndefined=e.valueForUndefined,n.logger=e.logger,n.on("start",function(o){r.emit("start",o),e.emit("start",o)}),n.on("query",function(o){r.emit("query",o),e.emit("query",o)}),n.on("query-error",function(o,s){r.emit("query-error",o,s),e.emit("query-error",o,s)}),n.on("query-response",function(o,s,l){r.emit("query-response",o,s,l),e.emit("query-response",o,s,l)});const i=n.query;n.query=function(o,s){const l=r.isCompleted();return new Promise(function(u,h){try{if(o!==t)throw new Error("Invalid connection for transaction query.");l&&qa(r,s),u(i.call(n,o,s))}catch(c){h(c)}})};const a=n.stream;return n.stream=function(o,s,l,u){const h=r.isCompleted();return new Promise(function(c,d){try{if(o!==t)throw new Error("Invalid connection for transaction query.");h&&qa(r,s),c(a.call(n,o,s,l,u))}catch(p){d(p)}})},n.acquireConnection=function(){return Promise.resolve(t)},n.releaseConnection=function(){return Promise.resolve()},n}function qa(r,e){const t=typeof e=="string"?e:e&&e.sql;throw bt("%s: Transaction completed: %s",r.txid,t),new Error("Transaction query already complete, run with DEBUG=knex:tx for more info")}var Ce=Na;const WC=ae("knex:query"),zC=ae("knex:bindings"),KC=(r,e)=>WC(r.replace(/%/g,"%%"),e),{isString:JC}=M;function Ra(r,e,t,n){e=e==null?[]:[].concat(e);let i=0;return r.replace(/\\?\?/g,a=>{if(a==="\\?")return"?";if(i===e.length)return a;const o=e[i++];return n._escapeBinding(o,{timeZone:t})})}function GC(r,e,t){const n=JC(e)?{sql:e}:e;n.bindings=t.prepBindings(n.bindings),n.sql=t.positionBindings(n.sql);const{__knexUid:i,__knexTxId:a}=r;return t.emit("query",Object.assign({__knexUid:i,__knexTxId:a},n)),KC(n.sql,a),zC(n.bindings,a),n}function YC(r,e,t){return t._query(r,e).catch(n=>{throw t.config&&t.config.compileSqlOnError===!1?n.message=e.sql+" - "+n.message:n.message=Ra(e.sql,e.bindings,void 0,t)+" - "+n.message,t.emit("query-error",n,Object.assign({__knexUid:r.__knexUid,__knexTxId:r.__knexUid},e)),n})}var Sa={enrichQueryObject:GC,executeQuery:YC,formatQuery:Ra},XC=Jt,ZC=Pe,ev=cn,tv=pe,rv=yt,nv=Le,iv=Object.prototype,sv=iv.hasOwnProperty,ov=ev(function(r,e){if(rv(e)||tv(e)){ZC(e,nv(e),r);return}for(var t in e)sv.call(e,t)&&XC(r,t,e[t])}),Me=ov,av=jo,lv=4;function uv(r){return av(r,lv)}var hn=uv,cv=ra,hv=Le;function dv(r,e){return r&&cv(r,e,hv)}var xa=dv,fv=pe;function pv(r,e){return function(t,n){if(t==null)return t;if(!fv(t))return r(t,n);for(var i=t.length,a=e?i:-1,o=Object(t);(e?a--:++a<i)&&n(o[a],a,o)!==!1;);return t}}var mv=pv,gv=xa,yv=mv,bv=yv(gv),it=bv,_v=ie;function wv(r){return typeof r=="function"?r:_v}var $v=wv,Cv=Vr,vv=it,Ev=$v,Tv=F;function Av(r,e){var t=Tv(r)?Cv:vv;return t(r,Ev(e))}var Ov=Av,_t=Ov,Nv=ao,qv=nt,Rv=gt,Sv=F,xv=pe,Iv=et,Pv=yt,Lv=tt,Bv="[object Map]",kv="[object Set]",Mv=Object.prototype,jv=Mv.hasOwnProperty;function Qv(r){if(r==null)return!0;if(xv(r)&&(Sv(r)||typeof r=="string"||typeof r.splice=="function"||Iv(r)||Lv(r)||Rv(r)))return!r.length;var e=qv(r);if(e==Bv||e==kv)return!r.size;if(Pv(r))return!Nv(r).length;for(var t in r)if(jv.call(r,t))return!1;return!0}var le=Qv;function Dv(r){var e=r==null?0:r.length;return e?r[e-1]:void 0}var Fv=Dv,Uv=it;function Hv(r,e){var t=[];return Uv(r,function(n,i,a){e(n,i,a)&&t.push(n)}),t}var Ia=Hv,dn,Pa;function Vv(){if(Pa)return dn;Pa=1;var r="__lodash_hash_undefined__";function e(t){return this.__data__.set(t,r),this}return dn=e,dn}var fn,La;function Wv(){if(La)return fn;La=1;function r(e){return this.__data__.has(e)}return fn=r,fn}var pn,Ba;function ka(){if(Ba)return pn;Ba=1;var r=Hr,e=Vv(),t=Wv();function n(i){var a=-1,o=i==null?0:i.length;for(this.__data__=new r;++a<o;)this.add(i[a])}return n.prototype.add=n.prototype.push=e,n.prototype.has=t,pn=n,pn}var mn,Ma;function ja(){if(Ma)return mn;Ma=1;function r(e,t){for(var n=-1,i=e==null?0:e.length;++n<i;)if(t(e[n],n,e))return!0;return!1}return mn=r,mn}var gn,Qa;function Da(){if(Qa)return gn;Qa=1;function r(e,t){return e.has(t)}return gn=r,gn}var zv=ka(),Kv=ja(),Jv=Da(),Gv=1,Yv=2;function Xv(r,e,t,n,i,a){var o=t&Gv,s=r.length,l=e.length;if(s!=l&&!(o&&l>s))return!1;var u=a.get(r),h=a.get(e);if(u&&h)return u==e&&h==r;var c=-1,d=!0,p=t&Yv?new zv:void 0;for(a.set(r,e),a.set(e,r);++c<s;){var g=r[c],_=e[c];if(n)var f=o?n(_,g,c,e,r,a):n(g,_,c,r,e,a);if(f!==void 0){if(f)continue;d=!1;break}if(p){if(!Kv(e,function(m,y){if(!Jv(p,y)&&(g===m||i(g,m,t,n,a)))return p.push(y)})){d=!1;break}}else if(!(g===_||i(g,_,t,n,a))){d=!1;break}}return a.delete(r),a.delete(e),d}var Fa=Xv;function Zv(r){var e=-1,t=Array(r.size);return r.forEach(function(n,i){t[++e]=[i,n]}),t}var Ua=Zv;function eE(r){var e=-1,t=Array(r.size);return r.forEach(function(n){t[++e]=n}),t}var lr=eE,Ha=Se,Va=vo,tE=Je,rE=Fa,nE=Ua,iE=lr,sE=1,oE=2,aE="[object Boolean]",lE="[object Date]",uE="[object Error]",cE="[object Map]",hE="[object Number]",dE="[object RegExp]",fE="[object Set]",pE="[object String]",mE="[object Symbol]",gE="[object ArrayBuffer]",yE="[object DataView]",Wa=Ha?Ha.prototype:void 0,yn=Wa?Wa.valueOf:void 0;function bE(r,e,t,n,i,a,o){switch(t){case yE:if(r.byteLength!=e.byteLength||r.byteOffset!=e.byteOffset)return!1;r=r.buffer,e=e.buffer;case gE:return!(r.byteLength!=e.byteLength||!a(new Va(r),new Va(e)));case aE:case lE:case hE:return tE(+r,+e);case uE:return r.name==e.name&&r.message==e.message;case dE:case pE:return r==e+"";case cE:var s=nE;case fE:var l=n&sE;if(s||(s=iE),r.size!=e.size&&!l)return!1;var u=o.get(r);if(u)return u==e;n|=oE,o.set(r,e);var h=rE(s(r),s(e),n,i,a,o);return o.delete(r),h;case mE:if(yn)return yn.call(r)==yn.call(e)}return!1}var _E=bE,za=po,wE=1,$E=Object.prototype,CE=$E.hasOwnProperty;function vE(r,e,t,n,i,a){var o=t&wE,s=za(r),l=s.length,u=za(e),h=u.length;if(l!=h&&!o)return!1;for(var c=l;c--;){var d=s[c];if(!(o?d in e:CE.call(e,d)))return!1}var p=a.get(r),g=a.get(e);if(p&&g)return p==e&&g==r;var _=!0;a.set(r,e),a.set(e,r);for(var f=o;++c<l;){d=s[c];var m=r[d],y=e[d];if(n)var w=o?n(y,m,d,e,r,a):n(m,y,d,r,e,a);if(!(w===void 0?m===y||i(m,y,t,n,a):w)){_=!1;break}f||(f=d=="constructor")}if(_&&!f){var $=r.constructor,E=e.constructor;$!=E&&"constructor"in r&&"constructor"in e&&!(typeof $=="function"&&$ instanceof $&&typeof E=="function"&&E instanceof E)&&(_=!1)}return a.delete(r),a.delete(e),_}var EE=vE,bn=zt,TE=Fa,AE=_E,OE=EE,Ka=nt,Ja=F,Ga=et,NE=tt,qE=1,Ya="[object Arguments]",Xa="[object Array]",ur="[object Object]",RE=Object.prototype,Za=RE.hasOwnProperty;function SE(r,e,t,n,i,a){var o=Ja(r),s=Ja(e),l=o?Xa:Ka(r),u=s?Xa:Ka(e);l=l==Ya?ur:l,u=u==Ya?ur:u;var h=l==ur,c=u==ur,d=l==u;if(d&&Ga(r)){if(!Ga(e))return!1;o=!0,h=!1}if(d&&!h)return a||(a=new bn),o||NE(r)?TE(r,e,t,n,i,a):AE(r,e,l,t,n,i,a);if(!(t&qE)){var p=h&&Za.call(r,"__wrapped__"),g=c&&Za.call(e,"__wrapped__");if(p||g){var _=p?r.value():r,f=g?e.value():e;return a||(a=new bn),i(_,f,t,n,a)}}return d?(a||(a=new bn),OE(r,e,t,n,i,a)):!1}var xE=SE,IE=xE,el=ce;function tl(r,e,t,n,i){return r===e?!0:r==null||e==null||!el(r)&&!el(e)?r!==r&&e!==e:IE(r,e,t,n,tl,i)}var rl=tl,PE=zt,LE=rl,BE=1,kE=2;function ME(r,e,t,n){var i=t.length,a=i,o=!n;if(r==null)return!a;for(r=Object(r);i--;){var s=t[i];if(o&&s[2]?s[1]!==r[s[0]]:!(s[0]in r))return!1}for(;++i<a;){s=t[i];var l=s[0],u=r[l],h=s[1];if(o&&s[2]){if(u===void 0&&!(l in r))return!1}else{var c=new PE;if(n)var d=n(u,h,l,r,e,c);if(!(d===void 0?LE(h,u,BE|kE,n,c):d))return!1}}return!0}var jE=ME,QE=ne;function DE(r){return r===r&&!QE(r)}var nl=DE,FE=nl,UE=Le;function HE(r){for(var e=UE(r),t=e.length;t--;){var n=e[t],i=r[n];e[t]=[n,i,FE(i)]}return e}var VE=HE;function WE(r,e){return function(t){return t==null?!1:t[r]===e&&(e!==void 0||r in Object(t))}}var il=WE,zE=jE,KE=VE,JE=il;function GE(r){var e=KE(r);return e.length==1&&e[0][2]?JE(e[0][0],e[0][1]):function(t){return t===r||zE(t,r,e)}}var YE=GE,XE=F,ZE=ir,eT=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,tT=/^\w*$/;function rT(r,e){if(XE(r))return!1;var t=typeof r;return t=="number"||t=="symbol"||t=="boolean"||r==null||ZE(r)?!0:tT.test(r)||!eT.test(r)||e!=null&&r in Object(e)}var _n=rT,sl=Hr,nT="Expected a function";function wn(r,e){if(typeof r!="function"||e!=null&&typeof e!="function")throw new TypeError(nT);var t=function(){var n=arguments,i=e?e.apply(this,n):n[0],a=t.cache;if(a.has(i))return a.get(i);var o=r.apply(this,n);return t.cache=a.set(i,o)||a,o};return t.cache=new(wn.Cache||sl),t}wn.Cache=sl;var iT=wn,sT=iT,oT=500;function aT(r){var e=sT(r,function(n){return t.size===oT&&t.clear(),n}),t=e.cache;return e}var lT=aT,uT=lT,cT=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,hT=/\\(\\)?/g,dT=uT(function(r){var e=[];return r.charCodeAt(0)===46&&e.push(""),r.replace(cT,function(t,n,i,a){e.push(i?a.replace(hT,"$1"):n||t)}),e}),fT=dT,pT=F,mT=_n,gT=fT,yT=Jo;function bT(r,e){return pT(r)?r:mT(r,e)?[r]:gT(yT(r))}var cr=bT,_T=ir,wT=1/0;function $T(r){if(typeof r=="string"||_T(r))return r;var e=r+"";return e=="0"&&1/r==-wT?"-0":e}var wt=$T,CT=cr,vT=wt;function ET(r,e){e=CT(e,r);for(var t=0,n=e.length;r!=null&&t<n;)r=r[vT(e[t++])];return t&&t==n?r:void 0}var $n=ET,TT=$n;function AT(r,e,t){var n=r==null?void 0:TT(r,e);return n===void 0?t:n}var OT=AT;function NT(r,e){return r!=null&&e in Object(r)}var qT=NT,RT=cr,ST=gt,xT=F,IT=Yt,PT=Wr,LT=wt;function BT(r,e,t){e=RT(e,r);for(var n=-1,i=e.length,a=!1;++n<i;){var o=LT(e[n]);if(!(a=r!=null&&t(r,o)))break;r=r[o]}return a||++n!=i?a:(i=r==null?0:r.length,!!i&&PT(i)&&IT(o,i)&&(xT(r)||ST(r)))}var ol=BT,kT=qT,MT=ol;function jT(r,e){return r!=null&&MT(r,e,kT)}var QT=jT,DT=rl,FT=OT,UT=QT,HT=_n,VT=nl,WT=il,zT=wt,KT=1,JT=2;function GT(r,e){return HT(r)&&VT(e)?WT(zT(r),e):function(t){var n=FT(t,r);return n===void 0&&n===e?UT(t,r):DT(e,n,KT|JT)}}var YT=GT;function XT(r){return function(e){return e==null?void 0:e[r]}}var ZT=XT,eA=$n;function tA(r){return function(e){return eA(e,r)}}var rA=tA,nA=ZT,iA=rA,sA=_n,oA=wt;function aA(r){return sA(r)?nA(oA(r)):iA(r)}var lA=aA,uA=YE,cA=YT,hA=ie,dA=F,fA=lA;function pA(r){return typeof r=="function"?r:r==null?hA:typeof r=="object"?dA(r)?cA(r[0],r[1]):uA(r):fA(r)}var me=pA,mA="Expected a function";function gA(r){if(typeof r!="function")throw new TypeError(mA);return function(){var e=arguments;switch(e.length){case 0:return!r.call(this);case 1:return!r.call(this,e[0]);case 2:return!r.call(this,e[0],e[1]);case 3:return!r.call(this,e[0],e[1],e[2])}return!r.apply(this,e)}}var al=gA,yA=Gr,bA=Ia,_A=me,wA=F,$A=al;function CA(r,e){var t=wA(r)?yA:bA;return t(r,$A(_A(e)))}var vA=CA,EA=ca;function TA(r){var e=r==null?0:r.length;return e?EA(r,1,e):[]}var hr=TA,AA=xe,OA=F,NA=ce,qA="[object String]";function RA(r){return typeof r=="string"||!OA(r)&&NA(r)&&AA(r)==qA}var SA=RA;function xA(r){for(var e,t=[];!(e=r.next()).done;)t.push(e.value);return t}var IA=xA;function PA(r){return r.split("")}var LA=PA,BA="\\ud800-\\udfff",kA="\\u0300-\\u036f",MA="\\ufe20-\\ufe2f",jA="\\u20d0-\\u20ff",QA=kA+MA+jA,DA="\\ufe0e\\ufe0f",FA="\\u200d",UA=RegExp("["+FA+BA+QA+DA+"]");function HA(r){return UA.test(r)}var VA=HA,ll="\\ud800-\\udfff",WA="\\u0300-\\u036f",zA="\\ufe20-\\ufe2f",KA="\\u20d0-\\u20ff",JA=WA+zA+KA,GA="\\ufe0e\\ufe0f",YA="["+ll+"]",Cn="["+JA+"]",vn="\\ud83c[\\udffb-\\udfff]",XA="(?:"+Cn+"|"+vn+")",ul="[^"+ll+"]",cl="(?:\\ud83c[\\udde6-\\uddff]){2}",hl="[\\ud800-\\udbff][\\udc00-\\udfff]",ZA="\\u200d",dl=XA+"?",fl="["+GA+"]?",eO="(?:"+ZA+"(?:"+[ul,cl,hl].join("|")+")"+fl+dl+")*",tO=fl+dl+eO,rO="(?:"+[ul+Cn+"?",Cn,cl,hl,YA].join("|")+")",nO=RegExp(vn+"(?="+vn+")|"+rO+tO,"g");function iO(r){return r.match(nO)||[]}var sO=iO,oO=LA,aO=VA,lO=sO;function uO(r){return aO(r)?lO(r):oO(r)}var cO=uO,hO=nr;function dO(r,e){return hO(e,function(t){return r[t]})}var fO=dO,pO=fO,mO=Le;function gO(r){return r==null?[]:pO(r,mO(r))}var pl=gO,ml=Se,yO=Jr,bO=nt,_O=pe,wO=SA,$O=IA,CO=Ua,vO=lr,EO=cO,TO=pl,AO="[object Map]",OO="[object Set]",En=ml?ml.iterator:void 0;function NO(r){if(!r)return[];if(_O(r))return wO(r)?EO(r):yO(r);if(En&&r[En])return $O(r[En]());var e=bO(r),t=e==AO?CO:e==OO?vO:TO;return t(r)}var $t=NO;const gl=Object.freeze({pg:"postgres",postgresql:"postgres",sqlite:"sqlite3"}),qO=Object.freeze(["mssql","mysql","mysql2","oracledb","postgres","pgnative","redshift","sqlite3","cockroachdb","better-sqlite3"].concat(Object.keys(gl))),RO=Object.freeze({MsSQL:"mssql",MySQL:"mysql",MySQL2:"mysql2",Oracle:"oracledb",PostgreSQL:"pg",PgNative:"pgnative",Redshift:"pg-redshift",SQLite:"sqlite3",CockroachDB:"cockroachdb",BetterSQLite3:"better-sqlite3"}),SO=Object.freeze(["maxWaitingClients","testOnBorrow","fifo","priorityRange","autostart","evictionRunIntervalMillis","numTestsPerRun","softIdleTimeoutMillis","Promise"]);var Tn={CLIENT_ALIASES:gl,SUPPORTED_CLIENTS:qO,POOL_CONFIG_OPTIONS:SO,COMMA_NO_PAREN_REGEX:/,[\s](?![^(]*\))/g,DRIVER_NAMES:RO};const yl=$e,xO=tt,{CLIENT_ALIASES:IO}=Tn,{isFunction:PO}=M;function LO(...r){return Array.isArray(r[0])?r[0]:r}function Ct(r){let e=!1;if(xO(r))return!1;if(r&&PO(r.toSQL))return e;if(Array.isArray(r))for(let t=0;t<r.length&&!e;t++)e=Ct(r[t]);else yl(r)?Object.keys(r).forEach(t=>{e||(e=Ct(r[t]))}):e=r===void 0;return e}function BO(r){const e=[];return Array.isArray(r)?r.forEach((t,n)=>{Ct(t)&&e.push(n)}):yl(r)?Object.keys(r).forEach(t=>{Ct(r[t])&&e.push(t)}):e.push(0),e}function kO(r){r.prototype.queryContext=function(e){return e===void 0?this._queryContext:(this._queryContext=e,this)}}function MO(r){return IO[r]||r}function jO(r,e){if(r==null)return e;const t=parseInt(r,10);return isNaN(t)?e:t}var z={addQueryContext:kO,containsUndefined:Ct,getUndefinedIndices:BO,normalizeArr:LO,resolveClientNameWithAliases:MO,toNumber:jO};const bl=I;function _l(r,e,t,n,i){if(typeof t=="function")return{type:"onWrapped",value:t,bool:e};switch(arguments.length){case 3:return{type:"onRaw",value:t,bool:e};case 4:return{type:r,column:t,operator:"=",value:n,bool:e};default:return{type:r,column:t,operator:n,value:i,bool:e}}}let D=class{constructor(e,t,n){this.schema=n,this.table=e,this.joinType=t,this.and=this,this.clauses=[]}get or(){return this._bool("or")}on(e){if(typeof e=="object"&&typeof e.toSQL!="function"){const n=Object.keys(e);let i=-1;const a=this._bool()==="or"?"orOn":"on";for(;++i<n.length;)this[a](n[i],e[n[i]]);return this}const t=_l("onBasic",this._bool(),...arguments);return t&&this.clauses.push(t),this}orOn(e,t,n){return this._bool("or").on.apply(this,arguments)}onJsonPathEquals(e,t,n,i){return this.clauses.push({type:"onJsonPathEquals",columnFirst:e,jsonPathFirst:t,columnSecond:n,jsonPathSecond:i,bool:this._bool(),not:this._not()}),this}orOnJsonPathEquals(e,t,n,i){return this._bool("or").onJsonPathEquals.apply(this,arguments)}using(e){return this.clauses.push({type:"onUsing",column:e,bool:this._bool()})}onVal(e){if(typeof e=="object"&&typeof e.toSQL!="function"){const n=Object.keys(e);let i=-1;const a=this._bool()==="or"?"orOnVal":"onVal";for(;++i<n.length;)this[a](n[i],e[n[i]]);return this}const t=_l("onVal",this._bool(),...arguments);return t&&this.clauses.push(t),this}andOnVal(){return this.onVal(...arguments)}orOnVal(){return this._bool("or").onVal(...arguments)}onBetween(e,t){return bl(Array.isArray(t),"The second argument to onBetween must be an array."),bl(t.length===2,"You must specify 2 values for the onBetween clause"),this.clauses.push({type:"onBetween",column:e,value:t,bool:this._bool(),not:this._not()}),this}onNotBetween(e,t){return this._not(!0).onBetween(e,t)}orOnBetween(e,t){return this._bool("or").onBetween(e,t)}orOnNotBetween(e,t){return this._bool("or")._not(!0).onBetween(e,t)}onIn(e,t){return Array.isArray(t)&&t.length===0?this.on(1,"=",0):(this.clauses.push({type:"onIn",column:e,value:t,not:this._not(),bool:this._bool()}),this)}onNotIn(e,t){return this._not(!0).onIn(e,t)}orOnIn(e,t){return this._bool("or").onIn(e,t)}orOnNotIn(e,t){return this._bool("or")._not(!0).onIn(e,t)}onNull(e){return this.clauses.push({type:"onNull",column:e,not:this._not(),bool:this._bool()}),this}orOnNull(e){return this._bool("or").onNull(e)}onNotNull(e){return this._not(!0).onNull(e)}orOnNotNull(e){return this._not(!0)._bool("or").onNull(e)}onExists(e){return this.clauses.push({type:"onExists",value:e,not:this._not(),bool:this._bool()}),this}orOnExists(e){return this._bool("or").onExists(e)}onNotExists(e){return this._not(!0).onExists(e)}orOnNotExists(e){return this._not(!0)._bool("or").onExists(e)}type(e){return this.joinType=e,this}_bool(e){if(arguments.length===1)return this._boolFlag=e,this;const t=this._boolFlag||"and";return this._boolFlag="and",t}_not(e){if(arguments.length===1)return this._notFlag=e,this;const t=this._notFlag;return this._notFlag=!1,t}};Object.assign(D.prototype,{grouping:"join"}),D.prototype.andOn=D.prototype.on,D.prototype.andOnIn=D.prototype.onIn,D.prototype.andOnNotIn=D.prototype.onNotIn,D.prototype.andOnNull=D.prototype.onNull,D.prototype.andOnNotNull=D.prototype.onNotNull,D.prototype.andOnExists=D.prototype.onExists,D.prototype.andOnNotExists=D.prototype.onNotExists,D.prototype.andOnBetween=D.prototype.onBetween,D.prototype.andOnNotBetween=D.prototype.onNotBetween,D.prototype.andOnJsonPathEquals=D.prototype.onJsonPathEquals;var wl=D;const $l=I;var QO=class{constructor(e,t,n,i,a){this.schema=t,this.type="analytic",this.method=e,this.order=i||[],this.partitions=a||[],this.alias=n,this.and=this,this.grouping="columns"}partitionBy(e,t){return $l(Array.isArray(e)||typeof e=="string",`The argument to an analytic partitionBy function must be either a string
            or an array of string.`),Array.isArray(e)?this.partitions=this.partitions.concat(e):this.partitions.push({column:e,order:t}),this}orderBy(e,t){return $l(Array.isArray(e)||typeof e=="string",`The argument to an analytic orderBy function must be either a string
            or an array of string.`),Array.isArray(e)?this.order=this.order.concat(e):this.order.push({column:e,order:t}),this}},An=function(e,t){e.client.config.asyncStackTraces&&(e._asyncStack={error:new Error,lines:t})},DO={lockMode:{forShare:"forShare",forUpdate:"forUpdate",forNoKeyUpdate:"forNoKeyUpdate",forKeyShare:"forKeyShare"},waitMode:{skipLocked:"skipLocked",noWait:"noWait"}};const FO=hn,UO=le,{callbackify:HO}=I,VO=Ea,{formatQuery:WO}=Sa;function zO(r){r.prototype.toQuery=function(e){let t=this.toSQL(this._method,e);return Array.isArray(t)||(t=[t]),t.length?t.map(n=>WO(n.sql,n.bindings,e,this.client)).reduce((n,i)=>n.concat(n.endsWith(";")?`
`:`;
`,i)):""},r.prototype.then=function(){let e=this.client.runner(this).run();return this.client.config.asyncStackTraces&&(e=e.catch(t=>{t.originalStack=t.stack;const n=t.stack.split(`
`)[0],{error:i,lines:a}=this._asyncStack,s=i.stack.split(`
`).slice(a);throw s.unshift(n),t.stack=s.join(`
`),t})),e.then.apply(e,arguments)},r.prototype.options=function(e){return this._options=this._options||[],this._options.push(FO(e)||{}),this},r.prototype.connection=function(e){return this._connection=e,this.client.processPassedConnection(e),this},r.prototype.debug=function(e){return this._debug=arguments.length?e:!0,this},r.prototype.transacting=function(e){if(e&&e.client&&(e.client.transacting?this.client=e.client:e.client.logger.warn(`Invalid transaction value: ${e.client}`)),UO(e))throw this.client.logger.error("Invalid value on transacting call, potential bug"),Error("Invalid transacting value (null, undefined or empty object)");return this},r.prototype.stream=function(e){return this.client.runner(this).stream(e)},r.prototype.pipe=function(e,t){return this.client.runner(this).pipe(e,t)},r.prototype.asCallback=function(e){const t=this.then();return HO(()=>t)(e),t},r.prototype.catch=function(e){return this.then().catch(e)},Object.defineProperty(r.prototype,Symbol.toStringTag,{get:()=>"object"}),VO(r.prototype)}var On={augmentWithBuilderInterface:zO};const st=I,{EventEmitter:KO}=I,JO=Me,dr=hn,GO=_t,ot=le,Cl=$e,YO=Fv,XO=vA,ZO=hr,vl=$t,{addQueryContext:eN,normalizeArr:vt}=z,Nn=wl,tN=QO,rN=An,{isBoolean:Et,isNumber:nN,isObject:ge,isString:qn,isFunction:iN}=M,{lockMode:ve,waitMode:fr}=DO,{augmentWithBuilderInterface:sN}=On,oN=new Set(["pluck","first","select"]),aN=new Set(["with","select","columns","hintComments","where","union","join","group","order","having","limit","offset","counter","counters"]),lN=new Set([ve.forShare,ve.forUpdate,ve.forNoKeyUpdate,ve.forKeyShare]);class q extends KO{constructor(e){super(),this.client=e,this.and=this,this._single={},this._statements=[],this._method="select",e.config&&(rN(this,5),this._debug=e.config.debug),this._joinFlag="inner",this._boolFlag="and",this._notFlag=!1,this._asColumnFlag=!1}toString(){return this.toQuery()}toSQL(e,t){return this.client.queryCompiler(this).toSQL(e||this._method,t)}clone(){const e=new this.constructor(this.client);return e._method=this._method,e._single=dr(this._single),e._statements=dr(this._statements),e._debug=this._debug,this._options!==void 0&&(e._options=dr(this._options)),this._queryContext!==void 0&&(e._queryContext=dr(this._queryContext)),this._connection!==void 0&&(e._connection=this._connection),e}timeout(e,{cancel:t}={}){return nN(e)&&e>0&&(this._timeout=e,t&&(this.client.assertCanCancelQuery(),this._cancelOnTimeout=!0)),this}isValidStatementArg(e){return typeof e=="function"||e instanceof q||e&&e.isRawInstance}_validateWithArgs(e,t,n,i){const[a,o]=typeof n>"u"?[t,void 0]:[n,t];if(typeof e!="string")throw new Error(`${i}() first argument must be a string`);if(this.isValidStatementArg(a)&&typeof o>"u")return;if(!(Array.isArray(o)&&o.length>0&&o.every(l=>typeof l=="string")))throw new Error(`${i}() second argument must be a statement or non-empty column name list.`);if(!this.isValidStatementArg(a))throw new Error(`${i}() third argument must be a function / QueryBuilder or a raw when its second argument is a column name list`)}with(e,t,n){return this._validateWithArgs(e,t,n,"with"),this.withWrapped(e,t,n)}withMaterialized(e,t,n){throw new Error("With materialized is not supported by this dialect")}withNotMaterialized(e,t,n){throw new Error("With materialized is not supported by this dialect")}withWrapped(e,t,n,i){const[a,o]=typeof n>"u"?[t,void 0]:[n,t],s={grouping:"with",type:"withWrapped",alias:e,columnList:o,value:a};return i!==void 0&&(s.materialized=i),this._statements.push(s),this}withRecursive(e,t,n){return this._validateWithArgs(e,t,n,"withRecursive"),this.withRecursiveWrapped(e,t,n)}withRecursiveWrapped(e,t,n){return this.withWrapped(e,t,n),this._statements[this._statements.length-1].recursive=!0,this}columns(e){return!e&&e!==0?this:(this._statements.push({grouping:"columns",value:vt(...arguments)}),this)}as(e){return this._single.as=e,this}hintComment(e){if(e=Array.isArray(e)?e:[e],e.some(t=>!qn(t)))throw new Error("Hint comment must be a string");if(e.some(t=>t.includes("/*")||t.includes("*/")))throw new Error('Hint comment cannot include "/*" or "*/"');if(e.some(t=>t.includes("?")))throw new Error('Hint comment cannot include "?"');return this._statements.push({grouping:"hintComments",value:e}),this}withSchema(e){return this._single.schema=e,this}table(e,t={}){return this._single.table=e,this._single.only=t.only===!0,this}distinct(...e){return this._statements.push({grouping:"columns",value:vt(...e),distinct:!0}),this}distinctOn(...e){if(ot(e))throw new Error("distinctOn requires at least on argument");return this._statements.push({grouping:"columns",value:vt(...e),distinctOn:!0}),this}join(e,t,...n){let i;const a=e instanceof q||typeof e=="function"?void 0:this._single.schema,o=this._joinType();return typeof t=="function"?(i=new Nn(e,o,a),t.call(i,i)):o==="raw"?i=new Nn(this.client.raw(e,t),"raw"):(i=new Nn(e,o,a),t&&i.on(t,...n)),this._statements.push(i),this}using(e){throw new Error("'using' function is only available in PostgreSQL dialect with Delete statements.")}innerJoin(...e){return this._joinType("inner").join(...e)}leftJoin(...e){return this._joinType("left").join(...e)}leftOuterJoin(...e){return this._joinType("left outer").join(...e)}rightJoin(...e){return this._joinType("right").join(...e)}rightOuterJoin(...e){return this._joinType("right outer").join(...e)}outerJoin(...e){return this._joinType("outer").join(...e)}fullOuterJoin(...e){return this._joinType("full outer").join(...e)}crossJoin(...e){return this._joinType("cross").join(...e)}joinRaw(...e){return this._joinType("raw").join(...e)}get or(){return this._bool("or")}get not(){return this._not(!0)}where(e,t,n){const i=arguments.length;if(e===!1||e===!0)return this.where(1,"=",e?1:0);if(typeof e=="function")return this.whereWrapped(e);if(ge(e)&&!e.isRawInstance)return this._objectWhere(e);if(e&&e.isRawInstance&&i===1)return this.whereRaw(e);if(i===2&&(n=t,t="=",n===null))return this.whereNull(e);const a=`${t}`.toLowerCase().trim();if(i===3){if(a==="in"||a==="not in")return this._not(a==="not in").whereIn(e,n);if(a==="between"||a==="not between")return this._not(a==="not between").whereBetween(e,n)}return n===null&&(a==="is"||a==="is not")?this._not(a==="is not").whereNull(e):(this._statements.push({grouping:"where",type:"whereBasic",column:e,operator:t,value:n,not:this._not(),bool:this._bool(),asColumn:this._asColumnFlag}),this)}whereColumn(...e){return this._asColumnFlag=!0,this.where(...e),this._asColumnFlag=!1,this}orWhere(e,...t){this._bool("or");const n=e;return ge(n)&&!n.isRawInstance?this.whereWrapped(function(){for(const i in n)this.andWhere(i,n[i])}):this.where(e,...t)}orWhereColumn(e,...t){this._bool("or");const n=e;return ge(n)&&!n.isRawInstance?this.whereWrapped(function(){for(const i in n)this.andWhereColumn(i,"=",n[i])}):this.whereColumn(e,...t)}whereNot(e,...t){return t.length>=2&&(t[0]==="in"||t[0]==="between")&&this.client.logger.warn('whereNot is not suitable for "in" and "between" type subqueries. You should use "not in" and "not between" instead.'),this._not(!0).where(e,...t)}whereNotColumn(...e){return this._not(!0).whereColumn(...e)}orWhereNot(...e){return this._bool("or").whereNot(...e)}orWhereNotColumn(...e){return this._bool("or").whereNotColumn(...e)}_objectWhere(e){const t=this._bool(),n=this._not()?"Not":"";for(const i in e)this[t+"Where"+n](i,e[i]);return this}whereRaw(e,t){const n=e.isRawInstance?e:this.client.raw(e,t);return this._statements.push({grouping:"where",type:"whereRaw",value:n,not:this._not(),bool:this._bool()}),this}orWhereRaw(e,t){return this._bool("or").whereRaw(e,t)}whereWrapped(e){return this._statements.push({grouping:"where",type:"whereWrapped",value:e,not:this._not(),bool:this._bool()}),this}whereExists(e){return this._statements.push({grouping:"where",type:"whereExists",value:e,not:this._not(),bool:this._bool()}),this}orWhereExists(e){return this._bool("or").whereExists(e)}whereNotExists(e){return this._not(!0).whereExists(e)}orWhereNotExists(e){return this._bool("or").whereNotExists(e)}whereIn(e,t){return Array.isArray(t)&&ot(t)?this.where(this._not()):(this._statements.push({grouping:"where",type:"whereIn",column:e,value:t,not:this._not(),bool:this._bool()}),this)}orWhereIn(e,t){return this._bool("or").whereIn(e,t)}whereNotIn(e,t){return this._not(!0).whereIn(e,t)}orWhereNotIn(e,t){return this._bool("or")._not(!0).whereIn(e,t)}whereNull(e){return this._statements.push({grouping:"where",type:"whereNull",column:e,not:this._not(),bool:this._bool()}),this}orWhereNull(e){return this._bool("or").whereNull(e)}whereNotNull(e){return this._not(!0).whereNull(e)}orWhereNotNull(e){return this._bool("or").whereNotNull(e)}whereBetween(e,t){return st(Array.isArray(t),"The second argument to whereBetween must be an array."),st(t.length===2,"You must specify 2 values for the whereBetween clause"),this._statements.push({grouping:"where",type:"whereBetween",column:e,value:t,not:this._not(),bool:this._bool()}),this}whereNotBetween(e,t){return this._not(!0).whereBetween(e,t)}orWhereBetween(e,t){return this._bool("or").whereBetween(e,t)}orWhereNotBetween(e,t){return this._bool("or").whereNotBetween(e,t)}_whereLike(e,t,n){return this._statements.push({grouping:"where",type:e,column:t,value:n,not:this._not(),bool:this._bool(),asColumn:this._asColumnFlag}),this}whereLike(e,t){return this._whereLike("whereLike",e,t)}orWhereLike(e,t){return this._bool("or")._whereLike("whereLike",e,t)}whereILike(e,t){return this._whereLike("whereILike",e,t)}orWhereILike(e,t){return this._bool("or")._whereLike("whereILike",e,t)}groupBy(e){return e&&e.isRawInstance?this.groupByRaw.apply(this,arguments):(this._statements.push({grouping:"group",type:"groupByBasic",value:vt(...arguments)}),this)}groupByRaw(e,t){const n=e.isRawInstance?e:this.client.raw(e,t);return this._statements.push({grouping:"group",type:"groupByRaw",value:n}),this}orderBy(e,t,n=""){return Array.isArray(e)?this._orderByArray(e):(this._statements.push({grouping:"order",type:"orderByBasic",value:e,direction:t,nulls:n}),this)}_orderByArray(e){for(let t=0;t<e.length;t++){const n=e[t];ge(n)?this._statements.push({grouping:"order",type:"orderByBasic",value:n.column,direction:n.order,nulls:n.nulls}):qn(n)&&this._statements.push({grouping:"order",type:"orderByBasic",value:n})}return this}orderByRaw(e,t){const n=e.isRawInstance?e:this.client.raw(e,t);return this._statements.push({grouping:"order",type:"orderByRaw",value:n}),this}_union(e,t){let n=t[0],i=t[1];if(t.length===1||t.length===2&&Et(i)){Array.isArray(n)||(n=[n]);for(let a=0,o=n.length;a<o;a++)this._statements.push({grouping:"union",clause:e,value:n[a],wrap:i||!1})}else n=vl(t).slice(0,t.length-1),i=t[t.length-1],Et(i)||(n.push(i),i=!1),this._union(e,[n,i]);return this}union(...e){return this._union("union",e)}unionAll(...e){return this._union("union all",e)}intersect(e,t){if(arguments.length===1||arguments.length===2&&Et(t)){Array.isArray(e)||(e=[e]);for(let n=0,i=e.length;n<i;n++)this._statements.push({grouping:"union",clause:"intersect",value:e[n],wrap:t||!1})}else e=vl(arguments).slice(0,arguments.length-1),t=arguments[arguments.length-1],Et(t)||(e.push(t),t=!1),this.intersect(e,t);return this}having(e,t,n){return e.isRawInstance&&arguments.length===1?this.havingRaw(e):typeof e=="function"?this.havingWrapped(e):(this._statements.push({grouping:"having",type:"havingBasic",column:e,operator:t,value:n,bool:this._bool(),not:this._not()}),this)}orHaving(e,...t){this._bool("or");const n=e;return ge(n)&&!n.isRawInstance?this.havingWrapped(function(){for(const i in n)this.andHaving(i,n[i])}):this.having(e,...t)}havingWrapped(e){return this._statements.push({grouping:"having",type:"havingWrapped",value:e,bool:this._bool(),not:this._not()}),this}havingNull(e){return this._statements.push({grouping:"having",type:"havingNull",column:e,not:this._not(),bool:this._bool()}),this}orHavingNull(e){return this._bool("or").havingNull(e)}havingNotNull(e){return this._not(!0).havingNull(e)}orHavingNotNull(e){return this._not(!0)._bool("or").havingNull(e)}havingExists(e){return this._statements.push({grouping:"having",type:"havingExists",value:e,not:this._not(),bool:this._bool()}),this}orHavingExists(e){return this._bool("or").havingExists(e)}havingNotExists(e){return this._not(!0).havingExists(e)}orHavingNotExists(e){return this._not(!0)._bool("or").havingExists(e)}havingBetween(e,t){return st(Array.isArray(t),"The second argument to havingBetween must be an array."),st(t.length===2,"You must specify 2 values for the havingBetween clause"),this._statements.push({grouping:"having",type:"havingBetween",column:e,value:t,not:this._not(),bool:this._bool()}),this}orHavingBetween(e,t){return this._bool("or").havingBetween(e,t)}havingNotBetween(e,t){return this._not(!0).havingBetween(e,t)}orHavingNotBetween(e,t){return this._not(!0)._bool("or").havingBetween(e,t)}havingIn(e,t){return Array.isArray(t)&&ot(t)?this.where(this._not()):(this._statements.push({grouping:"having",type:"havingIn",column:e,value:t,not:this._not(),bool:this._bool()}),this)}orHavingIn(e,t){return this._bool("or").havingIn(e,t)}havingNotIn(e,t){return this._not(!0).havingIn(e,t)}orHavingNotIn(e,t){return this._bool("or")._not(!0).havingIn(e,t)}havingRaw(e,t){const n=e.isRawInstance?e:this.client.raw(e,t);return this._statements.push({grouping:"having",type:"havingRaw",value:n,bool:this._bool(),not:this._not()}),this}orHavingRaw(e,t){return this._bool("or").havingRaw(e,t)}_setSkipBinding(e,t){let n=t;ge(t)&&(n=t.skipBinding),this._single.skipBinding=this._single.skipBinding||{},this._single.skipBinding[e]=n}offset(e,t){if(e==null||e.isRawInstance||e instanceof q)this._single.offset=e;else{const n=parseInt(e,10);if(isNaN(n))this.client.logger.warn("A valid integer must be provided to offset");else{if(n<0)throw new Error("A non-negative integer must be provided to offset.");this._single.offset=n}}return this._setSkipBinding("offset",t),this}limit(e,t){const n=parseInt(e,10);return isNaN(n)?this.client.logger.warn("A valid integer must be provided to limit"):(this._single.limit=n,this._setSkipBinding("limit",t)),this}count(e,t){return this._aggregate("count",e||"*",t)}min(e,t){return this._aggregate("min",e,t)}max(e,t){return this._aggregate("max",e,t)}sum(e,t){return this._aggregate("sum",e,t)}avg(e,t){return this._aggregate("avg",e,t)}countDistinct(...e){let t;return e.length>1&&Cl(YO(e))&&([t]=e.splice(e.length-1,1)),e.length?e.length===1&&(e=e[0]):e="*",this._aggregate("count",e,{...t,distinct:!0})}sumDistinct(e,t){return this._aggregate("sum",e,{...t,distinct:!0})}avgDistinct(e,t){return this._aggregate("avg",e,{...t,distinct:!0})}increment(e,t=1){if(ge(e)){for(const n in e)this._counter(n,e[n]);return this}return this._counter(e,t)}decrement(e,t=1){if(ge(e)){for(const n in e)this._counter(n,-e[n]);return this}return this._counter(e,-t)}clearCounters(){return this._single.counter={},this}first(...e){if(this._method&&this._method!=="select")throw new Error(`Cannot chain .first() on "${this._method}" query`);return this.select(vt(...e)),this._method="first",this.limit(1),this}connection(e){return this._connection=e,this.client.processPassedConnection(e),this}pluck(e){if(this._method&&this._method!=="select")throw new Error(`Cannot chain .pluck() on "${this._method}" query`);return this._method="pluck",this._single.pluck=e,this._statements.push({grouping:"columns",type:"pluck",value:e}),this}clearSelect(){return this._clearGrouping("columns"),this}clearWhere(){return this._clearGrouping("where"),this}clearGroup(){return this._clearGrouping("group"),this}clearOrder(){return this._clearGrouping("order"),this}clearHaving(){return this._clearGrouping("having"),this}clear(e){if(!aN.has(e))throw new Error(`Knex Error: unknown statement '${e}'`);return e.startsWith("counter")?this.clearCounters():(e==="select"&&(e="columns"),this._clearGrouping(e),this)}insert(e,t,n){return this._method="insert",ot(t)||this.returning(t,n),this._single.insert=e,this}update(e,t,n){let i;const a=this._single.update||{};if(this._method="update",qn(e))Cl(t)?a[e]=JSON.stringify(t):a[e]=t,arguments.length>2&&(i=arguments[2]);else{const o=Object.keys(e);this._single.update&&this.client.logger.warn("Update called multiple times with objects.");let s=-1;for(;++s<o.length;)a[o[s]]=e[o[s]];i=arguments[1]}return ot(i)||this.returning(i,n),this._single.update=a,this}returning(e,t){return this._single.returning=e,this._single.options=t,this}onConflict(e){return typeof e=="string"&&(e=[e]),new uN(this,e||!0)}delete(e,t){return this._method="del",ot(e)||this.returning(e,t),this}truncate(e){return this._method="truncate",e&&(this._single.table=e),this}columnInfo(e){return this._method="columnInfo",this._single.columnInfo=e,this}forUpdate(...e){return this._single.lock=ve.forUpdate,e.length===1&&Array.isArray(e[0])?this._single.lockTables=e[0]:this._single.lockTables=e,this}forShare(...e){return this._single.lock=ve.forShare,this._single.lockTables=e,this}forNoKeyUpdate(...e){return this._single.lock=ve.forNoKeyUpdate,this._single.lockTables=e,this}forKeyShare(...e){return this._single.lock=ve.forKeyShare,this._single.lockTables=e,this}skipLocked(){if(!this._isSelectQuery())throw new Error(`Cannot chain .skipLocked() on "${this._method}" query!`);if(!this._hasLockMode())throw new Error(".skipLocked() can only be used after a call to .forShare() or .forUpdate()!");if(this._single.waitMode===fr.noWait)throw new Error(".skipLocked() cannot be used together with .noWait()!");return this._single.waitMode=fr.skipLocked,this}noWait(){if(!this._isSelectQuery())throw new Error(`Cannot chain .noWait() on "${this._method}" query!`);if(!this._hasLockMode())throw new Error(".noWait() can only be used after a call to .forShare() or .forUpdate()!");if(this._single.waitMode===fr.skipLocked)throw new Error(".noWait() cannot be used together with .skipLocked()!");return this._single.waitMode=fr.noWait,this}fromJS(e){return GO(e,(t,n)=>{typeof this[n]!="function"&&this.client.logger.warn(`Knex Error: unknown key ${n}`),Array.isArray(t)?this[n].apply(this,t):this[n](t)}),this}fromRaw(e,t){const n=e.isRawInstance?e:this.client.raw(e,t);return this.from(n)}modify(e){return e.apply(this,[this].concat(ZO(arguments))),this}upsert(e,t,n){throw new Error(`Upsert is not yet supported for dialect ${this.client.dialect}`)}_json(e,t){return this._statements.push({grouping:"columns",type:"json",method:e,params:t}),this}jsonExtract(){const e=arguments[0];let t,n,i=!0;return arguments.length>=2&&(t=arguments[1]),arguments.length>=3&&(n=arguments[2]),arguments.length===4&&(i=arguments[3]),arguments.length===2&&Array.isArray(arguments[0])&&Et(arguments[1])&&(i=arguments[1]),this._json("jsonExtract",{column:e,path:t,alias:n,singleValue:i})}jsonSet(e,t,n,i){return this._json("jsonSet",{column:e,path:t,value:n,alias:i})}jsonInsert(e,t,n,i){return this._json("jsonInsert",{column:e,path:t,value:n,alias:i})}jsonRemove(e,t,n){return this._json("jsonRemove",{column:e,path:t,alias:n})}_isJsonObject(e){return ge(e)&&!(e instanceof q)}_whereJsonWrappedValue(e,t,n){const i={grouping:"where",type:e,column:t,value:n,not:this._not(),bool:this._bool(),asColumn:this._asColumnFlag};arguments[3]&&(i.operator=arguments[3]),arguments[4]&&(i.jsonPath=arguments[4]),this._statements.push(i)}whereJsonObject(e,t){return this._whereJsonWrappedValue("whereJsonObject",e,t),this}orWhereJsonObject(e,t){return this._bool("or").whereJsonObject(e,t)}whereNotJsonObject(e,t){return this._not(!0).whereJsonObject(e,t)}orWhereNotJsonObject(e,t){return this._bool("or").whereNotJsonObject(e,t)}whereJsonPath(e,t,n,i){return this._whereJsonWrappedValue("whereJsonPath",e,i,n,t),this}orWhereJsonPath(e,t,n,i){return this._bool("or").whereJsonPath(e,t,n,i)}whereJsonSupersetOf(e,t){return this._whereJsonWrappedValue("whereJsonSupersetOf",e,t),this}whereJsonNotSupersetOf(e,t){return this._not(!0).whereJsonSupersetOf(e,t)}orWhereJsonSupersetOf(e,t){return this._bool("or").whereJsonSupersetOf(e,t)}orWhereJsonNotSupersetOf(e,t){return this._bool("or").whereJsonNotSupersetOf(e,t)}whereJsonSubsetOf(e,t){return this._whereJsonWrappedValue("whereJsonSubsetOf",e,t),this}whereJsonNotSubsetOf(e,t){return this._not(!0).whereJsonSubsetOf(e,t)}orWhereJsonSubsetOf(e,t){return this._bool("or").whereJsonSubsetOf(e,t)}orWhereJsonNotSubsetOf(e,t){return this._bool("or").whereJsonNotSubsetOf(e,t)}whereJsonHasNone(e,t){return this._not(!0).whereJsonHasAll(e,t),this}_analytic(e,t,n){let i;const{schema:a}=this._single,o=this._analyticMethod();if(e=typeof e=="string"?e:null,st(typeof t=="function"||t.isRawInstance||Array.isArray(t)||typeof t=="string"||typeof t=="object",`The second argument to an analytic function must be either a function, a raw,
       an array of string or object, an object or a single string.`),n&&st(Array.isArray(n)||typeof n=="string"||typeof n=="object","The third argument to an analytic function must be either a string, an array of string or object or an object."),iN(t))i=new tN(o,a,e),t.call(i,i);else if(t.isRawInstance)i={grouping:"columns",type:"analytic",method:o,raw:t,alias:e};else{const s=Array.isArray(t)?t:[t];let l=n||[];l=Array.isArray(l)?l:[l],i={grouping:"columns",type:"analytic",method:o,order:s,alias:e,partitions:l}}return this._statements.push(i),this}rank(...e){return this._analyticMethod("rank")._analytic(...e)}denseRank(...e){return this._analyticMethod("dense_rank")._analytic(...e)}rowNumber(...e){return this._analyticMethod("row_number")._analytic(...e)}_counter(e,t){return t=parseFloat(t),this._method="update",this._single.counter=this._single.counter||{},this._single.counter[e]=t,this}_bool(e){if(arguments.length===1)return this._boolFlag=e,this;const t=this._boolFlag;return this._boolFlag="and",t}_not(e){if(arguments.length===1)return this._notFlag=e,this;const t=this._notFlag;return this._notFlag=!1,t}_joinType(e){if(arguments.length===1)return this._joinFlag=e,this;const t=this._joinFlag||"inner";return this._joinFlag="inner",t}_analyticMethod(e){return arguments.length===1?(this._analyticFlag=e,this):this._analyticFlag||"row_number"}_aggregate(e,t,n={}){return this._statements.push({grouping:"columns",type:t.isRawInstance?"aggregateRaw":"aggregate",method:e,value:t,aggregateDistinct:n.distinct||!1,alias:n.as}),this}_clearGrouping(e){e in this._single?this._single[e]=void 0:this._statements=XO(this._statements,{grouping:e})}_isSelectQuery(){return oN.has(this._method)}_hasLockMode(){return lN.has(this._single.lock)}}q.prototype.select=q.prototype.columns,q.prototype.column=q.prototype.columns,q.prototype.andWhereNot=q.prototype.whereNot,q.prototype.andWhereNotColumn=q.prototype.whereNotColumn,q.prototype.andWhere=q.prototype.where,q.prototype.andWhereColumn=q.prototype.whereColumn,q.prototype.andWhereRaw=q.prototype.whereRaw,q.prototype.andWhereBetween=q.prototype.whereBetween,q.prototype.andWhereNotBetween=q.prototype.whereNotBetween,q.prototype.andWhereJsonObject=q.prototype.whereJsonObject,q.prototype.andWhereNotJsonObject=q.prototype.whereJsonObject,q.prototype.andWhereJsonPath=q.prototype.whereJsonPath,q.prototype.andWhereLike=q.prototype.whereLike,q.prototype.andWhereILike=q.prototype.whereILike,q.prototype.andHaving=q.prototype.having,q.prototype.andHavingIn=q.prototype.havingIn,q.prototype.andHavingNotIn=q.prototype.havingNotIn,q.prototype.andHavingNull=q.prototype.havingNull,q.prototype.andHavingNotNull=q.prototype.havingNotNull,q.prototype.andHavingExists=q.prototype.havingExists,q.prototype.andHavingNotExists=q.prototype.havingNotExists,q.prototype.andHavingBetween=q.prototype.havingBetween,q.prototype.andHavingNotBetween=q.prototype.havingNotBetween,q.prototype.from=q.prototype.table,q.prototype.into=q.prototype.table,q.prototype.del=q.prototype.delete,sN(q),eN(q),q.extend=(r,e)=>{if(Object.prototype.hasOwnProperty.call(q.prototype,r))throw new Error(`Can't extend QueryBuilder with existing method ('${r}').`);JO(q.prototype,{[r]:e})};class uN{constructor(e,t){this.builder=e,this._columns=t}ignore(){return this.builder._single.onConflict=this._columns,this.builder._single.ignore=!0,this.builder}merge(e){return this.builder._single.onConflict=this._columns,this.builder._single.merge={updates:e},this.builder}then(){throw new Error("Incomplete onConflict clause. .onConflict() must be directly followed by either .merge() or .ignore()")}}var Ee=q;function cN(r,e,t,n){var i=-1,a=r==null?0:r.length;for(n&&a&&(t=r[++i]);++i<a;)t=e(t,r[i],i,r);return t}var hN=cN;function dN(r,e,t,n,i){return i(r,function(a,o,s){t=n?(n=!1,a):e(t,a,o,s)}),t}var fN=dN,pN=hN,mN=it,gN=me,yN=fN,bN=F;function _N(r,e,t){var n=bN(r)?pN:yN,i=arguments.length<3;return n(r,gN(e),t,i,mN)}var Tt=_N,wN=Vr,$N=Ro,CN=xa,vN=me,EN=er,TN=F,AN=et,ON=Ht,NN=ne,qN=tt;function RN(r,e,t){var n=TN(r),i=n||AN(r)||qN(r);if(e=vN(e),t==null){var a=r&&r.constructor;i?t=n?new a:[]:NN(r)?t=ON(a)?$N(EN(r)):{}:t={}}return(i?wN:CN)(r,function(o,s,l){return e(t,o,s,l)}),t}var SN=RN;const{isObject:xN}=M;function IN(r,e,t,n){const i=t.queryBuilder();return r.call(i,i),t.queryCompiler(i,n.bindings).toSQL(e||i._method||"select")}function PN(r,e,t){const n=e.queryContext();return t.wrapIdentifier((r||"").trim(),n)}function LN(r,e,t){return r===void 0?"":r===null?"null":r&&r.isRawInstance?r.toQuery():e==="bool"?(r==="false"&&(r=0),`'${r?1:0}'`):(e==="json"||e==="jsonb")&&xN(r)?`'${JSON.stringify(r)}'`:t._escapeBinding(r.toString())}var je={compileCallback:IN,wrapAsIdentifier:PN,formatDefault:LN};const BN=SN,El=Ee,{compileCallback:Rn,wrapAsIdentifier:pr}=je,kN=["asc","desc"],MN=BN(["=","<",">","<=",">=","<>","!=","like","not like","between","not between","ilike","not ilike","exists","not exist","rlike","not rlike","regexp","not regexp","match","&","|","^","<<",">>","~","~=","~*","!~","!~*","#","&&","@>","<@","||","&<","&>","-|-","@@","!!",["?","\\?"],["?|","\\?|"],["?&","\\?&"]],(r,e)=>{Array.isArray(e)?r[e[0]]=e[1]:r[e]=e},{});function jN(r,e,t,n){const i=Array.isArray(r)?r:[r];let a="",o=-1;for(;++o<i.length;)o>0&&(a+=", "),a+=mr(i[o],void 0,e,t,n);return a}function mr(r,e,t,n,i){const a=At(r,e,t,n,i);if(a)return a;switch(typeof r){case"function":return Nt(Rn(r,void 0,n,i),!0,t,n);case"object":return DN(r,t,n,i);case"number":return r;default:return Ot(r+"",t,n)}}function At(r,e,t,n,i){let a;if(r instanceof El)return a=n.queryCompiler(r).toSQL(),a.bindings&&i.bindings.push(...a.bindings),Nt(a,e,t,n);if(r&&r.isRawInstance)return r.client=n,t._queryContext&&(r.queryContext=()=>t._queryContext),a=r.toSQL(),a.bindings&&i.bindings.push(...a.bindings),a.sql;e&&i.bindings.push(r)}function QN(r,e,t,n){const i=At(r,void 0,e,t,n);if(i)return i;const a=MN[(r||"").toLowerCase()];if(!a)throw new TypeError(`The operator "${r}" is not permitted`);return a}function Ot(r,e,t){const n=r.toLowerCase().indexOf(" as ");if(n!==-1){const s=r.slice(0,n),l=r.slice(n+4);return t.alias(Ot(s,e,t),pr(l,e,t))}const i=[];let a=-1;const o=r.split(".");for(;++a<o.length;)r=o[a],a===0&&o.length>1?i.push(Ot((r||"").trim(),e,t)):i.push(pr(r,e,t));return i.join(".")}function DN(r,e,t,n){const i=[];for(const a in r){const o=r[a];if(typeof o=="function"){const s=Rn(o,void 0,t,n);s.as=a,i.push(Nt(s,!0,e,t))}else o instanceof El?i.push(t.alias(`(${mr(o,void 0,e,t,n)})`,pr(a,e,t))):i.push(t.alias(mr(o,void 0,e,t,n),pr(a,e,t)))}return i.join(", ")}function Nt(r,e,t,n){let i=r.sql||"";return i&&(r.method==="select"||r.method==="first")&&(e||r.as)&&(i=`(${i})`,r.as)?n.alias(i,Ot(r.as,t,n)):i}function FN(r,e,t,n,i){return typeof r=="function"?Nt(Rn(r,e,n,i),void 0,t,n):At(r,void 0,t,n,i)||""}function UN(r,e,t,n){const i=At(r,void 0,e,t,n);return i||(kN.indexOf((r||"").toLowerCase())!==-1?r:"asc")}var K={columnize:jN,direction:UN,operator:QN,outputQuery:Nt,rawOrFn:FN,unwrapRaw:At,wrap:mr,wrapString:Ot};const{columnize:Tl}=K;function HN(r,e){const t={bindings:[]},n=r,i=r.bindings.length,a=r.bindings;let o=0;const s=r.sql.replace(/\\?\?\??/g,function(l){if(l==="\\?")return l;const u=a[o++];return l==="??"?Tl(u,n,e,t):e.parameter(u,n,t)});if(i!==o)throw new Error(`Expected ${i} bindings, saw ${o}`);return{method:"raw",sql:s,bindings:t.bindings}}function VN(r,e){const t={bindings:[]},n=r,i=r.bindings,a=/\\?(:(\w+):(?=::)|:(\w+):(?!:)|:(\w+))/g;return{method:"raw",sql:r.sql.replace(a,function(s,l,u,h,c){if(s!==l)return l;const d=u||h||c,p=s.trim(),g=p[p.length-1]===":",_=i[d];return _===void 0?(Object.prototype.hasOwnProperty.call(i,d)&&t.bindings.push(_),s):g?s.replace(l,Tl(_,n,e,t)):s.replace(l,e.parameter(_,n,t))}),bindings:t.bindings}}var WN={replaceKeyBindings:VN,replaceRawArrBindings:HN};const zN="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",KN="0123456789";function JN(r=21){let e="",t=r;for(;t--;)e+=zN[Math.random()*64|0];return e}function GN(r=21){let e="",t=r;for(;t--;)e+=KN[Math.random()*10|0];return e}var Sn={nanoid:JN,nanonum:GN};const{EventEmitter:YN}=I,XN=ae,ZN=Me,eq=$e,tq=Tt,{replaceRawArrBindings:rq,replaceKeyBindings:nq}=WN,xn=z,iq=An,{nanoid:sq}=Sn,{isNumber:oq,isObject:aq}=M,{augmentWithBuilderInterface:lq}=On,uq=XN("knex:bindings");let gr=class extends YN{constructor(e){super(),this.client=e,this.sql="",this.bindings=[],this._wrappedBefore=void 0,this._wrappedAfter=void 0,e&&e.config&&(this._debug=e.config.debug,iq(this,4))}set(e,t){return this.sql=e,this.bindings=aq(t)&&!t.toSQL||t===void 0?t:[t],this}timeout(e,{cancel:t}={}){return oq(e)&&e>0&&(this._timeout=e,t&&(this.client.assertCanCancelQuery(),this._cancelOnTimeout=!0)),this}wrap(e,t){return this._wrappedBefore=e,this._wrappedAfter=t,this}toString(){return this.toQuery()}toSQL(e,t){let n;if(Array.isArray(this.bindings)?n=rq(this,this.client):this.bindings&&eq(this.bindings)?n=nq(this,this.client):n={method:"raw",sql:this.sql,bindings:this.bindings===void 0?[]:[this.bindings]},this._wrappedBefore&&(n.sql=this._wrappedBefore+n.sql),this._wrappedAfter&&(n.sql=n.sql+this._wrappedAfter),n.options=tq(this._options,ZN,{}),this._timeout&&(n.timeout=this._timeout,this._cancelOnTimeout&&(n.cancelOnTimeout=this._cancelOnTimeout)),n.bindings=n.bindings||[],xn.containsUndefined(n.bindings)){const i=xn.getUndefinedIndices(this.bindings);throw uq(n.bindings),new Error(`Undefined binding(s) detected for keys [${i}] when compiling RAW query: ${n.sql}`)}return n.__knexQueryUid=sq(),Object.defineProperties(n,{toNative:{value:()=>({sql:this.client.positionBindings(n.sql),bindings:this.client.prepBindings(n.bindings)}),enumerable:!1}}),n}};gr.prototype.isRawInstance=!0,lq(gr),xn.addQueryContext(gr);var at=gr;function cq(r){for(var e=-1,t=r==null?0:r.length,n=0,i=[];++e<t;){var a=r[e];a&&(i[n++]=a)}return i}var In=cq;function hq(r,e,t,n){for(var i=-1,a=r==null?0:r.length;++i<a;){var o=r[i];e(n,o,t(o),r)}return n}var dq=hq,fq=it;function pq(r,e,t,n){return fq(r,function(i,a,o){e(n,i,t(i),o)}),n}var mq=pq,gq=dq,yq=mq,bq=me,_q=F;function wq(r,e){return function(t,n){var i=_q(t)?gq:yq,a=e?e():{};return i(t,r,bq(n),a)}}var $q=wq,Cq=Kt,vq=$q,Eq=Object.prototype,Tq=Eq.hasOwnProperty,Aq=vq(function(r,e,t){Tq.call(r,t)?r[t].push(e):Cq(r,t,[e])}),yr=Aq,Oq=Object.prototype,Nq=Oq.hasOwnProperty;function qq(r,e){return r!=null&&Nq.call(r,e)}var Rq=qq,Sq=Rq,xq=ol;function Iq(r,e){return r!=null&&xq(r,e,Sq)}var br=Iq,Pq=it,Lq=pe;function Bq(r,e){var t=-1,n=Lq(r)?Array(r.length):[];return Pq(r,function(i,a,o){n[++t]=e(i,a,o)}),n}var kq=Bq,Mq=nr,jq=me,Qq=kq,Dq=F;function Fq(r,e){var t=Dq(r)?Mq:Qq;return t(r,jq(e))}var Qe=Fq,Uq=Jt,Hq=cr,Vq=Yt,Al=ne,Wq=wt;function zq(r,e,t,n){if(!Al(r))return r;e=Hq(e,r);for(var i=-1,a=e.length,o=a-1,s=r;s!=null&&++i<a;){var l=Wq(e[i]),u=t;if(l==="__proto__"||l==="constructor"||l==="prototype")return r;if(i!=o){var h=s[l];u=n?n(h,l,s):void 0,u===void 0&&(u=Al(h)?h:Vq(e[i+1])?[]:{})}Uq(s,l,u),s=s[l]}return r}var Kq=zq,Jq=$n,Gq=Kq,Yq=cr;function Xq(r,e,t){for(var n=-1,i=e.length,a={};++n<i;){var o=e[n],s=Jq(r,o);t(s,o)&&Gq(a,Yq(o,r),s)}return a}var Zq=Xq,eR=nr,tR=me,rR=Zq,nR=mo;function iR(r,e){if(r==null)return{};var t=eR(nR(r),function(n){return[n]});return e=tR(e),rR(r,t,function(n,i){return e(n,i[0])})}var sR=iR,oR=me,aR=al,lR=sR;function uR(r,e){return lR(r,aR(oR(e)))}var cR=uR;const hR=z,lt=at,_r=Ee,dR=wl,fR=ae,Ol=Me,qt=In,pR=yr,mR=br,Nl=le,ql=Qe,gR=cR,yR=Tt,{nanoid:bR}=Sn,{isString:Pn,isUndefined:_R}=M,{columnize:ye,direction:Rl,operator:Rt,wrap:U,unwrapRaw:ut,rawOrFn:Te}=K,wR=fR("knex:bindings"),$R=["columns","join","where","union","group","having","order","limit","offset","lock","waitMode"];var De=class{constructor(e,t,n){this.client=e,this.method=t._method||"select",this.options=t._options,this.single=t._single,this.timeout=t._timeout||!1,this.cancelOnTimeout=t._cancelOnTimeout||!1,this.grouped=pR(t._statements,"grouping"),this.formatter=e.formatter(t),this._emptyInsertValue="default values",this.first=this.select,this.bindings=n||[],this.formatter.bindings=this.bindings,this.bindingsHolder=this,this.builder=this.formatter.builder}toSQL(e,t){this._undefinedInWhereClause=!1,this.undefinedBindingsInfo=[],e=e||this.method;const n=this[e]()||"",i={method:e,options:yR(this.options,Ol,{}),timeout:this.timeout,cancelOnTimeout:this.cancelOnTimeout,bindings:this.bindingsHolder.bindings||[],__knexQueryUid:bR()};if(Object.defineProperties(i,{toNative:{value:()=>({sql:this.client.positionBindings(i.sql),bindings:this.client.prepBindings(i.bindings)}),enumerable:!1}}),Pn(n)?i.sql=n:Ol(i,n),(e==="select"||e==="first")&&this.single.as&&(i.as=this.single.as),this._undefinedInWhereClause)throw wR(i.bindings),new Error(`Undefined binding(s) detected when compiling ${e.toUpperCase()}. Undefined column(s): [${this.undefinedBindingsInfo.join(", ")}] query: ${i.sql}`);return i}select(){let e=this.with(),t="";const n=[],i=[];$R.forEach(o=>{const s=this[o](this);switch(o){case"union":t=s;break;case"columns":case"join":case"where":n.push(s);break;default:i.push(s);break}});const a=this.grouped.union&&this.grouped.union.map(o=>o.wrap).some(o=>o);if(this.onlyUnions()){const o=qt(n.concat(i)).join(" ");e+=t+(o?" "+o:"")}else{const o=(a?"(":"")+qt(n).join(" ")+(a?")":""),s=qt(i).join(" ");e+=o+(t?" "+t:"")+(s&&" "+s)}return e}pluck(){let e=this.single.pluck;return e.indexOf(".")!==-1&&(e=e.split(".").slice(-1)[0]),{sql:this.select(),pluck:e}}insert(){const e=this.single.insert||[],t=this.with()+`insert into ${this.tableName} `,n=this._insertBody(e);return n===""?"":t+n}_onConflictClause(e){return e instanceof lt?this.formatter.wrap(e):`(${this.formatter.columnize(e)})`}_buildInsertValues(e){let t="",n=-1;for(;++n<e.values.length;)n!==0&&(t+="), ("),t+=this.client.parameterize(e.values[n],this.client.valueForUndefined,this.builder,this.bindingsHolder);return t}_insertBody(e){let t="";if(Array.isArray(e)){if(e.length===0)return""}else if(typeof e=="object"&&Nl(e))return t+this._emptyInsertValue;const n=this._prepInsert(e);return typeof n=="string"?t+=n:n.columns.length?(t+=`(${ye(n.columns,this.builder,this.client,this.bindingsHolder)}`,t+=") values ("+this._buildInsertValues(n)+")"):e.length===1&&e[0]?t+=this._emptyInsertValue:t="",t}update(){const e=this.with(),{tableName:t}=this,n=this._prepUpdate(this.single.update),i=this.where();return e+`update ${this.single.only?"only ":""}${t} set `+n.join(", ")+(i?` ${i}`:"")}_hintComments(){let e=this.grouped.hintComments||[];return e=e.map(t=>qt(t.value).join(" ")),e=qt(e).join(" "),e?`/*+ ${e} */ `:""}columns(){let e="";if(this.onlyUnions())return"";const t=this._hintComments(),n=this.grouped.columns||[];let i=-1,a=[];if(n)for(;++i<n.length;){const s=n[i];if(s.distinct&&(e="distinct "),s.distinctOn){e=this.distinctOn(s.value);continue}s.type==="aggregate"?a.push(...this.aggregate(s)):s.type==="aggregateRaw"?a.push(this.aggregateRaw(s)):s.type==="analytic"?a.push(this.analytic(s)):s.type==="json"?a.push(this.json(s)):s.value&&s.value.length>0&&a.push(ye(s.value,this.builder,this.client,this.bindingsHolder))}return a.length===0&&(a=["*"]),`${this.onlyJson()?"":"select "}${t}${e}`+a.join(", ")+(this.tableName?` from ${this.single.only?"only ":""}${this.tableName}`:"")}_aggregate(e,{aliasSeparator:t=" as ",distinctParentheses:n}={}){const i=e.value,a=e.method,o=e.aggregateDistinct?"distinct ":"",s=g=>U(g,void 0,this.builder,this.client,this.bindingsHolder),l=(g,_)=>_?g+t+s(_):g,u=(g,_)=>{let f=g.map(s).join(", ");if(o){const y=n?"(":" ",w=n?")":"";f=o.trim()+y+f+w}const m=`${a}(${f})`;return l(m,_)},h=(g,_)=>{const f=`${a}(${o+s(g)})`;return l(f,_)};if(Array.isArray(i))return[u(i)];if(typeof i=="object"){if(e.alias)throw new Error("When using an object explicit alias can not be used");return Object.entries(i).map(([g,_])=>Array.isArray(_)?u(_,g):h(_,g))}const c=i.toLowerCase().indexOf(" as ");let d=i,{alias:p}=e;if(c!==-1){if(d=i.slice(0,c),p)throw new Error(`Found multiple aliases for same column: ${d}`);p=i.slice(c+4)}return[h(d,p)]}aggregate(e){return this._aggregate(e)}aggregateRaw(e){const t=e.aggregateDistinct?"distinct ":"";return`${e.method}(${t+ut(e.value,void 0,this.builder,this.client,this.bindingsHolder)})`}_joinTable(e){return e.schema&&!(e.table instanceof lt)?`${e.schema}.${e.table}`:e.table}join(){let e="",t=-1;const n=this.grouped.join;if(!n)return"";for(;++t<n.length;){const i=n[t],a=this._joinTable(i);if(t>0&&(e+=" "),i.joinType==="raw")e+=ut(i.table,void 0,this.builder,this.client,this.bindingsHolder);else{e+=i.joinType+" join "+U(a,void 0,this.builder,this.client,this.bindingsHolder);let o=-1;for(;++o<i.clauses.length;){const s=i.clauses[o];o>0?e+=` ${s.bool} `:e+=` ${s.type==="onUsing"?"using":"on"} `;const l=this[s.type](s);l&&(e+=l)}}}return e}onBetween(e){return U(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" "+this._not(e,"between")+" "+e.value.map(t=>this.client.parameter(t,this.builder,this.bindingsHolder)).join(" and ")}onNull(e){return U(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" is "+this._not(e,"null")}onExists(e){return this._not(e,"exists")+" ("+Te(e.value,void 0,this.builder,this.client,this.bindingsHolder)+")"}onIn(e){if(Array.isArray(e.column))return this.multiOnIn(e);let t;return e.value instanceof lt?t=this.client.parameter(e.value,this.builder,this.formatter):t=this.client.parameterize(e.value,void 0,this.builder,this.bindingsHolder),U(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" "+this._not(e,"in ")+this.wrap(t)}multiOnIn(e){let t=-1,n=`(${ye(e.column,this.builder,this.client,this.bindingsHolder)}) `;for(n+=this._not(e,"in ")+"((";++t<e.value.length;)t!==0&&(n+="),("),n+=this.client.parameterize(e.value[t],void 0,this.builder,this.bindingsHolder);return n+"))"}where(){const e=this.grouped.where;if(!e)return;const t=[];let n=-1;for(;++n<e.length;){const i=e[n];Object.prototype.hasOwnProperty.call(i,"value")&&hR.containsUndefined(i.value)&&(this.undefinedBindingsInfo.push(i.column),this._undefinedInWhereClause=!0);const a=this[i.type](i);a&&(t.length===0?t[0]="where":t.push(i.bool),t.push(a))}return t.length>1?t.join(" "):""}group(){return this._groupsOrders("group")}order(){return this._groupsOrders("order")}having(){const e=this.grouped.having;if(!e)return"";const t=["having"];for(let n=0,i=e.length;n<i;n++){const a=e[n],o=this[a.type](a);o&&(t.length===0&&(t[0]="where"),(t.length>1||t.length===1&&t[0]!=="having")&&t.push(a.bool),t.push(o))}return t.length>1?t.join(" "):""}havingRaw(e){return this._not(e,"")+ut(e.value,void 0,this.builder,this.client,this.bindingsHolder)}havingWrapped(e){const t=Te(e.value,"where",this.builder,this.client,this.bindingsHolder);return t&&this._not(e,"")+"("+t.slice(6)+")"||""}havingBasic(e){return this._not(e,"")+U(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" "+Rt(e.operator,this.builder,this.client,this.bindingsHolder)+" "+this.client.parameter(e.value,this.builder,this.bindingsHolder)}havingNull(e){return U(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" is "+this._not(e,"null")}havingExists(e){return this._not(e,"exists")+" ("+Te(e.value,void 0,this.builder,this.client,this.bindingsHolder)+")"}havingBetween(e){return U(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" "+this._not(e,"between")+" "+e.value.map(t=>this.client.parameter(t,this.builder,this.bindingsHolder)).join(" and ")}havingIn(e){return Array.isArray(e.column)?this.multiHavingIn(e):U(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" "+this._not(e,"in ")+this.wrap(this.client.parameterize(e.value,void 0,this.builder,this.bindingsHolder))}multiHavingIn(e){return this.multiOnIn(e)}union(){const e=this.onlyUnions(),t=this.grouped.union;if(!t)return"";let n="";for(let i=0,a=t.length;i<a;i++){const o=t[i];i>0&&(n+=" "),(i>0||!e)&&(n+=o.clause+" ");const s=Te(o.value,void 0,this.builder,this.client,this.bindingsHolder);if(s){const l=o.wrap;l&&(n+="("),n+=s,l&&(n+=")")}}return n}onlyUnions(){return(!this.grouped.columns||!!this.grouped.columns[0].value)&&this.grouped.union&&!this.tableName}_getValueOrParameterFromAttribute(e,t){return this.single.skipBinding[e]===!0?t??this.single[e]:this.client.parameter(this.single[e],this.builder,this.bindingsHolder)}onlyJson(){return!this.tableName&&this.grouped.columns&&this.grouped.columns.length===1&&this.grouped.columns[0].type==="json"}limit(){return!this.single.limit&&this.single.limit!==0?"":`limit ${this._getValueOrParameterFromAttribute("limit")}`}offset(){return this.single.offset?`offset ${this._getValueOrParameterFromAttribute("offset")}`:""}del(){const{tableName:e}=this,t=this.with(),n=this.where(),i=this.join(),a=i?e+" ":"";return t+`delete ${a}from ${this.single.only?"only ":""}${e}`+(i?` ${i}`:"")+(n?` ${n}`:"")}truncate(){return`truncate ${this.tableName}`}lock(){if(this.single.lock)return this[this.single.lock]()}waitMode(){if(this.single.waitMode)return this[this.single.waitMode]()}skipLocked(){throw new Error(".skipLocked() is currently only supported on MySQL 8.0+ and PostgreSQL 9.5+")}noWait(){throw new Error(".noWait() is currently only supported on MySQL 8.0+, MariaDB 10.3.0+ and PostgreSQL 9.5+")}distinctOn(e){throw new Error(".distinctOn() is currently only supported on PostgreSQL")}onWrapped(e){const t=this,n=new dR;e.value.call(n,n);let i="";for(let a=0;a<n.clauses.length;a++){const o=n.clauses[a];a>0&&(i+=` ${o.bool} `);const s=t[o.type](o);s&&(i+=s)}return i.length?`(${i})`:""}onBasic(e){const t=e.value instanceof _r;return U(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" "+Rt(e.operator,this.builder,this.client,this.bindingsHolder)+" "+(t?"(":"")+U(e.value,void 0,this.builder,this.client,this.bindingsHolder)+(t?")":"")}onVal(e){return U(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" "+Rt(e.operator,this.builder,this.client,this.bindingsHolder)+" "+this.client.parameter(e.value,this.builder,this.bindingsHolder)}onRaw(e){return ut(e.value,void 0,this.builder,this.client,this.bindingsHolder)}onUsing(e){return"("+ye(e.column,this.builder,this.client,this.bindingsHolder)+")"}_valueClause(e){return e.asColumn?U(e.value,void 0,this.builder,this.client,this.bindingsHolder):this.client.parameter(e.value,this.builder,this.bindingsHolder)}_columnClause(e){let t;return Array.isArray(e.column)?t=`(${ye(e.column,this.builder,this.client,this.bindingsHolder)})`:t=U(e.column,void 0,this.builder,this.client,this.bindingsHolder),t}whereIn(e){const t=this.client.values(e.value,this.builder,this.bindingsHolder);return`${this._columnClause(e)} ${this._not(e,"in ")}${t}`}whereLike(e){return`${this._columnClause(e)} ${this._not(e,"like ")}${this._valueClause(e)}`}whereILike(e){return`${this._columnClause(e)} ${this._not(e,"ilike ")}${this._valueClause(e)}`}whereNull(e){return U(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" is "+this._not(e,"null")}whereBasic(e){return this._not(e,"")+U(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" "+Rt(e.operator,this.builder,this.client,this.bindingsHolder)+" "+this._valueClause(e)}whereExists(e){return this._not(e,"exists")+" ("+Te(e.value,void 0,this.builder,this.client,this.bindingsHolder)+")"}whereWrapped(e){const t=Te(e.value,"where",this.builder,this.client,this.bindingsHolder);return t&&this._not(e,"")+"("+t.slice(6)+")"||""}whereBetween(e){return U(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" "+this._not(e,"between")+" "+e.value.map(t=>this.client.parameter(t,this.builder,this.bindingsHolder)).join(" and ")}whereRaw(e){return this._not(e,"")+ut(e.value,void 0,this.builder,this.client,this.bindingsHolder)}_jsonWrapValue(e){if(!this.builder._isJsonObject(e))try{return JSON.stringify(JSON.parse(e.replace(/\n|\t/g,"")))}catch{return e}return JSON.stringify(e)}_jsonValueClause(e){return e.value=this._jsonWrapValue(e.value),this._valueClause(e)}whereJsonObject(e){return`${this._columnClause(e)} ${e.not?"!=":"="} ${this._jsonValueClause(e)}`}wrap(e){return e.charAt(0)!=="("?`(${e})`:e}json(e){return this[e.method](e.params)}analytic(e){let t="";const n=this;return t+=e.method+"() over (",e.raw?t+=e.raw:(e.partitions.length&&(t+="partition by ",t+=ql(e.partitions,function(i){return Pn(i)?n.formatter.columnize(i):n.formatter.columnize(i.column)+(i.order?" "+i.order:"")}).join(", ")+" "),t+="order by ",t+=ql(e.order,function(i){return Pn(i)?n.formatter.columnize(i):n.formatter.columnize(i.column)+(i.order?" "+i.order:"")}).join(", ")),t+=")",e.alias&&(t+=" as "+e.alias),t}with(){if(!this.grouped.with||!this.grouped.with.length)return"";const e=this.grouped.with;if(!e)return;const t=[];let n=-1,i=!1;for(;++n<e.length;){const a=e[n];a.recursive&&(i=!0);const o=this[a.type](a);t.push(o)}return`with ${i?"recursive ":""}${t.join(", ")} `}withWrapped(e){const t=Te(e.value,void 0,this.builder,this.client,this.bindingsHolder),n=e.columnList?"("+ye(e.columnList,this.builder,this.client,this.bindingsHolder)+")":"",i=e.materialized===void 0?"":e.materialized?"materialized ":"not materialized ";return t&&ye(e.alias,this.builder,this.client,this.bindingsHolder)+n+" as "+i+"("+t+")"||""}_not(e,t){return e.not?`not ${t}`:t}_prepInsert(e){const t=Te(e,void 0,this.builder,this.client,this.bindingsHolder);if(t)return t;let n=[];const i=[];Array.isArray(e)||(e=e?[e]:[]);let a=-1;for(;++a<e.length&&e[a]!=null;){a===0&&(n=Object.keys(e[a]).sort());const o=new Array(n.length),s=Object.keys(e[a]);let l=-1;for(;++l<s.length;){const u=s[l];let h=n.indexOf(u);if(h===-1){n=n.concat(u).sort(),h=n.indexOf(u);let c=-1;for(;++c<i.length;)i[c].splice(h,0,void 0);o.splice(h,0,void 0)}o[h]=e[a][u]}i.push(o)}return{columns:n,values:i}}_prepUpdate(e={}){const{counter:t={}}=this.single;for(const o of Object.keys(t)){if(mR(e,o)){this.client.logger.warn("increment/decrement called for a column that has already been specified in main .update() call. Ignoring increment/decrement and using value from .update() call.");continue}let s=t[o];const l=s<0?"-":"+";l==="-"&&(s=-s),e[o]=this.client.raw(`?? ${l} ?`,[o,s])}e=gR(e,_R);const n=[],i=Object.keys(e);let a=-1;for(;++a<i.length;)n.push(U(i[a],void 0,this.builder,this.client,this.bindingsHolder)+" = "+this.client.parameter(e[i[a]],this.builder,this.bindingsHolder));if(Nl(n))throw new Error(["Empty .update() call detected!","Update data does not contain any values to update.","This will result in a faulty query.",this.single.table?`Table: ${this.single.table}.`:"",this.single.update?`Columns: ${Object.keys(this.single.update)}.`:""].join(" "));return n}_formatGroupsItemValue(e,t){const{formatter:n}=this;let i="";t==="last"?i=" is null":t==="first"&&(i=" is not null");let a;return e instanceof lt?a=ut(e,void 0,this.builder,this.client,this.bindingsHolder):e instanceof _r||t?a="("+n.columnize(e)+i+")":a=n.columnize(e),a}_basicGroupOrder(e,t){const n=this._formatGroupsItemValue(e.value,e.nulls),i=t==="order"&&e.type!=="orderByRaw"?` ${Rl(e.direction,this.builder,this.client,this.bindingsHolder)}`:"";return n+i}_groupOrder(e,t){return this._basicGroupOrder(e,t)}_groupOrderNulls(e,t){const n=this._formatGroupsItemValue(e.value),i=t==="order"&&e.type!=="orderByRaw"?` ${Rl(e.direction,this.builder,this.client,this.bindingsHolder)}`:"";return e.nulls&&!(e.value instanceof lt)?`${n}${i||""} nulls ${e.nulls}`:n+i}_groupsOrders(e){const t=this.grouped[e];if(!t)return"";const n=t.map(i=>this._groupOrder(i,e));return n.length?e+" by "+n.join(", "):""}get tableName(){if(!this._tableName){let e=this.single.table;const t=this.single.schema;if(e&&t){const n=e instanceof _r,i=e instanceof lt;!n&&!i&&!(typeof e=="function")&&(e=`${t}.${e}`)}this._tableName=e?U(e,e instanceof _r,this.builder,this.client,this.bindingsHolder):""}return this._tableName}_jsonPathWrap(e){return this.client.parameter(e.path||e[1],this.builder,this.bindingsHolder)}_jsonExtract(e,t){let n;return Array.isArray(t.column)?n=t.column:n=[t],Array.isArray(e)||(e=[e]),n.map(i=>{let a=`${ye(i.column||i[0],this.builder,this.client,this.bindingsHolder)}, ${this._jsonPathWrap(i)}`;e.forEach(s=>{a=s+"("+a+")"});const o=i.alias||i[2];return o?this.client.alias(a,this.formatter.wrap(o)):a}).join(", ")}_jsonSet(e,t){const n=`${e}(${ye(t.column,this.builder,this.client,this.bindingsHolder)}, ${this.client.parameter(t.path,this.builder,this.bindingsHolder)}, ${this.client.parameter(t.value,this.builder,this.bindingsHolder)})`;return t.alias?this.client.alias(n,this.formatter.wrap(t.alias)):n}_whereJsonPath(e,t){return`${e}(${this._columnClause(t)}, ${this._jsonPathWrap({path:t.jsonPath})}) ${Rt(t.operator,this.builder,this.client,this.bindingsHolder)} ${this._jsonValueClause(t)}`}_onJsonPathEquals(e,t){return e+"("+U(t.columnFirst,void 0,this.builder,this.client,this.bindingsHolder)+", "+this.client.parameter(t.jsonPathFirst,this.builder,this.bindingsHolder)+") = "+e+"("+U(t.columnSecond,void 0,this.builder,this.client,this.bindingsHolder)+", "+this.client.parameter(t.jsonPathSecond,this.builder,this.bindingsHolder)+")"}};const{EventEmitter:CR}=I,vR=$t,ER=Me,{addQueryContext:TR}=z,AR=An,{augmentWithBuilderInterface:OR}=On;let Fe=class extends CR{constructor(e){super(),this.client=e,this._sequence=[],e.config&&(this._debug=e.config.debug,AR(this,4))}withSchema(e){return this._schema=e,this}toString(){return this.toQuery()}toSQL(){return this.client.schemaCompiler(this).toSQL()}async generateDdlCommands(){return await this.client.schemaCompiler(this).generateDdlCommands()}};["createTable","createTableIfNotExists","createTableLike","createView","createViewOrReplace","createMaterializedView","refreshMaterializedView","dropView","dropViewIfExists","dropMaterializedView","dropMaterializedViewIfExists","createSchema","createSchemaIfNotExists","dropSchema","dropSchemaIfExists","createExtension","createExtensionIfNotExists","dropExtension","dropExtensionIfExists","table","alterTable","view","alterView","hasTable","hasColumn","dropTable","renameTable","renameView","dropTableIfExists","raw"].forEach(function(r){Fe.prototype[r]=function(){return r==="createTableIfNotExists"&&this.client.logger.warn(["Use async .hasTable to check if table exists and then use plain .createTable. Since ",'.createTableIfNotExists actually just generates plain "CREATE TABLE IF NOT EXIST..." ',"query it will not work correctly if there are any alter table queries generated for ","columns afterwards. To not break old migrations this function is left untouched for now",", but it should not be used when writing new code and it is removed from documentation."].join("")),r==="table"&&(r="alterTable"),r==="view"&&(r="alterView"),this._sequence.push({method:r,args:vR(arguments)}),this}}),Fe.extend=(r,e)=>{if(Object.prototype.hasOwnProperty.call(Fe.prototype,r))throw new Error(`Can't extend SchemaBuilder with existing method ('${r}').`);ER(Fe.prototype,{[r]:e})},OR(Fe),TR(Fe);var Sl=Fe;const NR=hr,{isString:xl}=M;function qR(r){r&&(xl(r)&&(r={sql:r}),r.bindings||(r.bindings=this.bindingsHolder.bindings),this.sequence.push(r),this.formatter=this.client.formatter(this._commonBuilder),this.bindings=[],this.formatter.bindings=this.bindings)}function RR(r){const e=new this.constructor(this.client,this.tableCompiler,this.columnBuilder);r.call(e,NR(arguments)),this.sequence.additional=(this.sequence.additional||[]).concat(e.sequence)}function SR(r){r&&(xl(r)&&(r={sql:r}),r.bindings||(r.bindings=this.bindingsHolder.bindings),this.sequence.unshift(r),this.formatter=this.client.formatter(this._commonBuilder),this.bindings=[],this.formatter.bindings=this.bindings)}var wr={pushAdditional:RR,pushQuery:qR,unshiftQuery:SR};const{pushQuery:xR,pushAdditional:IR,unshiftQuery:PR}=wr;let J=class{constructor(e,t){this.builder=t,this._commonBuilder=this.builder,this.client=e,this.schema=t._schema,this.bindings=[],this.bindingsHolder=this,this.formatter=e.formatter(t),this.formatter.bindings=this.bindings,this.sequence=[]}createSchema(){vr("createSchema")}createSchemaIfNotExists(){vr("createSchemaIfNotExists")}dropSchema(){vr("dropSchema")}dropSchemaIfExists(){vr("dropSchemaIfExists")}dropTable(e){this.pushQuery(this.dropTablePrefix+this.formatter.wrap(Bn(this.schema,e)))}dropTableIfExists(e){this.pushQuery(this.dropTablePrefix+"if exists "+this.formatter.wrap(Bn(this.schema,e)))}dropView(e){this._dropView(e,!1,!1)}dropViewIfExists(e){this._dropView(e,!0,!1)}dropMaterializedView(e){throw new Error("materialized views are not supported by this dialect.")}dropMaterializedViewIfExists(e){throw new Error("materialized views are not supported by this dialect.")}renameView(e,t){throw new Error("rename view is not supported by this dialect (instead drop then create another view).")}refreshMaterializedView(){throw new Error("materialized views are not supported by this dialect.")}_dropView(e,t,n){this.pushQuery((n?this.dropMaterializedViewPrefix:this.dropViewPrefix)+(t?"if exists ":"")+this.formatter.wrap(Bn(this.schema,e)))}raw(e,t){this.sequence.push(this.client.raw(e,t).toSQL())}toSQL(){const e=this.builder._sequence;for(let t=0,n=e.length;t<n;t++){const i=e[t];this[i.method].apply(this,i.args)}return this.sequence}async generateDdlCommands(){const e=this.toSQL();return{pre:[],sql:Array.isArray(e)?e:[e],check:null,post:[]}}};J.prototype.dropTablePrefix="drop table ",J.prototype.dropViewPrefix="drop view ",J.prototype.dropMaterializedViewPrefix="drop materialized view ",J.prototype.alterViewPrefix="alter view ",J.prototype.alterTable=$r("alter"),J.prototype.createTable=$r("create"),J.prototype.createTableIfNotExists=$r("createIfNot"),J.prototype.createTableLike=$r("createLike"),J.prototype.createView=Cr("create"),J.prototype.createViewOrReplace=Cr("createOrReplace"),J.prototype.createMaterializedView=Cr("createMaterializedView"),J.prototype.alterView=Cr("alter"),J.prototype.pushQuery=xR,J.prototype.pushAdditional=IR,J.prototype.unshiftQuery=PR;function Ln(r){const e=this.builder.queryContext();e!==void 0&&r.queryContext()===void 0&&r.queryContext(e),r.setSchema(this.schema);const t=r.toSQL();for(let n=0,i=t.length;n<i;n++)this.sequence.push(t[n])}function $r(r){return r==="createLike"?function(e,t,n){const i=this.client.tableBuilder(r,e,t,n);Ln.call(this,i)}:function(e,t){const n=this.client.tableBuilder(r,e,null,t);Ln.call(this,n)}}function Cr(r){return function(e,t){const n=this.client.viewBuilder(r,e,t);Ln.call(this,n)}}function Bn(r,e){return r?`${r}.${e}`:e}function vr(r){throw new Error(`${r} is not supported for this dialect (only PostgreSQL supports it currently).`)}var ct=J,LR=Pe,BR=cn,kR=Be,MR=BR(function(r,e){LR(e,kR(e),r)}),jR=MR,Er=jR;const QR=_t,Il=Er,DR=Me,Tr=$t,FR=z,{isString:UR,isFunction:HR,isObject:VR}=M;let Ae=class{constructor(e,t,n,i,a){if(this.client=e,this._fn=a,this._method=t,this._schemaName=void 0,this._tableName=n,this._tableNameLike=i,this._statements=[],this._single={},!i&&!HR(this._fn))throw new TypeError("A callback function must be supplied to calls against `.createTable` and `.table`")}setSchema(e){this._schemaName=e}toSQL(){return this._method==="alter"&&Il(this,kn),this._fn&&this._fn.call(this,this),this.client.tableCompiler(this).toSQL()}timestamps(e,t,n){VR(e)&&({useTimestamps:e,defaultToNow:t,useCamelCase:n}=e);const i=e===!0?"timestamp":"datetime",a=this[i](n?"createdAt":"created_at"),o=this[i](n?"updatedAt":"updated_at");if(t===!0){const s=this.client.raw("CURRENT_TIMESTAMP");a.notNullable().defaultTo(s),o.notNullable().defaultTo(s)}}comment(e){if(typeof e!="string")throw new TypeError("Table comment must be string");this._single.comment=e}foreign(e,t){const n={column:e,keyName:t};this._statements.push({grouping:"alterTable",method:"foreign",args:[n]});let i={references(a){let o;return UR(a)&&(o=a.split(".")),!o||o.length===1?(n.references=o?o[0]:a,{on(s){if(typeof s!="string")throw new TypeError(`Expected tableName to be a string, got: ${typeof s}`);return n.inTable=s,i},inTable(){return this.on.apply(this,arguments)}}):(n.inTable=o[0],n.references=o[1],i)},withKeyName(a){return n.keyName=a,i},onUpdate(a){return n.onUpdate=a,i},onDelete(a){return n.onDelete=a,i},deferrable:a=>{if(["mysql","mssql","redshift","mysql2","oracledb"].indexOf(this.client.dialect)!==-1)throw new Error(`${this.client.dialect} does not support deferrable`);return n.deferrable=a,i},_columnBuilder(a){return Il(a,i),i=a,a}};return i}check(e,t,n){return this._statements.push({grouping:"checks",args:[e,t,n]}),this}};["index","primary","unique","dropPrimary","dropUnique","dropIndex","dropForeign"].forEach(r=>{Ae.prototype[r]=function(){return this._statements.push({grouping:"alterTable",method:r,args:Tr(arguments)}),this}}),QR({mysql:["engine","charset","collate"],postgresql:["inherits"]},function(r,e){r.forEach(function(t){Ae.prototype[t]=function(n){if(this.client.dialect!==e)throw new Error(`Knex only supports ${t} statement with ${e}.`);if(this._method==="alter")throw new Error(`Knex does not support altering the ${t} outside of create table, please use knex.raw statement.`);this._single[t]=n}})}),FR.addQueryContext(Ae),["tinyint","smallint","mediumint","int","bigint","decimal","float","double","real","bit","boolean","serial","date","datetime","timestamp","time","year","geometry","geography","point","char","varchar","tinytext","tinyText","text","mediumtext","mediumText","longtext","longText","binary","varbinary","tinyblob","tinyBlob","mediumblob","mediumBlob","blob","longblob","longBlob","enum","set","bool","dateTime","increments","bigincrements","bigIncrements","integer","biginteger","bigInteger","string","json","jsonb","uuid","enu","specificType"].forEach(r=>{Ae.prototype[r]=function(){const e=Tr(arguments),t=this.client.columnBuilder(this,r,e);return this._statements.push({grouping:"columns",builder:t}),t}});const kn={renameColumn(r,e){return this._statements.push({grouping:"alterTable",method:"renameColumn",args:[r,e]}),this},dropTimestamps(){return this.dropColumns(arguments[0]===!0?["createdAt","updatedAt"]:["created_at","updated_at"])},setNullable(r){return this._statements.push({grouping:"alterTable",method:"setNullable",args:[r]}),this},check(r,e,t){this._statements.push({grouping:"alterTable",method:"check",args:[r,e,t]})},dropChecks(){this._statements.push({grouping:"alterTable",method:"dropChecks",args:Tr(arguments)})},dropNullable(r){return this._statements.push({grouping:"alterTable",method:"dropNullable",args:[r]}),this}};kn.dropColumn=kn.dropColumns=function(){return this._statements.push({grouping:"alterTable",method:"dropColumn",args:Tr(arguments)}),this},Ae.extend=(r,e)=>{if(Object.prototype.hasOwnProperty.call(Ae.prototype,r))throw new Error(`Can't extend TableBuilder with existing method ('${r}').`);DR(Ae.prototype,{[r]:e})};var Pl=Ae;function WR(r,e,t,n){for(var i=r.length,a=t+(n?1:-1);n?a--:++a<i;)if(e(r[a],a,r))return a;return-1}var zR=WR;function KR(r){return r!==r}var JR=KR;function GR(r,e,t){for(var n=t-1,i=r.length;++n<i;)if(r[n]===e)return n;return-1}var YR=GR,XR=zR,ZR=JR,eS=YR;function tS(r,e,t){return e===e?eS(r,e,t):XR(r,ZR,t)}var Ll=tS,rS=Ll,nS=pa,iS=Math.max;function sS(r,e,t){var n=r==null?0:r.length;if(!n)return-1;var i=t==null?0:nS(t);return i<0&&(i=iS(n+i,0)),rS(r,e,i)}var oS=sS;const{pushAdditional:aS,pushQuery:lS,unshiftQuery:uS}=wr,cS=z,hS=yr,dS=oS,Bl=le,fS=hr,{normalizeArr:pS}=z;let he=class{constructor(e,t){this.client=e,this.tableBuilder=t,this._commonBuilder=this.tableBuilder,this.method=t._method,this.schemaNameRaw=t._schemaName,this.tableNameRaw=t._tableName,this.tableNameLikeRaw=t._tableNameLike,this.single=t._single,this.grouped=hS(t._statements,"grouping"),this.formatter=e.formatter(t),this.bindings=[],this.formatter.bindings=this.bindings,this.bindingsHolder=this,this.sequence=[],this._formatting=e.config&&e.config.formatting,this.checksCount=0}toSQL(){return this[this.method](),this.sequence}create(e,t){const i=this.getColumns().map(o=>o.toSQL()),a=this.getColumnTypes(i);this.createAlterTableMethods&&this.alterTableForCreate(a),this.createQuery(a,e,t),this.columnQueries(i),delete this.single.comment,this.alterTable()}createIfNot(){this.create(!0)}createLike(){this.create(!1,!0)}createLikeIfNot(){this.create(!0,!0)}alter(){const t=this.getColumns().map(s=>s.toSQL()),n=this.getColumns("alter"),i=n.map(s=>s.toSQL()),a=this.getColumnTypes(t),o=this.getColumnTypes(i);this.addColumns(a),this.alterColumns(o,n),this.columnQueries(t),this.columnQueries(i),this.alterTable()}foreign(e){if(e.inTable&&e.references){const t=e.keyName?this.formatter.wrap(e.keyName):this._indexCommand("foreign",this.tableNameRaw,e.column),n=this.formatter.columnize(e.column),i=this.formatter.columnize(e.references),a=this.formatter.wrap(e.inTable),o=e.onUpdate?(this.lowerCase?" on update ":" ON UPDATE ")+e.onUpdate:"",s=e.onDelete?(this.lowerCase?" on delete ":" ON DELETE ")+e.onDelete:"",l=e.deferrable?this.lowerCase?` deferrable initially ${e.deferrable.toLowerCase()} `:` DEFERRABLE INITIALLY ${e.deferrable.toUpperCase()} `:"";this.lowerCase?this.pushQuery((this.forCreate?"":`alter table ${this.tableName()} add `)+"constraint "+t+" foreign key ("+n+") references "+a+" ("+i+")"+o+s+l):this.pushQuery((this.forCreate?"":`ALTER TABLE ${this.tableName()} ADD `)+"CONSTRAINT "+t+" FOREIGN KEY ("+n+") REFERENCES "+a+" ("+i+")"+o+s+l)}}getColumnTypes(e){return e.reduce(function(t,n){const i=n[0];return t.sql.push(i.sql),t.bindings.concat(i.bindings),t},{sql:[],bindings:[]})}columnQueries(e){const t=e.reduce(function(n,i){const a=fS(i);return Bl(a)?n:n.concat(a)},[]);for(const n of t)this.pushQuery(n)}addColumns(e,t){if(t=t||this.addColumnsPrefix,e.sql.length>0){const n=e.sql.map(i=>t+i);this.pushQuery({sql:(this.lowerCase?"alter table ":"ALTER TABLE ")+this.tableName()+" "+n.join(", "),bindings:e.bindings})}}alterColumns(e,t){e.sql.length>0&&this.addColumns(e,this.alterColumnsPrefix,t)}getColumns(e){const t=this.grouped.columns||[];e=e||"add";const n=this.tableBuilder.queryContext();return t.filter(i=>i.builder._method===e).map(i=>(n!==void 0&&i.builder.queryContext()===void 0&&i.builder.queryContext(n),this.client.columnCompiler(this,i.builder)))}tableName(){const e=this.schemaNameRaw?`${this.schemaNameRaw}.${this.tableNameRaw}`:this.tableNameRaw;return this.formatter.wrap(e)}tableNameLike(){const e=this.schemaNameRaw?`${this.schemaNameRaw}.${this.tableNameLikeRaw}`:this.tableNameLikeRaw;return this.formatter.wrap(e)}alterTable(){const e=this.grouped.alterTable||[];for(let t=0,n=e.length;t<n;t++){const i=e[t];this[i.method]?this[i.method].apply(this,i.args):this.client.logger.error(`Debug: ${i.method} does not exist`)}for(const t in this.single)typeof this[t]=="function"&&this[t](this.single[t])}alterTableForCreate(e){this.forCreate=!0;const t=this.sequence,n=this.grouped.alterTable||[];this.grouped.alterTable=[];for(let i=0,a=n.length;i<a;i++){const o=n[i];if(dS(this.createAlterTableMethods,o.method)<0){this.grouped.alterTable.push(o);continue}this[o.method]?(this.sequence=[],this[o.method].apply(this,o.args),e.sql.push(this.sequence[0].sql)):this.client.logger.error(`Debug: ${o.method} does not exist`)}this.sequence=t,this.forCreate=!1}dropIndex(e){this.pushQuery(`drop index${e}`)}dropUnique(){throw new Error("Method implemented in the dialect driver")}dropForeign(){throw new Error("Method implemented in the dialect driver")}dropColumn(){const e=cS.normalizeArr.apply(null,arguments),t=(Array.isArray(e)?e:[e]).map(n=>this.dropColumnPrefix+this.formatter.wrap(n));this.pushQuery((this.lowerCase?"alter table ":"ALTER TABLE ")+this.tableName()+" "+t.join(", "))}_setNullableState(e,t){const n=this.tableName(),i=this.formatter.columnize(e),a=this.alterColumnsPrefix;return this.pushQuery({sql:"SELECT 1",output:()=>this.client.queryBuilder().from(this.tableNameRaw).columnInfo(e).then(o=>{if(Bl(o))throw new Error(`.setNullable: Column ${i} does not exist in table ${n}.`);const s=t?"null":"not null",l=o.type+(o.maxLength?`(${o.maxLength})`:""),u=o.defaultValue!==null&&o.defaultValue!==void 0?`default '${o.defaultValue}'`:"",h=`alter table ${n} ${a} ${i} ${l} ${s} ${u}`;return this.client.raw(h)})})}setNullable(e){return this._setNullableState(e,!0)}dropNullable(e){return this._setNullableState(e,!1)}dropChecks(e){if(e===void 0)return"";e=pS(e);const n=`alter table ${this.tableName()} ${e.map(i=>`drop constraint ${i}`).join(", ")}`;this.pushQuery(n)}check(e,t,n){const i=this.tableName();let a=n;a||(this.checksCount++,a=i+"_"+this.checksCount);const o=`alter table ${i} add constraint ${a} check(${e})`;this.pushQuery(o)}_addChecks(){return this.grouped.checks?", "+this.grouped.checks.map(e=>`${e.args[2]?"constraint "+e.args[2]+" ":""}check (${this.client.raw(e.args[0],e.args[1])})`).join(", "):""}_indexCommand(e,t,n){Array.isArray(n)||(n=n?[n]:[]);const a=(t.replace(/\.|-/g,"_")+"_"+n.join("_")+"_"+e).toLowerCase();return this.formatter.wrap(a)}_getPrimaryKeys(){return(this.grouped.alterTable||[]).filter(e=>e.method==="primary").flatMap(e=>e.args).flat()}_canBeAddPrimaryKey(e){return e.primaryKey&&this._getPrimaryKeys().length===0}_getIncrementsColumnNames(){return this.grouped.columns.filter(e=>e.builder._type==="increments").map(e=>e.builder._args[0])}};he.prototype.pushQuery=lS,he.prototype.pushAdditional=aS,he.prototype.unshiftQuery=uS,he.prototype.lowerCase=!0,he.prototype.createAlterTableMethods=null,he.prototype.addColumnsPrefix="add column ",he.prototype.alterColumnsPrefix="alter column ",he.prototype.modifyColumnPrefix="modify column ",he.prototype.dropColumnPrefix="drop column ";var ht=he;const mS=Er,gS=Me,kl=$t,{addQueryContext:yS}=z;let be=class{constructor(e,t,n,i){this.client=e,this._method="add",this._single={},this._modifiers={},this._statements=[],this._type=wS[n]||n,this._args=i,this._tableBuilder=t,t._method==="alter"&&mS(this,Ar)}references(e){return this._tableBuilder.foreign.call(this._tableBuilder,this._args[0],void 0,this)._columnBuilder(this).references(e)}};const bS=["default","defaultsTo","defaultTo","unsigned","nullable","first","after","comment","collate","check","checkPositive","checkNegative","checkIn","checkNotIn","checkBetween","checkLength","checkRegex"],_S={default:"defaultTo",defaultsTo:"defaultTo"};bS.forEach(function(r){const e=_S[r]||r;be.prototype[r]=function(){return this._modifiers[e]=kl(arguments),this}}),yS(be),be.prototype.notNull=be.prototype.notNullable=function(){return this.nullable(!1)},["index","primary","unique"].forEach(function(r){be.prototype[r]=function(){return this._type.toLowerCase().indexOf("increments")===-1&&this._tableBuilder[r].apply(this._tableBuilder,[this._args[0]].concat(kl(arguments))),this}}),be.extend=(r,e)=>{if(Object.prototype.hasOwnProperty.call(be.prototype,r))throw new Error(`Can't extend ColumnBuilder with existing method ('${r}').`);gS(be.prototype,{[r]:e})};const Ar={};Ar.drop=function(){return this._single.drop=!0,this},Ar.alterType=function(r){return this._statements.push({grouping:"alterType",value:r}),this},Ar.alter=function({alterNullable:r=!0,alterType:e=!0}={}){return this._method="alter",this.alterNullable=r,this.alterType=e,this};const wS={float:"floating",enum:"enu",boolean:"bool",string:"varchar",bigint:"bigInteger"};var Or=be;function $S(r){return r&&r.length?r[0]:void 0}var CS=$S,vS=CS;const Mn=wr,ES=yr,TS=vS,AS=br,OS=hr,{toNumber:dt}=z,{formatDefault:NS}=je,{operator:jn}=K;let j=class{constructor(e,t,n){this.client=e,this.tableCompiler=t,this.columnBuilder=n,this._commonBuilder=this.columnBuilder,this.args=n._args,this.type=n._type.toLowerCase(),this.grouped=ES(n._statements,"grouping"),this.modified=n._modifiers,this.isIncrements=this.type.indexOf("increments")!==-1,this.formatter=e.formatter(n),this.bindings=[],this.formatter.bindings=this.bindings,this.bindingsHolder=this,this.sequence=[],this.modifiers=[],this.checksCount=0}_addCheckModifiers(){this.modifiers.push("check","checkPositive","checkNegative","checkIn","checkNotIn","checkBetween","checkLength","checkRegex")}defaults(e){if(Object.prototype.hasOwnProperty.call(this._defaultMap,e))return this._defaultMap[e].bind(this)();throw new Error(`There is no default for the specified identifier ${e}`)}toSQL(){return this.pushQuery(this.compileColumn()),this.sequence.additional&&(this.sequence=this.sequence.concat(this.sequence.additional)),this.sequence}compileColumn(){return this.formatter.wrap(this.getColumnName())+" "+this.getColumnType()+this.getModifiers()}getColumnName(){return TS(this.args)||this.defaults("columnName")}getColumnType(){if(!this._columnType){const e=this[this.type];this._columnType=typeof e=="function"?e.apply(this,OS(this.args)):e}return this._columnType}getModifiers(){const e=[];for(let t=0,n=this.modifiers.length;t<n;t++){const i=this.modifiers[t];if((!this.isIncrements||this.isIncrements&&i==="comment")&&AS(this.modified,i)){const a=this[i].apply(this,this.modified[i]);a&&e.push(a)}}return e.length>0?` ${e.join(" ")}`:""}varchar(e){return`varchar(${dt(e,255)})`}floating(e,t){return`float(${dt(e,8)}, ${dt(t,2)})`}decimal(e,t){if(e===null)throw new Error("Specifying no precision on decimal columns is not supported for that SQL dialect.");return`decimal(${dt(e,8)}, ${dt(t,2)})`}specifictype(e){return e}nullable(e){return e===!1?"not null":"null"}notNullable(){return this.nullable(!1)}defaultTo(e){return`default ${NS(e,this.type,this.client)}`}increments(e={primaryKey:!0}){return"integer not null"+(this.tableCompiler._canBeAddPrimaryKey(e)?" primary key":"")+" autoincrement"}bigincrements(e={primaryKey:!0}){return this.increments(e)}_pushAlterCheckQuery(e,t){let n=t;n||(this.checksCount++,n=this.tableCompiler.tableNameRaw+"_"+this.getColumnName()+"_"+this.checksCount),this.pushAdditional(function(){this.pushQuery(`alter table ${this.tableCompiler.tableName()} add constraint ${n} check(${e})`)})}_checkConstraintName(e){return e?`constraint ${e} `:""}_check(e,t){return this.columnBuilder._method==="alter"?(this._pushAlterCheckQuery(e,t),""):`${this._checkConstraintName(t)}check (${e})`}checkPositive(e){return this._check(`${this.formatter.wrap(this.getColumnName())} ${jn(">",this.columnBuilder,this.bindingsHolder)} 0`,e)}checkNegative(e){return this._check(`${this.formatter.wrap(this.getColumnName())} ${jn("<",this.columnBuilder,this.bindingsHolder)} 0`,e)}_checkIn(e,t,n){return this._check(`${this.formatter.wrap(this.getColumnName())} ${n?"not ":""}in (${e.map(i=>this.client._escapeBinding(i)).join(",")})`,t)}checkIn(e,t){return this._checkIn(e,t)}checkNotIn(e,t){return this._checkIn(e,t,!0)}checkBetween(e,t){e.length===2&&!Array.isArray(e[0])&&!Array.isArray(e[1])&&(e=[e]);const n=e.map(i=>`${this.formatter.wrap(this.getColumnName())} between ${this.client._escapeBinding(i[0])} and ${this.client._escapeBinding(i[1])}`).join(" or ");return this._check(n,t)}checkLength(e,t,n){return this._check(`length(${this.formatter.wrap(this.getColumnName())}) ${jn(e,this.columnBuilder,this.bindingsHolder)} ${dt(t)}`,n)}};j.prototype.binary="blob",j.prototype.bool="boolean",j.prototype.date="date",j.prototype.datetime="datetime",j.prototype.time="time",j.prototype.timestamp="timestamp",j.prototype.geometry="geometry",j.prototype.geography="geography",j.prototype.point="point",j.prototype.enu="varchar",j.prototype.bit=j.prototype.json="text",j.prototype.uuid=({useBinaryUuid:r=!1,primaryKey:e=!1}={})=>r?"binary(16)":"char(36)",j.prototype.integer=j.prototype.smallint=j.prototype.mediumint="integer",j.prototype.biginteger="bigint",j.prototype.text="text",j.prototype.tinyint="tinyint",j.prototype.pushQuery=Mn.pushQuery,j.prototype.pushAdditional=Mn.pushAdditional,j.prototype.unshiftQuery=Mn.unshiftQuery,j.prototype._defaultMap={columnName:function(){if(!this.isIncrements)throw new Error(`You did not specify a column name for the ${this.type} column.`);return"id"}};var Ue=j;const qS=at;var RS=class extends qS{constructor(e,t){super(e),this.ref=t,this._schema=null,this._alias=null}withSchema(e){return this._schema=e,this}as(e){return this._alias=e,this}toSQL(){const e=this._schema?`${this._schema}.${this.ref}`:this.ref,t=this.client.formatter(this),n=t.columnize(e),i=this._alias?`${n} as ${t.wrap(this._alias)}`:n;return this.set(i,[]),super.toSQL(...arguments)}};const{columnize:SS,wrap:xS}=K;var Nr=class{constructor(e,t){this.client=e,this.builder=t,this.bindings=[]}columnize(e){return SS(e,this.builder,this.client,this)}wrap(e,t){return xS(e,t,this.builder,this.client,this)}},R={};Object.defineProperty(R,"__esModule",{value:!0});var IS=I;function PS(r){if(r&&r.__esModule)return r;var e=Object.create(null);return r&&Object.keys(r).forEach(function(t){if(t!=="default"){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}}),e.default=r,Object.freeze(e)}var Qn=PS(IS);const{env:Oe={},argv:Ml=[],platform:LS=""}=typeof process>"u"?{}:process,BS="NO_COLOR"in Oe||Ml.includes("--no-color"),kS="FORCE_COLOR"in Oe||Ml.includes("--color"),MS=LS==="win32",jl=Oe.TERM==="dumb",jS=Qn&&Qn.isatty&&Qn.isatty(1)&&Oe.TERM&&!jl,QS="CI"in Oe&&("GITHUB_ACTIONS"in Oe||"GITLAB_CI"in Oe||"CIRCLECI"in Oe),Ql=!BS&&(kS||MS&&!jl||jS||QS),Dl=(r,e,t,n,i=e.substring(0,r)+n,a=e.substring(r+t.length),o=a.indexOf(t))=>i+(o<0?a:Dl(o,a,t,n)),DS=(r,e,t,n,i)=>r<0?t+e+n:t+Dl(r,e,n,i)+n,FS=(r,e,t=r,n=r.length+1)=>i=>i||!(i===""||i===void 0)?DS((""+i).indexOf(e,n),i,r,e,t):"",S=(r,e,t)=>FS(`\x1B[${r}m`,`\x1B[${e}m`,t),Fl={reset:S(0,0),bold:S(1,22,"\x1B[22m\x1B[1m"),dim:S(2,22,"\x1B[22m\x1B[2m"),italic:S(3,23),underline:S(4,24),inverse:S(7,27),hidden:S(8,28),strikethrough:S(9,29),black:S(30,39),red:S(31,39),green:S(32,39),yellow:S(33,39),blue:S(34,39),magenta:S(35,39),cyan:S(36,39),white:S(37,39),gray:S(90,39),bgBlack:S(40,49),bgRed:S(41,49),bgGreen:S(42,49),bgYellow:S(43,49),bgBlue:S(44,49),bgMagenta:S(45,49),bgCyan:S(46,49),bgWhite:S(47,49),blackBright:S(90,39),redBright:S(91,39),greenBright:S(92,39),yellowBright:S(93,39),blueBright:S(94,39),magentaBright:S(95,39),cyanBright:S(96,39),whiteBright:S(97,39),bgBlackBright:S(100,49),bgRedBright:S(101,49),bgGreenBright:S(102,49),bgYellowBright:S(103,49),bgBlueBright:S(104,49),bgMagentaBright:S(105,49),bgCyanBright:S(106,49),bgWhiteBright:S(107,49)},Ul=({useColor:r=Ql}={})=>r?Fl:Object.keys(Fl).reduce((e,t)=>({...e,[t]:String}),{}),{reset:US,bold:HS,dim:VS,italic:WS,underline:zS,inverse:KS,hidden:JS,strikethrough:GS,black:YS,red:XS,green:ZS,yellow:e1,blue:t1,magenta:r1,cyan:n1,white:i1,gray:s1,bgBlack:o1,bgRed:a1,bgGreen:l1,bgYellow:u1,bgBlue:c1,bgMagenta:h1,bgCyan:d1,bgWhite:f1,blackBright:p1,redBright:m1,greenBright:g1,yellowBright:y1,blueBright:b1,magentaBright:_1,cyanBright:w1,whiteBright:$1,bgBlackBright:C1,bgRedBright:v1,bgGreenBright:E1,bgYellowBright:T1,bgBlueBright:A1,bgMagentaBright:O1,bgCyanBright:N1,bgWhiteBright:q1}=Ul();R.bgBlack=o1,R.bgBlackBright=C1,R.bgBlue=c1,R.bgBlueBright=A1,R.bgCyan=d1,R.bgCyanBright=N1,R.bgGreen=l1,R.bgGreenBright=E1,R.bgMagenta=h1,R.bgMagentaBright=O1,R.bgRed=a1,R.bgRedBright=v1,R.bgWhite=f1,R.bgWhiteBright=q1,R.bgYellow=u1,R.bgYellowBright=T1,R.black=YS,R.blackBright=p1,R.blue=t1,R.blueBright=b1,R.bold=HS,R.createColors=Ul,R.cyan=n1,R.cyanBright=w1,R.dim=VS,R.gray=s1,R.green=ZS,R.greenBright=g1,R.hidden=JS,R.inverse=KS,R.isColorSupported=Ql,R.italic=WS,R.magenta=r1,R.magentaBright=_1,R.red=XS,R.redBright=m1,R.reset=US,R.strikethrough=GS,R.underline=zS,R.white=i1,R.whiteBright=$1,R.yellow=e1,R.yellowBright=y1;const Dn=R,{inspect:R1}=I,{isString:S1,isFunction:Hl}=M;let x1=class{constructor(e={}){const{log:{debug:t,warn:n,error:i,deprecate:a,inspectionDepth:o,enableColors:s}={}}=e;this._inspectionDepth=o||5,this._enableColors=I1(s),this._debug=t,this._warn=n,this._error=i,this._deprecate=a}_log(e,t,n){if(t!=null&&!Hl(t))throw new TypeError("Extensions to knex logger must be functions!");if(Hl(t)){t(e);return}S1(e)||(e=R1(e,{depth:this._inspectionDepth,colors:this._enableColors})),console.log(n?n(e):e)}debug(e){this._log(e,this._debug)}warn(e){this._log(e,this._warn,Dn.yellow)}error(e){this._log(e,this._error,Dn.red)}deprecate(e,t){const n=`${e} is deprecated, please use ${t}`;this._log(n,this._deprecate,Dn.yellow)}};function I1(r){return r??(process&&process.stdout?process.stdout.isTTY:!1)}var P1=x1;const L1=z,B1=Er,k1=Me;let St=class{constructor(e,t,n,i){this.client=e,this._method=t,this._schemaName=void 0,this._columns=void 0,this._fn=i,this._viewName=n,this._statements=[],this._single={}}setSchema(e){this._schemaName=e}columns(e){this._columns=e}as(e){this._selectQuery=e}checkOption(){throw new Error("check option definition is not supported by this dialect.")}localCheckOption(){throw new Error("check option definition is not supported by this dialect.")}cascadedCheckOption(){throw new Error("check option definition is not supported by this dialect.")}toSQL(){return this._method==="alter"&&B1(this,M1),this._fn.call(this,this),this.client.viewCompiler(this).toSQL()}};const M1={column(r){const e=this;return{rename:function(t){return e._statements.push({grouping:"alterView",method:"renameColumn",args:[r,t]}),this},defaultTo:function(t){return e._statements.push({grouping:"alterView",method:"defaultTo",args:[r,t]}),this}}}};L1.addQueryContext(St),St.extend=(r,e)=>{if(Object.prototype.hasOwnProperty.call(St.prototype,r))throw new Error(`Can't extend ViewBuilder with existing method ('${r}').`);k1(St.prototype,{[r]:e})};var xt=St;const{pushQuery:j1}=wr,Q1=yr,{columnize:D1}=K;let Vl=class{constructor(e,t){this.client=e,this.viewBuilder=t,this._commonBuilder=this.viewBuilder,this.method=t._method,this.schemaNameRaw=t._schemaName,this.viewNameRaw=t._viewName,this.single=t._single,this.selectQuery=t._selectQuery,this.columns=t._columns,this.grouped=Q1(t._statements,"grouping"),this.formatter=e.formatter(t),this.bindings=[],this.formatter.bindings=this.bindings,this.bindingsHolder=this,this.sequence=[]}toSQL(){return this[this.method](),this.sequence}create(){this.createQuery(this.columns,this.selectQuery)}createOrReplace(){throw new Error("replace views is not supported by this dialect.")}createMaterializedView(){throw new Error("materialized views are not supported by this dialect.")}createQuery(e,t,n,i){const a="create "+(n?"materialized ":"")+(i?"or replace ":"")+"view ",o=e?" ("+D1(e,this.viewBuilder,this.client,this.bindingsHolder)+")":"";let s=a+this.viewName()+o;switch(s+=" as ",s+=t.toString(),this.single.checkOption){case"default_option":s+=" with check option";break;case"local":s+=" with local check option";break;case"cascaded":s+=" with cascaded check option";break}this.pushQuery({sql:s})}renameView(e,t){throw new Error("rename view is not supported by this dialect (instead drop, then create another view).")}refreshMaterializedView(){throw new Error("materialized views are not supported by this dialect.")}alter(){this.alterView()}alterView(){const e=this.grouped.alterView||[];for(let t=0,n=e.length;t<n;t++){const i=e[t];this[i.method]?this[i.method].apply(this,i.args):this.client.logger.error(`Debug: ${i.method} does not exist`)}for(const t in this.single)typeof this[t]=="function"&&this[t](this.single[t])}renameColumn(e,t){throw new Error("rename column of views is not supported by this dialect.")}defaultTo(e,t){throw new Error("change default values of views is not supported by this dialect.")}viewName(){const e=this.schemaNameRaw?`${this.schemaNameRaw}.${this.viewNameRaw}`:this.viewNameRaw;return this.formatter.wrap(e)}};Vl.prototype.pushQuery=j1;var ft=Vl;const{Pool:F1,TimeoutError:U1}=ih,{EventEmitter:H1}=I,{promisify:V1}=I,{makeEscape:W1}=Dr,z1=__,K1=Ho,J1=Go,G1=vw,Y1=Ce,{executeQuery:X1,enrichQueryObject:Wl}=Sa,Z1=Ee,ex=De,tx=Sl,rx=ct,nx=Pl,ix=ht,sx=Or,ox=Ue,{KnexTimeoutError:ax}=we,{outputQuery:lx,unwrapRaw:ux}=K,{compileCallback:cx}=je,hx=at,dx=RS,fx=Nr,px=P1,{POOL_CONFIG_OPTIONS:mx}=Tn,gx=xt,yx=ft,bx=$e,Fn=ae("knex:client");let zl=class extends H1{constructor(e={}){if(super(),this.config=e,this.logger=new px(e),this.dialect&&!this.config.client&&this.logger.warn("Using 'this.dialect' to identify the client is deprecated and support for it will be removed in the future. Please use configuration option 'client' instead."),!(this.config.client||this.dialect))throw new Error("knex: Required configuration option 'client' is missing.");e.version&&(this.version=e.version),e.connection&&e.connection instanceof Function?(this.connectionConfigProvider=e.connection,this.connectionConfigExpirationChecker=()=>!0):(this.connectionSettings=z1(e.connection||{}),this.connectionConfigExpirationChecker=null),this.driverName&&e.connection&&(this.initializeDriver(),(!e.pool||e.pool&&e.pool.max!==0)&&this.initializePool(e)),this.valueForUndefined=this.raw("DEFAULT"),e.useNullAsDefault&&(this.valueForUndefined=null)}formatter(e){return new fx(this,e)}queryBuilder(){return new Z1(this)}queryCompiler(e,t){return new ex(this,e,t)}schemaBuilder(){return new tx(this)}schemaCompiler(e){return new rx(this,e)}tableBuilder(e,t,n,i){return new nx(this,e,t,n,i)}viewBuilder(e,t,n){return new gx(this,e,t,n)}tableCompiler(e){return new ix(this,e)}viewCompiler(e){return new yx(this,e)}columnBuilder(e,t,n){return new sx(this,e,t,n)}columnCompiler(e,t){return new ox(this,e,t)}runner(e){return new G1(this,e)}transaction(e,t,n){return new Y1(this,e,t,n)}raw(){return new hx(this).set(...arguments)}ref(){return new dx(this,...arguments)}query(e,t){const n=Wl(e,t,this);return X1(e,n,this)}stream(e,t,n,i){const a=Wl(e,t,this);return this._stream(e,a,n,i)}prepBindings(e){return e}positionBindings(e){return e}postProcessResponse(e,t){return this.config.postProcessResponse?this.config.postProcessResponse(e,t):e}wrapIdentifier(e,t){return this.customWrapIdentifier(e,this.wrapIdentifierImpl,t)}customWrapIdentifier(e,t,n){return this.config.wrapIdentifier?this.config.wrapIdentifier(e,t,n):t(e)}wrapIdentifierImpl(e){return e!=="*"?`"${e.replace(/"/g,'""')}"`:"*"}initializeDriver(){try{this.driver=this._driver()}catch(e){const t=`Knex: run
$ npm install ${this.driverName} --save`;throw this.logger.error(`${t}
${e.message}
${e.stack}`),new Error(`${t}
${e.message}`)}}poolDefaults(){return{min:2,max:10,propagateCreateError:!0}}getPoolSettings(e){e=K1({},e,this.poolDefaults()),mx.forEach(a=>{a in e&&this.logger.warn([`Pool config option "${a}" is no longer supported.`,"See https://github.com/Vincit/tarn.js for possible pool config options."].join(" "))});const t=6e4,n=[this.config.acquireConnectionTimeout,e.acquireTimeoutMillis].filter(a=>a!==void 0);n.length||n.push(t),e.acquireTimeoutMillis=Math.min(...n);const i=async()=>{if(!this.connectionConfigProvider||!this.connectionConfigExpirationChecker||!this.connectionConfigExpirationChecker())return;const a=await this.connectionConfigProvider();a.expirationChecker?(this.connectionConfigExpirationChecker=a.expirationChecker,delete a.expirationChecker):this.connectionConfigExpirationChecker=null,this.connectionSettings=a};return Object.assign(e,{create:async()=>{await i();const a=await this.acquireRawConnection();return a.__knexUid=J1("__knexUid"),e.afterCreate&&await V1(e.afterCreate)(a),a},destroy:a=>{if(a!==void 0)return this.destroyRawConnection(a)},validate:a=>a.__knex__disposed?(this.logger.warn(`Connection Error: ${a.__knex__disposed}`),!1):this.validateConnection(a)})}initializePool(e=this.config){if(this.pool){this.logger.warn("The pool has already been initialized");return}const t={...this.getPoolSettings(e.pool)};t.afterCreate&&delete t.afterCreate,this.pool=new F1(t)}validateConnection(e){return!0}async acquireConnection(){if(!this.pool)throw new Error("Unable to acquire a connection");try{const e=await this.pool.acquire().promise;return Fn("acquired connection from pool: %s",e.__knexUid),e}catch(e){let t=e;throw e instanceof U1&&(t=new ax("Knex: Timeout acquiring a connection. The pool is probably full. Are you missing a .transacting(trx) call?")),t}}releaseConnection(e){return Fn("releasing connection to pool: %s",e.__knexUid),this.pool.release(e)||Fn("pool refused connection: %s",e.__knexUid),Promise.resolve()}async destroy(e){try{this.pool&&this.pool.destroy&&await this.pool.destroy(),this.pool=void 0,typeof e=="function"&&e()}catch(t){if(typeof e=="function")return e(t);throw t}}database(){return this.connectionSettings.database}toString(){return"[object KnexClient]"}assertCanCancelQuery(){if(!this.canCancelQuery)throw new Error("Query cancelling not supported for this dialect")}cancelQuery(){throw new Error("Query cancelling not supported for this dialect")}alias(e,t){return e+" as "+t}parameter(e,t,n){return typeof e=="function"?lx(cx(e,void 0,this,n),!0,t,this):ux(e,!0,t,this,n)||"?"}parameterize(e,t,n,i){if(typeof e=="function")return this.parameter(e,n,i);e=Array.isArray(e)?e:[e];let a="",o=-1;for(;++o<e.length;){o>0&&(a+=", ");let s=e[o];bx(s)&&(s=JSON.stringify(s)),a+=this.parameter(s===void 0?t:s,n,i)}return a}values(e,t,n){return Array.isArray(e)?Array.isArray(e[0])?`(${e.map(i=>`(${this.parameterize(i,void 0,t,n)})`).join(", ")})`:`(${this.parameterize(e,void 0,t,n)})`:e&&e.isRawInstance?`(${this.parameter(e,t,n)})`:this.parameter(e,t,n)}processPassedConnection(e){}toPathForJson(e){return e}};Object.assign(zl.prototype,{_escapeBinding:W1({escapeString(r){return`'${r.replace(/'/g,"''")}'`}}),canCancelQuery:!1});var He=zl,_x=I,Un=I;function Hn(r){if(r.charAt(0)==="/"){var t=r.split(" ");return{host:t[0],database:t[1]}}var e=_x.parse(/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(r)?encodeURI(r).replace(/\%25(\d\d)/g,"%$1"):r,!0),t=e.query;for(var n in t)Array.isArray(t[n])&&(t[n]=t[n][t[n].length-1]);var i=(e.auth||":").split(":");if(t.user=i[0],t.password=i.splice(1).join(":"),t.port=e.port,e.protocol=="socket:")return t.host=decodeURI(e.pathname),t.database=e.query.db,t.client_encoding=e.query.encoding,t;t.host||(t.host=e.hostname);var a=e.pathname;if(!t.host&&a&&/^%2f/i.test(a)){var o=a.split("/");t.host=decodeURIComponent(o[0]),a=o.splice(1).join("/")}switch(a&&a.charAt(0)==="/"&&(a=a.slice(1)||null),t.database=a&&decodeURI(a),(t.ssl==="true"||t.ssl==="1")&&(t.ssl=!0),t.ssl==="0"&&(t.ssl=!1),(t.sslcert||t.sslkey||t.sslrootcert||t.sslmode)&&(t.ssl={}),t.sslcert&&(t.ssl.cert=Un.readFileSync(t.sslcert).toString()),t.sslkey&&(t.ssl.key=Un.readFileSync(t.sslkey).toString()),t.sslrootcert&&(t.ssl.ca=Un.readFileSync(t.sslrootcert).toString()),t.sslmode){case"disable":{t.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{t.ssl.rejectUnauthorized=!1;break}}return t}var wx=Hn;Hn.parse=Hn;const{parse:$x}=wx,Cx=$x,vx=process&&process.platform&&process.platform==="win32";function Ex(r){try{return new URL(r)}catch{return null}}var Tx=function(e){const t=Ex(e),n=vx&&t&&t.protocol.length===2;if(!t||n)return{client:"sqlite3",connection:{filename:e}};let{protocol:i}=t;i.slice(-1)===":"&&(i=i.slice(0,-1));const a=["postgresql","postgres"].includes(i);return{client:i,connection:a?Cx(e):Ax(t)}};function Ax(r){const e={};let t=r.pathname;if(t[0]==="/"&&(t=t.slice(1)),e.database=t,r.hostname&&(r.protocol.indexOf("mssql")===0?e.server=r.hostname:e.host=r.hostname),r.port&&(e.port=r.port),(r.username||r.password)&&(e.user=decodeURIComponent(r.username)),r.password&&(e.password=decodeURIComponent(r.password)),r.searchParams)for(const[n,i]of r.searchParams.entries())if(["mysql:","mariadb:","mssql:"].includes(r.protocol))try{e[n]=JSON.parse(i)}catch{e[n]=i}else e[n]=i;return e}var qr={},Vn,Kl;function Ox(){if(Kl)return Vn;Kl=1;const r=Ce;class e extends r{begin(n){return this.isolationLevel&&this.client.logger.warn("sqlite3 only supports serializable transactions, ignoring the isolation level param"),this.query(n,"BEGIN;")}}return Vn=e,Vn}var Wn,Jl;function Nx(){if(Jl)return Wn;Jl=1;const r=Do,e=_t,t=ie,n=le,i=Tt,a=De,o=sr,{isString:s}=M,{wrapString:l,columnize:u}=K,h=r("");class c extends a{constructor(p,g,_){super(p,g,_),this.forShare=h,this.forKeyShare=h,this.forUpdate=h,this.forNoKeyUpdate=h}insert(){const p=this.single.insert||[];let g=this.with()+`insert into ${this.tableName} `;if(Array.isArray(p)){if(p.length===0)return"";if(p.length===1&&p[0]&&n(p[0]))return{sql:g+this._emptyInsertValue}}else if(typeof p=="object"&&n(p))return{sql:g+this._emptyInsertValue};const _=this._prepInsert(p);if(s(_))return{sql:g+_};if(_.columns.length===0)return{sql:""};if(g+=`(${this.formatter.columnize(_.columns)})`,this.client.valueForUndefined!==null&&_.values.forEach(C=>{e(C,T=>{if(T===void 0)throw new TypeError("`sqlite` does not support inserting default values. Specify values explicitly or use the `useNullAsDefault` config flag. (see docs https://knexjs.org/guide/query-builder.html#insert).")})}),_.values.length===1){const C=this.client.parameterize(_.values[0],this.client.valueForUndefined,this.builder,this.bindingsHolder);g+=` values (${C})`;const{onConflict:T,ignore:N,merge:P}=this.single;if(T&&N)g+=this._ignore(T);else if(T&&P){g+=this._merge(P.updates,T,p);const G=this.where();G&&(g+=` ${G}`)}const{returning:L}=this.single;return L&&(g+=this._returning(L)),{sql:g,returning:L}}const f=[];let m=-1;for(;++m<_.values.length;){let C=-1;const T=f[m]=[];let N=_.values[m];for(N=N===void 0?this.client.valueForUndefined:N;++C<_.columns.length;)T.push(this.client.alias(this.client.parameter(N[C],this.builder,this.bindingsHolder),this.formatter.wrap(_.columns[C])));f[m]=T.join(", ")}g+=" select "+f.join(" union all select ");const{onConflict:y,ignore:w,merge:$}=this.single;y&&w?g+=" where true"+this._ignore(y):y&&$&&(g+=" where true"+this._merge($.updates,y,p));const{returning:E}=this.single;return E&&(g+=this._returning(E)),{sql:g,returning:E}}update(){const p=this.with(),g=this._prepUpdate(this.single.update),_=this.where(),{returning:f}=this.single;return{sql:p+`update ${this.single.only?"only ":""}${this.tableName} set ${g.join(", ")}`+(_?` ${_}`:"")+this._returning(f),returning:f}}_ignore(p){return p===!0?" on conflict do nothing":` on conflict ${this._onConflictClause(p)} do nothing`}_merge(p,g,_){let f=` on conflict ${this._onConflictClause(g)} do update set `;if(p&&Array.isArray(p))return f+=p.map(m=>l(m.split(".").pop(),this.formatter.builder,this.client,this.formatter)).map(m=>`${m} = excluded.${m}`).join(", "),f;if(p&&typeof p=="object"){const m=this._prepUpdate(p);return typeof m=="string"?f+=m:f+=m.join(","),f}else{const m=this._prepInsert(_);if(typeof m=="string")throw new Error("If using merge with a raw insert query, then updates must be provided");return f+=m.columns.map(y=>l(y.split(".").pop(),this.builder,this.client)).map(y=>`${y} = excluded.${y}`).join(", "),f}}_returning(p){return p?` returning ${this.formatter.columnize(p)}`:""}truncate(){const{table:p}=this.single;return{sql:`delete from ${this.tableName}`,output(){return this.query({sql:`delete from sqlite_sequence where name = '${p}'`}).catch(o)}}}columnInfo(){const p=this.single.columnInfo;return{sql:`PRAGMA table_info(\`${this.client.customWrapIdentifier(this.single.table,t)}\`)`,output(_){const f=/.*\((\d+)\)/,m=i(_,function(y,w){let{type:$}=w,E=$.match(f);return E&&(E=E[1]),$=E?$.split("(")[0]:$,y[w.name]={type:$.toLowerCase(),maxLength:E,nullable:!w.notnull,defaultValue:w.dflt_value},y},{});return p&&m[p]||m}}}limit(){const p=!this.single.limit&&this.single.limit!==0;return p&&!this.single.offset?"":(this.single.limit=p?-1:this.single.limit,`limit ${this._getValueOrParameterFromAttribute("limit")}`)}jsonExtract(p){return this._jsonExtract("json_extract",p)}jsonSet(p){return this._jsonSet("json_set",p)}jsonInsert(p){return this._jsonSet("json_insert",p)}jsonRemove(p){const g=`json_remove(${u(p.column,this.builder,this.client,this.bindingsHolder)},${this.client.parameter(p.path,this.builder,this.bindingsHolder)})`;return p.alias?this.client.alias(g,this.formatter.wrap(p.alias)):g}whereJsonPath(p){return this._whereJsonPath("json_extract",p)}whereJsonSupersetOf(p){throw new Error("Json superset where clause not actually supported by SQLite")}whereJsonSubsetOf(p){throw new Error("Json subset where clause not actually supported by SQLite")}onJsonPathEquals(p){return this._onJsonPathEquals("json_extract",p)}}return Wn=c,Wn}var zn,Gl;function qx(){if(Gl)return zn;Gl=1;var r=it;function e(t,n){var i;return r(t,function(a,o,s){return i=n(a,o,s),!i}),!!i}return zn=e,zn}var Kn,Yl;function Rx(){if(Yl)return Kn;Yl=1;var r=ja(),e=me,t=qx(),n=F,i=rr;function a(o,s,l){var u=n(o)?r:t;return l&&i(o,s,l)&&(s=void 0),u(o,e(s))}return Kn=a,Kn}var Jn,Xl;function Sx(){if(Xl)return Jn;Xl=1;const r=ct,e=Rx();class t extends r{constructor(i,a){super(i,a)}hasTable(i){const a=`select * from sqlite_master where type = 'table' and name = ${this.client.parameter(this.formatter.wrap(i).replace(/`/g,""),this.builder,this.bindingsHolder)}`;this.pushQuery({sql:a,output:o=>o.length>0})}hasColumn(i,a){this.pushQuery({sql:`PRAGMA table_info(${this.formatter.wrap(i)})`,output(o){return e(o,s=>this.client.wrapIdentifier(s.name.toLowerCase())===this.client.wrapIdentifier(a.toLowerCase()))}})}renameTable(i,a){this.pushQuery(`alter table ${this.formatter.wrap(i)} rename to ${this.formatter.wrap(a)}`)}async generateDdlCommands(){const i=this.builder._sequence;for(let o=0,s=i.length;o<s;o++){const l=i[o];this[l.method].apply(this,l.args)}const a=this.sequence;if(a.length===1&&a[0].statementsProducer)return a[0].statementsProducer();{const o=[];for(const s of a){const l=s.sql;Array.isArray(l)?o.push(...l):o.push(l)}return{pre:[],sql:o,check:null,post:[]}}}}return Jn=t,Jn}var Gn,Zl;function xx(){if(Zl)return Gn;Zl=1;const r=Ue;class e extends r{constructor(){super(...arguments),this.modifiers=["nullable","defaultTo"],this._addCheckModifiers()}enu(n){return`text check (${this.formatter.wrap(this.args[0])} in ('${n.join("', '")}'))`}_pushAlterCheckQuery(n,i){throw new Error("Alter table with to add constraints is not permitted in SQLite")}checkRegex(n,i){return this._check(`${this.formatter.wrap(this.getColumnName())} REGEXP ${this.client._escapeBinding(n)}`,i)}}return e.prototype.json="json",e.prototype.jsonb="json",e.prototype.double=e.prototype.decimal=e.prototype.floating="float",e.prototype.timestamp="datetime",e.prototype.increments=e.prototype.bigincrements="integer not null primary key autoincrement",Gn=e,Gn}var Yn,eu;function Ix(){if(eu)return Yn;eu=1;var r=Gr,e=Ia,t=me,n=F;function i(a,o){var s=n(a)?r:e;return s(a,t(o))}return Yn=i,Yn}var Xn,tu;function Px(){if(tu)return Xn;tu=1;const r=Ix(),e=pl,t=ie,{isObject:n}=M,i=ht,{formatDefault:a}=je;class o extends i{constructor(){super(...arguments)}createQuery(l,u,h){let d=(u?"create table if not exists ":"create table ")+this.tableName();h&&this.tableNameLike()?d+=" as select * from "+this.tableNameLike()+" where 0=1":(d+=" ("+l.sql.join(", "),d+=this.foreignKeys()||"",d+=this.primaryKeys()||"",d+=this._addChecks(),d+=")"),this.pushQuery(d),h&&this.addColumns(l,this.addColumnsPrefix)}addColumns(l,u,h){if(u===this.alterColumnsPrefix){const c=this,d=h.map(p=>{const g=this.client.customWrapIdentifier(p.getColumnName(),t,p.columnBuilder.queryContext()),_=p.getColumnType(),f=p.modified.defaultTo?a(p.modified.defaultTo[0],p.type,this.client):null,m=p.modified.nullable&&p.modified.nullable[0]===!1;return{name:g,type:_,defaultTo:f,notNull:m}});this.pushQuery({sql:`PRAGMA table_info(${this.tableName()})`,statementsProducer(p,g){return c.client.ddl(c,p,g).alterColumn(d)}})}else for(let c=0,d=l.sql.length;c<d;c++)this.pushQuery({sql:`alter table ${this.tableName()} add column ${l.sql[c]}`,bindings:l.bindings[c]})}dropUnique(l,u){u=u?this.formatter.wrap(u):this._indexCommand("unique",this.tableNameRaw,l),this.pushQuery(`drop index ${u}`)}dropForeign(l,u){const h=this;l=Array.isArray(l)?l:[l],l=l.map(c=>this.client.customWrapIdentifier(c,t)),u=this.client.customWrapIdentifier(u,t),this.pushQuery({sql:`PRAGMA table_info(${this.tableName()})`,output(c){return h.client.ddl(h,c,this.connection).dropForeign(l,u)}})}dropPrimary(l){const u=this;l=this.client.customWrapIdentifier(l,t),this.pushQuery({sql:`PRAGMA table_info(${this.tableName()})`,output(h){return u.client.ddl(u,h,this.connection).dropPrimary(l)}})}dropIndex(l,u){u=u?this.formatter.wrap(u):this._indexCommand("index",this.tableNameRaw,l),this.pushQuery(`drop index ${u}`)}unique(l,u){let h,c;n(u)&&({indexName:u,deferrable:h,predicate:c}=u),h&&h!=="not deferrable"&&this.client.logger.warn(`sqlite3: unique index \`${u}\` will not be deferrable ${h} because sqlite3 does not support deferred constraints.`),u=u?this.formatter.wrap(u):this._indexCommand("unique",this.tableNameRaw,l),l=this.formatter.columnize(l);const d=c?" "+this.client.queryCompiler(c).where():"";this.pushQuery(`create unique index ${u} on ${this.tableName()} (${l})${d}`)}index(l,u,h){u=u?this.formatter.wrap(u):this._indexCommand("index",this.tableNameRaw,l),l=this.formatter.columnize(l);let c;n(h)&&({predicate:c}=h);const d=c?" "+this.client.queryCompiler(c).where():"";this.pushQuery(`create index ${u} on ${this.tableName()} (${l})${d}`)}primary(l,u){const h=this;l=Array.isArray(l)?l:[l],l=l.map(d=>this.client.customWrapIdentifier(d,t));let c;n(u)&&({constraintName:u,deferrable:c}=u),c&&c!=="not deferrable"&&this.client.logger.warn(`sqlite3: primary key constraint \`${u}\` will not be deferrable ${c} because sqlite3 does not support deferred constraints.`),u=this.client.customWrapIdentifier(u,t),this.method!=="create"&&this.method!=="createIfNot"&&this.pushQuery({sql:`PRAGMA table_info(${this.tableName()})`,output(d){return h.client.ddl(h,d,this.connection).primary(l,u)}})}foreign(l){const u=this;this.method!=="create"&&this.method!=="createIfNot"&&(l.column=Array.isArray(l.column)?l.column:[l.column],l.column=l.column.map(h=>this.client.customWrapIdentifier(h,t)),l.inTable=this.client.customWrapIdentifier(l.inTable,t),l.references=Array.isArray(l.references)?l.references:[l.references],l.references=l.references.map(h=>this.client.customWrapIdentifier(h,t)),this.pushQuery({sql:`PRAGMA table_info(${this.tableName()})`,statementsProducer(h,c){return u.client.ddl(u,h,c).foreign(l)}}))}primaryKeys(){const l=r(this.grouped.alterTable||[],{method:"primary"});if(l.length>0&&l[0].args.length>0){const u=l[0].args[0];let h=l[0].args[1]||"";h&&(h=" constraint "+this.formatter.wrap(h));const c=this.grouped.columns.filter(d=>d.builder._type==="increments").length>0;return`,${h} ${c?"unique":"primary key"} (${this.formatter.columnize(u)})`}}foreignKeys(){let l="";const u=r(this.grouped.alterTable||[],{method:"foreign"});for(let h=0,c=u.length;h<c;h++){const d=u[h].args[0],p=this.formatter.columnize(d.column),g=this.formatter.columnize(d.references),_=this.formatter.wrap(d.inTable);let f=d.keyName||"";f&&(f=" constraint "+this.formatter.wrap(f)),l+=`,${f} foreign key(${p}) references ${_}(${g})`,d.onDelete&&(l+=` on delete ${d.onDelete}`),d.onUpdate&&(l+=` on update ${d.onUpdate}`)}return l}createTableBlock(){return this.getColumns().concat().join(",")}renameColumn(l,u){this.pushQuery({sql:`alter table ${this.tableName()} rename ${this.formatter.wrap(l)} to ${this.formatter.wrap(u)}`})}_setNullableState(l,u){const h=this;this.pushQuery({sql:`PRAGMA table_info(${this.tableName()})`,statementsProducer(c,d){return h.client.ddl(h,c,d).setNullable(l,u)}})}dropColumn(){const l=this,h=e(arguments).map(c=>this.client.customWrapIdentifier(c,t));this.pushQuery({sql:`PRAGMA table_info(${this.tableName()})`,output(c){return l.client.ddl(l,c,this.connection).dropColumn(h)}})}}return Xn=o,Xn}var Zn,ru;function Lx(){if(ru)return Zn;ru=1;const r=ft,{columnize:e}=K;class t extends r{constructor(i,a){super(i,a)}createOrReplace(){const i=this.columns,a=this.selectQuery.toString(),o=this.viewName(),s=i?" ("+e(i,this.viewBuilder,this.client,this.bindingsHolder)+")":"",l=`drop view if exists ${o}`,u=`create view ${o}${s} as ${a}`;this.pushQuery({sql:l}),this.pushQuery({sql:u})}}return Zn=t,Zn}var ei,nu;function Bx(){if(nu)return ei;nu=1;function r(s,l,u){return`INSERT INTO "${l}" SELECT ${u===void 0?"*":u.map(h=>`"${h}"`).join(", ")} FROM "${s}";`}function e(s){return`DROP TABLE "${s}"`}function t(s,l){return`ALTER TABLE "${s}" RENAME TO "${l}"`}function n(s){return`SELECT type, sql FROM sqlite_master WHERE (type='table' OR (type='index' AND sql IS NOT NULL)) AND tbl_name='${s}'`}function i(){return"PRAGMA foreign_keys"}function a(s){return`PRAGMA foreign_keys = ${s?"ON":"OFF"}`}function o(){return"PRAGMA foreign_key_check"}return ei={copyData:r,dropOriginal:e,renameTable:t,getTableSql:n,isForeignCheckEnabled:i,setForeignCheck:a,executeForeignCheck:o},ei}var ti,iu;function kx(){if(iu)return ti;iu=1;function r(e,t){const n=new RegExp(Object.entries(t).map(([o,s])=>`(?<${o}>${s.source})`).join("|"),"yi");let i=0;const a=[];for(;i<e.length;){n.lastIndex=i;const o=e.match(n);if(o!==null){const[s,l]=Object.entries(o.groups).find(([u,h])=>h!==void 0);i+=l.length,s.startsWith("_")||a.push({type:s,text:l})}else throw new Error(`No matching tokenizer rule found at: [${e.substring(i)}]`)}return a}return ti={tokenize:r},ti}var ri,su;function Mx(){if(su)return ri;su=1;function r(u,h=c=>c){return function({index:c=0,input:d}){let p=c;const g=[];for(const _ of u){const f=_({index:p,input:d});if(f.success)p=f.index,g.push(f.ast);else return f}return{success:!0,ast:h(g),index:p,input:d}}}function e(u,h=c=>c){return function({index:c=0,input:d}){for(const p of u){const g=p({index:c,input:d});if(g.success)return{success:!0,ast:h(g.ast),index:g.index,input:d}}return{success:!1,ast:null,index:c,input:d}}}function t(u,h=c=>c){return function({index:c=0,input:d}){let p={},g=c;const _=[];do p=u({index:g,input:d}),p.success&&(g=p.index,_.push(p.ast));while(p.success);return _.length>0?{success:!0,ast:h(_),index:g,input:d}:{success:!1,ast:null,index:g,input:d}}}function n(u,h=c=>c){return function({index:c=0,input:d}){const p=u({index:c,input:d});return p.success?{success:!0,ast:h(p.ast),index:p.index,input:d}:{success:!0,ast:h(null),index:c,input:d}}}function i(u,h=c=>c){return function({index:c=0,input:d}){const p=u.do({index:c,input:d});return p.success&&u.next({index:p.index,input:d}).success?{success:!0,ast:h(p.ast),index:p.index,input:d}:{success:!1,ast:null,index:c,input:d}}}function a(u,h=c=>c){return function({index:c=0,input:d}){const p=u.do({index:c,input:d});return p.success&&!u.not({index:c,input:d}).success?{success:!0,ast:h(p.ast),index:p.index,input:d}:{success:!1,ast:null,index:c,input:d}}}function o(u,h=c=>c.text){return function({index:c=0,input:d}){const p=d[c];return p!==void 0&&(u.type===void 0||u.type===p.type)&&(u.text===void 0||u.text.toUpperCase()===p.text.toUpperCase())?{success:!0,ast:h(p),index:c+1,input:d}:{success:!1,ast:null,index:c,input:d}}}return ri={s:r,a:e,m:t,o:n,l:i,n:a,t:o,e:function({index:u=0,input:h}){return{success:!0,ast:null,index:u,input:h}},f:function({index:u=0,input:h}){return{success:u===h.length,ast:null,index:u,input:h}}},ri}var ni,ou;function jx(){if(ou)return ni;ou=1;const{tokenize:r}=kx(),{s:e,a:t,m:n,o:i,l:a,n:o,t:s,e:l,f:u}=Mx(),h={keyword:/(?:ABORT|ACTION|ADD|AFTER|ALL|ALTER|ALWAYS|ANALYZE|AND|AS|ASC|ATTACH|AUTOINCREMENT|BEFORE|BEGIN|BETWEEN|BY|CASCADE|CASE|CAST|CHECK|COLLATE|COLUMN|COMMIT|CONFLICT|CONSTRAINT|CREATE|CROSS|CURRENT|CURRENT_DATE|CURRENT_TIME|CURRENT_TIMESTAMP|DATABASE|DEFAULT|DEFERRED|DEFERRABLE|DELETE|DESC|DETACH|DISTINCT|DO|DROP|END|EACH|ELSE|ESCAPE|EXCEPT|EXCLUSIVE|EXCLUDE|EXISTS|EXPLAIN|FAIL|FILTER|FIRST|FOLLOWING|FOR|FOREIGN|FROM|FULL|GENERATED|GLOB|GROUP|GROUPS|HAVING|IF|IGNORE|IMMEDIATE|IN|INDEX|INDEXED|INITIALLY|INNER|INSERT|INSTEAD|INTERSECT|INTO|IS|ISNULL|JOIN|KEY|LAST|LEFT|LIKE|LIMIT|MATCH|MATERIALIZED|NATURAL|NO|NOT|NOTHING|NOTNULL|NULL|NULLS|OF|OFFSET|ON|OR|ORDER|OTHERS|OUTER|OVER|PARTITION|PLAN|PRAGMA|PRECEDING|PRIMARY|QUERY|RAISE|RANGE|RECURSIVE|REFERENCES|REGEXP|REINDEX|RELEASE|RENAME|REPLACE|RESTRICT|RETURNING|RIGHT|ROLLBACK|ROW|ROWS|SAVEPOINT|SELECT|SET|TABLE|TEMP|TEMPORARY|THEN|TIES|TO|TRANSACTION|TRIGGER|UNBOUNDED|UNION|UNIQUE|UPDATE|USING|VACUUM|VALUES|VIEW|VIRTUAL|WHEN|WHERE|WINDOW|WITH|WITHOUT)(?=\s+|-|\(|\)|;|\+|\*|\/|%|==|=|<=|<>|<<|<|>=|>>|>|!=|,|&|~|\|\||\||\.)/,id:/"[^"]*(?:""[^"]*)*"|`[^`]*(?:``[^`]*)*`|\[[^[\]]*\]|[a-z_][a-z0-9_$]*/,string:/'[^']*(?:''[^']*)*'/,blob:/x'(?:[0-9a-f][0-9a-f])+'/,numeric:/(?:\d+(?:\.\d*)?|\.\d+)(?:e(?:\+|-)?\d+)?|0x[0-9a-f]+/,variable:/\?\d*|[@$:][a-z0-9_$]+/,operator:/-|\(|\)|;|\+|\*|\/|%|==|=|<=|<>|<<|<|>=|>>|>|!=|,|&|~|\|\||\||\./,_ws:/\s+/};function c(O){const b=p({input:r(O,h)});if(!b.success)throw new Error(`Parsing CREATE TABLE failed at [${b.input.slice(b.index).map(x=>x.text).join(" ")}] of "${O}"`);return b.ast}function d(O){const b=Bt({input:r(O,h)});if(!b.success)throw new Error(`Parsing CREATE INDEX failed at [${b.input.slice(b.index).map(x=>x.text).join(" ")}] of "${O}"`);return b.ast}function p(O){return e([s({text:"CREATE"},b=>null),g,s({text:"TABLE"},b=>null),de,fe,A,s({text:"("},b=>null),f,ee,s({text:")"},b=>null),_,u],b=>Object.assign({},...b.filter(x=>x!==null)))(O)}function g(O){return t([s({text:"TEMP"}),s({text:"TEMPORARY"}),l],b=>({temporary:b!==null}))(O)}function _(O){return i(e([s({text:"WITHOUT"}),s({text:"ROWID"})]),b=>({rowid:b!==null}))(O)}function f(O){return t([e([m,s({text:","}),f],b=>({columns:[b[0]].concat(b[2].columns)})),e([m],b=>({columns:[b[0]]}))])(O)}function m(O){return e([e([qe],b=>({name:b[0]})),y,w],b=>Object.assign({},...b))(O)}function y(O){return i(e([n(s({type:"id"})),t([e([s({text:"("}),xr,s({text:","}),xr,s({text:")"})],b=>`(${b[1]}, ${b[3]})`),e([s({text:"("}),xr,s({text:")"})],b=>`(${b[1]})`),l])],b=>`${b[0].join(" ")}${b[1]||""}`),b=>({type:b}))(O)}function w(O){return i(n($),b=>({constraints:Object.assign({primary:null,notnull:null,null:null,unique:null,check:null,default:null,collate:null,references:null,as:null},...b||[])}))(O)}function $(O){return t([E,T,N,P,L,G,H,Q,_e])(O)}function E(O){return e([Y,s({text:"PRIMARY"},b=>null),s({text:"KEY"},b=>null),Ls,Z,C],b=>({primary:Object.assign({},...b.filter(x=>x!==null))}))(O)}function C(O){return i(s({text:"AUTOINCREMENT"}),b=>({autoincrement:b!==null}))(O)}function T(O){return e([Y,s({text:"NOT"},b=>null),s({text:"NULL"},b=>null),Z],b=>({notnull:Object.assign({},...b.filter(x=>x!==null))}))(O)}function N(O){return e([Y,s({text:"NULL"},b=>null),Z],b=>({null:Object.assign({},...b.filter(x=>x!==null))}))(O)}function P(O){return e([Y,s({text:"UNIQUE"},b=>null),Z],b=>({unique:Object.assign({},...b.filter(x=>x!==null))}))(O)}function L(O){return e([Y,s({text:"CHECK"},b=>null),s({text:"("},b=>null),e([ze],b=>({expression:b[0]})),s({text:")"},b=>null)],b=>({check:Object.assign({},...b.filter(x=>x!==null))}))(O)}function G(O){return e([Y,s({text:"DEFAULT"},b=>null),t([e([s({text:"("}),ze,s({text:")"})],b=>({value:b[1],expression:!0})),e([p0],b=>({value:b[0],expression:!1})),e([xr],b=>({value:b[0],expression:!1}))])],b=>({default:Object.assign({},...b.filter(x=>x!==null))}))(O)}function H(O){return e([Y,s({text:"COLLATE"},b=>null),s({type:"id"},b=>({collation:b.text}))],b=>({collate:Object.assign({},...b.filter(x=>x!==null))}))(O)}function Q(O){return e([Y,e([Pt],b=>b[0].references)],b=>({references:Object.assign({},...b.filter(x=>x!==null))}))(O)}function _e(O){return e([Y,i(e([s({text:"GENERATED"}),s({text:"ALWAYS"})]),b=>({generated:b!==null})),s({text:"AS"},b=>null),s({text:"("},b=>null),e([ze],b=>({expression:b[0]})),s({text:")"},b=>null),t([s({text:"STORED"}),s({text:"VIRTUAL"}),l],b=>({mode:b?b.toUpperCase():null}))],b=>({as:Object.assign({},...b.filter(x=>x!==null))}))(O)}function ee(O){return i(n(e([s({text:","}),se],b=>b[1])),b=>({constraints:b||[]}))(O)}function se(O){return t([te,W,We,Sr])(O)}function te(O){return e([Y,s({text:"PRIMARY"},b=>null),s({text:"KEY"},b=>null),s({text:"("},b=>null),oe,s({text:")"},b=>null),Z],b=>Object.assign({type:"PRIMARY KEY"},...b.filter(x=>x!==null)))(O)}function W(O){return e([Y,s({text:"UNIQUE"},b=>null),s({text:"("},b=>null),oe,s({text:")"},b=>null),Z],b=>Object.assign({type:"UNIQUE"},...b.filter(x=>x!==null)))(O)}function Z(O){return i(e([s({text:"ON"}),s({text:"CONFLICT"}),t([s({text:"ROLLBACK"}),s({text:"ABORT"}),s({text:"FAIL"}),s({text:"IGNORE"}),s({text:"REPLACE"})])],b=>b[2]),b=>({conflict:b?b.toUpperCase():null}))(O)}function We(O){return e([Y,s({text:"CHECK"},b=>null),s({text:"("},b=>null),e([ze],b=>({expression:b[0]})),s({text:")"},b=>null)],b=>Object.assign({type:"CHECK"},...b.filter(x=>x!==null)))(O)}function Sr(O){return e([Y,s({text:"FOREIGN"},b=>null),s({text:"KEY"},b=>null),s({text:"("},b=>null),pt,s({text:")"},b=>null),Pt],b=>Object.assign({type:"FOREIGN KEY"},...b.filter(x=>x!==null)))(O)}function Pt(O){return e([s({text:"REFERENCES"},b=>null),A,Rs,i(n(t([Ss,Lt,xs])),b=>Object.assign({delete:null,update:null,match:null},...b||[])),Is],b=>({references:Object.assign({},...b.filter(x=>x!==null))}))(O)}function Rs(O){return i(e([s({text:"("}),pt,s({text:")"})],b=>b[1]),b=>({columns:b?b.columns:[]}))(O)}function pt(O){return e([i(n(e([qe,s({text:","})],b=>b[0])),b=>b!==null?b:[]),qe],b=>({columns:b[0].concat([b[1]])}))(O)}function Ss(O){return e([s({text:"ON"}),s({text:"DELETE"}),Mc],b=>({delete:b[2]}))(O)}function Lt(O){return e([s({text:"ON"}),s({text:"UPDATE"}),Mc],b=>({update:b[2]}))(O)}function xs(O){return e([s({text:"MATCH"}),t([s({type:"keyword"}),s({type:"id"})])],b=>({match:b[1]}))(O)}function Is(O){return i(e([i(s({text:"NOT"})),s({text:"DEFERRABLE"}),i(e([s({text:"INITIALLY"}),t([s({text:"DEFERRED"}),s({text:"IMMEDIATE"})])],b=>b[1].toUpperCase()))]),b=>({deferrable:b?{not:b[0]!==null,initially:b[2]}:null}))(O)}function Y(O){return i(e([s({text:"CONSTRAINT"}),qe],b=>b[1]),b=>({name:b}))(O)}function Bt(O){return e([s({text:"CREATE"},b=>null),Ps,s({text:"INDEX"},b=>null),de,fe,v,s({text:"ON"},b=>null),A,s({text:"("},b=>null),oe,s({text:")"},b=>null),V,u],b=>Object.assign({},...b.filter(x=>x!==null)))(O)}function Ps(O){return i(s({text:"UNIQUE"}),b=>({unique:b!==null}))(O)}function de(O){return i(e([s({text:"IF"}),s({text:"NOT"}),s({text:"EXISTS"})]),b=>({exists:b!==null}))(O)}function fe(O){return i(e([qe,s({text:"."})],b=>b[0]),b=>({schema:b}))(O)}function v(O){return e([qe],b=>({index:b[0]}))(O)}function A(O){return e([qe],b=>({table:b[0]}))(O)}function V(O){return i(e([s({text:"WHERE"}),ze],b=>b[1]),b=>({where:b}))(O)}function oe(O){return t([e([Lc,s({text:","}),oe],b=>({columns:[b[0]].concat(b[2].columns)})),e([Bc,s({text:","}),oe],b=>({columns:[b[0]].concat(b[2].columns)})),a({do:Lc,next:s({text:")"})},b=>({columns:[b]})),a({do:Bc,next:s({text:")"})},b=>({columns:[b]}))])(O)}function Lc(O){return e([e([qe],b=>({name:b[0],expression:!1})),kc,Ls],b=>Object.assign({},...b.filter(x=>x!==null)))(O)}function Bc(O){return e([e([f0],b=>({name:b[0],expression:!0})),kc,Ls],b=>Object.assign({},...b.filter(x=>x!==null)))(O)}function kc(O){return i(e([s({text:"COLLATE"}),s({type:"id"})],b=>b[1]),b=>({collation:b}))(O)}function Ls(O){return t([s({text:"ASC"}),s({text:"DESC"}),l],b=>({order:b?b.toUpperCase():null}))(O)}function f0(O){return n(t([o({do:s({type:"keyword"}),not:t([s({text:"COLLATE"}),s({text:"ASC"}),s({text:"DESC"})])}),s({type:"id"}),s({type:"string"}),s({type:"blob"}),s({type:"numeric"}),s({type:"variable"}),o({do:s({type:"operator"}),not:t([s({text:"("}),s({text:")"}),s({text:","})])}),e([s({text:"("}),i(ze),s({text:")"})],b=>b[1]||[])]))(O)}function ze(O){return n(t([s({type:"keyword"}),s({type:"id"}),s({type:"string"}),s({type:"blob"}),s({type:"numeric"}),s({type:"variable"}),o({do:s({type:"operator"}),not:t([s({text:"("}),s({text:")"})])}),e([s({text:"("}),i(ze),s({text:")"})],b=>b[1]||[])]))(O)}function qe(O){return t([s({type:"id"}),s({type:"string"})],b=>/^["`['][^]*["`\]']$/.test(b)?b.substring(1,b.length-1):b)(O)}function Mc(O){return t([e([s({text:"SET"}),s({text:"NULL"})],b=>`${b[0]} ${b[1]}`),e([s({text:"SET"}),s({text:"DEFAULT"})],b=>`${b[0]} ${b[1]}`),s({text:"CASCADE"}),s({text:"RESTRICT"}),e([s({text:"NO"}),s({text:"ACTION"})],b=>`${b[0]} ${b[1]}`)],b=>b.toUpperCase())(O)}function p0(O){return t([s({type:"numeric"}),s({type:"string"}),s({type:"id"}),s({type:"blob"}),s({text:"NULL"}),s({text:"TRUE"}),s({text:"FALSE"}),s({text:"CURRENT_TIME"}),s({text:"CURRENT_DATE"}),s({text:"CURRENT_TIMESTAMP"})])(O)}function xr(O){return e([t([s({text:"+"}),s({text:"-"}),l]),s({type:"numeric"})],b=>`${b[0]||""}${b[1]}`)(O)}return ni={parseCreateTable:c,parseCreateIndex:d},ni}var ii,au;function Qx(){if(au)return ii;au=1;function r(v,A=V=>V){return t(v,A)}function e(v,A=V=>V){return Z(v,A)}function t(v,A){return`CREATE${n(v)} TABLE${Sr(v)} ${Pt(v,A)}${pt(v,A)} (${a(v,A)}${w(v,A)})${i(v)}`}function n(v,A){return v.temporary?" TEMP":""}function i(v,A){return v.rowid?" WITHOUT ROWID":""}function a(v,A){return v.columns.map(V=>o(V,A)).join(", ")}function o(v,A){return`${fe(v.name,A)}${s(v)}${l(v.constraints,A)}`}function s(v,A){return v.type!==null?` ${v.type}`:""}function l(v,A){return`${u(v,A)}${c(v,A)}${d(v,A)}${p(v,A)}${g(v,A)}${_(v,A)}${f(v,A)}${m(v,A)}${y(v,A)}`}function u(v,A){return v.primary!==null?` ${W(v.primary,A)}PRIMARY KEY${Bt(v.primary)}${T(v.primary)}${h(v.primary)}`:""}function h(v,A){return v.autoincrement?" AUTOINCREMENT":""}function c(v,A){return v.notnull!==null?` ${W(v.notnull,A)}NOT NULL${T(v.notnull)}`:""}function d(v,A){return v.null!==null?` ${W(v.null,A)}NULL${T(v.null)}`:""}function p(v,A){return v.unique!==null?` ${W(v.unique,A)}UNIQUE${T(v.unique)}`:""}function g(v,A){return v.check!==null?` ${W(v.check,A)}CHECK (${de(v.check.expression)})`:""}function _(v,A){return v.default!==null?` ${W(v.default,A)}DEFAULT ${v.default.expression?`(${de(v.default.value)})`:v.default.value}`:""}function f(v,A){return v.collate!==null?` ${W(v.collate,A)}COLLATE ${v.collate.collation}`:""}function m(v,A){return v.references!==null?` ${W(v.references,A)}${L(v.references,A)}`:""}function y(v,A){return v.as!==null?` ${W(v.as,A)}${v.as.generated?"GENERATED ALWAYS ":""}AS (${de(v.as.expression)})${v.as.mode!==null?` ${v.as.mode}`:""}`:""}function w(v,A){return v.constraints.reduce((V,oe)=>`${V}, ${$(oe,A)}`,"")}function $(v,A){switch(v.type){case"PRIMARY KEY":return E(v,A);case"UNIQUE":return C(v,A);case"CHECK":return N(v,A);case"FOREIGN KEY":return P(v,A)}}function E(v,A){return`${W(v,A)}PRIMARY KEY (${Lt(v,A)})${T(v)}`}function C(v,A){return`${W(v,A)}UNIQUE (${Lt(v,A)})${T(v)}`}function T(v,A){return v.conflict!==null?` ON CONFLICT ${v.conflict}`:""}function N(v,A){return`${W(v,A)}CHECK (${de(v.expression)})`}function P(v,A){return`${W(v,A)}FOREIGN KEY (${H(v,A)}) ${L(v.references,A)}`}function L(v,A){return`REFERENCES ${pt(v,A)}${G(v,A)}${Q(v)}${te(v.deferrable)}`}function G(v,A){return v.columns.length>0?` (${H(v,A)})`:""}function H(v,A){return v.columns.map(V=>fe(V,A)).join(", ")}function Q(v,A){return`${_e(v)}${ee(v)}${se(v)}`}function _e(v,A){return v.delete!==null?` ON DELETE ${v.delete}`:""}function ee(v,A){return v.update!==null?` ON UPDATE ${v.update}`:""}function se(v,A){return v.match!==null?` MATCH ${v.match}`:""}function te(v,A){return v!==null?` ${v.not?"NOT ":""}DEFERRABLE${v.initially!==null?` INITIALLY ${v.initially}`:""}`:""}function W(v,A){return v.name!==null?`CONSTRAINT ${fe(v.name,A)} `:""}function Z(v,A){return`CREATE${We(v)} INDEX${Sr(v)} ${Pt(v,A)}${Rs(v,A)} on ${pt(v,A)} (${Lt(v,A)})${Ss(v)}`}function We(v,A){return v.unique?" UNIQUE":""}function Sr(v,A){return v.exists?" IF NOT EXISTS":""}function Pt(v,A){return v.schema!==null?`${fe(v.schema,A)}.`:""}function Rs(v,A){return fe(v.index,A)}function pt(v,A){return fe(v.table,A)}function Ss(v,A){return v.where!==null?` where ${de(v.where)}`:""}function Lt(v,A){return v.columns.map(V=>V.expression?Is(V):xs(V,A)).join(", ")}function xs(v,A){return`${fe(v.name,A)}${Y(v)}${Bt(v)}`}function Is(v,A){return`${Ps(v.name)}${Y(v)}${Bt(v)}`}function Y(v,A){return v.collation!==null?` COLLATE ${v.collation}`:""}function Bt(v,A){return v.order!==null?` ${v.order}`:""}function Ps(v,A){return de(v)}function de(v,A){return v.reduce((V,oe)=>Array.isArray(oe)?`${V}(${de(oe)})`:V?`${V} ${oe}`:oe,"")}function fe(v,A){return A(v)}return ii={compileCreateTable:r,compileCreateIndex:e},ii}var si,lu;function Dx(){if(lu)return si;lu=1;function r(t,n){return t.toLowerCase()===n.toLowerCase()}function e(t,n){return t.some(i=>r(i,n))}return si={isEqualId:r,includesId:e},si}var oi,uu;function Fx(){if(uu)return oi;uu=1;const r=ie,{nanonum:e}=Sn,{copyData:t,dropOriginal:n,renameTable:i,getTableSql:a,isForeignCheckEnabled:o,setForeignCheck:s,executeForeignCheck:l}=Bx(),{parseCreateTable:u,parseCreateIndex:h}=jx(),{compileCreateTable:c,compileCreateIndex:d}=Qx(),{isEqualId:p,includesId:g}=Dx();class _{constructor(m,y,w,$){this.client=m,this.tableCompiler=y,this.pragma=w,this.tableNameRaw=this.tableCompiler.tableNameRaw,this.alteredName=`_knex_temp_alter${e(3)}`,this.connection=$,this.formatter=E=>this.client.customWrapIdentifier(E,r),this.wrap=E=>this.client.wrapIdentifierImpl(E)}tableName(){return this.formatter(this.tableNameRaw)}getTableSql(){const m=this.tableName();return this.client.transaction(async y=>{y.disableProcessing();const w=await y.raw(a(m));return y.enableProcessing(),{createTable:w.filter($=>$.type==="table")[0].sql,createIndices:w.filter($=>$.type==="index").map($=>$.sql)}},{connection:this.connection})}async isForeignCheckEnabled(){return(await this.client.raw(o()).connection(this.connection))[0].foreign_keys===1}async setForeignCheck(m){await this.client.raw(s(m)).connection(this.connection)}renameTable(m){return m.raw(i(this.alteredName,this.tableName()))}dropOriginal(m){return m.raw(n(this.tableName()))}copyData(m,y){return m.raw(t(this.tableName(),this.alteredName,y))}async alterColumn(m){const{createTable:y,createIndices:w}=await this.getTableSql(),$=u(y);$.table=this.alteredName,$.columns=$.columns.map(C=>{const T=m.find(N=>p(N.name,C.name));return T&&(C.type=T.type,C.constraints.default=T.defaultTo!==null?{name:null,value:T.defaultTo,expression:!1}:null,C.constraints.notnull=T.notNull?{name:null,conflict:null}:null,C.constraints.null=T.notNull?null:C.constraints.null),C});const E=c($,this.wrap);return this.generateAlterCommands(E,w)}async dropColumn(m){const{createTable:y,createIndices:w}=await this.getTableSql(),$=u(y);if($.table=this.alteredName,$.columns=$.columns.filter(N=>N.expression||!g(m,N.name)),$.columns.length===0)throw new Error("Unable to drop last column from table");$.constraints=$.constraints.filter(N=>N.type==="PRIMARY KEY"||N.type==="UNIQUE"?N.columns.every(P=>P.expression||!g(m,P.name)):N.type==="FOREIGN KEY"?N.columns.every(P=>!g(m,P))&&(N.references.table!==$.table||N.references.columns.every(P=>!g(m,P))):!0);const E=$.columns.map(N=>N.name),C=c($,this.wrap),T=[];for(const N of w){const P=h(N);P.columns=P.columns.filter(L=>L.expression||!g(m,L.name)),P.columns.length>0&&T.push(d(P,this.wrap))}return this.alter(C,T,E)}async dropForeign(m,y){const{createTable:w,createIndices:$}=await this.getTableSql(),E=u(w);E.table=this.alteredName,y||(E.columns=E.columns.map(T=>({...T,references:g(m,T.name)?null:T.references}))),E.constraints=E.constraints.filter(T=>T.type==="FOREIGN KEY"?y?!T.name||!p(T.name,y):T.columns.every(N=>!g(m,N)):!0);const C=c(E,this.wrap);return this.alter(C,$)}async dropPrimary(m){const{createTable:y,createIndices:w}=await this.getTableSql(),$=u(y);$.table=this.alteredName,$.columns=$.columns.map(C=>({...C,primary:null})),$.constraints=$.constraints.filter(C=>C.type==="PRIMARY KEY"?m?!C.name||!p(C.name,m):!1:!0);const E=c($,this.wrap);return this.alter(E,w)}async primary(m,y){const{createTable:w,createIndices:$}=await this.getTableSql(),E=u(w);E.table=this.alteredName,E.columns=E.columns.map(T=>({...T,primary:null})),E.constraints=E.constraints.filter(T=>T.type!=="PRIMARY KEY"),E.constraints.push({type:"PRIMARY KEY",name:y||null,columns:m.map(T=>({name:T,expression:!1,collation:null,order:null})),conflict:null});const C=c(E,this.wrap);return this.alter(C,$)}async foreign(m){const{createTable:y,createIndices:w}=await this.getTableSql(),$=u(y);$.table=this.alteredName,$.constraints.push({type:"FOREIGN KEY",name:m.keyName||null,columns:m.column,references:{table:m.inTable,columns:m.references,delete:m.onDelete||null,update:m.onUpdate||null,match:null,deferrable:null}});const E=c($,this.wrap);return this.generateAlterCommands(E,w)}async setNullable(m,y){const{createTable:w,createIndices:$}=await this.getTableSql(),E=u(w);E.table=this.alteredName;const C=E.columns.find(N=>p(m,N.name));if(!C)throw new Error(`.setNullable: Column ${m} does not exist in table ${this.tableName()}.`);C.constraints.notnull=y?null:{name:null,conflict:null},C.constraints.null=y?C.constraints.null:null;const T=c(E,this.wrap);return this.generateAlterCommands(T,$)}async alter(m,y,w){const $=await this.isForeignCheckEnabled();$&&await this.setForeignCheck(!1);try{await this.client.transaction(async E=>{await E.raw(m),await this.copyData(E,w),await this.dropOriginal(E),await this.renameTable(E);for(const C of y)await E.raw(C);if($&&(await E.raw(l())).length>0)throw new Error("FOREIGN KEY constraint failed")},{connection:this.connection})}finally{$&&await this.setForeignCheck(!0)}}async generateAlterCommands(m,y,w){const $=[],E=[],C=[];let T=null;$.push(m),$.push(t(this.tableName(),this.alteredName,w)),$.push(n(this.tableName())),$.push(i(this.alteredName,this.tableName()));for(const P of y)$.push(P);return await this.isForeignCheckEnabled()&&(E.push(s(!1)),C.push(s(!0)),T=l()),{pre:E,sql:$,check:T,post:C}}}return oi=_,oi}var ai,cu;function Ux(){if(cu)return ai;cu=1;const r=Ee;return ai=class extends r{withMaterialized(t,n,i){return this._validateWithArgs(t,n,i,"with"),this.withWrapped(t,n,i,!0)}withNotMaterialized(t,n,i){return this._validateWithArgs(t,n,i,"with"),this.withWrapped(t,n,i,!1)}},ai}var li,hu;function du(){if(hu)return li;hu=1;const r=Ho,e=Qe,{promisify:t}=I,n=He,i=at,a=Ox(),o=Nx(),s=Sx(),l=xx(),u=Px(),h=Lx(),c=Fx(),d=Nr,p=Ux();class g extends n{constructor(f){super(f),f.connection&&f.connection.filename===void 0&&this.logger.warn("Could not find `connection.filename` in config. Please specify the database path and name to avoid errors. (see docs https://knexjs.org/guide/#configuration-options)"),f.useNullAsDefault===void 0&&this.logger.warn("sqlite does not support inserting default values. Set the `useNullAsDefault` flag to hide this warning. (see docs https://knexjs.org/guide/query-builder.html#insert).")}_driver(){return I}schemaCompiler(){return new s(this,...arguments)}transaction(){return new a(this,...arguments)}queryCompiler(f,m){return new o(this,f,m)}queryBuilder(){return new p(this)}viewCompiler(f,m){return new h(this,f,m)}columnCompiler(){return new l(this,...arguments)}tableCompiler(){return new u(this,...arguments)}ddl(f,m,y){return new c(this,f,m,y)}wrapIdentifierImpl(f){return f!=="*"?`\`${f.replace(/`/g,"``")}\``:"*"}acquireRawConnection(){return new Promise((f,m)=>{let y=this.driver.OPEN_READWRITE|this.driver.OPEN_CREATE;if(this.connectionSettings.flags){if(!Array.isArray(this.connectionSettings.flags))throw new Error("flags must be an array of strings");this.connectionSettings.flags.forEach($=>{if(!$.startsWith("OPEN_")||!this.driver[$])throw new Error(`flag ${$} not supported by node-sqlite3`);y=y|this.driver[$]})}const w=new this.driver.Database(this.connectionSettings.filename,y,$=>{if($)return m($);f(w)})})}async destroyRawConnection(f){return t(y=>f.close(y))()}_query(f,m){if(!m.sql)throw new Error("The query is empty");const{method:y}=m;let w;switch(y){case"insert":case"update":w=m.returning?"all":"run";break;case"counter":case"del":w="run";break;default:w="all"}return new Promise(function($,E){if(!f||!f[w])return E(new Error(`Error calling ${w} on connection.`));f[w](m.sql,m.bindings,function(C,T){return C?E(C):(m.response=T,m.context=this,$(m))})})}_stream(f,m,y){if(!m.sql)throw new Error("The query is empty");const w=this;return new Promise(function($,E){return y.on("error",E),y.on("end",$),w._query(f,m).then(C=>C.response).then(C=>C.forEach(T=>y.write(T))).catch(function(C){y.emit("error",C)}).then(function(){y.end()})})}processResponse(f,m){const y=f.context,{response:w,returning:$}=f;if(f.output)return f.output.call(m,w);switch(f.method){case"select":return w;case"first":return w[0];case"pluck":return e(w,f.pluck);case"insert":return $&&w?w:[y.lastID];case"update":return $&&w?w:y.changes;case"del":case"counter":return y.changes;default:return w}}poolDefaults(){return r({min:1,max:1},super.poolDefaults())}formatter(f){return new d(this,f)}values(f,m,y){return Array.isArray(f)?Array.isArray(f[0])?`( values ${f.map(w=>`(${this.parameterize(w,void 0,m,y)})`).join(", ")})`:`(${this.parameterize(f,void 0,m,y)})`:f instanceof i?`(${this.parameter(f,m,y)})`:this.parameter(f,m,y)}}return Object.assign(g.prototype,{dialect:"sqlite3",driverName:"sqlite3"}),li=g,li}var ui,fu;function Hx(){if(fu)return ui;fu=1;const r=du();class e extends r{_driver(){return I}async acquireRawConnection(){return new this.driver(this.connectionSettings.filename)}async destroyRawConnection(n){return n.close()}async _query(n,i){if(!i.sql)throw new Error("The query is empty");if(!n)throw new Error("No connection provided");const a=n.prepare(i.sql),o=this._formatBindings(i.bindings);if(a.reader){const l=await a.all(o);return i.response=l,i}const s=await a.run(o);return i.response=s,i.context={lastID:s.lastInsertRowid,changes:s.changes},i}_formatBindings(n){return n?n.map(i=>i instanceof Date?i.valueOf():typeof i=="boolean"?Number(i):i):[]}}return Object.assign(e.prototype,{driverName:"better-sqlite3"}),ui=e,ui}var ci,pu;function mu(){if(pu)return ci;pu=1;const r=Ce;class e extends r{begin(n){return this.isolationLevel?this.query(n,`BEGIN ISOLATION LEVEL ${this.isolationLevel};`):this.query(n,"BEGIN;")}}return ci=e,ci}var hi,gu;function di(){if(gu)return hi;gu=1;const r=ie,e=Tt,t=De,{wrapString:n,columnize:i,operator:a,wrap:o}=K;class s extends t{constructor(u,h,c){super(u,h,c),this._defaultInsertValue="default"}truncate(){return`truncate ${this.tableName} restart identity`}insert(){let u=super.insert();if(u==="")return u;const{returning:h,onConflict:c,ignore:d,merge:p,insert:g}=this.single;if(c&&d&&(u+=this._ignore(c)),c&&p){u+=this._merge(p.updates,c,g);const _=this.where();_&&(u+=` ${_}`)}return h&&(u+=this._returning(h)),{sql:u,returning:h}}update(){const u=this.with(),h=this._prepUpdate(this.single.update),c=this.where(),{returning:d}=this.single;return{sql:u+`update ${this.single.only?"only ":""}${this.tableName} set ${h.join(", ")}`+(c?` ${c}`:"")+this._returning(d),returning:d}}using(){const u=this.single.using;if(!u)return;let h="using ";return Array.isArray(u)?h+=u.map(c=>this.formatter.wrap(c)).join(","):h+=this.formatter.wrap(u),h}del(){const{tableName:u}=this,h=this.with();let c=this.where()||"",d=this.using()||"";const p=this.grouped.join,g=[];if(Array.isArray(p)){for(const m of p){g.push(o(this._joinTable(m),void 0,this.builder,this.client,this.bindingsHolder));const y=[];for(const w of m.clauses)y.push(this.whereBasic({column:w.column,operator:"=",value:w.value,asColumn:!0}));y.length>0&&(c+=(c?" and ":"where ")+y.join(" and "))}g.length>0&&(d+=(d?",":"using ")+g.join(","))}const _=h+`delete from ${this.single.only?"only ":""}${u}`+(d?` ${d}`:"")+(c?` ${c}`:""),{returning:f}=this.single;return{sql:_+this._returning(f),returning:f}}aggregate(u){return this._aggregate(u,{distinctParentheses:!0})}_returning(u){return u?` returning ${this.formatter.columnize(u)}`:""}_ignore(u){return u===!0?" on conflict do nothing":` on conflict ${this._onConflictClause(u)} do nothing`}_merge(u,h,c){let d=` on conflict ${this._onConflictClause(h)} do update set `;if(u&&Array.isArray(u))return d+=u.map(p=>n(p.split(".").pop(),this.formatter.builder,this.client,this.formatter)).map(p=>`${p} = excluded.${p}`).join(", "),d;if(u&&typeof u=="object"){const p=this._prepUpdate(u);return typeof p=="string"?d+=p:d+=p.join(","),d}else{const p=this._prepInsert(c);if(typeof p=="string")throw new Error("If using merge with a raw insert query, then updates must be provided");return d+=p.columns.map(g=>n(g.split(".").pop(),this.builder,this.client)).map(g=>`${g} = excluded.${g}`).join(", "),d}}_tableNames(u){const h=this.single.schema,c=[];for(let d=0;d<u.length;d++){let p=u[d];p&&(h&&(p=`${h}.${p}`),c.push(this.formatter.wrap(p)))}return c.join(", ")}_lockingClause(u){const h=this.single.lockTables||[];return u+(h.length?" of "+this._tableNames(h):"")}_groupOrder(u,h){return super._groupOrderNulls(u,h)}forUpdate(){return this._lockingClause("for update")}forShare(){return this._lockingClause("for share")}forNoKeyUpdate(){return this._lockingClause("for no key update")}forKeyShare(){return this._lockingClause("for key share")}skipLocked(){return"skip locked"}noWait(){return"nowait"}columnInfo(){const u=this.single.columnInfo;let h=this.single.schema;const c=this.client.customWrapIdentifier(this.single.table,r);h&&(h=this.client.customWrapIdentifier(h,r));const d="select * from information_schema.columns where table_name = ? and table_catalog = current_database()",p=[c];return this._buildColumnInfoQuery(h,d,p,u)}_buildColumnInfoQuery(u,h,c,d){return u?(h+=" and table_schema = ?",c.push(u)):h+=" and table_schema = current_schema()",{sql:h,bindings:c,output(p){const g=e(p.rows,function(_,f){return _[f.column_name]={type:f.data_type,maxLength:f.character_maximum_length,nullable:f.is_nullable==="YES",defaultValue:f.column_default},_},{});return d&&g[d]||g}}}distinctOn(u){return"distinct on ("+this.formatter.columnize(u)+") "}jsonExtract(u){return this._jsonExtract("jsonb_path_query",u)}jsonSet(u){return this._jsonSet("jsonb_set",Object.assign({},u,{path:this.client.toPathForJson(u.path)}))}jsonInsert(u){return this._jsonSet("jsonb_insert",Object.assign({},u,{path:this.client.toPathForJson(u.path)}))}jsonRemove(u){const h=`${i(u.column,this.builder,this.client,this.bindingsHolder)} #- ${this.client.parameter(this.client.toPathForJson(u.path),this.builder,this.bindingsHolder)}`;return u.alias?this.client.alias(h,this.formatter.wrap(u.alias)):h}whereJsonPath(u){let h="";return!isNaN(u.value)&&parseInt(u.value)?h="::int":!isNaN(u.value)&&parseFloat(u.value)?h="::float":h=" #>> '{}'",`jsonb_path_query_first(${this._columnClause(u)}, ${this.client.parameter(u.jsonPath,this.builder,this.bindingsHolder)})${h} ${a(u.operator,this.builder,this.client,this.bindingsHolder)} ${this._jsonValueClause(u)}`}whereJsonSupersetOf(u){return this._not(u,`${o(u.column,void 0,this.builder,this.client,this.bindingsHolder)} @> ${this._jsonValueClause(u)}`)}whereJsonSubsetOf(u){return this._not(u,`${i(u.column,this.builder,this.client,this.bindingsHolder)} <@ ${this._jsonValueClause(u)}`)}onJsonPathEquals(u){return this._onJsonPathEquals("jsonb_path_query_first",u)}}return hi=s,hi}var fi,yu;function Vx(){if(yu)return fi;yu=1;const r=Ee;return fi=class extends r{using(t){return this._single.using=t,this}withMaterialized(t,n,i){return this._validateWithArgs(t,n,i,"with"),this.withWrapped(t,n,i,!0)}withNotMaterialized(t,n,i){return this._validateWithArgs(t,n,i,"with"),this.withWrapped(t,n,i,!1)}},fi}var pi,bu;function mi(){if(bu)return pi;bu=1;const r=Ue,{isObject:e}=M,{toNumber:t}=z,n=new RegExp("(?<!')'(?!')","g");class i extends r{constructor(s,l,u){super(s,l,u),this.modifiers=["nullable","defaultTo","comment"],this._addCheckModifiers()}bit(s){return s.length!==!1?`bit(${s.length})`:"bit"}enu(s,l){l=l||{};const u=l.useNative&&l.existingType?void 0:s.join("', '");if(l.useNative){let h="";const c=l.schemaName||this.tableCompiler.schemaNameRaw;return c&&(h+=`"${c}".`),h+=`"${l.enumName}"`,l.existingType||this.tableCompiler.unshiftQuery(`create type ${h} as enum ('${u}')`),h}return`text check (${this.formatter.wrap(this.args[0])} in ('${u}'))`}decimal(s,l){return s===null?"decimal":`decimal(${t(s,8)}, ${t(l,2)})`}json(s){return s&&this.client.logger.deprecate("json(true)","jsonb()"),a(this.client,s)}jsonb(){return a(this.client,!0)}checkRegex(s,l){return this._check(`${this.formatter.wrap(this.getColumnName())} ~ ${this.client._escapeBinding(s)}`,l)}datetime(s=!1,l){let u;return e(s)?{useTz:u,precision:l}=s:u=!s,u=typeof u=="boolean"?u:!0,l=l!=null?"("+l+")":"",`${u?"timestamptz":"timestamp"}${l}`}timestamp(s=!1,l){return this.datetime(s,l)}comment(s){const l=this.args[0]||this.defaults("columnName"),u=s?`'${s.replace(n,"''")}'`:"NULL";this.pushAdditional(function(){this.pushQuery(`comment on column ${this.tableCompiler.tableName()}.`+this.formatter.wrap(l)+` is ${u}`)},s)}increments(s={primaryKey:!0}){return"serial"+(this.tableCompiler._canBeAddPrimaryKey(s)?" primary key":"")}bigincrements(s={primaryKey:!0}){return"bigserial"+(this.tableCompiler._canBeAddPrimaryKey(s)?" primary key":"")}uuid(s={primaryKey:!1}){return"uuid"+(this.tableCompiler._canBeAddPrimaryKey(s)?" primary key":"")}}i.prototype.bigint="bigint",i.prototype.binary="bytea",i.prototype.bool="boolean",i.prototype.double="double precision",i.prototype.floating="real",i.prototype.smallint="smallint",i.prototype.tinyint="smallint";function a(o,s){return!o.version||o.config.client==="cockroachdb"||o.config.jsonbSupport===!0||parseFloat(o.version)>=9.2?s?"jsonb":"json":"text"}return pi=i,pi}var gi,_u;function yi(){if(_u)return gi;_u=1;const r=br,e=ht,{isObject:t,isString:n}=M;class i extends e{constructor(o,s){super(o,s)}renameColumn(o,s){return this.pushQuery({sql:`alter table ${this.tableName()} rename ${this.formatter.wrap(o)} to ${this.formatter.wrap(s)}`})}_setNullableState(o,s){const l=s?"drop not null":"set not null",u=`alter table ${this.tableName()} alter column ${this.formatter.wrap(o)} ${l}`;return this.pushQuery({sql:u})}compileAdd(o){const s=this.formatter.wrap(o),l=this.prefixArray("add column",this.getColumns(o));return this.pushQuery({sql:`alter table ${s} ${l.join(", ")}`})}createQuery(o,s,l){const u=s?"create table if not exists ":"create table ",h=` (${o.sql.join(", ")}${this.primaryKeys()||""}${this._addChecks()})`;let c=u+this.tableName()+(l&&this.tableNameLike()?" (like "+this.tableNameLike()+" including all"+(o.sql.length?", "+o.sql.join(", "):"")+")":h);this.single.inherits&&(c+=` inherits (${this.formatter.wrap(this.single.inherits)})`),this.pushQuery({sql:c,bindings:o.bindings}),r(this.single,"comment")&&this.comment(this.single.comment)}primaryKeys(){const o=(this.grouped.alterTable||[]).filter(s=>s.method==="primary");if(o.length>0&&o[0].args.length>0){const s=o[0].args[0];let l=o[0].args[1]||"",u;return t(l)&&({constraintName:l,deferrable:u}=l),u=u?` deferrable initially ${u}`:"",l=l?this.formatter.wrap(l):this.formatter.wrap(`${this.tableNameRaw}_pkey`),`, constraint ${l} primary key (${this.formatter.columnize(s)})${u}`}}addColumns(o,s,l){if(s===this.alterColumnsPrefix)for(const u of l)this._addColumn(u);else super.addColumns(o,s)}_addColumn(o){const s=this.tableName(),l=o.getColumnType(),u=this.client.wrapIdentifier(o.getColumnName(),o.columnBuilder.queryContext()),h=o.type==="enu";this.pushQuery({sql:`alter table ${s} alter column ${u} drop default`,bindings:[]});const c=o.columnBuilder.alterNullable;c&&this.pushQuery({sql:`alter table ${s} alter column ${u} drop not null`,bindings:[]}),o.columnBuilder.alterType&&this.pushQuery({sql:`alter table ${s} alter column ${u} type ${l} using (${u}${h?"::text::":"::"}${l})`,bindings:[]});const p=o.modified.defaultTo;if(p){const g=o.defaultTo.apply(o,p);this.pushQuery({sql:`alter table ${s} alter column ${u} set ${g}`,bindings:[]})}if(c){const g=o.modified.nullable;g&&g[0]===!1&&this.pushQuery({sql:`alter table ${s} alter column ${u} set not null`,bindings:[]})}}comment(o){this.pushQuery(`comment on table ${this.tableName()} is '${this.single.comment}'`)}primary(o,s){let l;t(s)&&({constraintName:s,deferrable:l}=s),l=l?` deferrable initially ${l}`:"",s=s?this.formatter.wrap(s):this.formatter.wrap(`${this.tableNameRaw}_pkey`),this.method!=="create"&&this.method!=="createIfNot"&&this.pushQuery(`alter table ${this.tableName()} add constraint ${s} primary key (${this.formatter.columnize(o)})${l}`)}unique(o,s){let l,u=!0,h;if(t(s)&&({indexName:s,deferrable:l,useConstraint:u,predicate:h}=s,u===void 0&&(u=!!l||!h)),!u&&l&&l!=="not deferrable")throw new Error("postgres cannot create deferrable index");if(u&&h)throw new Error("postgres cannot create constraint with predicate");if(l=l?` deferrable initially ${l}`:"",s=s?this.formatter.wrap(s):this._indexCommand("unique",this.tableNameRaw,o),u)this.pushQuery(`alter table ${this.tableName()} add constraint ${s} unique (`+this.formatter.columnize(o)+")"+l);else{const c=h?" "+this.client.queryCompiler(h).where():"";this.pushQuery(`create unique index ${s} on ${this.tableName()} (${this.formatter.columnize(o)})${c}`)}}index(o,s,l){s=s?this.formatter.wrap(s):this._indexCommand("index",this.tableNameRaw,o);let u,h;n(l)?h=l:t(l)&&({indexType:h,predicate:u}=l);const c=u?" "+this.client.queryCompiler(u).where():"";this.pushQuery(`create index ${s} on ${this.tableName()}${h&&` using ${h}`||""} (`+this.formatter.columnize(o)+`)${c}`)}dropPrimary(o){o=o?this.formatter.wrap(o):this.formatter.wrap(this.tableNameRaw+"_pkey"),this.pushQuery(`alter table ${this.tableName()} drop constraint ${o}`)}dropIndex(o,s){s=s?this.formatter.wrap(s):this._indexCommand("index",this.tableNameRaw,o),s=this.schemaNameRaw?`${this.formatter.wrap(this.schemaNameRaw)}.${s}`:s,this.pushQuery(`drop index ${s}`)}dropUnique(o,s){s=s?this.formatter.wrap(s):this._indexCommand("unique",this.tableNameRaw,o),this.pushQuery(`alter table ${this.tableName()} drop constraint ${s}`)}dropForeign(o,s){s=s?this.formatter.wrap(s):this._indexCommand("foreign",this.tableNameRaw,o),this.pushQuery(`alter table ${this.tableName()} drop constraint ${s}`)}}return gi=i,gi}var bi,wu;function _i(){if(wu)return bi;wu=1;const r=ft;class e extends r{constructor(n,i){super(n,i)}renameColumn(n,i){return this.pushQuery({sql:`alter view ${this.viewName()} rename ${this.formatter.wrap(n)} to ${this.formatter.wrap(i)}`})}defaultTo(n,i){return this.pushQuery({sql:`alter view ${this.viewName()} alter ${this.formatter.wrap(n)} set default ${i}`})}createOrReplace(){this.createQuery(this.columns,this.selectQuery,!1,!0)}createMaterializedView(){this.createQuery(this.columns,this.selectQuery,!0)}}return bi=e,bi}var wi,$u;function Wx(){if($u)return wi;$u=1;const r=xt;class e extends r{constructor(){super(...arguments)}checkOption(){this._single.checkOption="default_option"}localCheckOption(){this._single.checkOption="local"}cascadedCheckOption(){this._single.checkOption="cascaded"}}return wi=e,wi}var $i,Cu;function vu(){if(Cu)return $i;Cu=1;const r=ct;class e extends r{constructor(n,i){super(n,i)}hasTable(n){let i="select * from information_schema.tables where table_name = ?";const a=[n];this.schema?(i+=" and table_schema = ?",a.push(this.schema)):i+=" and table_schema = current_schema()",this.pushQuery({sql:i,bindings:a,output(o){return o.rows.length>0}})}hasColumn(n,i){let a="select * from information_schema.columns where table_name = ? and column_name = ?";const o=[n,i];this.schema?(a+=" and table_schema = ?",o.push(this.schema)):a+=" and table_schema = current_schema()",this.pushQuery({sql:a,bindings:o,output(s){return s.rows.length>0}})}qualifiedTableName(n){const i=this.schema?`${this.schema}.${n}`:n;return this.formatter.wrap(i)}renameTable(n,i){this.pushQuery(`alter table ${this.qualifiedTableName(n)} rename to ${this.formatter.wrap(i)}`)}createSchema(n){this.pushQuery(`create schema ${this.formatter.wrap(n)}`)}createSchemaIfNotExists(n){this.pushQuery(`create schema if not exists ${this.formatter.wrap(n)}`)}dropSchema(n,i=!1){this.pushQuery(`drop schema ${this.formatter.wrap(n)}${i?" cascade":""}`)}dropSchemaIfExists(n,i=!1){this.pushQuery(`drop schema if exists ${this.formatter.wrap(n)}${i?" cascade":""}`)}dropExtension(n){this.pushQuery(`drop extension ${this.formatter.wrap(n)}`)}dropExtensionIfExists(n){this.pushQuery(`drop extension if exists ${this.formatter.wrap(n)}`)}createExtension(n){this.pushQuery(`create extension ${this.formatter.wrap(n)}`)}createExtensionIfNotExists(n){this.pushQuery(`create extension if not exists ${this.formatter.wrap(n)}`)}renameView(n,i){this.pushQuery(this.alterViewPrefix+`${this.formatter.wrap(n)} rename to ${this.formatter.wrap(i)}`)}refreshMaterializedView(n,i=!1){this.pushQuery({sql:`refresh materialized view${i?" concurrently":""} ${this.formatter.wrap(n)}`})}dropMaterializedView(n){this._dropView(n,!1,!0)}dropMaterializedViewIfExists(n){this._dropView(n,!0,!0)}}return $i=e,$i}var Ci,Eu;function Rr(){if(Eu)return Ci;Eu=1;const r=Er,e=Qe,{promisify:t}=I,n=He,i=mu(),a=di(),o=Vx(),s=mi(),l=yi(),u=_i(),h=Wx(),c=vu(),{makeEscape:d}=Dr,{isString:p}=M;class g extends n{constructor(m){super(m),m.returning&&(this.defaultReturning=m.returning),m.searchPath&&(this.searchPath=m.searchPath)}transaction(){return new i(this,...arguments)}queryBuilder(){return new o(this)}queryCompiler(m,y){return new a(this,m,y)}columnCompiler(){return new s(this,...arguments)}schemaCompiler(){return new c(this,...arguments)}tableCompiler(){return new l(this,...arguments)}viewCompiler(){return new u(this,...arguments)}viewBuilder(){return new h(this,...arguments)}_driver(){return I}wrapIdentifierImpl(m){if(m==="*")return m;let y="";const w=m.match(/(.*?)(\[[0-9]+\])/);return w&&(m=w[1],y=w[2]),`"${m.replace(/"/g,'""')}"${y}`}_acquireOnlyConnection(){const m=new this.driver.Client(this.connectionSettings);return m.connect().then(()=>m)}acquireRawConnection(){const m=this;return this._acquireOnlyConnection().then(function(y){return y.on("error",w=>{y.__knex__disposed=w}),y.on("end",w=>{y.__knex__disposed=w||"Connection ended unexpectedly"}),m.version?y:m.checkVersion(y).then(function(w){return m.version=w,y})}).then(async function(w){return await m.setSchemaSearchPath(w),w})}async destroyRawConnection(m){return t(w=>m.end(w))()}checkVersion(m){return new Promise((y,w)=>{m.query("select version();",($,E)=>{if($)return w($);y(this._parseVersion(E.rows[0].version))})})}_parseVersion(m){return/^PostgreSQL (.*?)( |$)/.exec(m)[1]}positionBindings(m){let y=0;return m.replace(/(\\*)(\?)/g,function(w,$){return $.length%2?"?":(y++,`$${y}`)})}setSchemaSearchPath(m,y){let w=y||this.searchPath;if(!w)return Promise.resolve(!0);if(!Array.isArray(w)&&!p(w))throw new TypeError(`knex: Expected searchPath to be Array/String, got: ${typeof w}`);if(p(w)){if(w.includes(",")){const E=`[${w.split(",").map(C=>`'${C}'`).join(", ")}]`;this.logger.warn(`Detected comma in searchPath "${w}".If you are trying to specify multiple schemas, use Array syntax: ${E}`)}w=[w]}return w=w.map($=>`"${$}"`).join(","),new Promise(function($,E){m.query(`set search_path to ${w}`,function(C){if(C)return E(C);$(!0)})})}_stream(m,y,w,$){if(!y.sql)throw new Error("The query is empty");const E=process.browser?void 0:I,C=y.sql;return new Promise(function(T,N){const P=m.query(new E(C,y.bindings,$));P.on("error",function(L){N(L),w.emit("error",L)}),w.on("end",T),P.pipe(w)})}_query(m,y){if(!y.sql)throw new Error("The query is empty");let w={text:y.sql,values:y.bindings||[]};return y.options&&(w=r(w,y.options)),new Promise(function($,E){m.query(w,function(C,T){if(C)return E(C);y.response=T,$(y)})})}processResponse(m,y){const w=m.response;if(m.output)return m.output.call(y,w);if(m.method==="raw")return w;const{returning:$}=m;if(w.command==="SELECT")return m.method==="first"?w.rows[0]:m.method==="pluck"?e(w.rows,m.pluck):w.rows;if($){const E=[];for(let C=0,T=w.rows.length;C<T;C++){const N=w.rows[C];E[C]=N}return E}return w.command==="UPDATE"||w.command==="DELETE"?w.rowCount:w}async cancelQuery(m){const y=await this.acquireRawConnection();try{return await this._wrappedCancelQueryCall(y,m)}finally{await this.destroyRawConnection(y).catch(w=>{this.logger.warn(`Connection Error: ${w}`)})}}_wrappedCancelQueryCall(m,y){return this._query(m,{sql:"SELECT pg_cancel_backend($1);",bindings:[y.processID],options:{}})}toPathForJson(m){const y=/^{.*}$/;return m.match(y)?m:"{"+m.replace(/^(\$\.)/,"").replace(".",",").replace(/\[([0-9]+)]/,",$1")+"}"}}Object.assign(g.prototype,{dialect:"postgresql",driverName:"pg",canCancelQuery:!0,_escapeBinding:d({escapeArray(f,m){return m(_(f,m))},escapeString(f){let m=!1,y="'";for(let w=0;w<f.length;w++){const $=f[w];$==="'"?y+=$+$:$==="\\"?(y+=$+$,m=!0):y+=$}return y+="'",m===!0&&(y="E"+y),y},escapeObject(f,m,y,w=[]){if(f&&typeof f.toPostgres=="function"){if(w=w||[],w.indexOf(f)!==-1)throw new Error(`circular reference detected while preparing "${f}" for query`);return w.push(f),m(f.toPostgres(m),w)}return JSON.stringify(f)}})});function _(f,m){let y="{";for(let w=0;w<f.length;w++){w>0&&(y+=",");const $=f[w];$===null||typeof $>"u"?y+="NULL":Array.isArray($)?y+=_($,m):typeof $=="number"?y+=$:y+=JSON.stringify(typeof $=="string"?$:m($))}return y+"}"}return Ci=g,Ci}var vi,Tu;function zx(){if(Tu)return vi;Tu=1;const r=di(),{columnize:e,wrap:t,operator:n}=K;class i extends r{truncate(){return`truncate ${this.tableName}`}upsert(){let o=this._upsert();if(o==="")return o;const{returning:s}=this.single;return s&&(o+=this._returning(s)),{sql:o,returning:s}}_upsert(){const o=this.single.upsert||[],s=this.with()+`upsert into ${this.tableName} `,l=this._insertBody(o);return l===""?"":s+l}_groupOrder(o,s){return this._basicGroupOrder(o,s)}whereJsonPath(o){let s="";return!isNaN(o.value)&&parseInt(o.value)?s="::int":!isNaN(o.value)&&parseFloat(o.value)?s="::float":s=" #>> '{}'",`json_extract_path(${this._columnClause(o)}, ${this.client.toArrayPathFromJsonPath(o.jsonPath,this.builder,this.bindingsHolder)})${s} ${n(o.operator,this.builder,this.client,this.bindingsHolder)} ${this._jsonValueClause(o)}`}_jsonExtract(o,s){let l;return Array.isArray(s.column)?l=s.column:l=[s],l.map(u=>{const h=`json_extract_path(${e(u.column||u[0],this.builder,this.client,this.bindingsHolder)}, ${this.client.toArrayPathFromJsonPath(u.path||u[1],this.builder,this.bindingsHolder)})`,c=u.alias||u[2];return c?this.client.alias(h,this.formatter.wrap(c)):h}).join(", ")}_onJsonPathEquals(o,s){return"json_extract_path("+t(s.columnFirst,void 0,this.builder,this.client,this.bindingsHolder)+", "+this.client.toArrayPathFromJsonPath(s.jsonPathFirst,this.builder,this.bindingsHolder)+") = json_extract_path("+t(s.columnSecond,void 0,this.builder,this.client,this.bindingsHolder)+", "+this.client.toArrayPathFromJsonPath(s.jsonPathSecond,this.builder,this.bindingsHolder)+")"}}return vi=i,vi}var Ei,Au;function Kx(){if(Au)return Ei;Au=1;const r=mi();class e extends r{uuid(n={primaryKey:!1}){return"uuid"+(this.tableCompiler._canBeAddPrimaryKey(n)?" primary key default gen_random_uuid()":"")}}return Ei=e,Ei}var Ti,Ou;function Jx(){if(Ou)return Ti;Ou=1;const r=yi();class e extends r{constructor(n,i){super(n,i)}addColumns(n,i,a){if(i===this.alterColumnsPrefix)for(const o of a)this.client.logger.warn("Experimental alter column in use, see issue: https://github.com/cockroachdb/cockroach/issues/49329"),this.pushQuery({sql:"SET enable_experimental_alter_column_type_general = true",bindings:[]}),super._addColumn(o);else super.addColumns(n,i)}dropUnique(n,i){i=i?this.formatter.wrap(i):this._indexCommand("unique",this.tableNameRaw,n),this.pushQuery(`drop index ${this.tableName()}@${i} cascade `)}}return Ti=e,Ti}var Ai,Nu;function Gx(){if(Nu)return Ai;Nu=1;const r=_i();class e extends r{renameColumn(n,i){throw new Error("rename column of views is not supported by this dialect.")}defaultTo(n,i){throw new Error("change default values of views is not supported by this dialect.")}}return Ai=e,Ai}var Oi,qu;function Yx(){if(qu)return Oi;qu=1;const r=Ee,e=le;return Oi=class extends r{upsert(n,i,a){return this._method="upsert",e(i)||this.returning(i,a),this._single.upsert=n,this}},Oi}var Ni,Ru;function Xx(){if(Ru)return Ni;Ru=1;const r=Rr(),e=mu(),t=zx(),n=Kx(),i=Jx(),a=Gx(),o=Yx();class s extends r{transaction(){return new e(this,...arguments)}queryCompiler(u,h){return new t(this,u,h)}columnCompiler(){return new n(this,...arguments)}tableCompiler(){return new i(this,...arguments)}viewCompiler(){return new a(this,...arguments)}queryBuilder(){return new o(this)}_parseVersion(u){return u.split(" ")[2]}async cancelQuery(u){try{return await this._wrappedCancelQueryCall(null,u)}catch(h){throw this.logger.warn(`Connection Error: ${h}`),h}}_wrappedCancelQueryCall(u,h){if(!(h.activeQuery.processID===0&&h.activeQuery.secretKey===0))return h.cancel(h,h.activeQuery)}toArrayPathFromJsonPath(u,h,c){return u.replace(/^(\$\.)/,"").replace(/\[([0-9]+)]/,".$1").split(".").map((function(d){return this.parameter(d,h,c)}).bind(this)).join(", ")}}return Object.assign(s.prototype,{driverName:"cockroachdb"}),Ni=s,Ni}var qi,Su;function Zx(){if(Su)return qi;Su=1;function r(e){return e==null}return qi=r,qi}var Ri,xu;function eI(){if(xu)return Ri;xu=1;const r=Nr;class e extends r{columnizeWithPrefix(n,i){const a=typeof i=="string"?[i]:i;let o="",s=-1;for(;++s<a.length;)s>0&&(o+=", "),o+=n+this.wrap(a[s]);return o}escapingStringDelimiters(n){return(n||"").replace(/'/g,"''")}}return Ri=e,Ri}var Si,Iu;function tI(){if(Iu)return Si;Iu=1;const r=Ce,e=ae("knex:tx");class t extends r{begin(s){return e("transaction::begin id=%s",this.txid),new Promise((l,u)=>{s.beginTransaction(h=>{if(h)return e("transaction::begin error id=%s message=%s",this.txid,h.message),u(h);l()},this.outerTx?this.txid:void 0,n(this.isolationLevel))}).then(this._resolver,this._rejecter)}savepoint(s){return e("transaction::savepoint id=%s",this.txid),new Promise((l,u)=>{s.saveTransaction(h=>{if(h)return e("transaction::savepoint id=%s message=%s",this.txid,h.message),u(h);this.trxClient.emit("query",{__knexUid:this.trxClient.__knexUid,__knexTxId:this.trxClient.__knexTxId,autogenerated:!0,sql:this.outerTx?`SAVE TRANSACTION [${this.txid}]`:"SAVE TRANSACTION"}),l()},this.outerTx?this.txid:void 0)})}commit(s,l){return e("transaction::commit id=%s",this.txid),new Promise((u,h)=>{s.commitTransaction(c=>{if(c)return e("transaction::commit error id=%s message=%s",this.txid,c.message),h(c);this._completed=!0,u(l)},this.outerTx?this.txid:void 0)}).then(()=>this._resolver(l),this._rejecter)}release(s,l){return this._resolver(l)}rollback(s,l){return this._completed=!0,e("transaction::rollback id=%s",this.txid),new Promise((u,h)=>{if(!s.inTransaction)return h(l||new Error("Transaction rejected with non-error: undefined"));if(s.state.name!=="LoggedIn")return h(new Error("Can't rollback transaction. There is a request in progress"));s.rollbackTransaction(c=>{c&&e("transaction::rollback error id=%s message=%s",this.txid,c.message),h(c||l||new Error("Transaction rejected with non-error: undefined"))},this.outerTx?this.txid:void 0)}).catch(u=>{if(!l&&this.doNotRejectOnRollback){this._resolver();return}if(l)try{u.originalError=l}catch{}this._rejecter(u)})}rollbackTo(s,l){return this.rollback(s,l).then(()=>void this.trxClient.emit("query",{__knexUid:this.trxClient.__knexUid,__knexTxId:this.trxClient.__knexTxId,autogenerated:!0,sql:"ROLLBACK TRANSACTION"}))}}Si=t;function n(o){if(!o)return;o=o.toUpperCase().replace(" ","_");const s=i[o];if(!s)throw new Error(`Unknown Isolation level, was expecting one of: ${JSON.stringify(a)}`);return s}const i={READ_UNCOMMITTED:1,READ_COMMITTED:2,REPEATABLE_READ:3,SERIALIZABLE:4,SNAPSHOT:5},a=Object.keys(i).map(o=>o.toLowerCase().replace("_"," "));return Si}var xi,Pu;function rI(){if(Pu)return xi;Pu=1;const r=De,e=In,t=ie,n=le,i=at,{columnize:a}=K,o=["columns","join","lock","where","union","group","having","order","limit","offset"];class s extends r{constructor(u,h,c){super(u,h,c);const{onConflict:d}=this.single;if(d)throw new Error(".onConflict() is not supported for mssql.");this._emptyInsertValue="default values"}with(){const u=[];if(this.grouped.with)for(const c of this.grouped.with)c.recursive&&(u.push(c),c.recursive=!1);const h=super.with();for(const c of u)c.recursive=!0;return h}select(){const u=this.with(),h=o.map(c=>this[c](this));return u+e(h).join(" ")}insert(){return this.single.options&&this.single.options.includeTriggerModifications?this.insertWithTriggers():this.standardInsert()}insertWithTriggers(){const u=this.single.insert||[],{returning:h}=this.single;let c=this.with()+`${this._buildTempTable(h)}insert into ${this.tableName} `;const d=h?this._returning("insert",h,!0)+" ":"";if(Array.isArray(u)){if(u.length===0)return""}else if(typeof u=="object"&&n(u))return{sql:c+d+this._emptyInsertValue+this._buildReturningSelect(h),returning:h};return c+=this._buildInsertData(u,d),h&&(c+=this._buildReturningSelect(h)),{sql:c,returning:h}}_buildInsertData(u,h){let c="";const d=this._prepInsert(u);if(typeof d=="string")c+=d;else if(d.columns.length)c+=`(${this.formatter.columnize(d.columns)}`,c+=`) ${h}values (`+this._buildInsertValues(d)+")";else if(u.length===1&&u[0])c+=h+this._emptyInsertValue;else return"";return c}standardInsert(){const u=this.single.insert||[];let h=this.with()+`insert into ${this.tableName} `;const{returning:c}=this.single,d=c?this._returning("insert",c)+" ":"";if(Array.isArray(u)){if(u.length===0)return""}else if(typeof u=="object"&&n(u))return{sql:h+d+this._emptyInsertValue,returning:c};return h+=this._buildInsertData(u,d),{sql:h,returning:c}}update(){return this.single.options&&this.single.options.includeTriggerModifications?this.updateWithTriggers():this.standardUpdate()}updateWithTriggers(){const u=this.top(),h=this.with(),c=this._prepUpdate(this.single.update),d=this.join(),p=this.where(),g=this.order(),{returning:_}=this.single,f=this._buildTempTable(_);return{sql:h+f+`update ${u?u+" ":""}${this.tableName} set `+c.join(", ")+(_?` ${this._returning("update",_,!0)}`:"")+(d?` from ${this.tableName} ${d}`:"")+(p?` ${p}`:"")+(g?` ${g}`:"")+(_?this._buildReturningSelect(_):this._returning("rowcount","@@rowcount")),returning:_||"@@rowcount"}}_formatGroupsItemValue(u,h){const c=super._formatGroupsItemValue(u);if(h&&!(u instanceof i)){const d=`IIF(${c} is null,`;if(h==="first")return`${d}0,1)`;if(h==="last")return`${d}1,0)`}return c}standardUpdate(){const u=this.top(),h=this.with(),c=this._prepUpdate(this.single.update),d=this.join(),p=this.where(),g=this.order(),{returning:_}=this.single;return{sql:h+`update ${u?u+" ":""}${this.tableName} set `+c.join(", ")+(_?` ${this._returning("update",_)}`:"")+(d?` from ${this.tableName} ${d}`:"")+(p?` ${p}`:"")+(g?` ${g}`:"")+(_?"":this._returning("rowcount","@@rowcount")),returning:_||"@@rowcount"}}del(){return this.single.options&&this.single.options.includeTriggerModifications?this.deleteWithTriggers():this.standardDelete()}deleteWithTriggers(){const u=this.with(),{tableName:h}=this,c=this.where(),d=this.join(),{returning:p}=this.single,g=p?` ${this._returning("del",p,!0)}`:"",_=d?`${h}${g} `:"";return{sql:u+`${this._buildTempTable(p)}delete ${_}from ${h}`+(d?"":g)+(d?` ${d}`:"")+(c?` ${c}`:"")+(p?this._buildReturningSelect(p):this._returning("rowcount","@@rowcount")),returning:p||"@@rowcount"}}standardDelete(){const u=this.with(),{tableName:h}=this,c=this.where(),d=this.join(),{returning:p}=this.single,g=p?` ${this._returning("del",p)}`:"",_=d?`${h}${g} `:"";return{sql:u+`delete ${_}from ${h}`+(d?"":g)+(d?` ${d}`:"")+(c?` ${c}`:"")+(p?"":this._returning("rowcount","@@rowcount")),returning:p||"@@rowcount"}}columns(){let u="";if(this.onlyUnions())return"";const h=this.top(),c=this._hintComments(),d=this.grouped.columns||[];let p=-1,g=[];if(d)for(;++p<d.length;){const f=d[p];if(f.distinct&&(u="distinct "),f.distinctOn){u=this.distinctOn(f.value);continue}f.type==="aggregate"?g.push(...this.aggregate(f)):f.type==="aggregateRaw"?g.push(this.aggregateRaw(f)):f.type==="analytic"?g.push(this.analytic(f)):f.type==="json"?g.push(this.json(f)):f.value&&f.value.length>0&&g.push(this.formatter.columnize(f.value))}return g.length===0&&(g=["*"]),`${this.onlyJson()?"":"select "}${c}${u}`+(h?h+" ":"")+g.join(", ")+(this.tableName?` from ${this.tableName}`:"")}_returning(u,h,c){switch(u){case"update":case"insert":return h?`output ${this.formatter.columnizeWithPrefix("inserted.",h)}${c?" into #out":""}`:"";case"del":return h?`output ${this.formatter.columnizeWithPrefix("deleted.",h)}${c?" into #out":""}`:"";case"rowcount":return h?";select @@rowcount":""}}_buildTempTable(u){if(u&&u.length>0){let h="";Array.isArray(u)?h=u.map(d=>`[t].${this.formatter.columnize(d)}`).join(","):h=`[t].${this.formatter.columnize(u)}`;let c=`select top(0) ${h} into #out `;return c+=`from ${this.tableName} as t `,c+=`left join ${this.tableName} on 0=1;`,c}return""}_buildReturningSelect(u){if(u&&u.length>0){let h="";Array.isArray(u)?h=u.map(d=>`${this.formatter.columnize(d)}`).join(","):h=this.formatter.columnize(u);let c=`; select ${h} from #out; `;return c+="drop table #out;",c}return""}truncate(){return`truncate table ${this.tableName}`}forUpdate(){return"with (UPDLOCK)"}forShare(){return"with (HOLDLOCK)"}columnInfo(){const u=this.single.columnInfo;let h=this.single.schema;const c=this.client.customWrapIdentifier(this.single.table,t);h&&(h=this.client.customWrapIdentifier(h,t));let d="select [COLUMN_NAME], [COLUMN_DEFAULT], [DATA_TYPE], [CHARACTER_MAXIMUM_LENGTH], [IS_NULLABLE] from INFORMATION_SCHEMA.COLUMNS where table_name = ? and table_catalog = ?";const p=[c,this.client.database()];return h?(d+=" and table_schema = ?",p.push(h)):d+=" and table_schema = 'dbo'",{sql:d,bindings:p,output(g){const _=g.reduce((f,m)=>(f[m[0].value]={defaultValue:m[1].value,type:m[2].value,maxLength:m[3].value,nullable:m[4].value==="YES"},f),{});return u&&_[u]||_}}}top(){const u=!this.single.limit&&this.single.limit!==0,h=!this.single.offset;return u||!h?"":`top (${this._getValueOrParameterFromAttribute("limit")})`}limit(){return""}offset(){const u=!this.single.limit&&this.single.limit!==0,h=!this.single.offset;if(h)return"";let c=`offset ${h?"0":this._getValueOrParameterFromAttribute("offset")} rows`;return u||(c+=` fetch next ${this._getValueOrParameterFromAttribute("limit")} rows only`),c}whereLike(u){return`${this._columnClause(u)} collate SQL_Latin1_General_CP1_CS_AS ${this._not(u,"like ")}${this._valueClause(u)}`}whereILike(u){return`${this._columnClause(u)} collate SQL_Latin1_General_CP1_CI_AS ${this._not(u,"like ")}${this._valueClause(u)}`}jsonExtract(u){return this._jsonExtract(u.singleValue?"JSON_VALUE":"JSON_QUERY",u)}jsonSet(u){return this._jsonSet("JSON_MODIFY",u)}jsonInsert(u){return this._jsonSet("JSON_MODIFY",u)}jsonRemove(u){const h=`JSON_MODIFY(${a(u.column,this.builder,this.client,this.bindingsHolder)},${this.client.parameter(u.path,this.builder,this.bindingsHolder)}, NULL)`;return u.alias?this.client.alias(h,this.formatter.wrap(u.alias)):h}whereJsonPath(u){return this._whereJsonPath("JSON_VALUE",u)}whereJsonSupersetOf(u){throw new Error("Json superset where clause not actually supported by MSSQL")}whereJsonSubsetOf(u){throw new Error("Json subset where clause not actually supported by MSSQL")}_getExtracts(u,h){const c=a(u.column,this.builder,this.client,this.bindingsHolder);return(Array.isArray(u.values)?u.values:[u.values]).map(function(d){return"JSON_VALUE("+c+","+this.client.parameter(d,this.builder,this.bindingsHolder)+")"},this).join(h)}onJsonPathEquals(u){return this._onJsonPathEquals("JSON_VALUE",u)}}return xi=s,xi}var Ii,Lu;function nI(){if(Lu)return Ii;Lu=1;const r=ct;class e extends r{constructor(i,a){super(i,a)}dropTableIfExists(i){const a=this.formatter.wrap(t(this.schema,i));this.pushQuery(`if object_id('${a}', 'U') is not null DROP TABLE ${a}`)}dropViewIfExists(i){const a=this.formatter.wrap(t(this.schema,i));this.pushQuery(`if object_id('${a}', 'V') is not null DROP VIEW ${a}`)}renameTable(i,a){this.pushQuery(`exec sp_rename ${this.client.parameter(t(this.schema,i),this.builder,this.bindingsHolder)}, ${this.client.parameter(a,this.builder,this.bindingsHolder)}`)}renameView(i,a){this.pushQuery(`exec sp_rename ${this.client.parameter(t(this.schema,i),this.builder,this.bindingsHolder)}, ${this.client.parameter(a,this.builder,this.bindingsHolder)}`)}hasTable(i){const a=this.client.parameter(t(this.schema,i),this.builder,this.bindingsHolder),o=[i];let s=`SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = ${a}`;this.schema&&(s+=" AND TABLE_SCHEMA = ?",o.push(this.schema)),this.pushQuery({sql:s,bindings:o,output:l=>l.length>0})}hasColumn(i,a){const o=this.client.parameter(a,this.builder,this.bindingsHolder),s=this.client.parameter(this.formatter.wrap(t(this.schema,i)),this.builder,this.bindingsHolder),l=`select object_id from sys.columns where name = ${o} and object_id = object_id(${s})`;this.pushQuery({sql:l,output:u=>u.length>0})}}e.prototype.dropTablePrefix="DROP TABLE ";function t(n,i){return n?`${n}.${i}`:i}return Ii=e,Ii}var Pi,Bu;function iI(){if(Bu)return Pi;Bu=1;const r=ht,e=z,{isObject:t}=M;class n extends r{constructor(a,o){super(a,o)}createQuery(a,o,s){let l=o?`if object_id('${this.tableName()}', 'U') is null `:"";s?l+=`SELECT * INTO ${this.tableName()} FROM ${this.tableNameLike()} WHERE 0=1`:l+="CREATE TABLE "+this.tableName()+(this._formatting?` (
    `:" (")+a.sql.join(this._formatting?`,
    `:", ")+this._addChecks()+")",this.pushQuery(l),this.single.comment&&this.comment(this.single.comment),s&&this.addColumns(a,this.addColumnsPrefix)}comment(a){if(!a)return;a.length>3750&&this.client.logger.warn("Your comment might be longer than the max comment length for MSSQL of 7,500 bytes.");const o=this.formatter.escapingStringDelimiters(a),s=this.formatter.escapingStringDelimiters(this.schemaNameRaw||"dbo"),l=this.formatter.escapingStringDelimiters(this.tableNameRaw),u=`N'MS_Description', N'${o}', N'Schema', N'${s}', N'Table', N'${l}'`,h=`EXISTS(SELECT * FROM sys.fn_listextendedproperty(N'MS_Description', N'Schema', N'${s}', N'Table', N'${l}', NULL, NULL))`;this.pushQuery(`IF ${h}
  EXEC sys.sp_updateextendedproperty ${u}
ELSE
  EXEC sys.sp_addextendedproperty ${u}`)}addColumns(a,o){o=o||this.addColumnsPrefix,a.sql.length>0&&this.pushQuery({sql:(this.lowerCase?"alter table ":"ALTER TABLE ")+this.tableName()+" "+o+a.sql.join(", "),bindings:a.bindings})}alterColumns(a,o){for(let s=0,l=o.length;s<l;s++){const u=o[s];if(u.modified.defaultTo){const c=`
              DECLARE @constraint varchar(100) = (SELECT default_constraints.name
                                                  FROM sys.all_columns
                                                  INNER JOIN sys.tables
                                                    ON all_columns.object_id = tables.object_id
                                                  INNER JOIN sys.schemas
                                                    ON tables.schema_id = schemas.schema_id
                                                  INNER JOIN sys.default_constraints
                                                    ON all_columns.default_object_id = default_constraints.object_id
                                                  WHERE schemas.name = '${this.schemaNameRaw||"dbo"}'
                                                  AND tables.name = '${this.tableNameRaw}'
                                                  AND all_columns.name = '${u.getColumnName()}')

              IF @constraint IS NOT NULL EXEC('ALTER TABLE ${this.tableNameRaw} DROP CONSTRAINT ' + @constraint)`;this.pushQuery(c)}}a.sql.forEach(s=>{this.pushQuery({sql:(this.lowerCase?"alter table ":"ALTER TABLE ")+this.tableName()+" "+(this.lowerCase?this.alterColumnPrefix.toLowerCase():this.alterColumnPrefix)+s,bindings:a.bindings})})}dropColumn(){const a=this,o=e.normalizeArr.apply(null,arguments),l=(Array.isArray(o)?o:[o]).map(h=>a.formatter.wrap(h)),u=this.schemaNameRaw||"dbo";for(const h of o){const c=`
              DECLARE @constraint varchar(100) = (SELECT default_constraints.name
                                                  FROM sys.all_columns
                                                  INNER JOIN sys.tables
                                                    ON all_columns.object_id = tables.object_id
                                                  INNER JOIN sys.schemas
                                                    ON tables.schema_id = schemas.schema_id
                                                  INNER JOIN sys.default_constraints
                                                    ON all_columns.default_object_id = default_constraints.object_id
                                                  WHERE schemas.name = '${u}'
                                                  AND tables.name = '${this.tableNameRaw}'
                                                  AND all_columns.name = '${h}')

              IF @constraint IS NOT NULL EXEC('ALTER TABLE ${this.tableNameRaw} DROP CONSTRAINT ' + @constraint)`;this.pushQuery(c)}this.pushQuery((this.lowerCase?"alter table ":"ALTER TABLE ")+this.tableName()+" "+this.dropColumnPrefix+l.join(", "))}changeType(){}renameColumn(a,o){this.pushQuery(`exec sp_rename ${this.client.parameter(this.tableName()+"."+a,this.tableBuilder,this.bindingsHolder)}, ${this.client.parameter(o,this.tableBuilder,this.bindingsHolder)}, 'COLUMN'`)}dropFKRefs(a,o){const s=this.client.formatter(this.tableBuilder);return Promise.all(o.map(function(l){const u=s.wrap(l.CONSTRAINT_NAME),h=s.wrap(l.TABLE_NAME);return a.query({sql:`ALTER TABLE ${h} DROP CONSTRAINT ${u}`})}))}createFKRefs(a,o){const s=this.client.formatter(this.tableBuilder);return Promise.all(o.map(function(l){const u=s.wrap(l.TABLE_NAME),h=s.wrap(l.CONSTRAINT_NAME),c=s.columnize(l.COLUMN_NAME),d=s.columnize(l.REFERENCED_COLUMN_NAME),p=s.wrap(l.REFERENCED_TABLE_NAME),g=` ON UPDATE ${l.UPDATE_RULE}`,_=` ON DELETE ${l.DELETE_RULE}`;return a.query({sql:`ALTER TABLE ${u} ADD CONSTRAINT ${h} FOREIGN KEY (`+c+") REFERENCES "+p+" ("+d+")"+g+_})}))}index(a,o,s){o=o?this.formatter.wrap(o):this._indexCommand("index",this.tableNameRaw,a);let l;t(s)&&({predicate:l}=s);const u=l?" "+this.client.queryCompiler(l).where():"";this.pushQuery(`CREATE INDEX ${o} ON ${this.tableName()} (${this.formatter.columnize(a)})${u}`)}primary(a,o){let s;t(o)&&({constraintName:o,deferrable:s}=o),s&&s!=="not deferrable"&&this.client.logger.warn(`mssql: primary key constraint [${o}] will not be deferrable ${s} because mssql does not support deferred constraints.`),o=o?this.formatter.wrap(o):this.formatter.wrap(`${this.tableNameRaw}_pkey`),this.forCreate?this.pushQuery(`CONSTRAINT ${o} PRIMARY KEY (${this.formatter.columnize(a)})`):this.pushQuery(`ALTER TABLE ${this.tableName()} ADD CONSTRAINT ${o} PRIMARY KEY (${this.formatter.columnize(a)})`)}unique(a,o){let s,l=!1,u;if(t(o)&&({indexName:o,deferrable:s,useConstraint:l,predicate:u}=o),s&&s!=="not deferrable"&&this.client.logger.warn(`mssql: unique index [${o}] will not be deferrable ${s} because mssql does not support deferred constraints.`),l&&u)throw new Error("mssql cannot create constraint with predicate");if(o=o?this.formatter.wrap(o):this._indexCommand("unique",this.tableNameRaw,a),Array.isArray(a)||(a=[a]),l)this.pushQuery(`ALTER TABLE ${this.tableName()} ADD CONSTRAINT ${o} UNIQUE (${this.formatter.columnize(a)})`);else{const h=u?" "+this.client.queryCompiler(u).where():" WHERE "+a.map(c=>this.formatter.columnize(c)+" IS NOT NULL").join(" AND ");this.pushQuery(`CREATE UNIQUE INDEX ${o} ON ${this.tableName()} (${this.formatter.columnize(a)})${h}`)}}dropIndex(a,o){o=o?this.formatter.wrap(o):this._indexCommand("index",this.tableNameRaw,a),this.pushQuery(`DROP INDEX ${o} ON ${this.tableName()}`)}dropForeign(a,o){o=o?this.formatter.wrap(o):this._indexCommand("foreign",this.tableNameRaw,a),this.pushQuery(`ALTER TABLE ${this.tableName()} DROP CONSTRAINT ${o}`)}dropPrimary(a){a=a?this.formatter.wrap(a):this.formatter.wrap(`${this.tableNameRaw}_pkey`),this.pushQuery(`ALTER TABLE ${this.tableName()} DROP CONSTRAINT ${a}`)}dropUnique(a,o){o=o?this.formatter.wrap(o):this._indexCommand("unique",this.tableNameRaw,a),this.pushQuery(`DROP INDEX ${o} ON ${this.tableName()}`)}}return n.prototype.createAlterTableMethods=["foreign","primary"],n.prototype.lowerCase=!1,n.prototype.addColumnsPrefix="ADD ",n.prototype.dropColumnPrefix="DROP COLUMN ",n.prototype.alterColumnPrefix="ALTER COLUMN ",Pi=n,Pi}var Li,ku;function sI(){if(ku)return Li;ku=1;const r=ft,{columnize:e}=K;class t extends r{constructor(i,a){super(i,a)}createQuery(i,a,o,s){let u="CREATE "+(s?"OR ALTER ":"")+"VIEW "+this.viewName();const h=i?" ("+e(i,this.viewBuilder,this.client,this.bindingsHolder)+")":"";u+=h,u+=" AS ",u+=a.toString(),this.pushQuery({sql:u})}renameColumn(i,a){this.pushQuery(`exec sp_rename ${this.client.parameter(this.viewName()+"."+i,this.viewBuilder,this.bindingsHolder)}, ${this.client.parameter(a,this.viewBuilder,this.bindingsHolder)}, 'COLUMN'`)}createOrReplace(){this.createQuery(this.columns,this.selectQuery,!1,!0)}}return Li=t,Li}var Bi,Mu;function oI(){if(Mu)return Bi;Mu=1;const r=Ue,{toNumber:e}=z,{formatDefault:t}=je,{operator:n}=K;class i extends r{constructor(o,s,l){super(o,s,l),this.modifiers=["nullable","defaultTo","first","after","comment"],this._addCheckModifiers()}double(o,s){return"float"}floating(o,s){return"float"}integer(){return"int"}tinyint(){return"tinyint"}varchar(o){return`nvarchar(${e(o,255)})`}timestamp({useTz:o=!1}={}){return o?"datetimeoffset":"datetime2"}bit(o){return o>1&&this.client.logger.warn("Bit field is exactly 1 bit length for MSSQL"),"bit"}binary(o){return o?`varbinary(${e(o)})`:"varbinary(max)"}first(){return this.client.logger.warn("Column first modifier not available for MSSQL"),""}after(o){return this.client.logger.warn("Column after modifier not available for MSSQL"),""}defaultTo(o,{constraintName:s}={}){const l=t(o,this.type,this.client);return s=typeof s<"u"?s:`${this.tableCompiler.tableNameRaw}_${this.getColumnName()}_default`.toLowerCase(),this.columnBuilder._method==="alter"?(this.pushAdditional(function(){this.pushQuery(`ALTER TABLE ${this.tableCompiler.tableName()} ADD CONSTRAINT ${this.formatter.wrap(s)} DEFAULT ${l} FOR ${this.formatter.wrap(this.getColumnName())}`)}),""):s?`CONSTRAINT ${this.formatter.wrap(s)} DEFAULT ${l}`:`DEFAULT ${l}`}comment(o){if(!o)return;o&&o.length>3750&&this.client.logger.warn("Your comment might be longer than the max comment length for MSSQL of 7,500 bytes.");const s=this.formatter.escapingStringDelimiters(o),l=this.tableCompiler.schemaNameRaw||"dbo",u=this.formatter.escapingStringDelimiters(this.tableCompiler.tableNameRaw),h=this.formatter.escapingStringDelimiters(this.args[0]||this.defaults("columnName")),c=`N'MS_Description', N'${s}', N'Schema', N'${l}', N'Table', N'${u}', N'Column', N'${h}'`;return this.pushAdditional(function(){const d=`EXISTS(SELECT * FROM sys.fn_listextendedproperty(N'MS_Description', N'Schema', N'${l}', N'Table', N'${u}', N'Column', N'${h}'))`;this.pushQuery(`IF ${d}
  EXEC sys.sp_updateextendedproperty ${c}
ELSE
  EXEC sys.sp_addextendedproperty ${c}`)}),""}checkLength(o,s,l){return this._check(`LEN(${this.formatter.wrap(this.getColumnName())}) ${n(o,this.columnBuilder,this.bindingsHolder)} ${e(s)}`,l)}checkRegex(o,s){return this._check(`${this.formatter.wrap(this.getColumnName())} LIKE ${this.client._escapeBinding("%"+o+"%")}`,s)}increments(o={primaryKey:!0}){return"int identity(1,1) not null"+(this.tableCompiler._canBeAddPrimaryKey(o)?" primary key":"")}bigincrements(o={primaryKey:!0}){return"bigint identity(1,1) not null"+(this.tableCompiler._canBeAddPrimaryKey(o)?" primary key":"")}}return i.prototype.bigint="bigint",i.prototype.mediumint="int",i.prototype.smallint="smallint",i.prototype.text="nvarchar(max)",i.prototype.mediumtext="nvarchar(max)",i.prototype.longtext="nvarchar(max)",i.prototype.json=i.prototype.jsonb="nvarchar(max)",i.prototype.enu="nvarchar(100)",i.prototype.uuid=({useBinaryUuid:a=!1}={})=>a?"binary(16)":"uniqueidentifier",i.prototype.datetime="datetime2",i.prototype.bool="bit",Bi=i,Bi}var ki,ju;function aI(){if(ju)return ki;ju=1;const r=Qe,e=Zx(),t=He,n=eI(),i=tI(),a=rI(),o=nI(),s=iI(),l=sI(),u=oI(),h=Ee,c=ae("knex:mssql"),d={MIN:-2147483648,MAX:2147483647},p={MIN:-9007199254740991,MAX:9007199254740991};class g extends t{constructor(f={}){super(f)}_generateConnection(){const f=this.connectionSettings;f.options=f.options||{};const m={authentication:{type:f.type||"default",options:{userName:f.userName||f.user,password:f.password,domain:f.domain,token:f.token,clientId:f.clientId,clientSecret:f.clientSecret,tenantId:f.tenantId,msiEndpoint:f.msiEndpoint}},server:f.server||f.host,options:{database:f.database,encrypt:f.encrypt||!1,port:f.port||1433,connectTimeout:f.connectionTimeout||f.timeout||15e3,requestTimeout:e(f.requestTimeout)?15e3:f.requestTimeout,rowCollectionOnDone:!1,rowCollectionOnRequestCompletion:!1,useColumnNames:!1,tdsVersion:f.options.tdsVersion||"7_4",appName:f.options.appName||"knex",trustServerCertificate:!1,...f.options}};return m.options.instanceName&&delete m.options.port,isNaN(m.options.requestTimeout)&&(m.options.requestTimeout=15e3),m.options.requestTimeout===1/0&&(m.options.requestTimeout=0),m.options.requestTimeout<0&&(m.options.requestTimeout=0),f.debug&&(m.options.debug={packet:!0,token:!0,data:!0,payload:!0}),m}_driver(){return I}formatter(){return new n(this,...arguments)}transaction(){return new i(this,...arguments)}queryCompiler(){return new a(this,...arguments)}schemaCompiler(){return new o(this,...arguments)}tableCompiler(){return new s(this,...arguments)}viewCompiler(){return new l(this,...arguments)}queryBuilder(){return new h(this)}columnCompiler(){return new u(this,...arguments)}wrapIdentifierImpl(f){return f==="*"?"*":`[${f.replace(/[[\]]+/g,"")}]`}acquireRawConnection(){return new Promise((f,m)=>{c("connection::connection new connection requested");const y=this._driver(),w=Object.assign({},this._generateConnection()),$=new y.Connection(w);$.connect(E=>E?(c("connection::connect error: %s",E.message),m(E)):(c("connection::connect connected to server"),$.connected=!0,$.on("error",C=>{c("connection::error message=%s",C.message),$.__knex__disposed=C,$.connected=!1}),$.once("end",()=>{$.connected=!1,$.__knex__disposed="Connection to server was terminated.",c("connection::end connection ended.")}),f($)))})}validateConnection(f){return f&&f.connected}destroyRawConnection(f){return c("connection::destroy"),new Promise(m=>{f.once("end",()=>{m()}),f.close()})}positionBindings(f){let m=-1;return f.replace(/\\?\?/g,y=>y==="\\?"?"?":(m+=1,`@p${m}`))}_chomp(f){if(f.state.name==="LoggedIn"){const m=this.requestQueue.pop();m&&(c("connection::query executing query, %d more in queue",this.requestQueue.length),f.execSql(m))}}_enqueueRequest(f,m){this.requestQueue.push(f),this._chomp(m)}_makeRequest(f,m){const y=this._driver(),w=typeof f=="string"?f:f.sql;let $=0;if(!w)throw new Error("The query is empty");c("request::request sql=%s",w);const E=new y.Request(w,(C,T)=>{if(C)return c("request::error message=%s",C.message),m(C);$=T,c("request::callback rowCount=%d",$)});return E.on("prepared",()=>{c("request %s::request prepared",this.id)}),E.on("done",(C,T)=>{c("request::done rowCount=%d more=%s",C,T)}),E.on("doneProc",(C,T)=>{c("request::doneProc id=%s rowCount=%d more=%s",E.id,C,T)}),E.on("doneInProc",(C,T)=>{c("request::doneInProc id=%s rowCount=%d more=%s",E.id,C,T)}),E.once("requestCompleted",()=>(c("request::completed id=%s",E.id),m(null,$))),E.on("error",C=>(c("request::error id=%s message=%s",E.id,C.message),m(C))),E}_stream(f,m,y){return new Promise((w,$)=>{const E=this._makeRequest(m,C=>{if(C)return y.emit("error",C),$(C);w()});E.on("row",C=>{y.write(C.reduce((T,N)=>({...T,[N.metadata.colName]:N.value}),{}))}),E.on("error",C=>{y.emit("error",C),$(C)}),E.once("requestCompleted",()=>{y.end(),w()}),this._assignBindings(E,m.bindings),this._enqueueRequest(E,f)})}_assignBindings(f,m){if(Array.isArray(m))for(let y=0;y<m.length;y++){const w=m[y];this._setReqInput(f,y,w)}}_scaleForBinding(f){if(f%1===0)throw new Error(`The binding value ${f} must be a decimal number.`);return{scale:10}}_typeForBinding(f){const m=this._driver();if(this.connectionSettings.options&&this.connectionSettings.options.mapBinding){const y=this.connectionSettings.options.mapBinding(f);if(y)return[y.value,y.type]}switch(typeof f){case"string":return[f,m.TYPES.NVarChar];case"boolean":return[f,m.TYPES.Bit];case"number":{if(f%1!==0)return[f,m.TYPES.Float];if(f<d.MIN||f>d.MAX){if(f<p.MIN||f>p.MAX)throw new Error(`Bigint must be safe integer or must be passed as string, saw ${f}`);return[f,m.TYPES.BigInt]}return[f,m.TYPES.Int]}default:return f instanceof Date?[f,m.TYPES.DateTime]:f instanceof Buffer?[f,m.TYPES.VarBinary]:[f,m.TYPES.NVarChar]}}_query(f,m){return new Promise((y,w)=>{const $=[],E=this._makeRequest(m,(C,T)=>{if(C)return w(C);m.response=$,process.nextTick(()=>this._chomp(f)),y(m)});E.on("row",C=>{c("request::row"),$.push(C)}),this._assignBindings(E,m.bindings),this._enqueueRequest(E,f)})}_setReqInput(f,m,y){const[w,$]=this._typeForBinding(y),E="p".concat(m);let C;typeof w=="number"&&w%1!==0&&(C=this._scaleForBinding(w)),c("request::binding pos=%d type=%s value=%s",m,$.name,w),Buffer.isBuffer(w)&&(C={length:"max"}),f.addParameter(E,$,w,C)}processResponse(f,m){if(f==null)return;let{response:y}=f;const{method:w}=f;if(f.output||(y=y.map($=>$.reduce((E,C)=>{const T=C.metadata.colName;return E[T]?(Array.isArray(E[T])||(E[T]=[E[T]]),E[T].push(C.value)):E[T]=C.value,E},{})),f.output))return f.output.call(m,y);switch(w){case"select":return y;case"first":return y[0];case"pluck":return r(y,f.pluck);case"insert":case"del":case"update":case"counter":return f.returning&&f.returning==="@@rowcount"?y[0][""]:y;default:return y}}}return Object.assign(g.prototype,{requestQueue:[],dialect:"mssql",driverName:"mssql"}),ki=g,ki}var Mi,Qu;function lI(){if(Qu)return Mi;Qu=1;var r="Expected a function";function e(t,n,i){if(typeof t!="function")throw new TypeError(r);return setTimeout(function(){t.apply(void 0,i)},n)}return Mi=e,Mi}var ji,Du;function uI(){if(Du)return ji;Du=1;var r=lI(),e=on,t=e(function(n,i){return r(n,1,i)});return ji=t,ji}var Qi,Fu;function cI(){if(Fu)return Qi;Fu=1;const r=Ce,t=ae("knex:tx");class n extends r{query(a,o,s,l){const u=this,h=this.trxClient.query(a,o).catch(c=>{if(c.errno===1305){this.trxClient.logger.warn("Transaction was implicitly committed, do not mix transactions and DDL with MySQL (#805)");return}s=2,l=c,u._completed=!0,t("%s error running transaction query",u.txid)}).then(function(c){if(s===1&&u._resolver(l),s===2){if(l===void 0){if(u.doNotRejectOnRollback&&/^ROLLBACK\b/i.test(o)){u._resolver();return}l=new Error(`Transaction rejected with non-error: ${l}`)}u._rejecter(l)}return c});return(s===1||s===2)&&(u._completed=!0),h}}return Qi=n,Qi}var Di,Uu;function hI(){if(Uu)return Di;Uu=1;const r=I,e=ie,t=$e,n=le,i=De,{wrapAsIdentifier:a}=je,{columnize:o,wrap:s}=K,l=h=>t(h)||Array.isArray(h);class u extends i{constructor(c,d,p){super(c,d,p);const{returning:g}=this.single;g&&this.client.logger.warn(".returning() is not supported by mysql and will not have any effect."),this._emptyInsertValue="() values ()"}insert(){let c=super.insert();if(c==="")return c;const{ignore:d,merge:p,insert:g}=this.single;if(d&&(c=c.replace("insert into","insert ignore into")),p&&(c+=this._merge(p.updates,g),this.where()))throw new Error(".onConflict().merge().where() is not supported for mysql");return c}_merge(c,d){const p=" on duplicate key update ";if(c&&Array.isArray(c))return p+c.map(g=>a(g,this.formatter.builder,this.client)).map(g=>`${g} = values(${g})`).join(", ");if(c&&typeof c=="object"){const g=this._prepUpdate(c);return p+g.join(",")}else{const g=this._prepInsert(d);if(typeof g=="string")throw new Error("If using merge with a raw insert query, then updates must be provided");return p+g.columns.map(_=>a(_,this.builder,this.client)).map(_=>`${_} = values(${_})`).join(", ")}}update(){const c=this.with(),d=this.join(),p=this._prepUpdate(this.single.update),g=this.where(),_=this.order(),f=this.limit();return c+`update ${this.tableName}`+(d?` ${d}`:"")+" set "+p.join(", ")+(g?` ${g}`:"")+(_?` ${_}`:"")+(f?` ${f}`:"")}forUpdate(){return"for update"}forShare(){return"lock in share mode"}skipLocked(){return"skip locked"}noWait(){return"nowait"}columnInfo(){const c=this.single.columnInfo;return{sql:"select * from information_schema.columns where table_name = ? and table_schema = ?",bindings:[this.client.customWrapIdentifier(this.single.table,e),this.client.database()],output(p){const g=p.reduce(function(_,f){return _[f.COLUMN_NAME]={defaultValue:f.COLUMN_DEFAULT==="NULL"?null:f.COLUMN_DEFAULT,type:f.DATA_TYPE,maxLength:f.CHARACTER_MAXIMUM_LENGTH,nullable:f.IS_NULLABLE==="YES"},_},{});return c&&g[c]||g}}}limit(){const c=!this.single.limit&&this.single.limit!==0;return c&&!this.single.offset?"":`limit ${this.single.offset&&c?"18446744073709551615":this._getValueOrParameterFromAttribute("limit")}`}whereBasic(c){return r(!l(c.value),"The values in where clause must not be object or array."),super.whereBasic(c)}whereRaw(c){return r(n(c.value.bindings)||!Object.values(c.value.bindings).some(l),"The values in where clause must not be object or array."),super.whereRaw(c)}whereLike(c){return`${this._columnClause(c)} ${this._not(c,"like ")}${this._valueClause(c)} COLLATE utf8_bin`}whereILike(c){return`${this._columnClause(c)} ${this._not(c,"like ")}${this._valueClause(c)}`}jsonExtract(c){return this._jsonExtract(["json_extract","json_unquote"],c)}jsonSet(c){return this._jsonSet("json_set",c)}jsonInsert(c){return this._jsonSet("json_insert",c)}jsonRemove(c){const d=`json_remove(${o(c.column,this.builder,this.client,this.bindingsHolder)},${this.client.parameter(c.path,this.builder,this.bindingsHolder)})`;return c.alias?this.client.alias(d,this.formatter.wrap(c.alias)):d}whereJsonObject(c){return this._not(c,`json_contains(${this._columnClause(c)}, ${this._jsonValueClause(c)})`)}whereJsonPath(c){return this._whereJsonPath("json_extract",c)}whereJsonSupersetOf(c){return this._not(c,`json_contains(${s(c.column,void 0,this.builder,this.client,this.bindingsHolder)},${this._jsonValueClause(c)})`)}whereJsonSubsetOf(c){return this._not(c,`json_contains(${this._jsonValueClause(c)},${s(c.column,void 0,this.builder,this.client,this.bindingsHolder)})`)}onJsonPathEquals(c){return this._onJsonPathEquals("json_extract",c)}}return Di=u,Di}var Fi,Hu;function dI(){if(Hu)return Fi;Hu=1;const r=ct;class e extends r{constructor(n,i){super(n,i)}renameTable(n,i){this.pushQuery(`rename table ${this.formatter.wrap(n)} to ${this.formatter.wrap(i)}`)}renameView(n,i){this.renameTable(n,i)}hasTable(n){let i="select * from information_schema.tables where table_name = ?";const a=[n];this.schema?(i+=" and table_schema = ?",a.push(this.schema)):i+=" and table_schema = database()",this.pushQuery({sql:i,bindings:a,output:function(s){return s.length>0}})}hasColumn(n,i){this.pushQuery({sql:`show columns from ${this.formatter.wrap(n)}`,output(a){return a.some(o=>this.client.wrapIdentifier(o.Field.toLowerCase())===this.client.wrapIdentifier(i.toLowerCase()))}})}}return Fi=e,Fi}var Ui,Vu;function fI(){if(Vu)return Ui;Vu=1;const r=ht,{isObject:e,isString:t}=M;class n extends r{constructor(a,o){super(a,o)}createQuery(a,o,s){const l=o?"create table if not exists ":"create table ",{client:u}=this;let h={},c=" ("+a.sql.join(", ");c+=this.primaryKeys()||"",c+=this._addChecks(),c+=")";let d=l+this.tableName()+(s&&this.tableNameLike()?" like "+this.tableNameLike():c);u.connectionSettings&&(h=u.connectionSettings);const p=this.single.charset||h.charset||"",g=this.single.collate||h.collate||"",_=this.single.engine||"";if(p&&!s&&(d+=` default character set ${p}`),g&&(d+=` collate ${g}`),_&&(d+=` engine = ${_}`),this.single.comment){const f=this.single.comment||"",m=1024;f.length>m&&this.client.logger.warn(`The max length for a table comment is ${m} characters`),d+=` comment = '${f}'`}this.pushQuery(d),s&&this.addColumns(a,this.addColumnsPrefix)}comment(a){this.pushQuery(`alter table ${this.tableName()} comment = '${a}'`)}changeType(){}renameColumn(a,o){const s=this,l=this.tableName(),u=this.formatter.wrap(a)+" "+this.formatter.wrap(o);this.pushQuery({sql:`show full fields from ${l} where field = `+this.client.parameter(a,this.tableBuilder,this.bindingsHolder),output(h){const c=h[0],d=this;return s.getFKRefs(d).then(([p])=>new Promise((g,_)=>{try{p.length||g(),g(s.dropFKRefs(d,p))}catch(f){_(f)}}).then(function(){let g=`alter table ${l} change ${u} ${c.Type}`;return String(c.Null).toUpperCase()!=="YES"?g+=" NOT NULL":g+=" NULL",c.Default!==void 0&&c.Default!==null&&(g+=` DEFAULT '${c.Default}'`),c.Collation!==void 0&&c.Collation!==null&&(g+=` COLLATE '${c.Collation}'`),c.Extra=="auto_increment"&&(g+=" AUTO_INCREMENT"),d.query({sql:g})}).then(function(){if(p.length)return s.createFKRefs(d,p.map(function(g){return g.REFERENCED_COLUMN_NAME===a&&(g.REFERENCED_COLUMN_NAME=o),g.COLUMN_NAME===a&&(g.COLUMN_NAME=o),g}))}))}})}primaryKeys(){const a=(this.grouped.alterTable||[]).filter(o=>o.method==="primary");if(a.length>0&&a[0].args.length>0){const o=a[0].args[0];let s=a[0].args[1]||"";if(s&&(s=" constraint "+this.formatter.wrap(s)),this.grouped.columns){const l=this._getIncrementsColumnNames();l.length&&l.forEach(u=>{o.includes(u)||o.unshift(u)})}return`,${s} primary key (${this.formatter.columnize(o)})`}}getFKRefs(a){const o={bindings:[]},s="SELECT KCU.CONSTRAINT_NAME, KCU.TABLE_NAME, KCU.COLUMN_NAME,        KCU.REFERENCED_TABLE_NAME, KCU.REFERENCED_COLUMN_NAME,        RC.UPDATE_RULE, RC.DELETE_RULE FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE AS KCU JOIN INFORMATION_SCHEMA.REFERENTIAL_CONSTRAINTS AS RC        USING(CONSTRAINT_NAME)WHERE KCU.REFERENCED_TABLE_NAME = "+this.client.parameter(this.tableNameRaw,this.tableBuilder,o)+"   AND KCU.CONSTRAINT_SCHEMA = "+this.client.parameter(this.client.database(),this.tableBuilder,o)+"   AND RC.CONSTRAINT_SCHEMA = "+this.client.parameter(this.client.database(),this.tableBuilder,o);return a.query({sql:s,bindings:o.bindings})}dropFKRefs(a,o){const s=this.client.formatter(this.tableBuilder);return Promise.all(o.map(function(l){const u=s.wrap(l.CONSTRAINT_NAME),h=s.wrap(l.TABLE_NAME);return a.query({sql:`alter table ${h} drop foreign key ${u}`})}))}createFKRefs(a,o){const s=this.client.formatter(this.tableBuilder);return Promise.all(o.map(function(l){const u=s.wrap(l.TABLE_NAME),h=s.wrap(l.CONSTRAINT_NAME),c=s.columnize(l.COLUMN_NAME),d=s.columnize(l.REFERENCED_COLUMN_NAME),p=s.wrap(l.REFERENCED_TABLE_NAME),g=` ON UPDATE ${l.UPDATE_RULE}`,_=` ON DELETE ${l.DELETE_RULE}`;return a.query({sql:`alter table ${u} add constraint ${h} foreign key (`+c+") references "+p+" ("+d+")"+g+_})}))}index(a,o,s){let l,u;t(s)?u=s:e(s)&&({indexType:u,storageEngineIndexType:l}=s),o=o?this.formatter.wrap(o):this._indexCommand("index",this.tableNameRaw,a),l=l?` using ${l}`:"",this.pushQuery(`alter table ${this.tableName()} add${u?` ${u}`:""} index ${o}(${this.formatter.columnize(a)})${l}`)}primary(a,o){let s;e(o)&&({constraintName:o,deferrable:s}=o),s&&s!=="not deferrable"&&this.client.logger.warn(`mysql: primary key constraint \`${o}\` will not be deferrable ${s} because mysql does not support deferred constraints.`),o=o?this.formatter.wrap(o):this.formatter.wrap(`${this.tableNameRaw}_pkey`);const l=a;let u=[];this.grouped.columns&&(u=this._getIncrementsColumnNames(),u&&u.forEach(h=>{l.includes(h)||l.unshift(h)})),this.method!=="create"&&this.method!=="createIfNot"&&this.pushQuery(`alter table ${this.tableName()} add primary key ${o}(${this.formatter.columnize(l)})`),u.length&&this.pushQuery(`alter table ${this.tableName()} modify column ${this.formatter.columnize(u)} int unsigned not null auto_increment`)}unique(a,o){let s,l;e(o)&&({indexName:o,deferrable:l,storageEngineIndexType:s}=o),l&&l!=="not deferrable"&&this.client.logger.warn(`mysql: unique index \`${o}\` will not be deferrable ${l} because mysql does not support deferred constraints.`),o=o?this.formatter.wrap(o):this._indexCommand("unique",this.tableNameRaw,a),s=s?` using ${s}`:"",this.pushQuery(`alter table ${this.tableName()} add unique ${o}(${this.formatter.columnize(a)})${s}`)}dropIndex(a,o){o=o?this.formatter.wrap(o):this._indexCommand("index",this.tableNameRaw,a),this.pushQuery(`alter table ${this.tableName()} drop index ${o}`)}dropForeign(a,o){o=o?this.formatter.wrap(o):this._indexCommand("foreign",this.tableNameRaw,a),this.pushQuery(`alter table ${this.tableName()} drop foreign key ${o}`)}dropPrimary(){this.pushQuery(`alter table ${this.tableName()} drop primary key`)}dropUnique(a,o){o=o?this.formatter.wrap(o):this._indexCommand("unique",this.tableNameRaw,a),this.pushQuery(`alter table ${this.tableName()} drop index ${o}`)}}return n.prototype.addColumnsPrefix="add ",n.prototype.alterColumnsPrefix="modify ",n.prototype.dropColumnPrefix="drop ",Ui=n,Ui}var Hi,Wu;function pI(){if(Wu)return Hi;Wu=1;const r=Ue,{isObject:e}=M,{toNumber:t}=z,n=new RegExp("(?<!\\\\)'","g");class i extends r{constructor(o,s,l){super(o,s,l),this.modifiers=["unsigned","nullable","defaultTo","comment","collate","first","after"],this._addCheckModifiers()}double(o,s){return o?`double(${t(o,8)}, ${t(s,2)})`:"double"}integer(o){return o=o?`(${t(o,11)})`:"",`int${o}`}tinyint(o){return o=o?`(${t(o,1)})`:"",`tinyint${o}`}text(o){switch(o){case"medium":case"mediumtext":return"mediumtext";case"long":case"longtext":return"longtext";default:return"text"}}mediumtext(){return this.text("medium")}longtext(){return this.text("long")}enu(o){return`enum('${o.join("', '")}')`}datetime(o){return e(o)&&({precision:o}=o),typeof o=="number"?`datetime(${o})`:"datetime"}timestamp(o){return e(o)&&({precision:o}=o),typeof o=="number"?`timestamp(${o})`:"timestamp"}time(o){return e(o)&&({precision:o}=o),typeof o=="number"?`time(${o})`:"time"}bit(o){return o?`bit(${t(o)})`:"bit"}binary(o){return o?`varbinary(${t(o)})`:"blob"}json(){return"json"}jsonb(){return"json"}defaultTo(o){if(o==null)return;if((this.type==="json"||this.type==="jsonb")&&e(o))return`default ('${JSON.stringify(o)}')`;const s=super.defaultTo.apply(this,arguments);return this.type!=="blob"&&this.type.indexOf("text")===-1?s:""}unsigned(){return"unsigned"}comment(o){return o&&o.length>255&&this.client.logger.warn("Your comment is longer than the max comment length for MySQL"),o&&`comment '${o.replace(n,"\\'")}'`}first(){return"first"}after(o){return`after ${this.formatter.wrap(o)}`}collate(o){return o&&`collate '${o}'`}checkRegex(o,s){return this._check(`${this.formatter.wrap(this.getColumnName())} REGEXP ${this.client._escapeBinding(o)}`,s)}increments(o={primaryKey:!0}){return"int unsigned not null"+(this.tableCompiler._canBeAddPrimaryKey(o)?" auto_increment primary key":"")}bigincrements(o={primaryKey:!0}){return"bigint unsigned not null"+(this.tableCompiler._canBeAddPrimaryKey(o)?" auto_increment primary key":"")}}return i.prototype.bigint="bigint",i.prototype.mediumint="mediumint",i.prototype.smallint="smallint",Hi=i,Hi}var Vi,zu;function mI(){if(zu)return Vi;zu=1;const r=ft;class e extends r{constructor(n,i){super(n,i)}createOrReplace(){this.createQuery(this.columns,this.selectQuery,!1,!0)}}return Vi=e,Vi}var Wi,Ku;function gI(){if(Ku)return Wi;Ku=1;const r=xt;class e extends r{constructor(){super(...arguments)}checkOption(){this._single.checkOption="default_option"}localCheckOption(){this._single.checkOption="local"}cascadedCheckOption(){this._single.checkOption="cascaded"}}return Wi=e,Wi}var zi,Ju;function Gu(){if(Ju)return zi;Ju=1;const r=uI(),e=Qe,{promisify:t}=I,n=He,i=cI(),a=hI(),o=dI(),s=fI(),l=pI(),{makeEscape:u}=Dr,h=mI(),c=gI();class d extends n{_driver(){return I}queryCompiler(g,_){return new a(this,g,_)}schemaCompiler(){return new o(this,...arguments)}tableCompiler(){return new s(this,...arguments)}viewCompiler(){return new h(this,...arguments)}viewBuilder(){return new c(this,...arguments)}columnCompiler(){return new l(this,...arguments)}transaction(){return new i(this,...arguments)}wrapIdentifierImpl(g){return g!=="*"?`\`${g.replace(/`/g,"``")}\``:"*"}acquireRawConnection(){return new Promise((g,_)=>{const f=this.driver.createConnection(this.connectionSettings);f.on("error",m=>{f.__knex__disposed=m}),f.connect(m=>{if(m)return f.removeAllListeners(),_(m);g(f)})})}async destroyRawConnection(g){try{return await t(f=>g.end(f))()}catch(_){g.__knex__disposed=_}finally{r(()=>g.removeAllListeners())}}validateConnection(g){return g.state==="connected"||g.state==="authenticated"}_stream(g,_,f,m){if(!_.sql)throw new Error("The query is empty");m=m||{};const y=Object.assign({sql:_.sql},_.options);return new Promise((w,$)=>{f.on("error",$),f.on("end",w);const E=g.query(y,_.bindings).stream(m);E.on("error",C=>{$(C),f.emit("error",C)}),E.pipe(f)})}_query(g,_){if((!_||typeof _=="string")&&(_={sql:_}),!_.sql)throw new Error("The query is empty");return new Promise(function(f,m){if(!_.sql){f();return}const y=Object.assign({sql:_.sql},_.options);g.query(y,_.bindings,function(w,$,E){if(w)return m(w);_.response=[$,E],f(_)})})}processResponse(g,_){if(g==null)return;const{response:f}=g,{method:m}=g,y=f[0],w=f[1];if(g.output)return g.output.call(_,y,w);switch(m){case"select":return y;case"first":return y[0];case"pluck":return e(y,g.pluck);case"insert":return[y.insertId];case"del":case"update":case"counter":return y.affectedRows;default:return f}}async cancelQuery(g){const _=await this.acquireRawConnection();try{return await this._wrappedCancelQueryCall(_,g)}finally{await this.destroyRawConnection(_),_.__knex__disposed&&this.logger.warn(`Connection Error: ${_.__knex__disposed}`)}}_wrappedCancelQueryCall(g,_){return this._query(g,{sql:"KILL QUERY ?",bindings:[_.threadId],options:{}})}}return Object.assign(d.prototype,{dialect:"mysql",driverName:"mysql",_escapeBinding:u(),canCancelQuery:!0}),zi=d,zi}var Ki,Yu;function yI(){if(Yu)return Ki;Yu=1;const r=Ce,e=ae("knex:tx");class t extends r{query(i,a,o,s){const l=this,u=this.trxClient.query(i,a).catch(h=>{if(h.code==="ER_SP_DOES_NOT_EXIST"){this.trxClient.logger.warn("Transaction was implicitly committed, do not mix transactions and DDL with MySQL (#805)");return}o=2,s=h,l._completed=!0,e("%s error running transaction query",l.txid)}).then(function(h){if(o===1&&l._resolver(s),o===2){if(s===void 0){if(l.doNotRejectOnRollback&&/^ROLLBACK\b/i.test(a)){l._resolver();return}s=new Error(`Transaction rejected with non-error: ${s}`)}return l._rejecter(s),h}});return(o===1||o===2)&&(l._completed=!0),u}}return Ki=t,Ki}var Ji,Xu;function bI(){if(Xu)return Ji;Xu=1;const r=Gu(),e=yI();class t extends r{transaction(){return new e(this,...arguments)}_driver(){return I}validateConnection(i){return i&&!i._fatalError&&!i._protocolError&&!i._closing&&!i.stream.destroyed}}return Object.assign(t.prototype,{driverName:"mysql2"}),Ji=t,Ji}var Gi,Zu;function Ve(){if(Zu)return Gi;Zu=1;function r(i,a,o,s){const l=I,u=30;Array.isArray(s)||(s=s?[s]:[]);const h=o.replace(/\.|-/g,"_"),c=s.join("_");let d=`${h}_${c.length?c+"_":""}${a}`.toLowerCase();return d.length>u&&(i.warn(`Automatically generated name "${d}" exceeds ${u} character limit for Oracle. Using base64 encoded sha1 of that name instead.`),d=l.createHash("sha1").update(d).digest("base64").replace("=","")),d}function e(i,a){return`begin execute immediate '${i.replace(/'/g,"''")}'; exception when others then if sqlcode != ${a} then raise; end if; end;`}function t(i){this.columnName=i}t.prototype.toString=function(){return`[object ReturningHelper:${this.columnName}]`};function n(i){return["DPI-1010","DPI-1080","ORA-03114","ORA-03113","ORA-03135","ORA-12514","ORA-00022","ORA-00028","ORA-00031","ORA-00045","ORA-00378","ORA-00602","ORA-00603","ORA-00609","ORA-01012","ORA-01041","ORA-01043","ORA-01089","ORA-01092","ORA-02396","ORA-03122","ORA-12153","ORA-12537","ORA-12547","ORA-12570","ORA-12583","ORA-27146","ORA-28511","ORA-56600","NJS-024","NJS-003"].some(function(a){return i.message.indexOf(a)===0})}return Gi={generateCombinedName:r,isConnectionError:n,wrapSqlWithCatch:e,ReturningHelper:t},Gi}var Yi,ec;function Xi(){if(ec)return Yi;ec=1;const r=Ve();return Yi={renameColumnTrigger:function(t,n,i,a){const o=r.generateCombinedName(t,"autoinc_trg",n),s=r.generateCombinedName(t,"seq",n);return`DECLARE PK_NAME VARCHAR(200); IS_AUTOINC NUMBER := 0; BEGIN  EXECUTE IMMEDIATE ('ALTER TABLE "${n}" RENAME COLUMN "${i}" TO "${a}"');  SELECT COUNT(*) INTO IS_AUTOINC from "USER_TRIGGERS" where trigger_name = '${o}';  IF (IS_AUTOINC > 0) THEN    SELECT cols.column_name INTO PK_NAME    FROM all_constraints cons, all_cons_columns cols    WHERE cons.constraint_type = 'P'    AND cons.constraint_name = cols.constraint_name    AND cons.owner = cols.owner    AND cols.table_name = '${n}';    IF ('${a}' = PK_NAME) THEN      EXECUTE IMMEDIATE ('DROP TRIGGER "${o}"');      EXECUTE IMMEDIATE ('create or replace trigger "${o}"      BEFORE INSERT on "${n}" for each row        declare        checking number := 1;        begin          if (:new."${a}" is null) then            while checking >= 1 loop              select "${s}".nextval into :new."${a}" from dual;              select count("${a}") into checking from "${n}"              where "${a}" = :new."${a}";            end loop;          end if;        end;');    end if;  end if;END;`},createAutoIncrementTrigger:function(t,n,i){const a=`"${n}"`,o=n,s=i?`"${i}".`:"",l=i?`'${i}'`:"cols.owner",u=r.generateCombinedName(t,"autoinc_trg",n),c=`"${r.generateCombinedName(t,"seq",n)}"`;return`DECLARE PK_NAME VARCHAR(200); BEGIN  EXECUTE IMMEDIATE ('CREATE SEQUENCE ${s}${c}');  SELECT cols.column_name INTO PK_NAME  FROM all_constraints cons, all_cons_columns cols  WHERE cons.constraint_type = 'P'  AND cons.constraint_name = cols.constraint_name  AND cons.owner = ${l}  AND cols.table_name = '${o}';  execute immediate ('create or replace trigger ${s}"${u}"  BEFORE INSERT on ${s}${a}  for each row  declare  checking number := 1;  begin    if (:new."' || PK_NAME || '" is null) then      while checking >= 1 loop        select ${s}${c}.nextval into :new."' || PK_NAME || '" from dual;        select count("' || PK_NAME || '") into checking from ${s}${a}        where "' || PK_NAME || '" = :new."' || PK_NAME || '";      end loop;    end if;  end;'); END;`},renameTableAndAutoIncrementTrigger:function(t,n,i){const a=r.generateCombinedName(t,"autoinc_trg",n),o=r.generateCombinedName(t,"seq",n),s=r.generateCombinedName(t,"autoinc_trg",i),l=r.generateCombinedName(t,"seq",i);return`DECLARE PK_NAME VARCHAR(200); IS_AUTOINC NUMBER := 0; BEGIN  EXECUTE IMMEDIATE ('RENAME "${n}" TO "${i}"');  SELECT COUNT(*) INTO IS_AUTOINC from "USER_TRIGGERS" where trigger_name = '${a}';  IF (IS_AUTOINC > 0) THEN    EXECUTE IMMEDIATE ('DROP TRIGGER "${a}"');    EXECUTE IMMEDIATE ('RENAME "${o}" TO "${l}"');    SELECT cols.column_name INTO PK_NAME    FROM all_constraints cons, all_cons_columns cols    WHERE cons.constraint_type = 'P'    AND cons.constraint_name = cols.constraint_name    AND cons.owner = cols.owner    AND cols.table_name = '${i}';    EXECUTE IMMEDIATE ('create or replace trigger "${s}"    BEFORE INSERT on "${i}" for each row      declare      checking number := 1;      begin        if (:new."' || PK_NAME || '" is null) then          while checking >= 1 loop            select "${l}".nextval into :new."' || PK_NAME || '" from dual;            select count("' || PK_NAME || '") into checking from "${i}"            where "' || PK_NAME || '" = :new."' || PK_NAME || '";          end loop;        end if;      end;');  end if;END;`}},Yi}var Zi,tc;function _I(){if(tc)return Zi;tc=1;const r=ct,e=Ve(),t=Xi();class n extends r{constructor(){super(...arguments)}renameTable(a,o){const s=t.renameTableAndAutoIncrementTrigger(this.client.logger,a,o);this.pushQuery(s)}hasTable(a){this.pushQuery({sql:"select TABLE_NAME from USER_TABLES where TABLE_NAME = "+this.client.parameter(a,this.builder,this.bindingsHolder),output(o){return o.length>0}})}hasColumn(a,o){const s=`select COLUMN_NAME from ALL_TAB_COLUMNS where TABLE_NAME = ${this.client.parameter(a,this.builder,this.bindingsHolder)} and COLUMN_NAME = ${this.client.parameter(o,this.builder,this.bindingsHolder)}`;this.pushQuery({sql:s,output:l=>l.length>0})}dropSequenceIfExists(a){const o=this.schema?`"${this.schema}".`:"";this.pushQuery(e.wrapSqlWithCatch(`drop sequence ${o}${this.formatter.wrap(a)}`,-2289))}_dropRelatedSequenceIfExists(a){const o=e.generateCombinedName(this.client.logger,"seq",a);this.dropSequenceIfExists(o)}dropTable(a){const o=this.schema?`"${this.schema}".`:"";this.pushQuery(`drop table ${o}${this.formatter.wrap(a)}`),this._dropRelatedSequenceIfExists(a)}dropTableIfExists(a){this.dropObject(a,"table")}dropViewIfExists(a){this.dropObject(a,"view")}dropObject(a,o){const s=this.schema?`"${this.schema}".`:"";let l=-942;o==="materialized view"&&(l=-12003),this.pushQuery(e.wrapSqlWithCatch(`drop ${o} ${s}${this.formatter.wrap(a)}`,l)),this._dropRelatedSequenceIfExists(a)}refreshMaterializedView(a){return this.pushQuery({sql:`BEGIN DBMS_MVIEW.REFRESH('${this.schemaNameRaw?this.schemaNameRaw+".":""}${a}'); END;`})}dropMaterializedView(a){this._dropView(a,!1,!0)}dropMaterializedViewIfExists(a){this.dropObject(a,"materialized view")}}return Zi=n,Zi}var es,rc;function wI(){if(rc)return es;rc=1;const r=Or,e=$t;class t extends r{constructor(){super(...arguments)}checkIn(){return this._modifiers.checkIn=e(arguments),this}}return es=t,es}var ts,nc;function $I(){if(nc)return ts;nc=1;var r=Ll;function e(t,n){var i=t==null?0:t.length;return!!i&&r(t,n,0)>-1}return ts=e,ts}var rs,ic;function CI(){if(ic)return rs;ic=1;function r(e,t,n){for(var i=-1,a=e==null?0:e.length;++i<a;)if(n(t,e[i]))return!0;return!1}return rs=r,rs}var ns,sc;function vI(){if(sc)return ns;sc=1;function r(){}return ns=r,ns}var is,oc;function EI(){if(oc)return is;oc=1;var r=go,e=vI(),t=lr,n=1/0,i=r&&1/t(new r([,-0]))[1]==n?function(a){return new r(a)}:e;return is=i,is}var ss,ac;function TI(){if(ac)return ss;ac=1;var r=ka(),e=$I(),t=CI(),n=Da(),i=EI(),a=lr,o=200;function s(l,u,h){var c=-1,d=e,p=l.length,g=!0,_=[],f=_;if(h)g=!1,d=t;else if(p>=o){var m=u?null:i(l);if(m)return a(m);g=!1,d=n,f=new r}else f=u?[]:_;e:for(;++c<p;){var y=l[c],w=u?u(y):y;if(y=h||y!==0?y:0,g&&w===w){for(var $=f.length;$--;)if(f[$]===w)continue e;u&&f.push(w),_.push(y)}else d(f,w,h)||(f!==_&&f.push(w),_.push(y))}return _}return ss=s,ss}var os,lc;function AI(){if(lc)return os;lc=1;var r=TI();function e(t){return t&&t.length?r(t):[]}return os=e,os}var as,uc;function OI(){if(uc)return as;uc=1;const r=Xi();function e(t){t.pushAdditional(function(){const n=this.tableCompiler.tableNameRaw,i=this.tableCompiler.schemaNameRaw,a=r.createAutoIncrementTrigger(this.client.logger,n,i);this.pushQuery(a)})}return as={createAutoIncrementTriggerAndSequence:e},as}var ls,cc;function hc(){if(cc)return ls;cc=1;const r=AI(),e=at,t=Ue,{createAutoIncrementTriggerAndSequence:n}=OI(),{toNumber:i}=z;class a extends t{constructor(){super(...arguments),this.modifiers=["defaultTo","checkIn","nullable","comment"]}increments(s={primaryKey:!0}){return n(this),"integer not null"+(this.tableCompiler._canBeAddPrimaryKey(s)?" primary key":"")}bigincrements(s={primaryKey:!0}){return n(this),"number(20, 0) not null"+(this.tableCompiler._canBeAddPrimaryKey(s)?" primary key":"")}floating(s){const l=i(s,0);return`float${l?`(${l})`:""}`}double(s,l){return`number(${i(s,8)}, ${i(l,2)})`}decimal(s,l){return s===null?"decimal":`decimal(${i(s,8)}, ${i(l,2)})`}integer(s){return s?`number(${i(s,11)})`:"integer"}enu(s){s=r(s);const l=(s||[]).reduce((u,h)=>Math.max(u,String(h).length),1);return this.columnBuilder._modifiers.checkIn=[s],`varchar2(${l})`}datetime(s){return s?"timestamp":"timestamp with time zone"}timestamp(s){return s?"timestamp":"timestamp with time zone"}bool(){return this.columnBuilder._modifiers.checkIn=[[0,1]],"number(1, 0)"}varchar(s){return`varchar2(${i(s,255)})`}comment(s){const l=this.args[0]||this.defaults("columnName");this.pushAdditional(function(){this.pushQuery(`comment on column ${this.tableCompiler.tableName()}.`+this.formatter.wrap(l)+" is '"+(s||"")+"'")},s)}checkIn(s){return s===void 0?"":(s instanceof e?s=s.toQuery():Array.isArray(s)?s=s.map(l=>`'${l}'`).join(", "):s=`'${s}'`,`check (${this.formatter.wrap(this.args[0])} in (${s}))`)}}return a.prototype.tinyint="smallint",a.prototype.smallint="smallint",a.prototype.mediumint="integer",a.prototype.biginteger="number(20, 0)",a.prototype.text="clob",a.prototype.time="timestamp with time zone",a.prototype.bit="clob",a.prototype.json="clob",ls=a,ls}var us,dc;function fc(){if(dc)return us;dc=1;const r=Ve(),e=ht,t=z,n=Xi(),{isObject:i}=M;class a extends e{constructor(){super(...arguments)}addColumns(s,l){if(s.sql.length>0){l=l||this.addColumnsPrefix;const u=s.sql;let c=`${this.lowerCase?"alter table ":"ALTER TABLE "}${this.tableName()} ${l}`;s.sql.length>1?c+=`(${u.join(", ")})`:c+=u.join(", "),this.pushQuery({sql:c,bindings:s.bindings})}}renameColumn(s,l){const u=this.tableName().slice(1,-1);return this.pushQuery(n.renameColumnTrigger(this.client.logger,u,s,l))}compileAdd(s){const l=this.formatter.wrap(s),u=this.prefixArray("add column",this.getColumns(s));return this.pushQuery({sql:`alter table ${l} ${u.join(", ")}`})}createQuery(s,l,u){const h=u&&this.tableNameLike()?" as (select * from "+this.tableNameLike()+" where 0=1)":" ("+s.sql.join(", ")+this._addChecks()+")",c=`create table ${this.tableName()}${h}`;this.pushQuery({sql:l?r.wrapSqlWithCatch(c,-955):c,bindings:s.bindings}),this.single.comment&&this.comment(this.single.comment),u&&this.addColumns(s,this.addColumnsPrefix)}comment(s){this.pushQuery(`comment on table ${this.tableName()} is '${s}'`)}dropColumn(){const s=t.normalizeArr.apply(null,arguments);this.pushQuery(`alter table ${this.tableName()} drop (${this.formatter.columnize(s)})`)}_indexCommand(s,l,u){return this.formatter.wrap(r.generateCombinedName(this.client.logger,s,l,u))}primary(s,l){let u;i(l)&&({constraintName:l,deferrable:u}=l),u=u?` deferrable initially ${u}`:"",l=l?this.formatter.wrap(l):this.formatter.wrap(`${this.tableNameRaw}_pkey`);const h=s;let c=[];this.grouped.columns&&(c=this._getIncrementsColumnNames(),c&&c.forEach(d=>{h.includes(d)||h.unshift(d)})),this.pushQuery(`alter table ${this.tableName()} add constraint ${l} primary key (${this.formatter.columnize(h)})${u}`)}dropPrimary(s){s=s?this.formatter.wrap(s):this.formatter.wrap(this.tableNameRaw+"_pkey"),this.pushQuery(`alter table ${this.tableName()} drop constraint ${s}`)}index(s,l){l=l?this.formatter.wrap(l):this._indexCommand("index",this.tableNameRaw,s),this.pushQuery(`create index ${l} on ${this.tableName()} (`+this.formatter.columnize(s)+")")}dropIndex(s,l){l=l?this.formatter.wrap(l):this._indexCommand("index",this.tableNameRaw,s),this.pushQuery(`drop index ${l}`)}unique(s,l){let u;i(l)&&({indexName:l,deferrable:u}=l),u=u?` deferrable initially ${u}`:"",l=l?this.formatter.wrap(l):this._indexCommand("unique",this.tableNameRaw,s),this.pushQuery(`alter table ${this.tableName()} add constraint ${l} unique (`+this.formatter.columnize(s)+")"+u)}dropUnique(s,l){l=l?this.formatter.wrap(l):this._indexCommand("unique",this.tableNameRaw,s),this.pushQuery(`alter table ${this.tableName()} drop constraint ${l}`)}dropForeign(s,l){l=l?this.formatter.wrap(l):this._indexCommand("foreign",this.tableNameRaw,s),this.pushQuery(`alter table ${this.tableName()} drop constraint ${l}`)}}return a.prototype.addColumnsPrefix="add ",a.prototype.alterColumnsPrefix="modify ",us=a,us}var cs,pc;function mc(){if(pc)return cs;pc=1;const{ReturningHelper:r}=Ve(),{isConnectionError:e}=Ve(),t=He,n=_I(),i=wI(),a=hc(),o=fc();class s extends t{schemaCompiler(){return new n(this,...arguments)}columnBuilder(){return new i(this,...arguments)}columnCompiler(){return new a(this,...arguments)}tableCompiler(){return new o(this,...arguments)}database(){return this.connectionSettings.database}positionBindings(u){let h=0;return u.replace(/\?/g,function(){return h+=1,`:${h}`})}_stream(u,h,c,d){if(!h.sql)throw new Error("The query is empty");return new Promise(function(p,g){c.on("error",f=>{e(f)&&(u.__knex__disposed=f),g(f)}),c.on("end",p);const _=u.queryStream(h.sql,h.bindings,d);_.pipe(c),_.on("error",function(f){g(f),c.emit("error",f)})})}alias(u,h){return u+" "+h}parameter(u,h,c){return u instanceof r&&this.driver?u=new this.driver.OutParam(this.driver.OCCISTRING):typeof u=="boolean"&&(u=u?1:0),super.parameter(u,h,c)}}return Object.assign(s.prototype,{dialect:"oracle",driverName:"oracle"}),cs=s,cs}var hs,gc;function NI(){if(gc)return hs;gc=1;const r=In,e=ie,t=le,n=$e,i=Tt,a=De,{ReturningHelper:o}=Ve(),{isString:s}=M,l=["columns","join","where","union","group","having","order","lock"];class u extends a{constructor(c,d,p){super(c,d,p);const{onConflict:g}=this.single;if(g)throw new Error(".onConflict() is not supported for oracledb.");this.first=this.select}insert(){let c=this.single.insert||[],{returning:d}=this.single;if(!Array.isArray(c)&&n(this.single.insert)&&(c=[this.single.insert]),d&&!Array.isArray(d)&&(d=[d]),Array.isArray(c)&&c.length===1&&t(c[0]))return this._addReturningToSqlAndConvert(`insert into ${this.tableName} (${this.formatter.wrap(this.single.returning)}) values (default)`,d,this.tableName);if(t(this.single.insert)&&typeof this.single.insert!="function")return"";const p=this._prepInsert(c),g={};if(s(p))return this._addReturningToSqlAndConvert(`insert into ${this.tableName} ${p}`,d);if(p.values.length===1)return this._addReturningToSqlAndConvert(`insert into ${this.tableName} (${this.formatter.columnize(p.columns)}) values (${this.client.parameterize(p.values[0],void 0,this.builder,this.bindingsHolder)})`,d,this.tableName);const _=p.columns.length===0;return g.sql="begin "+p.values.map(f=>{let m;const y=_?"":this.client.parameterize(f,this.client.valueForUndefined,this.builder,this.bindingsHolder),w=Array.isArray(d)?d:[d];let $=`insert into ${this.tableName} `;d&&(m=new o(w.join(":")),g.outParams=(g.outParams||[]).concat(m)),_?$+=`(${this.formatter.wrap(this.single.returning)}) values (default)`:$+=`(${this.formatter.columnize(p.columns)}) values (${y})`,$+=d?` returning ROWID into ${this.client.parameter(m,this.builder,this.bindingsHolder)}`:"",$=this.formatter.client.positionBindings($);const E=y.replace("DEFAULT, ","").replace(", DEFAULT","");return`execute immediate '${$.replace(/'/g,"''")}`+(E||d?"' using ":"")+E+(E&&d?", ":"")+(d?"out ?":"")+";"}).join(" ")+"end;",d&&(g.returning=d,g.returningSql=`select ${this.formatter.columnize(d)} from `+this.tableName+" where ROWID in ("+g.outParams.map((f,m)=>`:${m+1}`).join(", ")+") order by case ROWID "+g.outParams.map((f,m)=>`when CHARTOROWID(:${m+1}) then ${m}`).join(" ")+" end"),g}update(){const c=this._prepUpdate(this.single.update),d=this.where();let{returning:p}=this.single;const g=`update ${this.tableName} set `+c.join(", ")+(d?` ${d}`:"");return p?(Array.isArray(p)||(p=[p]),this._addReturningToSqlAndConvert(g,p,this.tableName)):g}truncate(){return`truncate table ${this.tableName}`}forUpdate(){return"for update"}forShare(){return this.client.logger.warn("lock for share is not supported by oracle dialect"),""}columnInfo(){const c=this.single.columnInfo;return{sql:`select * from xmltable( '/ROWSET/ROW'
      passing dbms_xmlgen.getXMLType('
      select char_col_decl_length, column_name, data_type, data_default, nullable
      from all_tab_columns where table_name = ''${this.client.customWrapIdentifier(this.single.table,e)}'' ')
      columns
      CHAR_COL_DECL_LENGTH number, COLUMN_NAME varchar2(200), DATA_TYPE varchar2(106),
      DATA_DEFAULT clob, NULLABLE varchar2(1))`,output(g){const _=i(g,function(f,m){return f[m.COLUMN_NAME]={type:m.DATA_TYPE,defaultValue:m.DATA_DEFAULT,maxLength:m.CHAR_COL_DECL_LENGTH,nullable:m.NULLABLE==="Y"},f},{});return c&&_[c]||_}}}select(){let c=this.with();const d=l.map(p=>this[p]());return c+=r(d).join(" "),this._surroundQueryWithLimitAndOffset(c)}aggregate(c){return this._aggregate(c,{aliasSeparator:" "})}_addReturningToSqlAndConvert(c,d,p){const g={sql:c};if(!d)return g;const _=Array.isArray(d)?d:[d],f=new o(_.join(":"));return g.sql=c+" returning ROWID into "+this.client.parameter(f,this.builder,this.bindingsHolder),g.returningSql=`select ${this.formatter.columnize(d)} from ${p} where ROWID = :1`,g.outParams=[f],g.returning=d,g}_surroundQueryWithLimitAndOffset(c){let{limit:d}=this.single;const{offset:p}=this.single,g=d||d===0||d==="0";if(d=+d,!g&&!p)return c;if(c=c||"",g&&!p)return`select * from (${c}) where rownum <= ${this._getValueOrParameterFromAttribute("limit",d)}`;const _=+p+(g?d:1e13);return"select * from (select row_.*, ROWNUM rownum_ from ("+c+") row_ where rownum <= "+(this.single.skipBinding.offset?_:this.client.parameter(_,this.builder,this.bindingsHolder))+") where rownum_ > "+this._getValueOrParameterFromAttribute("offset",p)}}return hs=u,hs}var ds,yc;function fs(){if(yc)return ds;yc=1;const r=Ve(),{promisify:e}=I,t=I;function n(s,l){this.columnName=s,this.value=l,this.returning=!1}n.prototype.toString=function(){return"[object BlobHelper:"+this.columnName+"]"};function i(s,l){return new Promise((u,h)=>{let c=l==="string"?"":Buffer.alloc(0);s.on("error",function(d){h(d)}),s.on("data",function(d){l==="string"?c+=d:c=Buffer.concat([c,d])}),s.on("end",function(){u(c)})})}const a=function(s){const l=I;let u;if(s.type)s.type===l.BLOB?u="buffer":s.type===l.CLOB&&(u="string");else if(s.iLob)s.iLob.type===l.CLOB?u="string":s.iLob.type===l.BLOB&&(u="buffer");else throw new Error("Unrecognized oracledb lob stream type");return u==="string"&&s.setEncoding("utf-8"),i(s,u)};function o(s,l){if(s.executeAsync)return;s.commitAsync=function(){return new Promise((h,c)=>{this.commit(function(d){if(d)return c(d);h()})})},s.rollbackAsync=function(){return new Promise((h,c)=>{this.rollback(function(d){if(d)return c(d);h()})})};const u=e(function(h,c,d,p){if(d=d||{},d.outFormat=l.driver.OUT_FORMAT_OBJECT||l.driver.OBJECT,!d.outFormat)throw new Error("not found oracledb.outFormat constants");d.resultSet?s.execute(h,c||[],d,function(g,_){if(g)return r.isConnectionError(g)&&(s.close().catch(function(w){}),s.__knex__disposed=g),p(g);const f={rows:[],resultSet:_.resultSet},m=100,y=function(w,$,E){$.getRows(E,function(C,T){if(C)r.isConnectionError(C)&&(w.close().catch(function(N){}),w.__knex__disposed=C),$.close(function(){return p(C)});else{if(T.length===0)return p(null,f);if(T.length>0)if(T.length===E)f.rows=f.rows.concat(T),y(w,$,E);else return f.rows=f.rows.concat(T),p(null,f)}})};y(s,_.resultSet,m)}):s.execute(h,c||[],d,function(g,_){return g?(r.isConnectionError(g)&&(s.close().catch(function(f){}),s.__knex__disposed=g),p(g)):p(null,_)})});s.executeAsync=function(h,c,d){return u(h,c,d).then(async p=>{const g=()=>p.resultSet?e(p.resultSet.close).call(p.resultSet):Promise.resolve(),_=[];if(p.rows&&Array.isArray(p.rows))for(let f=0;f<p.rows.length;f++){const m=p.rows[f];for(const y in m)m[y]instanceof t.Readable&&_.push({index:f,key:y,stream:m[y]})}try{for(const f of _)p.rows[f.index][f.key]=await a(f.stream)}catch(f){throw await g().catch(()=>{}),f}return await g(),p})}}return r.BlobHelper=n,r.monkeyPatchConnection=o,ds=r,ds}var ps,bc;function qI(){if(bc)return ps;bc=1;const r=hn,e=_t,t=le,n=$e,i=NI(),a=fs().ReturningHelper,o=fs().BlobHelper,{isString:s}=M,{columnize:l}=K;class u extends i{insert(){const c=this,d=this._prepOutbindings(this.single.insert,this.single.returning),p=d.outBinding,g=d.returning,_=d.values;if(Array.isArray(_)&&_.length===1&&t(_[0])){const w=this.single.returning?" ("+this.formatter.wrap(this.single.returning)+")":"";return this._addReturningToSqlAndConvert("insert into "+this.tableName+w+" values (default)",p[0],this.tableName,g)}if(t(this.single.insert)&&typeof this.single.insert!="function")return"";const f=this._prepInsert(_),m={};if(s(f))return this._addReturningToSqlAndConvert("insert into "+this.tableName+" "+f,p[0],this.tableName,g);if(f.values.length===1)return this._addReturningToSqlAndConvert("insert into "+this.tableName+" ("+this.formatter.columnize(f.columns)+") values ("+this.client.parameterize(f.values[0],void 0,this.builder,this.bindingsHolder)+")",p[0],this.tableName,g);const y=f.columns.length===0;return m.returning=g,m.sql="begin "+f.values.map(function(w,$){const E=y?"":c.client.parameterize(w,c.client.valueForUndefined,c.builder,c.bindingsHolder);let C="insert into "+c.tableName;y?C+=" ("+c.formatter.wrap(c.single.returning)+") values (default)":C+=" ("+c.formatter.columnize(f.columns)+") values ("+E+")";let T="",N="",P="",L="";e(w,function(H){H instanceof o||(P+=" ?,")}),P=P.slice(0,-1),p[$].forEach(function(H){const Q=H.columnName||H;if(T+=c.formatter.wrap(Q)+",",N+=" ?,",L+=" out ?,",H instanceof o)return c.formatter.bindings.push(H);c.formatter.bindings.push(new a(Q))}),T=T.slice(0,-1),N=N.slice(0,-1),L=L.slice(0,-1),T&&N&&(C+=" returning "+T+" into"+N),C=c.formatter.client.positionBindings(C);const G=E.replace(/DEFAULT, /g,"").replace(/, DEFAULT/g,"").replace("EMPTY_BLOB(), ","").replace(", EMPTY_BLOB()","");return"execute immediate '"+C.replace(/'/g,"''")+(G||w?"' using ":"")+G+(G&&L?",":"")+L+";"}).join(" ")+"end;",m.outBinding=p,g[0]==="*"&&(m.returningSql=function(){return"select * from "+c.tableName+" where ROWID in ("+this.outBinding.map(function(w,$){return":"+($+1)}).join(", ")+") order by case ROWID "+this.outBinding.map(function(w,$){return"when CHARTOROWID(:"+($+1)+") then "+$}).join(" ")+" end"}),m}with(){const c=[];if(this.grouped.with)for(const p of this.grouped.with)p.recursive&&(c.push(p),p.recursive=!1);const d=super.with();for(const p of c)p.recursive=!0;return d}_addReturningToSqlAndConvert(c,d,p,g){const _=this,f={sql:c};if(!d)return f;const m=Array.isArray(d)?d:[d];let y="",w="";return m.forEach(function($){const E=$.columnName||$;if(y+=_.formatter.wrap(E)+",",w+="?,",$ instanceof o)return _.formatter.bindings.push($);_.formatter.bindings.push(new a(E))}),f.sql=c,y=y.slice(0,-1),w=w.slice(0,-1),y&&w&&(f.sql+=" returning "+y+" into "+w),f.outBinding=[d],g[0]==="*"&&(f.returningSql=function(){return"select * from "+_.tableName+" where ROWID = :1"}),f.returning=g,f}_prepOutbindings(c,d){const p={};let g=c||[],_=d||[];!Array.isArray(g)&&n(c)&&(g=[g]),_&&!Array.isArray(_)&&(_=[_]);const f=[];return e(g,function(m,y){_[0]==="*"?f[y]=["ROWID"]:f[y]=r(_),e(m,function(w,$){if(w instanceof Buffer){m[$]=new o($,w);const E=f[y].indexOf($);E>=0&&(f[y].splice(E,1),m[$].returning=!0),f[y].push(m[$])}w===void 0&&delete g[y][$]})}),p.returning=_,p.outBinding=f,p.values=g,p}_groupOrder(c,d){return super._groupOrderNulls(c,d)}update(){const c=this,d={},p=this._prepOutbindings(this.single.update||this.single.counter,this.single.returning),g=p.outBinding,_=p.returning,f=this._prepUpdate(this.single.update),m=this.where();let y="",w="";return t(f)&&typeof this.single.update!="function"?"":(g.forEach(function($){$.forEach(function(E){const C=E.columnName||E;if(y+=c.formatter.wrap(C)+",",w+=" ?,",E instanceof o)return c.formatter.bindings.push(E);c.formatter.bindings.push(new a(C))})}),y=y.slice(0,-1),w=w.slice(0,-1),d.outBinding=g,d.returning=_,d.sql="update "+this.tableName+" set "+f.join(", ")+(m?" "+m:""),g.length&&!t(g[0])&&(d.sql+=" returning "+y+" into"+w),_[0]==="*"&&(d.returningSql=function(){let $="select * from "+c.tableName;const E=this.rowsAffected.length||this.rowsAffected;let C=" where ROWID in (",T=") order by case ROWID ";for(let N=0;N<E;N++)this.returning[0]==="*"&&(C+=":"+(N+1)+", ",T+="when CHARTOROWID(:"+(N+1)+") then "+N+" ");return this.returning[0]==="*"&&(this.returning=this.returning.slice(0,-1),C=C.slice(0,-2),T=T.slice(0,-1)),$+=C+T+" end"}),d)}_jsonPathWrap(c){return`'${c.path||c[1]}'`}jsonExtract(c){return this._jsonExtract(c.singleValue?"json_value":"json_query",c)}jsonSet(c){return`json_transform(${l(c.column,this.builder,this.client,this.bindingsHolder)}, set ${this.client.parameter(c.path,this.builder,this.bindingsHolder)} = ${this.client.parameter(c.value,this.builder,this.bindingsHolder)})`}jsonInsert(c){return`json_transform(${l(c.column,this.builder,this.client,this.bindingsHolder)}, insert ${this.client.parameter(c.path,this.builder,this.bindingsHolder)} = ${this.client.parameter(c.value,this.builder,this.bindingsHolder)})`}jsonRemove(c){const d=`json_transform(${l(c.column,this.builder,this.client,this.bindingsHolder)}, remove ${this.client.parameter(c.path,this.builder,this.bindingsHolder)})`;return c.alias?this.client.alias(d,this.formatter.wrap(c.alias)):d}whereJsonPath(c){return this._whereJsonPath("json_value",c)}whereJsonSupersetOf(c){throw new Error("Json superset where clause not actually supported by Oracle")}whereJsonSubsetOf(c){throw new Error("Json subset where clause not actually supported by Oracle")}onJsonPathEquals(c){return this._onJsonPathEquals("json_value",c)}}return ps=u,ps}var ms,_c;function RI(){if(_c)return ms;_c=1;const r=fc();class e extends r{constructor(n,i){super(n,i)}_setNullableState(n,i){const a=i?"NULL":"NOT NULL",o=`alter table ${this.tableName()} modify (${this.formatter.wrap(n)} ${a})`;return this.pushQuery({sql:o})}}return ms=e,ms}var gs,wc;function SI(){if(wc)return gs;wc=1;const r=hc(),{isObject:e}=M;class t extends r{constructor(){super(...arguments),this.modifiers=["defaultTo","nullable","comment"],this._addCheckModifiers()}datetime(i){let a;return e(i)?{useTz:a}=i:a=!i,a?"timestamp with local time zone":"timestamp"}timestamp(i){let a;return e(i)?{useTz:a}=i:a=!i,a?"timestamp with local time zone":"timestamp"}checkRegex(i,a){return this._check(`REGEXP_LIKE(${this.formatter.wrap(this.getColumnName())},${this.client._escapeBinding(i)})`,a)}json(){return`varchar2(4000) check (${this.formatter.columnize(this.getColumnName())} is json)`}jsonb(){return this.json()}}return t.prototype.time="timestamp with local time zone",t.prototype.uuid=({useBinaryUuid:n=!1}={})=>n?"raw(16)":"char(36)",gs=t,gs}var ys,$c;function xI(){if($c)return ys;$c=1;const r=ft;class e extends r{constructor(n,i){super(n,i)}createOrReplace(){this.createQuery(this.columns,this.selectQuery,!1,!0)}createMaterializedView(){this.createQuery(this.columns,this.selectQuery,!0)}}return ys=e,ys}var bs,Cc;function II(){if(Cc)return bs;Cc=1;const r=xt;class e extends r{constructor(){super(...arguments)}checkOption(){this._single.checkOption="default_option"}}return bs=e,bs}var _s,vc;function PI(){if(vc)return _s;vc=1;const r=Ce,{timeout:e,KnexTimeoutError:t}=we,n=ae("knex:tx");return _s=class extends r{begin(a){return this.isolationLevel&&this.client.logger.warn("Transaction isolation is not currently supported for Oracle"),Promise.resolve()}async commit(a,o){this._completed=!0;try{await a.commitAsync(),this._resolver(o)}catch(s){this._rejecter(s)}}release(a,o){return this._resolver(o)}rollback(a,o){return this._completed=!0,n("%s: rolling back",this.txid),e(a.rollbackAsync(),5e3).catch(s=>{if(!(s instanceof t))return Promise.reject(s);this._rejecter(s)}).then(()=>{if(o===void 0){if(this.doNotRejectOnRollback){this._resolver();return}o=new Error(`Transaction rejected with non-error: ${o}`)}this._rejecter(o)})}savepoint(a){return this.query(a,`SAVEPOINT ${this.txid}`)}async acquireConnection(a,o){const s=a&&a.connection,l=s||await this.client.acquireConnection();try{return l.__knexTxId=this.txid,l.isTransaction=!0,await o(l)}finally{n("%s: releasing connection",this.txid),l.isTransaction=!1;try{await l.commitAsync()}catch(u){this._rejecter(u)}finally{s?n("%s: not releasing external connection",this.txid):await this.client.releaseConnection(l)}}}},_s}var ws,Ec;function LI(){if(Ec)return ws;Ec=1;const r=_t,e=ba,t=le,n=Qe,i=Nr,a=qI(),o=RI(),s=SI(),{BlobHelper:l,ReturningHelper:u,monkeyPatchConnection:h}=fs(),c=xI(),d=II(),p=PI(),g=mc(),{isString:_}=M,{outputQuery:f,unwrapRaw:m}=K,{compileCallback:y}=je;class w extends g{constructor(C){super(C),this.driver&&(process.env.UV_THREADPOOL_SIZE=process.env.UV_THREADPOOL_SIZE||1,process.env.UV_THREADPOOL_SIZE=parseInt(process.env.UV_THREADPOOL_SIZE)+this.driver.poolMax)}_driver(){const C=this,T=I;return C.fetchAsString=[],this.config.fetchAsString&&Array.isArray(this.config.fetchAsString)&&this.config.fetchAsString.forEach(function(N){_(N)&&(N=N.toUpperCase(),T[N]&&(N!=="NUMBER"&&N!=="DATE"&&N!=="CLOB"&&N!=="BUFFER"&&this.logger.warn('Only "date", "number", "clob" and "buffer" are supported for fetchAsString'),C.fetchAsString.push(T[N])))}),T}queryCompiler(C,T){return new a(this,C,T)}tableCompiler(){return new o(this,...arguments)}columnCompiler(){return new s(this,...arguments)}viewBuilder(){return new d(this,...arguments)}viewCompiler(){return new c(this,...arguments)}formatter(C){return new i(this,C)}transaction(){return new p(this,...arguments)}prepBindings(C){return n(C,T=>T instanceof l&&this.driver?{type:this.driver.BLOB,dir:this.driver.BIND_OUT}:T instanceof u&&this.driver?{type:this.driver.STRING,dir:this.driver.BIND_OUT}:typeof T=="boolean"?T?1:0:T)}parameter(C,T,N){return typeof C=="function"?f(y(C,void 0,this,N),!0,T,this):C instanceof l?(N.bindings.push(C.value),"?"):m(C,!0,T,this,N)||"?"}acquireRawConnection(){const C=this;return new Promise(function(N,P){const L=C.connectionSettings.externalAuth?{externalAuth:C.connectionSettings.externalAuth}:{user:C.connectionSettings.user,password:C.connectionSettings.password};L.connectString=$(C.connectionSettings),C.connectionSettings.prefetchRowCount&&(L.prefetchRows=C.connectionSettings.prefetchRowCount),C.connectionSettings.stmtCacheSize!==void 0&&(L.stmtCacheSize=C.connectionSettings.stmtCacheSize),C.driver.fetchAsString=C.fetchAsString,C.driver.getConnection(L,function(G,H){if(G)return P(G);h(H,C),N(H)})})}destroyRawConnection(C){return C.release()}_query(C,T){if(!T.sql)throw new Error("The query is empty");const N={autoCommit:!1};return T.method==="select"&&(N.resultSet=!0),C.executeAsync(T.sql,T.bindings,N).then(async function(P){let L=e(P.outBinds);if(T.response=P.rows||[],T.rowsAffected=P.rows?P.rows.rowsAffected:P.rowsAffected,T.method==="raw"&&L.length>0)return{response:L};if(T.method==="update"){const Q=T.rowsAffected.length||T.rowsAffected,_e=[],ee=[],se=te=>function(W,Z){const We=Z*Q;ee.push(L[te+We])};for(let te=0;te<Q;te++)_e.push(T.outBinding[0]),r(T.outBinding[0],se(te));L=ee,T.outBinding=_e}if(!T.returning&&L.length===0)return C.isTransaction||await C.commitAsync(),T;const G=[];let H=0;for(let Q=0;Q<T.outBinding.length;Q++){const _e=T.outBinding[Q];H=H+(T.outBinding[Q-1]?T.outBinding[Q-1].length:0);for(let ee=0;ee<_e.length;ee++){const se=_e[ee];await new Promise(function(te,W){if(se instanceof l){const Z=L[ee+H];se.returning&&(T.response[Q]=T.response[Q]||{},T.response[Q][se.columnName]=se.value),Z.on("error",function(We){W(We)}),Z.on("finish",function(){te()}),Z.write(se.value),Z.end()}else T.outBinding[Q][ee]==="ROWID"?(G.push(L[ee+H]),te()):(T.response[Q]=T.response[Q]||{},T.response[Q][se]=L[ee+H],te())})}}if(C.isTransaction)return T;if(await C.commitAsync(),T.returningSql){const Q=await C.executeAsync(T.returningSql(),G,{resultSet:!0});T.response=Q.rows}return T})}processResponse(C,T){const{response:N}=C;if(C.output)return C.output.call(T,N);switch(C.method){case"select":return N;case"first":return N[0];case"pluck":return n(N,C.pluck);case"insert":case"del":case"update":case"counter":return C.returning&&!t(C.returning)?N:C.rowsAffected!==void 0?C.rowsAffected:1;default:return N}}processPassedConnection(C){h(C,this)}}w.prototype.driverName="oracledb";function $(E){return E.connectString?E.connectString:E.port?E.host+":"+E.port+"/"+E.database:E.host+"/"+E.database}return ws=w,ws}var $s,Tc;function BI(){if(Tc)return $s;Tc=1;const r=Rr();class e extends r{constructor(...n){super(...n),this.driverName="pgnative",this.canCancelQuery=!0}_driver(){return I.native}_stream(n,i,a,o){if(!i.sql)throw new Error("The query is empty");const s=this;return new Promise((l,u)=>(a.on("error",u),a.on("end",l),s._query(n,i).then(h=>h.response).then(({rows:h})=>h.forEach(c=>a.write(c))).catch(function(h){a.emit("error",h)}).then(function(){a.end()})))}async cancelQuery(n){try{return await this._wrappedCancelQueryCall(null,n)}catch(i){throw this.logger.warn(`Connection Error: ${i}`),i}}_wrappedCancelQueryCall(n,i){return new Promise(function(a,o){i.native.cancel(function(s){if(s){o(s);return}a(!0)})})}}return $s=e,$s}var Cs,Ac;function kI(){if(Ac)return Cs;Ac=1;const r=Ce;return Cs=class extends r{begin(t){return this.isolationLevel?this.query(t,`BEGIN ISOLATION LEVEL ${this.isolationLevel};`):this.query(t,"BEGIN;")}savepoint(t){return this.trxClient.logger("Redshift does not support savepoints."),Promise.resolve()}release(t,n){return this.trxClient.logger("Redshift does not support savepoints."),Promise.resolve()}rollbackTo(t,n){return this.trxClient.logger("Redshift does not support savepoints."),Promise.resolve()}},Cs}var vs,Oc;function MI(){if(Oc)return vs;Oc=1;const r=De,e=di(),t=ie,{columnize:n}=K;class i extends e{truncate(){return`truncate ${this.tableName.toLowerCase()}`}insert(){const o=r.prototype.insert.apply(this,arguments);return o===""?o:(this._slightReturn(),{sql:o})}update(){const o=r.prototype.update.apply(this,arguments);return this._slightReturn(),{sql:o}}del(){const o=r.prototype.del.apply(this,arguments);return this._slightReturn(),{sql:o}}_slightReturn(){this.single.isReturning&&this.client.logger.warn("insert/update/delete returning is not supported by redshift dialect")}forUpdate(){return this.client.logger.warn("table lock is not supported by redshift dialect"),""}forShare(){return this.client.logger.warn("lock for share is not supported by redshift dialect"),""}forNoKeyUpdate(){return this.client.logger.warn("table lock is not supported by redshift dialect"),""}forKeyShare(){return this.client.logger.warn("lock for share is not supported by redshift dialect"),""}columnInfo(){const o=this.single.columnInfo;let s=this.single.schema;const l=this.client.customWrapIdentifier(this.single.table,t);s&&(s=this.client.customWrapIdentifier(s,t));const u="select * from information_schema.columns where table_name = ? and table_catalog = ?",h=[l.toLowerCase(),this.client.database().toLowerCase()];return this._buildColumnInfoQuery(s,u,h,o)}jsonExtract(o){let s;return Array.isArray(o.column)?s=o.column:s=[o],s.map(l=>{const u=`json_extract_path_text(${n(l.column||l[0],this.builder,this.client,this.bindingsHolder)}, ${this.client.toPathForJson(o.path||l[1],this.builder,this.bindingsHolder)})`,h=l.alias||l[2];return h?this.client.alias(u,this.formatter.wrap(h)):u}).join(", ")}jsonSet(o){throw new Error("Json set is not supported by Redshift")}jsonInsert(o){throw new Error("Json insert is not supported by Redshift")}jsonRemove(o){throw new Error("Json remove is not supported by Redshift")}whereJsonPath(o){return this._whereJsonPath("json_extract_path_text",Object.assign({},o,{path:this.client.toPathForJson(o.path)}))}whereJsonSupersetOf(o){throw new Error("Json superset is not supported by Redshift")}whereJsonSubsetOf(o){throw new Error("Json subset is not supported by Redshift")}onJsonPathEquals(o){return this._onJsonPathEquals("json_extract_path_text",o)}}return vs=i,vs}var Es,Nc;function jI(){if(Nc)return Es;Nc=1;const r=Or;class e extends r{constructor(){super(...arguments)}primary(){return this.notNullable(),super.primary(...arguments)}index(){return this.client.logger.warn("Redshift does not support the creation of indexes."),this}}return Es=e,Es}var Ts,qc;function QI(){if(qc)return Ts;qc=1;const r=mi(),e=Ue;class t extends r{constructor(){super(...arguments)}bit(i){return i.length!==!1?`char(${i.length})`:"char(1)"}datetime(i){return i?"timestamp":"timestamptz"}timestamp(i){return i?"timestamp":"timestamptz"}comment(i){this.pushAdditional(function(){this.pushQuery(`comment on column ${this.tableCompiler.tableName()}.`+this.formatter.wrap(this.args[0])+" is "+(i?`'${i}'`:"NULL"))},i)}}return t.prototype.increments=({primaryKey:n=!0}={})=>"integer identity(1,1)"+(n?" primary key":"")+" not null",t.prototype.bigincrements=({primaryKey:n=!0}={})=>"bigint identity(1,1)"+(n?" primary key":"")+" not null",t.prototype.binary="varchar(max)",t.prototype.blob="varchar(max)",t.prototype.enu="varchar(255)",t.prototype.enum="varchar(255)",t.prototype.json="varchar(max)",t.prototype.jsonb="varchar(max)",t.prototype.longblob="varchar(max)",t.prototype.mediumblob="varchar(16777218)",t.prototype.set="text",t.prototype.text="varchar(max)",t.prototype.tinyblob="varchar(256)",t.prototype.uuid=e.prototype.uuid,t.prototype.varbinary="varchar(max)",t.prototype.bigint="bigint",t.prototype.bool="boolean",t.prototype.double="double precision",t.prototype.floating="real",t.prototype.smallint="smallint",t.prototype.tinyint="smallint",Ts=t,Ts}var As,Rc;function DI(){if(Rc)return As;Rc=1;const r=br,e=yi();class t extends e{constructor(){super(...arguments)}index(i,a,o){this.client.logger.warn("Redshift does not support the creation of indexes.")}dropIndex(i,a){this.client.logger.warn("Redshift does not support the deletion of indexes.")}createQuery(i,a,o){const s=a?"create table if not exists ":"create table ",l=" ("+i.sql.join(", ")+this._addChecks()+")";let u=s+this.tableName()+(o&&this.tableNameLike()?" (like "+this.tableNameLike()+")":l);this.single.inherits&&(u+=` like (${this.formatter.wrap(this.single.inherits)})`),this.pushQuery({sql:u,bindings:i.bindings}),r(this.single,"comment")&&this.comment(this.single.comment),o&&this.addColumns(i,this.addColumnsPrefix)}primary(i,a){const o=this;a=a?o.formatter.wrap(a):o.formatter.wrap(`${this.tableNameRaw}_pkey`),i.constructor!==Array&&(i=[i]);const s=o.grouped.columns;if(s)for(let l=0;l<i.length;l++){let u=s.find(c=>c.grouping==="columns"&&c.builder&&c.builder._method==="add"&&c.builder._args&&c.builder._args.indexOf(i[l])>-1);if(u&&(u=u.builder),!(u&&u._modifiers&&u._modifiers.nullable&&u._modifiers.nullable[0]===!1))return u?this.client.logger.warn("Redshift does not allow primary keys to contain nullable columns."):this.client.logger.warn("Redshift does not allow primary keys to contain nonexistent columns.")}return o.pushQuery(`alter table ${o.tableName()} add constraint ${a} primary key (${o.formatter.columnize(i)})`)}addColumns(i,a,o){if(a===this.alterColumnsPrefix)super.addColumns(i,a,o);else{a=a||this.addColumnsPrefix,o=o||this.getColumns();for(const s of o){const l=this.tableName(),u=s.compileColumn();this.pushQuery({sql:`alter table ${l} ${a}${u}`,bindings:[]})}}}}return As=t,As}var Os,Sc;function FI(){if(Sc)return Os;Sc=1;const r=vu();class e extends r{constructor(){super(...arguments)}}return Os=e,Os}var Ns,xc;function UI(){if(xc)return Ns;xc=1;const r=_i();class e extends r{constructor(n,i){super(n,i)}}return Ns=e,Ns}var qs,Ic;function HI(){if(Ic)return qs;Ic=1;const r=Rr(),e=Qe,t=kI(),n=MI(),i=jI(),a=QI(),o=DI(),s=FI(),l=UI();class u extends r{transaction(){return new t(this,...arguments)}queryCompiler(c,d){return new n(this,c,d)}columnBuilder(){return new i(this,...arguments)}columnCompiler(){return new a(this,...arguments)}tableCompiler(){return new o(this,...arguments)}schemaCompiler(){return new s(this,...arguments)}viewCompiler(){return new l(this,...arguments)}_driver(){return I}processResponse(c,d){const p=c.response;return c.output?c.output.call(d,p):c.method==="raw"?p:p.command==="SELECT"?c.method==="first"?p.rows[0]:c.method==="pluck"?e(p.rows,c.pluck):p.rows:p.command==="INSERT"||p.command==="UPDATE"||p.command==="DELETE"?p.rowCount:p}toPathForJson(c,d,p){return c.replace(/^(\$\.)/,"").split(".").map((function(g){return this.parameter(g,d,p)}).bind(this)).join(", ")}}return Object.assign(u.prototype,{dialect:"redshift",driverName:"pg-redshift"}),qs=u,qs}Object.defineProperty(qr,"__esModule",{value:!0}),qr.getDialectByNameOrAlias=void 0;const{resolveClientNameWithAliases:VI}=z,WI=Object.freeze({"better-sqlite3":()=>Hx(),cockroachdb:()=>Xx(),mssql:()=>aI(),mysql:()=>Gu(),mysql2:()=>bI(),oracle:()=>mc(),oracledb:()=>LI(),pgnative:()=>BI(),postgres:()=>Rr(),redshift:()=>HI(),sqlite3:()=>du()});function zI(r){const e=VI(r),t=WI[e];if(!t)throw new Error(`Invalid clientName given: ${r}`);return t()}qr.getDialectByNameOrAlias=zI;const KI=He,{SUPPORTED_CLIENTS:JI}=Tn,Pc=Tx,{getDialectByNameOrAlias:GI}=qr;function YI(r){let e,t;const n=typeof r=="string"?Object.assign(Pc(r),arguments[2]):r;if(arguments.length===0||!n.client&&!n.dialect)e=KI;else if(typeof n.client=="function")e=n.client;else{const i=n.client||n.dialect;if(!JI.includes(i))throw new Error(`knex: Unknown configuration option 'client' value ${i}. Note that it is case-sensitive, check documentation for supported values.`);e=GI(i)}return typeof n.connection=="string"?t=Object.assign({},n,{connection:Pc(n.connection).connection}):t=Object.assign({},n),{resolvedConfig:t,Dialect:e}}var XI={resolveConfig:YI};const ZI=He,e0=Ee,t0=ea,r0=va,{KnexTimeoutError:n0}=we,{resolveConfig:i0}=XI,s0=Sl,o0=xt,a0=Or,l0=Pl;function Ne(r){const{resolvedConfig:e,Dialect:t}=i0(...arguments),n=r0(new t(e));return e.userParams&&(n.userParams=e.userParams),n}Ne.Client=ZI,Ne.KnexTimeoutError=n0,Ne.QueryBuilder={extend:function(r,e){e0.extend(r,e),t0.push(r)}},Ne.SchemaBuilder={extend:function(r,e){s0.extend(r,e)}},Ne.ViewBuilder={extend:function(r,e){o0.extend(r,e)}},Ne.ColumnBuilder={extend:function(r,e){a0.extend(r,e)}},Ne.TableBuilder={extend:function(r,e){l0.extend(r,e)}};var u0=Ne,c0=u0;const It=c0;It.knex=It,It.default=It;var h0=It;class d0 extends h0.knex.Client{constructor(e={}){super(e),this.driverName="odbc",this.driverName&&e.connection&&(this.initializeDriver(),(!e.pool||e.pool&&e.pool.max!==0)&&this.initializePool(e))}_driver(){return require("odbc")}wrapIdentifierImpl(e){return e}printDebug(e){(void 0).DEBUG}async acquireRawConnection(){this.printDebug("acquiring raw connection");const e=this.config.connection;return await this.driver.connect(this._getConnectionString(e))}async destroyRawConnection(e){return await e.close()}_getConnectionString(e={}){const t=e.connectionStringParams||{},n=Object.keys(t).reduce((i,a)=>{const o=t[a];return`${i}${a}=${o};`},"");return`${`DRIVER=${e.driver};SYSTEM=${e.host};HOSTNAME=${e.host};PORT=${e.port};DATABASE=${e.database};UID=${e.user};PWD=${e.password};`}${n}`}async _query(e,t){(!t||typeof t=="string")&&(t={sql:t});const n=(t.method!=="raw"?t.method:t.sql.split(" ")[0]).toLowerCase();if(t.sqlMethod=n,n==="select"||n==="first"||n==="pluck"){const a=await e.query(t.sql,t.bindings);return a&&(t.response={rows:a,rowCount:a.length}),t}const i=await e.createStatement();return await i.prepare(t.sql),await i.bind(t.bindings),t.response=await i.execute(),t}processResponse(e,t){if(e===null)return null;const n=e.response,i=e.sqlMethod,{rows:a}=n;if(e.output)return e.output.call(t,n);switch(i){case"select":case"pluck":case"first":return i==="pluck"?a.map(e.pluck):i==="first"?a[0]:a;case"insert":case"del":case"delete":case"update":case"counter":return n.rowCount;default:return n}}}return d0}();
//# sourceMappingURL=index.iife.js.map
