(function(x,P){typeof exports=="object"&&typeof module<"u"?module.exports=P():typeof define=="function"&&define.amd?define(P):(x=typeof globalThis<"u"?globalThis:x||self,x.knexDB2=P())})(this,function(){"use strict";var s0=Object.defineProperty;var o0=(x,P,K)=>P in x?s0(x,P,{enumerable:!0,configurable:!0,writable:!0,value:K}):x[P]=K;var qr=(x,P,K)=>(o0(x,typeof P!="symbol"?P+"":P,K),K);var x=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function P(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function K(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){if(this instanceof n){var i=[null];i.push.apply(i,arguments);var s=Function.bind.apply(e,i);return new s}return e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var i=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return r[n]}})}),t}const E=K(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));var Pt={exports:{}},Nt,Rr;function Qs(){if(Rr)return Nt;Rr=1;var r=1e3,e=r*60,t=e*60,n=t*24,i=n*7,s=n*365.25;Nt=function(l,h){h=h||{};var d=typeof l;if(d==="string"&&l.length>0)return o(l);if(d==="number"&&isFinite(l))return h.long?u(l):a(l);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(l))};function o(l){if(l=String(l),!(l.length>100)){var h=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(l);if(h){var d=parseFloat(h[1]),_=(h[2]||"ms").toLowerCase();switch(_){case"years":case"year":case"yrs":case"yr":case"y":return d*s;case"weeks":case"week":case"w":return d*i;case"days":case"day":case"d":return d*n;case"hours":case"hour":case"hrs":case"hr":case"h":return d*t;case"minutes":case"minute":case"mins":case"min":case"m":return d*e;case"seconds":case"second":case"secs":case"sec":case"s":return d*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return d;default:return}}}}function a(l){var h=Math.abs(l);return h>=n?Math.round(l/n)+"d":h>=t?Math.round(l/t)+"h":h>=e?Math.round(l/e)+"m":h>=r?Math.round(l/r)+"s":l+"ms"}function u(l){var h=Math.abs(l);return h>=n?c(l,h,n,"day"):h>=t?c(l,h,t,"hour"):h>=e?c(l,h,e,"minute"):h>=r?c(l,h,r,"second"):l+" ms"}function c(l,h,d,_){var m=h>=d*1.5;return Math.round(l/d)+" "+_+(m?"s":"")}return Nt}function Ws(r){t.debug=t,t.default=t,t.coerce=u,t.disable=s,t.enable=i,t.enabled=o,t.humanize=Qs(),t.destroy=c,Object.keys(r).forEach(l=>{t[l]=r[l]}),t.names=[],t.skips=[],t.formatters={};function e(l){let h=0;for(let d=0;d<l.length;d++)h=(h<<5)-h+l.charCodeAt(d),h|=0;return t.colors[Math.abs(h)%t.colors.length]}t.selectColor=e;function t(l){let h,d=null,_,m;function y(...b){if(!y.enabled)return;const $=y,N=Number(new Date),Oe=N-(h||N);$.diff=Oe,$.prev=h,$.curr=N,h=N,b[0]=t.coerce(b[0]),typeof b[0]!="string"&&b.unshift("%O");let D=0;b[0]=b[0].replace(/%([a-zA-Z%])/g,(Br,n0)=>{if(Br==="%%")return"%";D++;const Fs=t.formatters[n0];if(typeof Fs=="function"){const i0=b[D];Br=Fs.call($,i0),b.splice(D,1),D--}return Br}),t.formatArgs.call($,b),($.log||t.log).apply($,b)}return y.namespace=l,y.useColors=t.useColors(),y.color=t.selectColor(l),y.extend=n,y.destroy=t.destroy,Object.defineProperty(y,"enabled",{enumerable:!0,configurable:!1,get:()=>d!==null?d:(_!==t.namespaces&&(_=t.namespaces,m=t.enabled(l)),m),set:b=>{d=b}}),typeof t.init=="function"&&t.init(y),y}function n(l,h){const d=t(this.namespace+(typeof h>"u"?":":h)+l);return d.log=this.log,d}function i(l){t.save(l),t.namespaces=l,t.names=[],t.skips=[];let h;const d=(typeof l=="string"?l:"").split(/[\s,]+/),_=d.length;for(h=0;h<_;h++)d[h]&&(l=d[h].replace(/\*/g,".*?"),l[0]==="-"?t.skips.push(new RegExp("^"+l.slice(1)+"$")):t.names.push(new RegExp("^"+l+"$")))}function s(){const l=[...t.names.map(a),...t.skips.map(a).map(h=>"-"+h)].join(",");return t.enable(""),l}function o(l){if(l[l.length-1]==="*")return!0;let h,d;for(h=0,d=t.skips.length;h<d;h++)if(t.skips[h].test(l))return!1;for(h=0,d=t.names.length;h<d;h++)if(t.names[h].test(l))return!0;return!1}function a(l){return l.toString().substring(2,l.toString().length-2).replace(/\.\*\?$/,"*")}function u(l){return l instanceof Error?l.stack||l.message:l}function c(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}var Ds=Ws;(function(r,e){e.formatArgs=n,e.save=i,e.load=s,e.useColors=t,e.storage=o(),e.destroy=(()=>{let u=!1;return()=>{u||(u=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function n(u){if(u[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+u[0]+(this.useColors?"%c ":" ")+"+"+r.exports.humanize(this.diff),!this.useColors)return;const c="color: "+this.color;u.splice(1,0,c,"color: inherit");let l=0,h=0;u[0].replace(/%[a-zA-Z%]/g,d=>{d!=="%%"&&(l++,d==="%c"&&(h=l))}),u.splice(h,0,c)}e.log=console.debug||console.log||(()=>{});function i(u){try{u?e.storage.setItem("debug",u):e.storage.removeItem("debug")}catch{}}function s(){let u;try{u=e.storage.getItem("debug")}catch{}return!u&&typeof process<"u"&&"env"in process&&(u=process.env.DEBUG),u}function o(){try{return localStorage}catch{}}r.exports=Ds(e);const{formatters:a}=r.exports;a.j=function(u){try{return JSON.stringify(u)}catch(c){return"[UnexpectedJSONParseError]: "+c.message}}})(Pt,Pt.exports);var ae=Pt.exports,Us=typeof x=="object"&&x&&x.Object===Object&&x,kr=Us,Js=kr,Vs=typeof self=="object"&&self&&self.Object===Object&&self,Gs=Js||Vs||Function("return this")(),R=Gs,Ks=R,zs=Ks.Symbol,z=zs;function Ys(r,e){for(var t=-1,n=r==null?0:r.length,i=Array(n);++t<n;)i[t]=e(r[t],t,r);return i}var We=Ys,Xs=Array.isArray,A=Xs,Mr=z,Lr=Object.prototype,Zs=Lr.hasOwnProperty,eo=Lr.toString,Ae=Mr?Mr.toStringTag:void 0;function to(r){var e=Zs.call(r,Ae),t=r[Ae];try{r[Ae]=void 0;var n=!0}catch{}var i=eo.call(r);return n&&(e?r[Ae]=t:delete r[Ae]),i}var ro=to,no=Object.prototype,io=no.toString;function so(r){return io.call(r)}var oo=so,Fr=z,ao=ro,uo=oo,lo="[object Null]",co="[object Undefined]",Hr=Fr?Fr.toStringTag:void 0;function ho(r){return r==null?r===void 0?co:lo:Hr&&Hr in Object(r)?ao(r):uo(r)}var Y=ho;function fo(r){return r!=null&&typeof r=="object"}var k=fo,po=Y,go=k,yo="[object Symbol]";function mo(r){return typeof r=="symbol"||go(r)&&po(r)==yo}var De=mo,Qr=z,bo=We,_o=A,wo=De,vo=1/0,Wr=Qr?Qr.prototype:void 0,Dr=Wr?Wr.toString:void 0;function Ur(r){if(typeof r=="string")return r;if(_o(r))return bo(r,Ur)+"";if(wo(r))return Dr?Dr.call(r):"";var e=r+"";return e=="0"&&1/r==-vo?"-0":e}var $o=Ur,Co=$o;function To(r){return r==null?"":Co(r)}var Jr=To,Oo=Jr,Ao=0;function Eo(r){var e=++Ao;return Oo(r)+e}var Vr=Eo,jt=function(){},So=class{constructor(e){this.client=e}now(e){return typeof e=="number"?this.client.raw(`CURRENT_TIMESTAMP(${e})`):this.client.raw("CURRENT_TIMESTAMP")}uuidToBin(e,t=!0){const n=Buffer.from(e.replace(/-/g,""),"hex");return t?Buffer.concat([n.slice(6,8),n.slice(4,6),n.slice(0,4),n.slice(8,16)]):Buffer.concat([n.slice(0,4),n.slice(4,6),n.slice(6,8),n.slice(8,16)])}binToUuid(e,t=!0){const n=Buffer.from(e,"hex");return t?[n.toString("hex",4,8),n.toString("hex",2,4),n.toString("hex",0,2),n.toString("hex",8,10),n.toString("hex",10,16)].join("-"):[n.toString("hex",0,4),n.toString("hex",4,6),n.toString("hex",6,8),n.toString("hex",8,10),n.toString("hex",10,16)].join("-")}},Io=["with","withRecursive","withMaterialized","withNotMaterialized","select","as","columns","column","from","fromJS","fromRaw","into","withSchema","table","distinct","join","joinRaw","innerJoin","leftJoin","leftOuterJoin","rightJoin","rightOuterJoin","outerJoin","fullOuterJoin","crossJoin","where","andWhere","orWhere","whereNot","orWhereNot","whereLike","andWhereLike","orWhereLike","whereILike","andWhereILike","orWhereILike","whereRaw","whereWrapped","havingWrapped","orWhereRaw","whereExists","orWhereExists","whereNotExists","orWhereNotExists","whereIn","orWhereIn","whereNotIn","orWhereNotIn","whereNull","orWhereNull","whereNotNull","orWhereNotNull","whereBetween","whereNotBetween","andWhereBetween","andWhereNotBetween","orWhereBetween","orWhereNotBetween","groupBy","groupByRaw","orderBy","orderByRaw","union","unionAll","intersect","having","havingRaw","orHaving","orHavingRaw","offset","limit","count","countDistinct","min","max","sum","sumDistinct","avg","avgDistinct","increment","decrement","first","debug","pluck","clearSelect","clearWhere","clearGroup","clearOrder","clearHaving","insert","update","returning","del","delete","truncate","transacting","connection","jsonExtract","jsonSet","jsonInsert","jsonRemove","whereJsonObject","orWhereJsonObject","andWhereJsonObject","whereNotJsonObject","orWhereNotJsonObject","andWhereNotJsonObject","whereJsonPath","orWhereJsonPath","andWhereJsonPath","whereJsonSupersetOf","orWhereJsonSupersetOf","andWhereJsonSupersetOf","whereJsonNotSupersetOf","orWhereJsonNotSupersetOf","andWhereJsonNotSupersetOf","whereJsonSubsetOf","orWhereJsonSubsetOf","andWhereJsonSubsetOf","whereJsonNotSubsetOf","orWhereJsonNotSubsetOf","andWhereJsonNotSubsetOf"];function xo(){this.__data__=[],this.size=0}var Po=xo;function No(r,e){return r===e||r!==r&&e!==e}var ue=No,jo=ue;function Bo(r,e){for(var t=r.length;t--;)if(jo(r[t][0],e))return t;return-1}var Ue=Bo,qo=Ue,Ro=Array.prototype,ko=Ro.splice;function Mo(r){var e=this.__data__,t=qo(e,r);if(t<0)return!1;var n=e.length-1;return t==n?e.pop():ko.call(e,t,1),--this.size,!0}var Lo=Mo,Fo=Ue;function Ho(r){var e=this.__data__,t=Fo(e,r);return t<0?void 0:e[t][1]}var Qo=Ho,Wo=Ue;function Do(r){return Wo(this.__data__,r)>-1}var Uo=Do,Jo=Ue;function Vo(r,e){var t=this.__data__,n=Jo(t,r);return n<0?(++this.size,t.push([r,e])):t[n][1]=e,this}var Go=Vo,Ko=Po,zo=Lo,Yo=Qo,Xo=Uo,Zo=Go;function le(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}le.prototype.clear=Ko,le.prototype.delete=zo,le.prototype.get=Yo,le.prototype.has=Xo,le.prototype.set=Zo;var Je=le,ea=Je;function ta(){this.__data__=new ea,this.size=0}var ra=ta;function na(r){var e=this.__data__,t=e.delete(r);return this.size=e.size,t}var ia=na;function sa(r){return this.__data__.get(r)}var oa=sa;function aa(r){return this.__data__.has(r)}var ua=aa;function la(r){var e=typeof r;return r!=null&&(e=="object"||e=="function")}var j=la,ca=Y,ha=j,da="[object AsyncFunction]",fa="[object Function]",pa="[object GeneratorFunction]",ga="[object Proxy]";function ya(r){if(!ha(r))return!1;var e=ca(r);return e==fa||e==pa||e==da||e==ga}var Ve=ya,ma=R,ba=ma["__core-js_shared__"],_a=ba,Bt=_a,Gr=function(){var r=/[^.]+$/.exec(Bt&&Bt.keys&&Bt.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}();function wa(r){return!!Gr&&Gr in r}var va=wa,$a=Function.prototype,Ca=$a.toString;function Ta(r){if(r!=null){try{return Ca.call(r)}catch{}try{return r+""}catch{}}return""}var Kr=Ta,Oa=Ve,Aa=va,Ea=j,Sa=Kr,Ia=/[\\^$.*+?()[\]{}|]/g,xa=/^\[object .+?Constructor\]$/,Pa=Function.prototype,Na=Object.prototype,ja=Pa.toString,Ba=Na.hasOwnProperty,qa=RegExp("^"+ja.call(Ba).replace(Ia,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Ra(r){if(!Ea(r)||Aa(r))return!1;var e=Oa(r)?qa:xa;return e.test(Sa(r))}var ka=Ra;function Ma(r,e){return r==null?void 0:r[e]}var La=Ma,Fa=ka,Ha=La;function Qa(r,e){var t=Ha(r,e);return Fa(t)?t:void 0}var X=Qa,Wa=X,Da=R,Ua=Wa(Da,"Map"),qt=Ua,Ja=X,Va=Ja(Object,"create"),Ge=Va,zr=Ge;function Ga(){this.__data__=zr?zr(null):{},this.size=0}var Ka=Ga;function za(r){var e=this.has(r)&&delete this.__data__[r];return this.size-=e?1:0,e}var Ya=za,Xa=Ge,Za="__lodash_hash_undefined__",eu=Object.prototype,tu=eu.hasOwnProperty;function ru(r){var e=this.__data__;if(Xa){var t=e[r];return t===Za?void 0:t}return tu.call(e,r)?e[r]:void 0}var nu=ru,iu=Ge,su=Object.prototype,ou=su.hasOwnProperty;function au(r){var e=this.__data__;return iu?e[r]!==void 0:ou.call(e,r)}var uu=au,lu=Ge,cu="__lodash_hash_undefined__";function hu(r,e){var t=this.__data__;return this.size+=this.has(r)?0:1,t[r]=lu&&e===void 0?cu:e,this}var du=hu,fu=Ka,pu=Ya,gu=nu,yu=uu,mu=du;function ce(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}ce.prototype.clear=fu,ce.prototype.delete=pu,ce.prototype.get=gu,ce.prototype.has=yu,ce.prototype.set=mu;var bu=ce,Yr=bu,_u=Je,wu=qt;function vu(){this.size=0,this.__data__={hash:new Yr,map:new(wu||_u),string:new Yr}}var $u=vu;function Cu(r){var e=typeof r;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?r!=="__proto__":r===null}var Tu=Cu,Ou=Tu;function Au(r,e){var t=r.__data__;return Ou(e)?t[typeof e=="string"?"string":"hash"]:t.map}var Ke=Au,Eu=Ke;function Su(r){var e=Eu(this,r).delete(r);return this.size-=e?1:0,e}var Iu=Su,xu=Ke;function Pu(r){return xu(this,r).get(r)}var Nu=Pu,ju=Ke;function Bu(r){return ju(this,r).has(r)}var qu=Bu,Ru=Ke;function ku(r,e){var t=Ru(this,r),n=t.size;return t.set(r,e),this.size+=t.size==n?0:1,this}var Mu=ku,Lu=$u,Fu=Iu,Hu=Nu,Qu=qu,Wu=Mu;function he(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}he.prototype.clear=Lu,he.prototype.delete=Fu,he.prototype.get=Hu,he.prototype.has=Qu,he.prototype.set=Wu;var Rt=he,Du=Je,Uu=qt,Ju=Rt,Vu=200;function Gu(r,e){var t=this.__data__;if(t instanceof Du){var n=t.__data__;if(!Uu||n.length<Vu-1)return n.push([r,e]),this.size=++t.size,this;t=this.__data__=new Ju(n)}return t.set(r,e),this.size=t.size,this}var Ku=Gu,zu=Je,Yu=ra,Xu=ia,Zu=oa,el=ua,tl=Ku;function de(r){var e=this.__data__=new zu(r);this.size=e.size}de.prototype.clear=Yu,de.prototype.delete=Xu,de.prototype.get=Zu,de.prototype.has=el,de.prototype.set=tl;var ze=de,rl=X,nl=function(){try{var r=rl(Object,"defineProperty");return r({},"",{}),r}catch{}}(),Xr=nl,Zr=Xr;function il(r,e,t){e=="__proto__"&&Zr?Zr(r,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):r[e]=t}var Ye=il,sl=Ye,ol=ue;function al(r,e,t){(t!==void 0&&!ol(r[e],t)||t===void 0&&!(e in r))&&sl(r,e,t)}var en=al;function ul(r){return function(e,t,n){for(var i=-1,s=Object(e),o=n(e),a=o.length;a--;){var u=o[r?a:++i];if(t(s[u],u,s)===!1)break}return e}}var ll=ul,cl=ll,hl=cl(),tn=hl,Xe={exports:{}};Xe.exports,function(r,e){var t=R,n=e&&!e.nodeType&&e,i=n&&!0&&r&&!r.nodeType&&r,s=i&&i.exports===n,o=s?t.Buffer:void 0,a=o?o.allocUnsafe:void 0;function u(c,l){if(l)return c.slice();var h=c.length,d=a?a(h):new c.constructor(h);return c.copy(d),d}r.exports=u}(Xe,Xe.exports);var rn=Xe.exports,dl=R,fl=dl.Uint8Array,nn=fl,sn=nn;function pl(r){var e=new r.constructor(r.byteLength);return new sn(e).set(new sn(r)),e}var kt=pl,gl=kt;function yl(r,e){var t=e?gl(r.buffer):r.buffer;return new r.constructor(t,r.byteOffset,r.length)}var on=yl;function ml(r,e){var t=-1,n=r.length;for(e||(e=Array(n));++t<n;)e[t]=r[t];return e}var Mt=ml,bl=j,an=Object.create,_l=function(){function r(){}return function(e){if(!bl(e))return{};if(an)return an(e);r.prototype=e;var t=new r;return r.prototype=void 0,t}}(),un=_l;function wl(r,e){return function(t){return r(e(t))}}var ln=wl,vl=ln,$l=vl(Object.getPrototypeOf,Object),Ze=$l,Cl=Object.prototype;function Tl(r){var e=r&&r.constructor,t=typeof e=="function"&&e.prototype||Cl;return r===t}var Ee=Tl,Ol=un,Al=Ze,El=Ee;function Sl(r){return typeof r.constructor=="function"&&!El(r)?Ol(Al(r)):{}}var cn=Sl,Il=Y,xl=k,Pl="[object Arguments]";function Nl(r){return xl(r)&&Il(r)==Pl}var jl=Nl,hn=jl,Bl=k,dn=Object.prototype,ql=dn.hasOwnProperty,Rl=dn.propertyIsEnumerable,kl=hn(function(){return arguments}())?hn:function(r){return Bl(r)&&ql.call(r,"callee")&&!Rl.call(r,"callee")},Se=kl,Ml=9007199254740991;function Ll(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=Ml}var Lt=Ll,Fl=Ve,Hl=Lt;function Ql(r){return r!=null&&Hl(r.length)&&!Fl(r)}var F=Ql,Wl=F,Dl=k;function Ul(r){return Dl(r)&&Wl(r)}var Jl=Ul,et={exports:{}};function Vl(){return!1}var Gl=Vl;et.exports,function(r,e){var t=R,n=Gl,i=e&&!e.nodeType&&e,s=i&&!0&&r&&!r.nodeType&&r,o=s&&s.exports===i,a=o?t.Buffer:void 0,u=a?a.isBuffer:void 0,c=u||n;r.exports=c}(et,et.exports);var fe=et.exports,Kl=Y,zl=Ze,Yl=k,Xl="[object Object]",Zl=Function.prototype,ec=Object.prototype,fn=Zl.toString,tc=ec.hasOwnProperty,rc=fn.call(Object);function nc(r){if(!Yl(r)||Kl(r)!=Xl)return!1;var e=zl(r);if(e===null)return!0;var t=tc.call(e,"constructor")&&e.constructor;return typeof t=="function"&&t instanceof t&&fn.call(t)==rc}var Ie=nc,ic=Y,sc=Lt,oc=k,ac="[object Arguments]",uc="[object Array]",lc="[object Boolean]",cc="[object Date]",hc="[object Error]",dc="[object Function]",fc="[object Map]",pc="[object Number]",gc="[object Object]",yc="[object RegExp]",mc="[object Set]",bc="[object String]",_c="[object WeakMap]",wc="[object ArrayBuffer]",vc="[object DataView]",$c="[object Float32Array]",Cc="[object Float64Array]",Tc="[object Int8Array]",Oc="[object Int16Array]",Ac="[object Int32Array]",Ec="[object Uint8Array]",Sc="[object Uint8ClampedArray]",Ic="[object Uint16Array]",xc="[object Uint32Array]",v={};v[$c]=v[Cc]=v[Tc]=v[Oc]=v[Ac]=v[Ec]=v[Sc]=v[Ic]=v[xc]=!0,v[ac]=v[uc]=v[wc]=v[lc]=v[vc]=v[cc]=v[hc]=v[dc]=v[fc]=v[pc]=v[gc]=v[yc]=v[mc]=v[bc]=v[_c]=!1;function Pc(r){return oc(r)&&sc(r.length)&&!!v[ic(r)]}var Nc=Pc;function jc(r){return function(e){return r(e)}}var Ft=jc,tt={exports:{}};tt.exports,function(r,e){var t=kr,n=e&&!e.nodeType&&e,i=n&&!0&&r&&!r.nodeType&&r,s=i&&i.exports===n,o=s&&t.process,a=function(){try{var u=i&&i.require&&i.require("util").types;return u||o&&o.binding&&o.binding("util")}catch{}}();r.exports=a}(tt,tt.exports);var Ht=tt.exports,Bc=Nc,qc=Ft,pn=Ht,gn=pn&&pn.isTypedArray,Rc=gn?qc(gn):Bc,pe=Rc;function kc(r,e){if(!(e==="constructor"&&typeof r[e]=="function")&&e!="__proto__")return r[e]}var yn=kc,Mc=Ye,Lc=ue,Fc=Object.prototype,Hc=Fc.hasOwnProperty;function Qc(r,e,t){var n=r[e];(!(Hc.call(r,e)&&Lc(n,t))||t===void 0&&!(e in r))&&Mc(r,e,t)}var rt=Qc,Wc=rt,Dc=Ye;function Uc(r,e,t,n){var i=!t;t||(t={});for(var s=-1,o=e.length;++s<o;){var a=e[s],u=n?n(t[a],r[a],a,t,r):void 0;u===void 0&&(u=r[a]),i?Dc(t,a,u):Wc(t,a,u)}return t}var Z=Uc;function Jc(r,e){for(var t=-1,n=Array(r);++t<r;)n[t]=e(t);return n}var Vc=Jc,Gc=9007199254740991,Kc=/^(?:0|[1-9]\d*)$/;function zc(r,e){var t=typeof r;return e=e??Gc,!!e&&(t=="number"||t!="symbol"&&Kc.test(r))&&r>-1&&r%1==0&&r<e}var nt=zc,Yc=Vc,Xc=Se,Zc=A,eh=fe,th=nt,rh=pe,nh=Object.prototype,ih=nh.hasOwnProperty;function sh(r,e){var t=Zc(r),n=!t&&Xc(r),i=!t&&!n&&eh(r),s=!t&&!n&&!i&&rh(r),o=t||n||i||s,a=o?Yc(r.length,String):[],u=a.length;for(var c in r)(e||ih.call(r,c))&&!(o&&(c=="length"||i&&(c=="offset"||c=="parent")||s&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||th(c,u)))&&a.push(c);return a}var mn=sh;function oh(r){var e=[];if(r!=null)for(var t in Object(r))e.push(t);return e}var ah=oh,uh=j,lh=Ee,ch=ah,hh=Object.prototype,dh=hh.hasOwnProperty;function fh(r){if(!uh(r))return ch(r);var e=lh(r),t=[];for(var n in r)n=="constructor"&&(e||!dh.call(r,n))||t.push(n);return t}var ph=fh,gh=mn,yh=ph,mh=F;function bh(r){return mh(r)?gh(r,!0):yh(r)}var ee=bh,_h=Z,wh=ee;function vh(r){return _h(r,wh(r))}var $h=vh,bn=en,Ch=rn,Th=on,Oh=Mt,Ah=cn,_n=Se,wn=A,Eh=Jl,Sh=fe,Ih=Ve,xh=j,Ph=Ie,Nh=pe,vn=yn,jh=$h;function Bh(r,e,t,n,i,s,o){var a=vn(r,t),u=vn(e,t),c=o.get(u);if(c){bn(r,t,c);return}var l=s?s(a,u,t+"",r,e,o):void 0,h=l===void 0;if(h){var d=wn(u),_=!d&&Sh(u),m=!d&&!_&&Nh(u);l=u,d||_||m?wn(a)?l=a:Eh(a)?l=Oh(a):_?(h=!1,l=Ch(u,!0)):m?(h=!1,l=Th(u,!0)):l=[]:Ph(u)||_n(u)?(l=a,_n(a)?l=jh(a):(!xh(a)||Ih(a))&&(l=Ah(u))):h=!1}h&&(o.set(u,l),i(l,u,n,s,o),o.delete(u)),bn(r,t,l)}var qh=Bh,Rh=ze,kh=en,Mh=tn,Lh=qh,Fh=j,Hh=ee,Qh=yn;function $n(r,e,t,n,i){r!==e&&Mh(e,function(s,o){if(i||(i=new Rh),Fh(s))Lh(r,e,o,t,$n,n,i);else{var a=n?n(Qh(r,o),s,o+"",r,e,i):void 0;a===void 0&&(a=s),kh(r,o,a)}},Hh)}var Wh=$n;function Dh(r){return r}var it=Dh;function Uh(r,e,t){switch(t.length){case 0:return r.call(e);case 1:return r.call(e,t[0]);case 2:return r.call(e,t[0],t[1]);case 3:return r.call(e,t[0],t[1],t[2])}return r.apply(e,t)}var Jh=Uh,Vh=Jh,Cn=Math.max;function Gh(r,e,t){return e=Cn(e===void 0?r.length-1:e,0),function(){for(var n=arguments,i=-1,s=Cn(n.length-e,0),o=Array(s);++i<s;)o[i]=n[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=n[i];return a[e]=t(o),Vh(r,this,a)}}var Kh=Gh;function zh(r){return function(){return r}}var Yh=zh,Xh=Yh,Tn=Xr,Zh=it,ed=Tn?function(r,e){return Tn(r,"toString",{configurable:!0,enumerable:!1,value:Xh(e),writable:!0})}:Zh,td=ed,rd=800,nd=16,id=Date.now;function sd(r){var e=0,t=0;return function(){var n=id(),i=nd-(n-t);if(t=n,i>0){if(++e>=rd)return arguments[0]}else e=0;return r.apply(void 0,arguments)}}var od=sd,ad=td,ud=od,ld=ud(ad),cd=ld,hd=it,dd=Kh,fd=cd;function pd(r,e){return fd(dd(r,e,hd),r+"")}var On=pd,gd=ue,yd=F,md=nt,bd=j;function _d(r,e,t){if(!bd(t))return!1;var n=typeof e;return(n=="number"?yd(t)&&md(e,t.length):n=="string"&&e in t)?gd(t[e],r):!1}var Qt=_d,wd=On,vd=Qt;function $d(r){return wd(function(e,t){var n=-1,i=t.length,s=i>1?t[i-1]:void 0,o=i>2?t[2]:void 0;for(s=r.length>3&&typeof s=="function"?(i--,s):void 0,o&&vd(t[0],t[1],o)&&(s=i<3?void 0:s,i=1),e=Object(e);++n<i;){var a=t[n];a&&r(e,a,n,s)}return e})}var Wt=$d,Cd=Wh,Td=Wt,Od=Td(function(r,e,t){Cd(r,e,t)}),Ad=Od;function Ed(r,e,t){var n=-1,i=r.length;e<0&&(e=-e>i?0:i+e),t=t>i?i:t,t<0&&(t+=i),i=e>t?0:t-e>>>0,e>>>=0;for(var s=Array(i);++n<i;)s[n]=r[n+e];return s}var An=Ed,Sd=/\s/;function Id(r){for(var e=r.length;e--&&Sd.test(r.charAt(e)););return e}var xd=Id,Pd=xd,Nd=/^\s+/;function jd(r){return r&&r.slice(0,Pd(r)+1).replace(Nd,"")}var Bd=jd,qd=Bd,En=j,Rd=De,Sn=0/0,kd=/^[-+]0x[0-9a-f]+$/i,Md=/^0b[01]+$/i,Ld=/^0o[0-7]+$/i,Fd=parseInt;function Hd(r){if(typeof r=="number")return r;if(Rd(r))return Sn;if(En(r)){var e=typeof r.valueOf=="function"?r.valueOf():r;r=En(e)?e+"":e}if(typeof r!="string")return r===0?r:+r;r=qd(r);var t=Md.test(r);return t||Ld.test(r)?Fd(r.slice(2),t?2:8):kd.test(r)?Sn:+r}var Qd=Hd,Wd=Qd,In=1/0,Dd=17976931348623157e292;function Ud(r){if(!r)return r===0?r:0;if(r=Wd(r),r===In||r===-In){var e=r<0?-1:1;return e*Dd}return r===r?r:0}var Jd=Ud,Vd=Jd;function Gd(r){var e=Vd(r),t=e%1;return e===e?t?e-t:e:0}var xn=Gd,Kd=An,zd=Qt,Yd=xn,Xd=Math.ceil,Zd=Math.max;function ef(r,e,t){(t?zd(r,e,t):e===void 0)?e=1:e=Zd(Yd(e),0);var n=r==null?0:r.length;if(!n||e<1)return[];for(var i=0,s=0,o=Array(Xd(n/e));i<n;)o[s++]=Kd(r,i,i+=e);return o}var tf=ef;function rf(r,e){for(var t=-1,n=e.length,i=r.length;++t<n;)r[i+t]=e[t];return r}var Dt=rf,Pn=z,nf=Se,sf=A,Nn=Pn?Pn.isConcatSpreadable:void 0;function of(r){return sf(r)||nf(r)||!!(Nn&&r&&r[Nn])}var af=of,uf=Dt,lf=af;function jn(r,e,t,n,i){var s=-1,o=r.length;for(t||(t=lf),i||(i=[]);++s<o;){var a=r[s];e>0&&t(a)?e>1?jn(a,e-1,t,n,i):uf(i,a):n||(i[i.length]=a)}return i}var cf=jn,hf=cf;function df(r){var e=r==null?0:r.length;return e?hf(r,1):[]}var ff=df,pf=r=>new Promise(e=>setTimeout(e,r));function gf(r){return typeof r=="string"}function yf(r){return typeof r=="number"}function mf(r){return typeof r=="boolean"}function bf(r){return typeof r>"u"}function _f(r){return typeof r=="object"&&r!==null}function wf(r){return typeof r=="function"}var q={isString:gf,isNumber:yf,isBoolean:mf,isUndefined:bf,isObject:_f,isFunction:wf};const vf=tf,$f=ff,Cf=pf,{isNumber:Tf}=q;function Of(r,e,t,n=1e3){let i,s=null;if(!Tf(n)||n<1)throw new TypeError(`Invalid chunkSize: ${n}`);if(!Array.isArray(t))throw new TypeError(`Invalid batch: Expected array, got ${typeof t}`);const o=vf(t,n),a=u=>s?u(s):r.transaction(u);return Object.assign(Promise.resolve().then(async()=>(await Cf(1),a(async u=>{const c=[];for(const l of o)c.push(await u(e).insert(l,i));return $f(c)}))),{returning(u){return i=u,this},transacting(u){return s=u,this}})}var Af=Of;const{EventEmitter:Ef}=E,{Migrator:Sf}=jt,If=jt,xf=So,Bn=Io,Pf=Ad,Nf=Af,{isObject:jf}=q,qn={client:{get(){return this.context.client},set(r){this.context.client=r},configurable:!0},userParams:{get(){return this.context.userParams},set(r){this.context.userParams=r},configurable:!0},schema:{get(){return this.client.schemaBuilder()},configurable:!0},migrate:{get(){return new Sf(this)},configurable:!0},seed:{get(){return new If},configurable:!0},fn:{get(){return new xf(this.client)},configurable:!0}},Bf=["raw","batchInsert","transaction","transactionProvider","initialize","destroy","ref","withUserParams","queryBuilder","disableProcessing","enableProcessing"];for(const r of Bf)qn[r]={value:function(...e){return this.context[r](...e)},configurable:!0};function qf(r){function e(t,n){return kn(e.context,t,n)}return Rn(e,r),e}function Rf(r){const e=r.context||{};Object.assign(e,{queryBuilder(){return this.client.queryBuilder()},raw(){return this.client.raw.apply(this.client,arguments)},batchInsert(t,n,i=1e3){return Nf(this,t,n,i)},transaction(t,n){!n&&jf(t)&&(n=t,t=null);const i=Object.assign({},n);return i.userParams=this.userParams||{},i.doNotRejectOnRollback===void 0&&(i.doNotRejectOnRollback=!0),this._transaction(t,i)},_transaction(t,n,i=null){return t?this.client.transaction(t,n,i):new Promise((s,o)=>{this.client.transaction(s,n,i).catch(o)})},transactionProvider(t){let n;return()=>(n||(n=this.transaction(void 0,t)),n)},initialize(t){return this.client.initializePool(t)},destroy(t){return this.client.destroy(t)},ref(t){return this.client.ref(t)},disableProcessing(){this.userParams.isProcessingDisabled||(this.userParams.wrapIdentifier=this.client.config.wrapIdentifier,this.userParams.postProcessResponse=this.client.config.postProcessResponse,this.client.config.wrapIdentifier=null,this.client.config.postProcessResponse=null,this.userParams.isProcessingDisabled=!0)},enableProcessing(){this.userParams.isProcessingDisabled&&(this.client.config.wrapIdentifier=this.userParams.wrapIdentifier,this.client.config.postProcessResponse=this.userParams.postProcessResponse,this.userParams.isProcessingDisabled=!1)},withUserParams(t){const n=kf(r);return this.client&&(n.client=Object.create(this.client.constructor.prototype),Pf(n.client,this.client),n.client.config=Object.assign({},this.client.config)),Rn(n,n.client),st("query",r,n),st("query-error",r,n),st("query-response",r,n),st("start",r,n),n.userParams=t,n}}),r.context||(r.context=e)}function st(r,e,t){e.listeners(r).forEach(i=>{t.on(r,i)})}function Rn(r,e){for(let n=0;n<Bn.length;n++){const i=Bn[n];r[i]=function(){const s=this.queryBuilder();return s[i].apply(s,arguments)}}Object.defineProperties(r,qn),Rf(r),r.client=e,r.userParams={};const t=new Ef;for(const n in t)r[n]=t[n];r._internalListeners&&r._internalListeners.forEach(({eventName:n,listener:i})=>{r.client.removeListener(n,i)}),r._internalListeners=[],ot(r,"start",n=>{r.emit("start",n)}),ot(r,"query",n=>{r.emit("query",n)}),ot(r,"query-error",(n,i)=>{r.emit("query-error",n,i)}),ot(r,"query-response",(n,i,s)=>{r.emit("query-response",n,i,s)})}function ot(r,e,t){r.client.on(e,t),r._internalListeners.push({eventName:e,listener:t})}function kn(r,e,t){const n=r.queryBuilder();return e||r.client.logger.warn("calling knex without a tableName is deprecated. Use knex.queryBuilder() instead."),e?n.table(e,t):n}function kf(r){const e=Object.create(Object.getPrototypeOf(r),Object.getOwnPropertyDescriptors(r)),t={},i=((s,o)=>kn(t,s,o)).bind(e);return Object.assign(i,r),i.context=t,i}var Mf=qf,ge={};let Mn=class extends Error{constructor(e){super(e),this.name="KnexTimeoutError"}};function Lf(r,e){return new Promise(function(t,n){const i=setTimeout(function(){n(new Mn("operation timed out"))},e);function s(a){clearTimeout(i),t(a)}function o(a){clearTimeout(i),n(a)}r.then(s,o)})}ge.KnexTimeoutError=Mn,ge.timeout=Lf;const Ff=jt,Hf=r=>Object.assign(r,{finally(e){return this.then().finally(e)}});var Ln=Promise.prototype.finally?Hf:Ff;const{EventEmitter:Qf}=E,Wf=ae,Df=Vr,{callbackify:Uf}=E,Jf=Mf,{timeout:Fn,KnexTimeoutError:Hn}=ge,Vf=Ln,xe=Wf("knex:tx");function Gf(){return{userParams:{},doNotRejectOnRollback:!0}}const Qn=["read uncommitted","read committed","snapshot","repeatable read","serializable"];let Wn=class extends Qf{constructor(e,t,n=Gf(),i=null){super(),this.userParams=n.userParams,this.doNotRejectOnRollback=n.doNotRejectOnRollback;const s=this.txid=Df("trx");this.client=e,this.logger=e.logger,this.outerTx=i,this.trxClient=void 0,this._completed=!1,this._debug=e.config&&e.config.debug,n.isolationLevel&&this.setIsolationLevel(n.isolationLevel),xe("%s: Starting %s transaction",s,i?"nested":"top level"),this._lastChild=Promise.resolve();const a=(i?i._lastChild:Promise.resolve()).then(()=>this._evaluateContainer(n,t));this._promise=a.then(u=>u),i&&(i._lastChild=a.catch(()=>{}))}isCompleted(){return this._completed||this.outerTx&&this.outerTx.isCompleted()||!1}begin(e){return(this.isolationLevel?this.query(e,`SET TRANSACTION ISOLATION LEVEL ${this.isolationLevel};`):Promise.resolve()).then(()=>this.query(e,"BEGIN;"))}savepoint(e){return this.query(e,`SAVEPOINT ${this.txid};`)}commit(e,t){return this.query(e,"COMMIT;",1,t)}release(e,t){return this.query(e,`RELEASE SAVEPOINT ${this.txid};`,1,t)}setIsolationLevel(e){if(!Qn.includes(e))throw new Error(`Invalid isolationLevel, supported isolation levels are: ${JSON.stringify(Qn)}`);return this.isolationLevel=e,this}rollback(e,t){return Fn(this.query(e,"ROLLBACK",2,t),5e3).catch(n=>{if(!(n instanceof Hn))return Promise.reject(n);this._rejecter(t)})}rollbackTo(e,t){return Fn(this.query(e,`ROLLBACK TO SAVEPOINT ${this.txid}`,2,t),5e3).catch(n=>{if(!(n instanceof Hn))return Promise.reject(n);this._rejecter(t)})}query(e,t,n,i){const s=this.trxClient.query(e,t).catch(o=>{n=2,i=o,this._completed=!0,xe("%s error running transaction query",this.txid)}).then(o=>{if(n===1&&this._resolver(i),n===2){if(i===void 0){if(this.doNotRejectOnRollback&&/^ROLLBACK\b/i.test(t)){this._resolver();return}i=new Error(`Transaction rejected with non-error: ${i}`)}this._rejecter(i)}return o});return(n===1||n===2)&&(this._completed=!0),s}debug(e){return this._debug=arguments.length?e:!0,this}async _evaluateContainer(e,t){return this.acquireConnection(e,n=>{const i=this.trxClient=zf(this,this.client,n),s=this.client.transacting?this.savepoint(n):this.begin(n),o=new Promise((a,u)=>{this._resolver=a,this._rejecter=u});return s.then(()=>Kf(this,n,i)).then(a=>{a.executionPromise=o;let u;try{u=t(a)}catch(c){u=Promise.reject(c)}return u&&u.then&&typeof u.then=="function"&&u.then(c=>a.commit(c)).catch(c=>a.rollback(c)),null}).catch(a=>this._rejecter(a)),o})}async acquireConnection(e,t){const n=e&&e.connection,i=n||await this.client.acquireConnection();try{return i.__knexTxId=this.txid,await t(i)}finally{n?xe("%s: not releasing external connection",this.txid):(xe("%s: releasing connection",this.txid),this.client.releaseConnection(i))}}then(e,t){return this._promise.then(e,t)}catch(...e){return this._promise.catch(...e)}asCallback(e){return Uf(()=>this._promise)(e),this._promise}};Vf(Wn.prototype);function Kf(r,e,t){const n=Jf(t);return n.context.withUserParams=()=>{throw new Error("Cannot set user params on a transaction - it can only inherit params from main knex instance")},n.isTransaction=!0,n.userParams=r.userParams||{},n.context.transaction=function(i,s){return s?s.doNotRejectOnRollback===void 0&&(s.doNotRejectOnRollback=!0):s={doNotRejectOnRollback:!0},this._transaction(i,s,r)},n.savepoint=function(i,s){return n.transaction(i,s)},r.client.transacting?(n.commit=i=>r.release(e,i),n.rollback=i=>r.rollbackTo(e,i)):(n.commit=i=>r.commit(e,i),n.rollback=i=>r.rollback(e,i)),n.isCompleted=()=>r.isCompleted(),n}function zf(r,e,t){const n=Object.create(e.constructor.prototype);n.version=e.version,n.config=e.config,n.driver=e.driver,n.connectionSettings=e.connectionSettings,n.transacting=!0,n.valueForUndefined=e.valueForUndefined,n.logger=e.logger,n.on("start",function(o){r.emit("start",o),e.emit("start",o)}),n.on("query",function(o){r.emit("query",o),e.emit("query",o)}),n.on("query-error",function(o,a){r.emit("query-error",o,a),e.emit("query-error",o,a)}),n.on("query-response",function(o,a,u){r.emit("query-response",o,a,u),e.emit("query-response",o,a,u)});const i=n.query;n.query=function(o,a){const u=r.isCompleted();return new Promise(function(c,l){try{if(o!==t)throw new Error("Invalid connection for transaction query.");u&&Dn(r,a),c(i.call(n,o,a))}catch(h){l(h)}})};const s=n.stream;return n.stream=function(o,a,u,c){const l=r.isCompleted();return new Promise(function(h,d){try{if(o!==t)throw new Error("Invalid connection for transaction query.");l&&Dn(r,a),h(s.call(n,o,a,u,c))}catch(_){d(_)}})},n.acquireConnection=function(){return Promise.resolve(t)},n.releaseConnection=function(){return Promise.resolve()},n}function Dn(r,e){const t=typeof e=="string"?e:e&&e.sql;throw xe("%s: Transaction completed: %s",r.txid,t),new Error("Transaction query already complete, run with DEBUG=knex:tx for more info")}var Un=Wn;const Yf=P(Un);class Xf extends Yf{}var Ut={exports:{}},Jt={},Vt={},at={};Object.defineProperty(at,"__esModule",{value:!0});let Zf=class extends Error{};at.TimeoutError=Zf;var B={},Gt={};Object.defineProperty(Gt,"__esModule",{value:!0});class ep{constructor(e){this._value=e.value,this._error=e.error}value(){return this._value}reason(){return this._error}isRejected(){return!!this._error}isFulfilled(){return!!this._value}}Gt.PromiseInspection=ep,Object.defineProperty(B,"__esModule",{value:!0});const Jn=Gt;function tp(){let r=null,e=null;return{promise:new Promise((n,i)=>{r=n,e=i}),resolve:r,reject:e}}B.defer=tp;function rp(){return Date.now()}B.now=rp;function np(r,e){return Math.abs(e-r)}B.duration=np;function ip(r){return typeof r>"u"?!0:Vn(r)}B.checkOptionalTime=ip;function Vn(r){return typeof r=="number"&&r===Math.round(r)&&r>0}B.checkRequiredTime=Vn;function sp(r){return new Promise(e=>setTimeout(e,r))}B.delay=sp;function op(r){return r.then(e=>new Jn.PromiseInspection({value:e})).catch(e=>new Jn.PromiseInspection({error:e}))}B.reflect=op;function ap(r){try{const e=r();return Promise.resolve(e)}catch(e){return Promise.reject(e)}}B.tryPromise=ap,Object.defineProperty(Vt,"__esModule",{value:!0});const ut=at,up=B;class lp{constructor(e){this.timeoutMillis=e,this.deferred=up.defer(),this.possibleTimeoutCause=null,this.isRejected=!1,this.promise=cp(this.deferred.promise,e).catch(t=>(t instanceof ut.TimeoutError&&(this.possibleTimeoutCause?t=new ut.TimeoutError(this.possibleTimeoutCause.message):t=new ut.TimeoutError("operation timed out for an unknown reason")),this.isRejected=!0,Promise.reject(t)))}abort(){this.reject(new Error("aborted"))}reject(e){this.deferred.reject(e)}resolve(e){this.deferred.resolve(e)}}Vt.PendingOperation=lp;function cp(r,e){return new Promise((t,n)=>{const i=setTimeout(()=>n(new ut.TimeoutError),e);r.then(s=>{clearTimeout(i),t(s)}).catch(s=>{clearTimeout(i),n(s)})})}var Kt={};Object.defineProperty(Kt,"__esModule",{value:!0});const Gn=B;class zt{constructor(e){this.resource=e,this.resource=e,this.timestamp=Gn.now(),this.deferred=Gn.defer()}get promise(){return this.deferred.promise}resolve(){return this.deferred.resolve(void 0),new zt(this.resource)}}Kt.Resource=zt,Object.defineProperty(Jt,"__esModule",{value:!0});const lt=Vt,hp=Kt,I=B,dp=E,Kn=E;let fp=class{constructor(e){if(this.destroyed=!1,this.emitter=new dp.EventEmitter,e=e||{},!e.create)throw new Error("Tarn: opt.create function most be provided");if(!e.destroy)throw new Error("Tarn: opt.destroy function most be provided");if(typeof e.min!="number"||e.min<0||e.min!==Math.round(e.min))throw new Error("Tarn: opt.min must be an integer >= 0");if(typeof e.max!="number"||e.max<=0||e.max!==Math.round(e.max))throw new Error("Tarn: opt.max must be an integer > 0");if(e.min>e.max)throw new Error("Tarn: opt.max is smaller than opt.min");if(!I.checkOptionalTime(e.acquireTimeoutMillis))throw new Error("Tarn: invalid opt.acquireTimeoutMillis "+JSON.stringify(e.acquireTimeoutMillis));if(!I.checkOptionalTime(e.createTimeoutMillis))throw new Error("Tarn: invalid opt.createTimeoutMillis "+JSON.stringify(e.createTimeoutMillis));if(!I.checkOptionalTime(e.destroyTimeoutMillis))throw new Error("Tarn: invalid opt.destroyTimeoutMillis "+JSON.stringify(e.destroyTimeoutMillis));if(!I.checkOptionalTime(e.idleTimeoutMillis))throw new Error("Tarn: invalid opt.idleTimeoutMillis "+JSON.stringify(e.idleTimeoutMillis));if(!I.checkOptionalTime(e.reapIntervalMillis))throw new Error("Tarn: invalid opt.reapIntervalMillis "+JSON.stringify(e.reapIntervalMillis));if(!I.checkOptionalTime(e.createRetryIntervalMillis))throw new Error("Tarn: invalid opt.createRetryIntervalMillis "+JSON.stringify(e.createRetryIntervalMillis));const t={create:!0,validate:!0,destroy:!0,log:!0,min:!0,max:!0,acquireTimeoutMillis:!0,createTimeoutMillis:!0,destroyTimeoutMillis:!0,idleTimeoutMillis:!0,reapIntervalMillis:!0,createRetryIntervalMillis:!0,propagateCreateError:!0};for(const n of Object.keys(e))if(!t[n])throw new Error(`Tarn: unsupported option opt.${n}`);this.creator=e.create,this.destroyer=e.destroy,this.validate=typeof e.validate=="function"?e.validate:()=>!0,this.log=e.log||(()=>{}),this.acquireTimeoutMillis=e.acquireTimeoutMillis||3e4,this.createTimeoutMillis=e.createTimeoutMillis||3e4,this.destroyTimeoutMillis=e.destroyTimeoutMillis||5e3,this.idleTimeoutMillis=e.idleTimeoutMillis||3e4,this.reapIntervalMillis=e.reapIntervalMillis||1e3,this.createRetryIntervalMillis=e.createRetryIntervalMillis||200,this.propagateCreateError=!!e.propagateCreateError,this.min=e.min,this.max=e.max,this.used=[],this.free=[],this.pendingCreates=[],this.pendingAcquires=[],this.pendingDestroys=[],this.pendingValidations=[],this.destroyed=!1,this.interval=null,this.eventId=1}numUsed(){return this.used.length}numFree(){return this.free.length}numPendingAcquires(){return this.pendingAcquires.length}numPendingValidations(){return this.pendingValidations.length}numPendingCreates(){return this.pendingCreates.length}acquire(){const e=this.eventId++;this._executeEventHandlers("acquireRequest",e);const t=new lt.PendingOperation(this.acquireTimeoutMillis);return this.pendingAcquires.push(t),t.promise=t.promise.then(n=>(this._executeEventHandlers("acquireSuccess",e,n),n)).catch(n=>(this._executeEventHandlers("acquireFail",e,n),ye(this.pendingAcquires,t),Promise.reject(n))),this._tryAcquireOrCreate(),t}release(e){this._executeEventHandlers("release",e);for(let t=0,n=this.used.length;t<n;++t){const i=this.used[t];if(i.resource===e)return this.used.splice(t,1),this.free.push(i.resolve()),this._tryAcquireOrCreate(),!0}return!1}isEmpty(){return[this.numFree(),this.numUsed(),this.numPendingAcquires(),this.numPendingValidations(),this.numPendingCreates()].reduce((e,t)=>e+t)===0}check(){const e=I.now(),t=[],n=this.min-this.used.length,i=this.free.length-n;let s=0;this.free.forEach(o=>{I.duration(e,o.timestamp)>=this.idleTimeoutMillis&&s<i?(s++,this._destroy(o.resource)):t.push(o)}),this.free=t,this.isEmpty()&&this._stopReaping()}destroy(){const e=this.eventId++;return this._executeEventHandlers("poolDestroyRequest",e),this._stopReaping(),this.destroyed=!0,I.reflect(Promise.all(this.pendingCreates.map(t=>I.reflect(t.promise))).then(()=>new Promise((t,n)=>{if(this.numPendingValidations()===0){t();return}const i=setInterval(()=>{this.numPendingValidations()===0&&(Kn.clearInterval(i),t())},100)})).then(()=>Promise.all(this.used.map(t=>I.reflect(t.promise)))).then(()=>Promise.all(this.pendingAcquires.map(t=>(t.abort(),I.reflect(t.promise))))).then(()=>Promise.all(this.free.map(t=>I.reflect(this._destroy(t.resource))))).then(()=>Promise.all(this.pendingDestroys.map(t=>t.promise))).then(()=>{this.free=[],this.pendingAcquires=[]})).then(t=>(this._executeEventHandlers("poolDestroySuccess",e),this.emitter.removeAllListeners(),t))}on(e,t){this.emitter.on(e,t)}removeListener(e,t){this.emitter.removeListener(e,t)}removeAllListeners(e){this.emitter.removeAllListeners(e)}_tryAcquireOrCreate(){this.destroyed||(this._hasFreeResources()?this._doAcquire():this._shouldCreateMoreResources()&&this._doCreate())}_hasFreeResources(){return this.free.length>0}_doAcquire(){for(;this._canAcquire();){const e=this.pendingAcquires.shift(),t=this.free.pop();if(t===void 0||e===void 0){const i="this.free was empty while trying to acquire resource";throw this.log(`Tarn: ${i}`,"warn"),new Error(`Internal error, should never happen. ${i}`)}this.pendingValidations.push(e),this.used.push(t);const n=new lt.PendingOperation(this.acquireTimeoutMillis);e.promise.catch(i=>{n.abort()}),n.promise.catch(i=>(this.log("Tarn: resource validator threw an exception "+i.stack,"warn"),!1)).then(i=>{try{i&&!e.isRejected?(this._startReaping(),e.resolve(t.resource)):(ye(this.used,t),i?this.free.push(t):(this._destroy(t.resource),setTimeout(()=>{this._tryAcquireOrCreate()},0)),e.isRejected||this.pendingAcquires.unshift(e))}finally{ye(this.pendingValidations,e)}}),this._validateResource(t.resource).then(i=>{n.resolve(i)}).catch(i=>{n.reject(i)})}}_canAcquire(){return this.free.length>0&&this.pendingAcquires.length>0}_validateResource(e){try{return Promise.resolve(this.validate(e))}catch(t){return Promise.reject(t)}}_shouldCreateMoreResources(){return this.used.length+this.pendingCreates.length<this.max&&this.pendingCreates.length<this.pendingAcquires.length}_doCreate(){const e=this.pendingAcquires.slice();this._create().promise.then(()=>(this._tryAcquireOrCreate(),null)).catch(n=>{this.propagateCreateError&&this.pendingAcquires.length!==0&&this.pendingAcquires[0].reject(n),e.forEach(i=>{i.possibleTimeoutCause=n}),I.delay(this.createRetryIntervalMillis).then(()=>this._tryAcquireOrCreate())})}_create(){const e=this.eventId++;this._executeEventHandlers("createRequest",e);const t=new lt.PendingOperation(this.createTimeoutMillis);return t.promise=t.promise.catch(n=>{throw ye(this.pendingCreates,t)&&this._executeEventHandlers("createFail",e,n),n}),this.pendingCreates.push(t),pp(this.creator).then(n=>t.isRejected?(this.destroyer(n),null):(ye(this.pendingCreates,t),this.free.push(new hp.Resource(n)),t.resolve(n),this._executeEventHandlers("createSuccess",e,n),null)).catch(n=>(t.isRejected||(ye(this.pendingCreates,t)&&this._executeEventHandlers("createFail",e,n),t.reject(n)),null)),t}_destroy(e){const t=this.eventId++;this._executeEventHandlers("destroyRequest",t,e);const n=new lt.PendingOperation(this.destroyTimeoutMillis);return Promise.resolve().then(()=>this.destroyer(e)).then(()=>{n.resolve(e)}).catch(s=>{n.reject(s)}),this.pendingDestroys.push(n),n.promise.then(s=>(this._executeEventHandlers("destroySuccess",t,e),s)).catch(s=>this._logDestroyerError(t,e,s)).then(s=>{const o=this.pendingDestroys.findIndex(a=>a===n);return this.pendingDestroys.splice(o,1),s})}_logDestroyerError(e,t,n){this._executeEventHandlers("destroyFail",e,t,n),this.log("Tarn: resource destroyer threw an exception "+n.stack,"warn")}_startReaping(){this.interval||(this._executeEventHandlers("startReaping"),this.interval=setInterval(()=>this.check(),this.reapIntervalMillis))}_stopReaping(){this.interval!==null&&(this._executeEventHandlers("stopReaping"),Kn.clearInterval(this.interval)),this.interval=null}_executeEventHandlers(e,...t){this.emitter.listeners(e).forEach(i=>{try{i(...t)}catch(s){this.log(`Tarn: event handler "${e}" threw an exception ${s.stack}`,"warn")}})}};Jt.Pool=fp;function ye(r,e){const t=r.indexOf(e);return t===-1?!1:(r.splice(t,1),!0)}function pp(r){return new Promise((e,t)=>{const n=(i,s)=>{i?t(i):e(s)};I.tryPromise(()=>r(n)).then(i=>{i&&e(i)}).catch(i=>{t(i)})})}(function(r,e){Object.defineProperty(e,"__esModule",{value:!0});const t=Jt;e.Pool=t.Pool;const n=at;e.TimeoutError=n.TimeoutError,r.exports={Pool:t.Pool,TimeoutError:n.TimeoutError}})(Ut,Ut.exports);var gp=Ut.exports;const ct=/[\0\b\t\n\r\x1a"'\\]/g,zn={"\0":"\\0","\b":"\\b","	":"\\t","\n":"\\n","\r":"\\r","":"\\Z",'"':'\\"',"'":"\\'","\\":"\\\\"};function yp(r){return function e(t,n={}){return r(t,e,n)}}function mp(r={}){const e=r.escapeDate||Zn,t=r.escapeArray||Yt,n=r.escapeBuffer||Xn,i=r.escapeString||Xt,s=r.escapeObject||Yn,o=r.wrap||yp;function a(u,c,l){if(u==null)return"NULL";switch(typeof u){case"boolean":return u?"true":"false";case"number":return u+"";case"object":if(u instanceof Date)u=e(u,c,l);else return Array.isArray(u)?t(u,c,l):Buffer.isBuffer(u)?n(u,c,l):s(u,c,l)}return i(u,c,l)}return o?o(a):a}function Yn(r,e,t){return r&&typeof r.toSQL=="function"?r.toSQL(t):JSON.stringify(r)}function Yt(r,e,t){let n="";for(let i=0;i<r.length;i++){const s=r[i];Array.isArray(s)?n+=(i===0?"":", ")+"("+Yt(s,e,t)+")":n+=(i===0?"":", ")+e(s,t)}return n}function Xn(r){return"X"+Xt(r.toString("hex"))}function Xt(r,e,t){let n=ct.lastIndex=0,i="",s;for(;s=ct.exec(r);)i+=r.slice(n,s.index)+zn[s[0]],n=ct.lastIndex;return n===0?"'"+r+"'":n<r.length?"'"+i+r.slice(n)+"'":"'"+i+"'"}function Zn(r,e,t={}){const n=t.timeZone||"local",i=new Date(r);let s,o,a,u,c,l,h;if(n==="local")s=i.getFullYear(),o=i.getMonth()+1,a=i.getDate(),u=i.getHours(),c=i.getMinutes(),l=i.getSeconds(),h=i.getMilliseconds();else{const d=bp(n);d!==!1&&d!==0&&i.setTime(i.getTime()+d*6e4),s=i.getUTCFullYear(),o=i.getUTCMonth()+1,a=i.getUTCDate(),u=i.getUTCHours(),c=i.getUTCMinutes(),l=i.getUTCSeconds(),h=i.getUTCMilliseconds()}return te(s,4)+"-"+te(o,2)+"-"+te(a,2)+" "+te(u,2)+":"+te(c,2)+":"+te(l,2)+"."+te(h,3)}function te(r,e){for(r=r.toString();r.length<e;)r="0"+r;return r}function bp(r){if(r==="Z")return 0;const e=r.match(/([+\-\s])(\d\d):?(\d\d)?/);return e?(e[1]=="-"?-1:1)*(parseInt(e[2],10)+(e[3]?parseInt(e[3],10):0)/60)*60:!1}var _p={arrayToList:Yt,bufferToString:Xn,dateToString:Zn,escapeString:Xt,charsRegex:ct,charsMap:zn,escapeObject:Yn,makeEscape:mp};function wp(r,e){for(var t=-1,n=r==null?0:r.length;++t<n&&e(r[t],t,r)!==!1;);return r}var Zt=wp,vp=ln,$p=vp(Object.keys,Object),Cp=$p,Tp=Ee,Op=Cp,Ap=Object.prototype,Ep=Ap.hasOwnProperty;function Sp(r){if(!Tp(r))return Op(r);var e=[];for(var t in Object(r))Ep.call(r,t)&&t!="constructor"&&e.push(t);return e}var ei=Sp,Ip=mn,xp=ei,Pp=F;function Np(r){return Pp(r)?Ip(r):xp(r)}var re=Np,jp=Z,Bp=re;function qp(r,e){return r&&jp(e,Bp(e),r)}var Rp=qp,kp=Z,Mp=ee;function Lp(r,e){return r&&kp(e,Mp(e),r)}var Fp=Lp;function Hp(r,e){for(var t=-1,n=r==null?0:r.length,i=0,s=[];++t<n;){var o=r[t];e(o,t,r)&&(s[i++]=o)}return s}var ti=Hp;function Qp(){return[]}var ri=Qp,Wp=ti,Dp=ri,Up=Object.prototype,Jp=Up.propertyIsEnumerable,ni=Object.getOwnPropertySymbols,Vp=ni?function(r){return r==null?[]:(r=Object(r),Wp(ni(r),function(e){return Jp.call(r,e)}))}:Dp,er=Vp,Gp=Z,Kp=er;function zp(r,e){return Gp(r,Kp(r),e)}var Yp=zp,Xp=Dt,Zp=Ze,eg=er,tg=ri,rg=Object.getOwnPropertySymbols,ng=rg?function(r){for(var e=[];r;)Xp(e,eg(r)),r=Zp(r);return e}:tg,ii=ng,ig=Z,sg=ii;function og(r,e){return ig(r,sg(r),e)}var ag=og,ug=Dt,lg=A;function cg(r,e,t){var n=e(r);return lg(r)?n:ug(n,t(r))}var si=cg,hg=si,dg=er,fg=re;function pg(r){return hg(r,fg,dg)}var oi=pg,gg=si,yg=ii,mg=ee;function bg(r){return gg(r,mg,yg)}var ai=bg,_g=X,wg=R,vg=_g(wg,"DataView"),$g=vg,Cg=X,Tg=R,Og=Cg(Tg,"Promise"),Ag=Og,Eg=X,Sg=R,Ig=Eg(Sg,"Set"),xg=Ig,Pg=X,Ng=R,jg=Pg(Ng,"WeakMap"),Bg=jg,tr=$g,rr=qt,nr=Ag,ir=xg,sr=Bg,ui=Y,me=Kr,li="[object Map]",qg="[object Object]",ci="[object Promise]",hi="[object Set]",di="[object WeakMap]",fi="[object DataView]",Rg=me(tr),kg=me(rr),Mg=me(nr),Lg=me(ir),Fg=me(sr),ne=ui;(tr&&ne(new tr(new ArrayBuffer(1)))!=fi||rr&&ne(new rr)!=li||nr&&ne(nr.resolve())!=ci||ir&&ne(new ir)!=hi||sr&&ne(new sr)!=di)&&(ne=function(r){var e=ui(r),t=e==qg?r.constructor:void 0,n=t?me(t):"";if(n)switch(n){case Rg:return fi;case kg:return li;case Mg:return ci;case Lg:return hi;case Fg:return di}return e});var be=ne,Hg=Object.prototype,Qg=Hg.hasOwnProperty;function Wg(r){var e=r.length,t=new r.constructor(e);return e&&typeof r[0]=="string"&&Qg.call(r,"index")&&(t.index=r.index,t.input=r.input),t}var Dg=Wg,Ug=kt;function Jg(r,e){var t=e?Ug(r.buffer):r.buffer;return new r.constructor(t,r.byteOffset,r.byteLength)}var Vg=Jg,Gg=/\w*$/;function Kg(r){var e=new r.constructor(r.source,Gg.exec(r));return e.lastIndex=r.lastIndex,e}var zg=Kg,pi=z,gi=pi?pi.prototype:void 0,yi=gi?gi.valueOf:void 0;function Yg(r){return yi?Object(yi.call(r)):{}}var Xg=Yg,Zg=kt,ey=Vg,ty=zg,ry=Xg,ny=on,iy="[object Boolean]",sy="[object Date]",oy="[object Map]",ay="[object Number]",uy="[object RegExp]",ly="[object Set]",cy="[object String]",hy="[object Symbol]",dy="[object ArrayBuffer]",fy="[object DataView]",py="[object Float32Array]",gy="[object Float64Array]",yy="[object Int8Array]",my="[object Int16Array]",by="[object Int32Array]",_y="[object Uint8Array]",wy="[object Uint8ClampedArray]",vy="[object Uint16Array]",$y="[object Uint32Array]";function Cy(r,e,t){var n=r.constructor;switch(e){case dy:return Zg(r);case iy:case sy:return new n(+r);case fy:return ey(r,t);case py:case gy:case yy:case my:case by:case _y:case wy:case vy:case $y:return ny(r,t);case oy:return new n;case ay:case cy:return new n(r);case uy:return ty(r);case ly:return new n;case hy:return ry(r)}}var Ty=Cy,Oy=be,Ay=k,Ey="[object Map]";function Sy(r){return Ay(r)&&Oy(r)==Ey}var Iy=Sy,xy=Iy,Py=Ft,mi=Ht,bi=mi&&mi.isMap,Ny=bi?Py(bi):xy,jy=Ny,By=be,qy=k,Ry="[object Set]";function ky(r){return qy(r)&&By(r)==Ry}var My=ky,Ly=My,Fy=Ft,_i=Ht,wi=_i&&_i.isSet,Hy=wi?Fy(wi):Ly,Qy=Hy,Wy=ze,Dy=Zt,Uy=rt,Jy=Rp,Vy=Fp,Gy=rn,Ky=Mt,zy=Yp,Yy=ag,Xy=oi,Zy=ai,em=be,tm=Dg,rm=Ty,nm=cn,im=A,sm=fe,om=jy,am=j,um=Qy,lm=re,cm=ee,hm=1,dm=2,fm=4,vi="[object Arguments]",pm="[object Array]",gm="[object Boolean]",ym="[object Date]",mm="[object Error]",$i="[object Function]",bm="[object GeneratorFunction]",_m="[object Map]",wm="[object Number]",Ci="[object Object]",vm="[object RegExp]",$m="[object Set]",Cm="[object String]",Tm="[object Symbol]",Om="[object WeakMap]",Am="[object ArrayBuffer]",Em="[object DataView]",Sm="[object Float32Array]",Im="[object Float64Array]",xm="[object Int8Array]",Pm="[object Int16Array]",Nm="[object Int32Array]",jm="[object Uint8Array]",Bm="[object Uint8ClampedArray]",qm="[object Uint16Array]",Rm="[object Uint32Array]",w={};w[vi]=w[pm]=w[Am]=w[Em]=w[gm]=w[ym]=w[Sm]=w[Im]=w[xm]=w[Pm]=w[Nm]=w[_m]=w[wm]=w[Ci]=w[vm]=w[$m]=w[Cm]=w[Tm]=w[jm]=w[Bm]=w[qm]=w[Rm]=!0,w[mm]=w[$i]=w[Om]=!1;function ht(r,e,t,n,i,s){var o,a=e&hm,u=e&dm,c=e&fm;if(t&&(o=i?t(r,n,i,s):t(r)),o!==void 0)return o;if(!am(r))return r;var l=im(r);if(l){if(o=tm(r),!a)return Ky(r,o)}else{var h=em(r),d=h==$i||h==bm;if(sm(r))return Gy(r,a);if(h==Ci||h==vi||d&&!i){if(o=u||d?{}:nm(r),!a)return u?Yy(r,Vy(o,r)):zy(r,Jy(o,r))}else{if(!w[h])return i?r:{};o=rm(r,h,a)}}s||(s=new Wy);var _=s.get(r);if(_)return _;s.set(r,o),um(r)?r.forEach(function(b){o.add(ht(b,e,t,b,r,s))}):om(r)&&r.forEach(function(b,$){o.set($,ht(b,e,t,$,r,s))});var m=c?u?Zy:Xy:u?cm:lm,y=l?void 0:m(r);return Dy(y||r,function(b,$){y&&($=b,b=r[$]),Uy(o,$,ht(b,e,t,$,r,s))}),o}var Ti=ht,km=Ti,Mm=1,Lm=4;function Fm(r){return km(r,Mm|Lm)}var Hm=Fm,Qm=On,Wm=ue,Dm=Qt,Um=ee,Oi=Object.prototype,Jm=Oi.hasOwnProperty,Vm=Qm(function(r,e){r=Object(r);var t=-1,n=e.length,i=n>2?e[2]:void 0;for(i&&Dm(e[0],e[1],i)&&(n=1);++t<n;)for(var s=e[t],o=Um(s),a=-1,u=o.length;++a<u;){var c=o[a],l=r[c];(l===void 0||Wm(l,Oi[c])&&!Jm.call(r,c))&&(r[c]=s[c])}return r}),Gm=Vm;function Km(r){r.client.emit("start",r.builder),r.builder.emit("start",r.builder);const e=r.builder.toSQL();return r.builder._debug&&r.client.logger.debug(e),Array.isArray(e)?r.queryArray(e):r.query(e)}function zm(r,e){try{const t=r.builder.toSQL();if(Array.isArray(t)&&e.hasHandler)throw new Error("The stream may only be used with a single query statement.");return r.client.stream(r.connection,t,e.stream,e.options)}catch(t){throw e.stream.emit("error",t),t}}var Ym={ensureConnectionCallback:Km,ensureConnectionStreamCallback:zm};const{KnexTimeoutError:Ai}=ge,{timeout:Xm}=ge,{ensureConnectionCallback:Zm,ensureConnectionStreamCallback:eb}=Ym;let or;var tb=class Hs{constructor(e,t){this.client=e,this.builder=t,this.queries=[],this.connection=void 0}async run(){const e=this;try{const t=await this.ensureConnection(Zm);return e.builder.emit("end"),t}catch(t){throw e.builder._events&&e.builder._events.error&&e.builder.emit("error",t),t}}stream(e,t){const n=typeof e=="function"&&arguments.length===1,i=n?{}:e,s=n?e:t,o=typeof s=="function";or=or||E.Transform;const a=this.builder.queryContext(),u=new or({objectMode:!0,transform:(l,h,d)=>{d(null,this.client.postProcessResponse(l,a))}});u.on("close",()=>{this.client.releaseConnection(this.connection)});const c=this.ensureConnection(eb,{options:i,hasHandler:o,stream:u}).catch(l=>{this.connection||u.emit("error",l)});return o?(s(u),c):u}pipe(e,t){return this.stream(t).pipe(e)}async query(e){const{__knexUid:t,__knexTxId:n}=this.connection;this.builder.emit("query",Object.assign({__knexUid:t,__knexTxId:n},e));const i=this,s=this.builder.queryContext();e!==null&&typeof e=="object"&&(e.queryContext=s);let o=this.client.query(this.connection,e);return e.timeout&&(o=Xm(o,e.timeout)),o.then(a=>this.client.processResponse(a,i)).then(a=>{const u=this.client.postProcessResponse(a,s);return this.builder.emit("query-response",u,Object.assign({__knexUid:t,__knexTxId:n},e),this.builder),this.client.emit("query-response",u,Object.assign({__knexUid:t,__knexTxId:n},e),this.builder),u}).catch(a=>{if(!(a instanceof Ai))return Promise.reject(a);const{timeout:u,sql:c,bindings:l}=e;let h;return e.cancelOnTimeout?h=this.client.cancelQuery(this.connection):(this.connection.__knex__disposed=a,h=Promise.resolve()),h.catch(d=>{throw this.connection.__knex__disposed=a,Object.assign(d,{message:`After query timeout of ${u}ms exceeded, cancelling of query failed.`,sql:c,bindings:l,timeout:u})}).then(()=>{throw Object.assign(a,{message:`Defined query timeout of ${u}ms exceeded when running query.`,sql:c,bindings:l,timeout:u})})}).catch(a=>{throw this.builder.emit("query-error",a,Object.assign({__knexUid:t,__knexTxId:n,queryContext:s},e)),a})}async queryArray(e){if(e.length===1){const n=e[0];if(!n.statementsProducer)return this.query(n);const i=await n.statementsProducer(void 0,this.connection),s=i.sql.map(c=>({sql:c,bindings:n.bindings})),o=i.pre.map(c=>({sql:c,bindings:n.bindings})),a=i.post.map(c=>({sql:c,bindings:n.bindings}));let u=[];await this.queryArray(o);try{await this.client.transaction(async c=>{const l=new Hs(c.client,this.builder);if(l.connection=this.connection,u=await l.queryArray(s),i.check&&(await c.raw(i.check)).length>0)throw new Error("FOREIGN KEY constraint failed")},{connection:this.connection})}finally{await this.queryArray(a)}return u}const t=[];for(const n of e)t.push(await this.queryArray([n]));return t}async ensureConnection(e,t){if(this.builder._connection&&(this.connection=this.builder._connection),this.connection)return e(this,t);let n;try{n=await this.client.acquireConnection()}catch(i){if(!(i instanceof Ai))return Promise.reject(i);throw this.builder&&(i.sql=this.builder.sql,i.bindings=this.builder.bindings),i}try{return this.connection=n,await e(this,t)}finally{await this.client.releaseConnection(n)}}};const rb=ae("knex:query"),nb=ae("knex:bindings"),ib=(r,e)=>rb(r.replace(/%/g,"%%"),e),{isString:sb}=q;function Ei(r,e,t,n){e=e==null?[]:[].concat(e);let i=0;return r.replace(/\\?\?/g,s=>{if(s==="\\?")return"?";if(i===e.length)return s;const o=e[i++];return n._escapeBinding(o,{timeZone:t})})}function ob(r,e,t){const n=sb(e)?{sql:e}:e;n.bindings=t.prepBindings(n.bindings),n.sql=t.positionBindings(n.sql);const{__knexUid:i,__knexTxId:s}=r;return t.emit("query",Object.assign({__knexUid:i,__knexTxId:s},n)),ib(n.sql,s),nb(n.bindings,s),n}function ab(r,e,t){return t._query(r,e).catch(n=>{throw t.config&&t.config.compileSqlOnError===!1?n.message=e.sql+" - "+n.message:n.message=Ei(e.sql,e.bindings,void 0,t)+" - "+n.message,t.emit("query-error",n,Object.assign({__knexUid:r.__knexUid,__knexTxId:r.__knexUid},e)),n})}var Si={enrichQueryObject:ob,executeQuery:ab,formatQuery:Ei},ub=rt,lb=Z,cb=Wt,hb=F,db=Ee,fb=re,pb=Object.prototype,gb=pb.hasOwnProperty,yb=cb(function(r,e){if(db(e)||hb(e)){lb(e,fb(e),r);return}for(var t in e)gb.call(e,t)&&ub(r,t,e[t])}),ie=yb,mb=Ti,bb=4;function _b(r){return mb(r,bb)}var Ii=_b,wb=tn,vb=re;function $b(r,e){return r&&wb(r,e,vb)}var xi=$b,Cb=F;function Tb(r,e){return function(t,n){if(t==null)return t;if(!Cb(t))return r(t,n);for(var i=t.length,s=e?i:-1,o=Object(t);(e?s--:++s<i)&&n(o[s],s,o)!==!1;);return t}}var Ob=Tb,Ab=xi,Eb=Ob,Sb=Eb(Ab),Pe=Sb,Ib=it;function xb(r){return typeof r=="function"?r:Ib}var Pb=xb,Nb=Zt,jb=Pe,Bb=Pb,qb=A;function Rb(r,e){var t=qb(r)?Nb:jb;return t(r,Bb(e))}var kb=Rb,Pi=kb,Mb=ei,Lb=be,Fb=Se,Hb=A,Qb=F,Wb=fe,Db=Ee,Ub=pe,Jb="[object Map]",Vb="[object Set]",Gb=Object.prototype,Kb=Gb.hasOwnProperty;function zb(r){if(r==null)return!0;if(Qb(r)&&(Hb(r)||typeof r=="string"||typeof r.splice=="function"||Wb(r)||Ub(r)||Fb(r)))return!r.length;var e=Lb(r);if(e==Jb||e==Vb)return!r.size;if(Db(r))return!Mb(r).length;for(var t in r)if(Kb.call(r,t))return!1;return!0}var dt=zb;function Yb(r){var e=r==null?0:r.length;return e?r[e-1]:void 0}var Xb=Yb,Zb=Pe;function e_(r,e){var t=[];return Zb(r,function(n,i,s){e(n,i,s)&&t.push(n)}),t}var t_=e_,r_="__lodash_hash_undefined__";function n_(r){return this.__data__.set(r,r_),this}var i_=n_;function s_(r){return this.__data__.has(r)}var o_=s_,a_=Rt,u_=i_,l_=o_;function ft(r){var e=-1,t=r==null?0:r.length;for(this.__data__=new a_;++e<t;)this.add(r[e])}ft.prototype.add=ft.prototype.push=u_,ft.prototype.has=l_;var c_=ft;function h_(r,e){for(var t=-1,n=r==null?0:r.length;++t<n;)if(e(r[t],t,r))return!0;return!1}var d_=h_;function f_(r,e){return r.has(e)}var p_=f_,g_=c_,y_=d_,m_=p_,b_=1,__=2;function w_(r,e,t,n,i,s){var o=t&b_,a=r.length,u=e.length;if(a!=u&&!(o&&u>a))return!1;var c=s.get(r),l=s.get(e);if(c&&l)return c==e&&l==r;var h=-1,d=!0,_=t&__?new g_:void 0;for(s.set(r,e),s.set(e,r);++h<a;){var m=r[h],y=e[h];if(n)var b=o?n(y,m,h,e,r,s):n(m,y,h,r,e,s);if(b!==void 0){if(b)continue;d=!1;break}if(_){if(!y_(e,function($,N){if(!m_(_,N)&&(m===$||i(m,$,t,n,s)))return _.push(N)})){d=!1;break}}else if(!(m===y||i(m,y,t,n,s))){d=!1;break}}return s.delete(r),s.delete(e),d}var Ni=w_;function v_(r){var e=-1,t=Array(r.size);return r.forEach(function(n,i){t[++e]=[i,n]}),t}var ji=v_;function $_(r){var e=-1,t=Array(r.size);return r.forEach(function(n){t[++e]=n}),t}var Bi=$_,qi=z,Ri=nn,C_=ue,T_=Ni,O_=ji,A_=Bi,E_=1,S_=2,I_="[object Boolean]",x_="[object Date]",P_="[object Error]",N_="[object Map]",j_="[object Number]",B_="[object RegExp]",q_="[object Set]",R_="[object String]",k_="[object Symbol]",M_="[object ArrayBuffer]",L_="[object DataView]",ki=qi?qi.prototype:void 0,ar=ki?ki.valueOf:void 0;function F_(r,e,t,n,i,s,o){switch(t){case L_:if(r.byteLength!=e.byteLength||r.byteOffset!=e.byteOffset)return!1;r=r.buffer,e=e.buffer;case M_:return!(r.byteLength!=e.byteLength||!s(new Ri(r),new Ri(e)));case I_:case x_:case j_:return C_(+r,+e);case P_:return r.name==e.name&&r.message==e.message;case B_:case R_:return r==e+"";case N_:var a=O_;case q_:var u=n&E_;if(a||(a=A_),r.size!=e.size&&!u)return!1;var c=o.get(r);if(c)return c==e;n|=S_,o.set(r,e);var l=T_(a(r),a(e),n,i,s,o);return o.delete(r),l;case k_:if(ar)return ar.call(r)==ar.call(e)}return!1}var H_=F_,Mi=oi,Q_=1,W_=Object.prototype,D_=W_.hasOwnProperty;function U_(r,e,t,n,i,s){var o=t&Q_,a=Mi(r),u=a.length,c=Mi(e),l=c.length;if(u!=l&&!o)return!1;for(var h=u;h--;){var d=a[h];if(!(o?d in e:D_.call(e,d)))return!1}var _=s.get(r),m=s.get(e);if(_&&m)return _==e&&m==r;var y=!0;s.set(r,e),s.set(e,r);for(var b=o;++h<u;){d=a[h];var $=r[d],N=e[d];if(n)var Oe=o?n(N,$,d,e,r,s):n($,N,d,r,e,s);if(!(Oe===void 0?$===N||i($,N,t,n,s):Oe)){y=!1;break}b||(b=d=="constructor")}if(y&&!b){var D=r.constructor,Qe=e.constructor;D!=Qe&&"constructor"in r&&"constructor"in e&&!(typeof D=="function"&&D instanceof D&&typeof Qe=="function"&&Qe instanceof Qe)&&(y=!1)}return s.delete(r),s.delete(e),y}var J_=U_,ur=ze,V_=Ni,G_=H_,K_=J_,Li=be,Fi=A,Hi=fe,z_=pe,Y_=1,Qi="[object Arguments]",Wi="[object Array]",pt="[object Object]",X_=Object.prototype,Di=X_.hasOwnProperty;function Z_(r,e,t,n,i,s){var o=Fi(r),a=Fi(e),u=o?Wi:Li(r),c=a?Wi:Li(e);u=u==Qi?pt:u,c=c==Qi?pt:c;var l=u==pt,h=c==pt,d=u==c;if(d&&Hi(r)){if(!Hi(e))return!1;o=!0,l=!1}if(d&&!l)return s||(s=new ur),o||z_(r)?V_(r,e,t,n,i,s):G_(r,e,u,t,n,i,s);if(!(t&Y_)){var _=l&&Di.call(r,"__wrapped__"),m=h&&Di.call(e,"__wrapped__");if(_||m){var y=_?r.value():r,b=m?e.value():e;return s||(s=new ur),i(y,b,t,n,s)}}return d?(s||(s=new ur),K_(r,e,t,n,i,s)):!1}var ew=Z_,tw=ew,Ui=k;function Ji(r,e,t,n,i){return r===e?!0:r==null||e==null||!Ui(r)&&!Ui(e)?r!==r&&e!==e:tw(r,e,t,n,Ji,i)}var Vi=Ji,rw=ze,nw=Vi,iw=1,sw=2;function ow(r,e,t,n){var i=t.length,s=i,o=!n;if(r==null)return!s;for(r=Object(r);i--;){var a=t[i];if(o&&a[2]?a[1]!==r[a[0]]:!(a[0]in r))return!1}for(;++i<s;){a=t[i];var u=a[0],c=r[u],l=a[1];if(o&&a[2]){if(c===void 0&&!(u in r))return!1}else{var h=new rw;if(n)var d=n(c,l,u,r,e,h);if(!(d===void 0?nw(l,c,iw|sw,n,h):d))return!1}}return!0}var aw=ow,uw=j;function lw(r){return r===r&&!uw(r)}var Gi=lw,cw=Gi,hw=re;function dw(r){for(var e=hw(r),t=e.length;t--;){var n=e[t],i=r[n];e[t]=[n,i,cw(i)]}return e}var fw=dw;function pw(r,e){return function(t){return t==null?!1:t[r]===e&&(e!==void 0||r in Object(t))}}var Ki=pw,gw=aw,yw=fw,mw=Ki;function bw(r){var e=yw(r);return e.length==1&&e[0][2]?mw(e[0][0],e[0][1]):function(t){return t===r||gw(t,r,e)}}var _w=bw,ww=A,vw=De,$w=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Cw=/^\w*$/;function Tw(r,e){if(ww(r))return!1;var t=typeof r;return t=="number"||t=="symbol"||t=="boolean"||r==null||vw(r)?!0:Cw.test(r)||!$w.test(r)||e!=null&&r in Object(e)}var lr=Tw,zi=Rt,Ow="Expected a function";function cr(r,e){if(typeof r!="function"||e!=null&&typeof e!="function")throw new TypeError(Ow);var t=function(){var n=arguments,i=e?e.apply(this,n):n[0],s=t.cache;if(s.has(i))return s.get(i);var o=r.apply(this,n);return t.cache=s.set(i,o)||s,o};return t.cache=new(cr.Cache||zi),t}cr.Cache=zi;var Aw=cr,Ew=Aw,Sw=500;function Iw(r){var e=Ew(r,function(n){return t.size===Sw&&t.clear(),n}),t=e.cache;return e}var xw=Iw,Pw=xw,Nw=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,jw=/\\(\\)?/g,Bw=Pw(function(r){var e=[];return r.charCodeAt(0)===46&&e.push(""),r.replace(Nw,function(t,n,i,s){e.push(i?s.replace(jw,"$1"):n||t)}),e}),qw=Bw,Rw=A,kw=lr,Mw=qw,Lw=Jr;function Fw(r,e){return Rw(r)?r:kw(r,e)?[r]:Mw(Lw(r))}var gt=Fw,Hw=De,Qw=1/0;function Ww(r){if(typeof r=="string"||Hw(r))return r;var e=r+"";return e=="0"&&1/r==-Qw?"-0":e}var Ne=Ww,Dw=gt,Uw=Ne;function Jw(r,e){e=Dw(e,r);for(var t=0,n=e.length;r!=null&&t<n;)r=r[Uw(e[t++])];return t&&t==n?r:void 0}var hr=Jw,Vw=hr;function Gw(r,e,t){var n=r==null?void 0:Vw(r,e);return n===void 0?t:n}var Kw=Gw;function zw(r,e){return r!=null&&e in Object(r)}var Yw=zw,Xw=gt,Zw=Se,ev=A,tv=nt,rv=Lt,nv=Ne;function iv(r,e,t){e=Xw(e,r);for(var n=-1,i=e.length,s=!1;++n<i;){var o=nv(e[n]);if(!(s=r!=null&&t(r,o)))break;r=r[o]}return s||++n!=i?s:(i=r==null?0:r.length,!!i&&rv(i)&&tv(o,i)&&(ev(r)||Zw(r)))}var Yi=iv,sv=Yw,ov=Yi;function av(r,e){return r!=null&&ov(r,e,sv)}var uv=av,lv=Vi,cv=Kw,hv=uv,dv=lr,fv=Gi,pv=Ki,gv=Ne,yv=1,mv=2;function bv(r,e){return dv(r)&&fv(e)?pv(gv(r),e):function(t){var n=cv(t,r);return n===void 0&&n===e?hv(t,r):lv(e,n,yv|mv)}}var _v=bv;function wv(r){return function(e){return e==null?void 0:e[r]}}var vv=wv,$v=hr;function Cv(r){return function(e){return $v(e,r)}}var Tv=Cv,Ov=vv,Av=Tv,Ev=lr,Sv=Ne;function Iv(r){return Ev(r)?Ov(Sv(r)):Av(r)}var xv=Iv,Pv=_w,Nv=_v,jv=it,Bv=A,qv=xv;function Rv(r){return typeof r=="function"?r:r==null?jv:typeof r=="object"?Bv(r)?Nv(r[0],r[1]):Pv(r):qv(r)}var se=Rv,kv="Expected a function";function Mv(r){if(typeof r!="function")throw new TypeError(kv);return function(){var e=arguments;switch(e.length){case 0:return!r.call(this);case 1:return!r.call(this,e[0]);case 2:return!r.call(this,e[0],e[1]);case 3:return!r.call(this,e[0],e[1],e[2])}return!r.apply(this,e)}}var Xi=Mv,Lv=ti,Fv=t_,Hv=se,Qv=A,Wv=Xi;function Dv(r,e){var t=Qv(r)?Lv:Fv;return t(r,Wv(Hv(e)))}var Uv=Dv,Jv=An;function Vv(r){var e=r==null?0:r.length;return e?Jv(r,1,e):[]}var yt=Vv,Gv=Y,Kv=A,zv=k,Yv="[object String]";function Xv(r){return typeof r=="string"||!Kv(r)&&zv(r)&&Gv(r)==Yv}var Zv=Xv;function e$(r){for(var e,t=[];!(e=r.next()).done;)t.push(e.value);return t}var t$=e$;function r$(r){return r.split("")}var n$=r$,i$="\\ud800-\\udfff",s$="\\u0300-\\u036f",o$="\\ufe20-\\ufe2f",a$="\\u20d0-\\u20ff",u$=s$+o$+a$,l$="\\ufe0e\\ufe0f",c$="\\u200d",h$=RegExp("["+c$+i$+u$+l$+"]");function d$(r){return h$.test(r)}var f$=d$,Zi="\\ud800-\\udfff",p$="\\u0300-\\u036f",g$="\\ufe20-\\ufe2f",y$="\\u20d0-\\u20ff",m$=p$+g$+y$,b$="\\ufe0e\\ufe0f",_$="["+Zi+"]",dr="["+m$+"]",fr="\\ud83c[\\udffb-\\udfff]",w$="(?:"+dr+"|"+fr+")",es="[^"+Zi+"]",ts="(?:\\ud83c[\\udde6-\\uddff]){2}",rs="[\\ud800-\\udbff][\\udc00-\\udfff]",v$="\\u200d",ns=w$+"?",is="["+b$+"]?",$$="(?:"+v$+"(?:"+[es,ts,rs].join("|")+")"+is+ns+")*",C$=is+ns+$$,T$="(?:"+[es+dr+"?",dr,ts,rs,_$].join("|")+")",O$=RegExp(fr+"(?="+fr+")|"+T$+C$,"g");function A$(r){return r.match(O$)||[]}var E$=A$,S$=n$,I$=f$,x$=E$;function P$(r){return I$(r)?x$(r):S$(r)}var N$=P$,j$=We;function B$(r,e){return j$(e,function(t){return r[t]})}var q$=B$,R$=q$,k$=re;function M$(r){return r==null?[]:R$(r,k$(r))}var L$=M$,ss=z,F$=Mt,H$=be,Q$=F,W$=Zv,D$=t$,U$=ji,J$=Bi,V$=N$,G$=L$,K$="[object Map]",z$="[object Set]",pr=ss?ss.iterator:void 0;function Y$(r){if(!r)return[];if(Q$(r))return W$(r)?V$(r):F$(r);if(pr&&r[pr])return D$(r[pr]());var e=H$(r),t=e==K$?U$:e==z$?J$:G$;return t(r)}var mt=Y$;const os=Object.freeze({pg:"postgres",postgresql:"postgres",sqlite:"sqlite3"}),X$=Object.freeze(["mssql","mysql","mysql2","oracledb","postgres","pgnative","redshift","sqlite3","cockroachdb","better-sqlite3"].concat(Object.keys(os))),Z$=Object.freeze({MsSQL:"mssql",MySQL:"mysql",MySQL2:"mysql2",Oracle:"oracledb",PostgreSQL:"pg",PgNative:"pgnative",Redshift:"pg-redshift",SQLite:"sqlite3",CockroachDB:"cockroachdb",BetterSQLite3:"better-sqlite3"}),eC=Object.freeze(["maxWaitingClients","testOnBorrow","fifo","priorityRange","autostart","evictionRunIntervalMillis","numTestsPerRun","softIdleTimeoutMillis","Promise"]);var as={CLIENT_ALIASES:os,SUPPORTED_CLIENTS:X$,POOL_CONFIG_OPTIONS:eC,COMMA_NO_PAREN_REGEX:/,[\s](?![^(]*\))/g,DRIVER_NAMES:Z$};const us=Ie,tC=pe,{CLIENT_ALIASES:rC}=as,{isFunction:nC}=q;function iC(...r){return Array.isArray(r[0])?r[0]:r}function je(r){let e=!1;if(tC(r))return!1;if(r&&nC(r.toSQL))return e;if(Array.isArray(r))for(let t=0;t<r.length&&!e;t++)e=je(r[t]);else us(r)?Object.keys(r).forEach(t=>{e||(e=je(r[t]))}):e=r===void 0;return e}function sC(r){const e=[];return Array.isArray(r)?r.forEach((t,n)=>{je(t)&&e.push(n)}):us(r)?Object.keys(r).forEach(t=>{je(r[t])&&e.push(t)}):e.push(0),e}function oC(r){r.prototype.queryContext=function(e){return e===void 0?this._queryContext:(this._queryContext=e,this)}}function aC(r){return rC[r]||r}function uC(r,e){if(r==null)return e;const t=parseInt(r,10);return isNaN(t)?e:t}var M={addQueryContext:oC,containsUndefined:je,getUndefinedIndices:sC,normalizeArr:iC,resolveClientNameWithAliases:aC,toNumber:uC};const ls=E;function cs(r,e,t,n,i){if(typeof t=="function")return{type:"onWrapped",value:t,bool:e};switch(arguments.length){case 3:return{type:"onRaw",value:t,bool:e};case 4:return{type:r,column:t,operator:"=",value:n,bool:e};default:return{type:r,column:t,operator:n,value:i,bool:e}}}let T=class{constructor(e,t,n){this.schema=n,this.table=e,this.joinType=t,this.and=this,this.clauses=[]}get or(){return this._bool("or")}on(e){if(typeof e=="object"&&typeof e.toSQL!="function"){const n=Object.keys(e);let i=-1;const s=this._bool()==="or"?"orOn":"on";for(;++i<n.length;)this[s](n[i],e[n[i]]);return this}const t=cs("onBasic",this._bool(),...arguments);return t&&this.clauses.push(t),this}orOn(e,t,n){return this._bool("or").on.apply(this,arguments)}onJsonPathEquals(e,t,n,i){return this.clauses.push({type:"onJsonPathEquals",columnFirst:e,jsonPathFirst:t,columnSecond:n,jsonPathSecond:i,bool:this._bool(),not:this._not()}),this}orOnJsonPathEquals(e,t,n,i){return this._bool("or").onJsonPathEquals.apply(this,arguments)}using(e){return this.clauses.push({type:"onUsing",column:e,bool:this._bool()})}onVal(e){if(typeof e=="object"&&typeof e.toSQL!="function"){const n=Object.keys(e);let i=-1;const s=this._bool()==="or"?"orOnVal":"onVal";for(;++i<n.length;)this[s](n[i],e[n[i]]);return this}const t=cs("onVal",this._bool(),...arguments);return t&&this.clauses.push(t),this}andOnVal(){return this.onVal(...arguments)}orOnVal(){return this._bool("or").onVal(...arguments)}onBetween(e,t){return ls(Array.isArray(t),"The second argument to onBetween must be an array."),ls(t.length===2,"You must specify 2 values for the onBetween clause"),this.clauses.push({type:"onBetween",column:e,value:t,bool:this._bool(),not:this._not()}),this}onNotBetween(e,t){return this._not(!0).onBetween(e,t)}orOnBetween(e,t){return this._bool("or").onBetween(e,t)}orOnNotBetween(e,t){return this._bool("or")._not(!0).onBetween(e,t)}onIn(e,t){return Array.isArray(t)&&t.length===0?this.on(1,"=",0):(this.clauses.push({type:"onIn",column:e,value:t,not:this._not(),bool:this._bool()}),this)}onNotIn(e,t){return this._not(!0).onIn(e,t)}orOnIn(e,t){return this._bool("or").onIn(e,t)}orOnNotIn(e,t){return this._bool("or")._not(!0).onIn(e,t)}onNull(e){return this.clauses.push({type:"onNull",column:e,not:this._not(),bool:this._bool()}),this}orOnNull(e){return this._bool("or").onNull(e)}onNotNull(e){return this._not(!0).onNull(e)}orOnNotNull(e){return this._not(!0)._bool("or").onNull(e)}onExists(e){return this.clauses.push({type:"onExists",value:e,not:this._not(),bool:this._bool()}),this}orOnExists(e){return this._bool("or").onExists(e)}onNotExists(e){return this._not(!0).onExists(e)}orOnNotExists(e){return this._not(!0)._bool("or").onExists(e)}type(e){return this.joinType=e,this}_bool(e){if(arguments.length===1)return this._boolFlag=e,this;const t=this._boolFlag||"and";return this._boolFlag="and",t}_not(e){if(arguments.length===1)return this._notFlag=e,this;const t=this._notFlag;return this._notFlag=!1,t}};Object.assign(T.prototype,{grouping:"join"}),T.prototype.andOn=T.prototype.on,T.prototype.andOnIn=T.prototype.onIn,T.prototype.andOnNotIn=T.prototype.onNotIn,T.prototype.andOnNull=T.prototype.onNull,T.prototype.andOnNotNull=T.prototype.onNotNull,T.prototype.andOnExists=T.prototype.onExists,T.prototype.andOnNotExists=T.prototype.onNotExists,T.prototype.andOnBetween=T.prototype.onBetween,T.prototype.andOnNotBetween=T.prototype.onNotBetween,T.prototype.andOnJsonPathEquals=T.prototype.onJsonPathEquals;var hs=T;const ds=E;var lC=class{constructor(e,t,n,i,s){this.schema=t,this.type="analytic",this.method=e,this.order=i||[],this.partitions=s||[],this.alias=n,this.and=this,this.grouping="columns"}partitionBy(e,t){return ds(Array.isArray(e)||typeof e=="string",`The argument to an analytic partitionBy function must be either a string
            or an array of string.`),Array.isArray(e)?this.partitions=this.partitions.concat(e):this.partitions.push({column:e,order:t}),this}orderBy(e,t){return ds(Array.isArray(e)||typeof e=="string",`The argument to an analytic orderBy function must be either a string
            or an array of string.`),Array.isArray(e)?this.order=this.order.concat(e):this.order.push({column:e,order:t}),this}},gr=function(e,t){e.client.config.asyncStackTraces&&(e._asyncStack={error:new Error,lines:t})},cC={lockMode:{forShare:"forShare",forUpdate:"forUpdate",forNoKeyUpdate:"forNoKeyUpdate",forKeyShare:"forKeyShare"},waitMode:{skipLocked:"skipLocked",noWait:"noWait"}};const hC=Ii,dC=dt,{callbackify:fC}=E,pC=Ln,{formatQuery:gC}=Si;function yC(r){r.prototype.toQuery=function(e){let t=this.toSQL(this._method,e);return Array.isArray(t)||(t=[t]),t.length?t.map(n=>gC(n.sql,n.bindings,e,this.client)).reduce((n,i)=>n.concat(n.endsWith(";")?`
`:`;
`,i)):""},r.prototype.then=function(){let e=this.client.runner(this).run();return this.client.config.asyncStackTraces&&(e=e.catch(t=>{t.originalStack=t.stack;const n=t.stack.split(`
`)[0],{error:i,lines:s}=this._asyncStack,a=i.stack.split(`
`).slice(s);throw a.unshift(n),t.stack=a.join(`
`),t})),e.then.apply(e,arguments)},r.prototype.options=function(e){return this._options=this._options||[],this._options.push(hC(e)||{}),this},r.prototype.connection=function(e){return this._connection=e,this.client.processPassedConnection(e),this},r.prototype.debug=function(e){return this._debug=arguments.length?e:!0,this},r.prototype.transacting=function(e){if(e&&e.client&&(e.client.transacting?this.client=e.client:e.client.logger.warn(`Invalid transaction value: ${e.client}`)),dC(e))throw this.client.logger.error("Invalid value on transacting call, potential bug"),Error("Invalid transacting value (null, undefined or empty object)");return this},r.prototype.stream=function(e){return this.client.runner(this).stream(e)},r.prototype.pipe=function(e,t){return this.client.runner(this).pipe(e,t)},r.prototype.asCallback=function(e){const t=this.then();return fC(()=>t)(e),t},r.prototype.catch=function(e){return this.then().catch(e)},Object.defineProperty(r.prototype,Symbol.toStringTag,{get:()=>"object"}),pC(r.prototype)}var yr={augmentWithBuilderInterface:yC};const _e=E,{EventEmitter:mC}=E,bC=ie,bt=Ii,_C=Pi,we=dt,fs=Ie,wC=Xb,vC=Uv,$C=yt,ps=mt,{addQueryContext:CC,normalizeArr:Be}=M,mr=hs,TC=lC,OC=gr,{isBoolean:qe,isNumber:AC,isObject:H,isString:br,isFunction:EC}=q,{lockMode:U,waitMode:_t}=cC,{augmentWithBuilderInterface:SC}=yr,IC=new Set(["pluck","first","select"]),xC=new Set(["with","select","columns","hintComments","where","union","join","group","order","having","limit","offset","counter","counters"]),PC=new Set([U.forShare,U.forUpdate,U.forNoKeyUpdate,U.forKeyShare]);class f extends mC{constructor(e){super(),this.client=e,this.and=this,this._single={},this._statements=[],this._method="select",e.config&&(OC(this,5),this._debug=e.config.debug),this._joinFlag="inner",this._boolFlag="and",this._notFlag=!1,this._asColumnFlag=!1}toString(){return this.toQuery()}toSQL(e,t){return this.client.queryCompiler(this).toSQL(e||this._method,t)}clone(){const e=new this.constructor(this.client);return e._method=this._method,e._single=bt(this._single),e._statements=bt(this._statements),e._debug=this._debug,this._options!==void 0&&(e._options=bt(this._options)),this._queryContext!==void 0&&(e._queryContext=bt(this._queryContext)),this._connection!==void 0&&(e._connection=this._connection),e}timeout(e,{cancel:t}={}){return AC(e)&&e>0&&(this._timeout=e,t&&(this.client.assertCanCancelQuery(),this._cancelOnTimeout=!0)),this}isValidStatementArg(e){return typeof e=="function"||e instanceof f||e&&e.isRawInstance}_validateWithArgs(e,t,n,i){const[s,o]=typeof n>"u"?[t,void 0]:[n,t];if(typeof e!="string")throw new Error(`${i}() first argument must be a string`);if(this.isValidStatementArg(s)&&typeof o>"u")return;if(!(Array.isArray(o)&&o.length>0&&o.every(u=>typeof u=="string")))throw new Error(`${i}() second argument must be a statement or non-empty column name list.`);if(!this.isValidStatementArg(s))throw new Error(`${i}() third argument must be a function / QueryBuilder or a raw when its second argument is a column name list`)}with(e,t,n){return this._validateWithArgs(e,t,n,"with"),this.withWrapped(e,t,n)}withMaterialized(e,t,n){throw new Error("With materialized is not supported by this dialect")}withNotMaterialized(e,t,n){throw new Error("With materialized is not supported by this dialect")}withWrapped(e,t,n,i){const[s,o]=typeof n>"u"?[t,void 0]:[n,t],a={grouping:"with",type:"withWrapped",alias:e,columnList:o,value:s};return i!==void 0&&(a.materialized=i),this._statements.push(a),this}withRecursive(e,t,n){return this._validateWithArgs(e,t,n,"withRecursive"),this.withRecursiveWrapped(e,t,n)}withRecursiveWrapped(e,t,n){return this.withWrapped(e,t,n),this._statements[this._statements.length-1].recursive=!0,this}columns(e){return!e&&e!==0?this:(this._statements.push({grouping:"columns",value:Be(...arguments)}),this)}as(e){return this._single.as=e,this}hintComment(e){if(e=Array.isArray(e)?e:[e],e.some(t=>!br(t)))throw new Error("Hint comment must be a string");if(e.some(t=>t.includes("/*")||t.includes("*/")))throw new Error('Hint comment cannot include "/*" or "*/"');if(e.some(t=>t.includes("?")))throw new Error('Hint comment cannot include "?"');return this._statements.push({grouping:"hintComments",value:e}),this}withSchema(e){return this._single.schema=e,this}table(e,t={}){return this._single.table=e,this._single.only=t.only===!0,this}distinct(...e){return this._statements.push({grouping:"columns",value:Be(...e),distinct:!0}),this}distinctOn(...e){if(we(e))throw new Error("distinctOn requires at least on argument");return this._statements.push({grouping:"columns",value:Be(...e),distinctOn:!0}),this}join(e,t,...n){let i;const s=e instanceof f||typeof e=="function"?void 0:this._single.schema,o=this._joinType();return typeof t=="function"?(i=new mr(e,o,s),t.call(i,i)):o==="raw"?i=new mr(this.client.raw(e,t),"raw"):(i=new mr(e,o,s),t&&i.on(t,...n)),this._statements.push(i),this}using(e){throw new Error("'using' function is only available in PostgreSQL dialect with Delete statements.")}innerJoin(...e){return this._joinType("inner").join(...e)}leftJoin(...e){return this._joinType("left").join(...e)}leftOuterJoin(...e){return this._joinType("left outer").join(...e)}rightJoin(...e){return this._joinType("right").join(...e)}rightOuterJoin(...e){return this._joinType("right outer").join(...e)}outerJoin(...e){return this._joinType("outer").join(...e)}fullOuterJoin(...e){return this._joinType("full outer").join(...e)}crossJoin(...e){return this._joinType("cross").join(...e)}joinRaw(...e){return this._joinType("raw").join(...e)}get or(){return this._bool("or")}get not(){return this._not(!0)}where(e,t,n){const i=arguments.length;if(e===!1||e===!0)return this.where(1,"=",e?1:0);if(typeof e=="function")return this.whereWrapped(e);if(H(e)&&!e.isRawInstance)return this._objectWhere(e);if(e&&e.isRawInstance&&i===1)return this.whereRaw(e);if(i===2&&(n=t,t="=",n===null))return this.whereNull(e);const s=`${t}`.toLowerCase().trim();if(i===3){if(s==="in"||s==="not in")return this._not(s==="not in").whereIn(e,n);if(s==="between"||s==="not between")return this._not(s==="not between").whereBetween(e,n)}return n===null&&(s==="is"||s==="is not")?this._not(s==="is not").whereNull(e):(this._statements.push({grouping:"where",type:"whereBasic",column:e,operator:t,value:n,not:this._not(),bool:this._bool(),asColumn:this._asColumnFlag}),this)}whereColumn(...e){return this._asColumnFlag=!0,this.where(...e),this._asColumnFlag=!1,this}orWhere(e,...t){this._bool("or");const n=e;return H(n)&&!n.isRawInstance?this.whereWrapped(function(){for(const i in n)this.andWhere(i,n[i])}):this.where(e,...t)}orWhereColumn(e,...t){this._bool("or");const n=e;return H(n)&&!n.isRawInstance?this.whereWrapped(function(){for(const i in n)this.andWhereColumn(i,"=",n[i])}):this.whereColumn(e,...t)}whereNot(e,...t){return t.length>=2&&(t[0]==="in"||t[0]==="between")&&this.client.logger.warn('whereNot is not suitable for "in" and "between" type subqueries. You should use "not in" and "not between" instead.'),this._not(!0).where(e,...t)}whereNotColumn(...e){return this._not(!0).whereColumn(...e)}orWhereNot(...e){return this._bool("or").whereNot(...e)}orWhereNotColumn(...e){return this._bool("or").whereNotColumn(...e)}_objectWhere(e){const t=this._bool(),n=this._not()?"Not":"";for(const i in e)this[t+"Where"+n](i,e[i]);return this}whereRaw(e,t){const n=e.isRawInstance?e:this.client.raw(e,t);return this._statements.push({grouping:"where",type:"whereRaw",value:n,not:this._not(),bool:this._bool()}),this}orWhereRaw(e,t){return this._bool("or").whereRaw(e,t)}whereWrapped(e){return this._statements.push({grouping:"where",type:"whereWrapped",value:e,not:this._not(),bool:this._bool()}),this}whereExists(e){return this._statements.push({grouping:"where",type:"whereExists",value:e,not:this._not(),bool:this._bool()}),this}orWhereExists(e){return this._bool("or").whereExists(e)}whereNotExists(e){return this._not(!0).whereExists(e)}orWhereNotExists(e){return this._bool("or").whereNotExists(e)}whereIn(e,t){return Array.isArray(t)&&we(t)?this.where(this._not()):(this._statements.push({grouping:"where",type:"whereIn",column:e,value:t,not:this._not(),bool:this._bool()}),this)}orWhereIn(e,t){return this._bool("or").whereIn(e,t)}whereNotIn(e,t){return this._not(!0).whereIn(e,t)}orWhereNotIn(e,t){return this._bool("or")._not(!0).whereIn(e,t)}whereNull(e){return this._statements.push({grouping:"where",type:"whereNull",column:e,not:this._not(),bool:this._bool()}),this}orWhereNull(e){return this._bool("or").whereNull(e)}whereNotNull(e){return this._not(!0).whereNull(e)}orWhereNotNull(e){return this._bool("or").whereNotNull(e)}whereBetween(e,t){return _e(Array.isArray(t),"The second argument to whereBetween must be an array."),_e(t.length===2,"You must specify 2 values for the whereBetween clause"),this._statements.push({grouping:"where",type:"whereBetween",column:e,value:t,not:this._not(),bool:this._bool()}),this}whereNotBetween(e,t){return this._not(!0).whereBetween(e,t)}orWhereBetween(e,t){return this._bool("or").whereBetween(e,t)}orWhereNotBetween(e,t){return this._bool("or").whereNotBetween(e,t)}_whereLike(e,t,n){return this._statements.push({grouping:"where",type:e,column:t,value:n,not:this._not(),bool:this._bool(),asColumn:this._asColumnFlag}),this}whereLike(e,t){return this._whereLike("whereLike",e,t)}orWhereLike(e,t){return this._bool("or")._whereLike("whereLike",e,t)}whereILike(e,t){return this._whereLike("whereILike",e,t)}orWhereILike(e,t){return this._bool("or")._whereLike("whereILike",e,t)}groupBy(e){return e&&e.isRawInstance?this.groupByRaw.apply(this,arguments):(this._statements.push({grouping:"group",type:"groupByBasic",value:Be(...arguments)}),this)}groupByRaw(e,t){const n=e.isRawInstance?e:this.client.raw(e,t);return this._statements.push({grouping:"group",type:"groupByRaw",value:n}),this}orderBy(e,t,n=""){return Array.isArray(e)?this._orderByArray(e):(this._statements.push({grouping:"order",type:"orderByBasic",value:e,direction:t,nulls:n}),this)}_orderByArray(e){for(let t=0;t<e.length;t++){const n=e[t];H(n)?this._statements.push({grouping:"order",type:"orderByBasic",value:n.column,direction:n.order,nulls:n.nulls}):br(n)&&this._statements.push({grouping:"order",type:"orderByBasic",value:n})}return this}orderByRaw(e,t){const n=e.isRawInstance?e:this.client.raw(e,t);return this._statements.push({grouping:"order",type:"orderByRaw",value:n}),this}_union(e,t){let n=t[0],i=t[1];if(t.length===1||t.length===2&&qe(i)){Array.isArray(n)||(n=[n]);for(let s=0,o=n.length;s<o;s++)this._statements.push({grouping:"union",clause:e,value:n[s],wrap:i||!1})}else n=ps(t).slice(0,t.length-1),i=t[t.length-1],qe(i)||(n.push(i),i=!1),this._union(e,[n,i]);return this}union(...e){return this._union("union",e)}unionAll(...e){return this._union("union all",e)}intersect(e,t){if(arguments.length===1||arguments.length===2&&qe(t)){Array.isArray(e)||(e=[e]);for(let n=0,i=e.length;n<i;n++)this._statements.push({grouping:"union",clause:"intersect",value:e[n],wrap:t||!1})}else e=ps(arguments).slice(0,arguments.length-1),t=arguments[arguments.length-1],qe(t)||(e.push(t),t=!1),this.intersect(e,t);return this}having(e,t,n){return e.isRawInstance&&arguments.length===1?this.havingRaw(e):typeof e=="function"?this.havingWrapped(e):(this._statements.push({grouping:"having",type:"havingBasic",column:e,operator:t,value:n,bool:this._bool(),not:this._not()}),this)}orHaving(e,...t){this._bool("or");const n=e;return H(n)&&!n.isRawInstance?this.havingWrapped(function(){for(const i in n)this.andHaving(i,n[i])}):this.having(e,...t)}havingWrapped(e){return this._statements.push({grouping:"having",type:"havingWrapped",value:e,bool:this._bool(),not:this._not()}),this}havingNull(e){return this._statements.push({grouping:"having",type:"havingNull",column:e,not:this._not(),bool:this._bool()}),this}orHavingNull(e){return this._bool("or").havingNull(e)}havingNotNull(e){return this._not(!0).havingNull(e)}orHavingNotNull(e){return this._not(!0)._bool("or").havingNull(e)}havingExists(e){return this._statements.push({grouping:"having",type:"havingExists",value:e,not:this._not(),bool:this._bool()}),this}orHavingExists(e){return this._bool("or").havingExists(e)}havingNotExists(e){return this._not(!0).havingExists(e)}orHavingNotExists(e){return this._not(!0)._bool("or").havingExists(e)}havingBetween(e,t){return _e(Array.isArray(t),"The second argument to havingBetween must be an array."),_e(t.length===2,"You must specify 2 values for the havingBetween clause"),this._statements.push({grouping:"having",type:"havingBetween",column:e,value:t,not:this._not(),bool:this._bool()}),this}orHavingBetween(e,t){return this._bool("or").havingBetween(e,t)}havingNotBetween(e,t){return this._not(!0).havingBetween(e,t)}orHavingNotBetween(e,t){return this._not(!0)._bool("or").havingBetween(e,t)}havingIn(e,t){return Array.isArray(t)&&we(t)?this.where(this._not()):(this._statements.push({grouping:"having",type:"havingIn",column:e,value:t,not:this._not(),bool:this._bool()}),this)}orHavingIn(e,t){return this._bool("or").havingIn(e,t)}havingNotIn(e,t){return this._not(!0).havingIn(e,t)}orHavingNotIn(e,t){return this._bool("or")._not(!0).havingIn(e,t)}havingRaw(e,t){const n=e.isRawInstance?e:this.client.raw(e,t);return this._statements.push({grouping:"having",type:"havingRaw",value:n,bool:this._bool(),not:this._not()}),this}orHavingRaw(e,t){return this._bool("or").havingRaw(e,t)}_setSkipBinding(e,t){let n=t;H(t)&&(n=t.skipBinding),this._single.skipBinding=this._single.skipBinding||{},this._single.skipBinding[e]=n}offset(e,t){if(e==null||e.isRawInstance||e instanceof f)this._single.offset=e;else{const n=parseInt(e,10);if(isNaN(n))this.client.logger.warn("A valid integer must be provided to offset");else{if(n<0)throw new Error("A non-negative integer must be provided to offset.");this._single.offset=n}}return this._setSkipBinding("offset",t),this}limit(e,t){const n=parseInt(e,10);return isNaN(n)?this.client.logger.warn("A valid integer must be provided to limit"):(this._single.limit=n,this._setSkipBinding("limit",t)),this}count(e,t){return this._aggregate("count",e||"*",t)}min(e,t){return this._aggregate("min",e,t)}max(e,t){return this._aggregate("max",e,t)}sum(e,t){return this._aggregate("sum",e,t)}avg(e,t){return this._aggregate("avg",e,t)}countDistinct(...e){let t;return e.length>1&&fs(wC(e))&&([t]=e.splice(e.length-1,1)),e.length?e.length===1&&(e=e[0]):e="*",this._aggregate("count",e,{...t,distinct:!0})}sumDistinct(e,t){return this._aggregate("sum",e,{...t,distinct:!0})}avgDistinct(e,t){return this._aggregate("avg",e,{...t,distinct:!0})}increment(e,t=1){if(H(e)){for(const n in e)this._counter(n,e[n]);return this}return this._counter(e,t)}decrement(e,t=1){if(H(e)){for(const n in e)this._counter(n,-e[n]);return this}return this._counter(e,-t)}clearCounters(){return this._single.counter={},this}first(...e){if(this._method&&this._method!=="select")throw new Error(`Cannot chain .first() on "${this._method}" query`);return this.select(Be(...e)),this._method="first",this.limit(1),this}connection(e){return this._connection=e,this.client.processPassedConnection(e),this}pluck(e){if(this._method&&this._method!=="select")throw new Error(`Cannot chain .pluck() on "${this._method}" query`);return this._method="pluck",this._single.pluck=e,this._statements.push({grouping:"columns",type:"pluck",value:e}),this}clearSelect(){return this._clearGrouping("columns"),this}clearWhere(){return this._clearGrouping("where"),this}clearGroup(){return this._clearGrouping("group"),this}clearOrder(){return this._clearGrouping("order"),this}clearHaving(){return this._clearGrouping("having"),this}clear(e){if(!xC.has(e))throw new Error(`Knex Error: unknown statement '${e}'`);return e.startsWith("counter")?this.clearCounters():(e==="select"&&(e="columns"),this._clearGrouping(e),this)}insert(e,t,n){return this._method="insert",we(t)||this.returning(t,n),this._single.insert=e,this}update(e,t,n){let i;const s=this._single.update||{};if(this._method="update",br(e))fs(t)?s[e]=JSON.stringify(t):s[e]=t,arguments.length>2&&(i=arguments[2]);else{const o=Object.keys(e);this._single.update&&this.client.logger.warn("Update called multiple times with objects.");let a=-1;for(;++a<o.length;)s[o[a]]=e[o[a]];i=arguments[1]}return we(i)||this.returning(i,n),this._single.update=s,this}returning(e,t){return this._single.returning=e,this._single.options=t,this}onConflict(e){return typeof e=="string"&&(e=[e]),new NC(this,e||!0)}delete(e,t){return this._method="del",we(e)||this.returning(e,t),this}truncate(e){return this._method="truncate",e&&(this._single.table=e),this}columnInfo(e){return this._method="columnInfo",this._single.columnInfo=e,this}forUpdate(...e){return this._single.lock=U.forUpdate,e.length===1&&Array.isArray(e[0])?this._single.lockTables=e[0]:this._single.lockTables=e,this}forShare(...e){return this._single.lock=U.forShare,this._single.lockTables=e,this}forNoKeyUpdate(...e){return this._single.lock=U.forNoKeyUpdate,this._single.lockTables=e,this}forKeyShare(...e){return this._single.lock=U.forKeyShare,this._single.lockTables=e,this}skipLocked(){if(!this._isSelectQuery())throw new Error(`Cannot chain .skipLocked() on "${this._method}" query!`);if(!this._hasLockMode())throw new Error(".skipLocked() can only be used after a call to .forShare() or .forUpdate()!");if(this._single.waitMode===_t.noWait)throw new Error(".skipLocked() cannot be used together with .noWait()!");return this._single.waitMode=_t.skipLocked,this}noWait(){if(!this._isSelectQuery())throw new Error(`Cannot chain .noWait() on "${this._method}" query!`);if(!this._hasLockMode())throw new Error(".noWait() can only be used after a call to .forShare() or .forUpdate()!");if(this._single.waitMode===_t.skipLocked)throw new Error(".noWait() cannot be used together with .skipLocked()!");return this._single.waitMode=_t.noWait,this}fromJS(e){return _C(e,(t,n)=>{typeof this[n]!="function"&&this.client.logger.warn(`Knex Error: unknown key ${n}`),Array.isArray(t)?this[n].apply(this,t):this[n](t)}),this}fromRaw(e,t){const n=e.isRawInstance?e:this.client.raw(e,t);return this.from(n)}modify(e){return e.apply(this,[this].concat($C(arguments))),this}upsert(e,t,n){throw new Error(`Upsert is not yet supported for dialect ${this.client.dialect}`)}_json(e,t){return this._statements.push({grouping:"columns",type:"json",method:e,params:t}),this}jsonExtract(){const e=arguments[0];let t,n,i=!0;return arguments.length>=2&&(t=arguments[1]),arguments.length>=3&&(n=arguments[2]),arguments.length===4&&(i=arguments[3]),arguments.length===2&&Array.isArray(arguments[0])&&qe(arguments[1])&&(i=arguments[1]),this._json("jsonExtract",{column:e,path:t,alias:n,singleValue:i})}jsonSet(e,t,n,i){return this._json("jsonSet",{column:e,path:t,value:n,alias:i})}jsonInsert(e,t,n,i){return this._json("jsonInsert",{column:e,path:t,value:n,alias:i})}jsonRemove(e,t,n){return this._json("jsonRemove",{column:e,path:t,alias:n})}_isJsonObject(e){return H(e)&&!(e instanceof f)}_whereJsonWrappedValue(e,t,n){const i={grouping:"where",type:e,column:t,value:n,not:this._not(),bool:this._bool(),asColumn:this._asColumnFlag};arguments[3]&&(i.operator=arguments[3]),arguments[4]&&(i.jsonPath=arguments[4]),this._statements.push(i)}whereJsonObject(e,t){return this._whereJsonWrappedValue("whereJsonObject",e,t),this}orWhereJsonObject(e,t){return this._bool("or").whereJsonObject(e,t)}whereNotJsonObject(e,t){return this._not(!0).whereJsonObject(e,t)}orWhereNotJsonObject(e,t){return this._bool("or").whereNotJsonObject(e,t)}whereJsonPath(e,t,n,i){return this._whereJsonWrappedValue("whereJsonPath",e,i,n,t),this}orWhereJsonPath(e,t,n,i){return this._bool("or").whereJsonPath(e,t,n,i)}whereJsonSupersetOf(e,t){return this._whereJsonWrappedValue("whereJsonSupersetOf",e,t),this}whereJsonNotSupersetOf(e,t){return this._not(!0).whereJsonSupersetOf(e,t)}orWhereJsonSupersetOf(e,t){return this._bool("or").whereJsonSupersetOf(e,t)}orWhereJsonNotSupersetOf(e,t){return this._bool("or").whereJsonNotSupersetOf(e,t)}whereJsonSubsetOf(e,t){return this._whereJsonWrappedValue("whereJsonSubsetOf",e,t),this}whereJsonNotSubsetOf(e,t){return this._not(!0).whereJsonSubsetOf(e,t)}orWhereJsonSubsetOf(e,t){return this._bool("or").whereJsonSubsetOf(e,t)}orWhereJsonNotSubsetOf(e,t){return this._bool("or").whereJsonNotSubsetOf(e,t)}whereJsonHasNone(e,t){return this._not(!0).whereJsonHasAll(e,t),this}_analytic(e,t,n){let i;const{schema:s}=this._single,o=this._analyticMethod();if(e=typeof e=="string"?e:null,_e(typeof t=="function"||t.isRawInstance||Array.isArray(t)||typeof t=="string"||typeof t=="object",`The second argument to an analytic function must be either a function, a raw,
       an array of string or object, an object or a single string.`),n&&_e(Array.isArray(n)||typeof n=="string"||typeof n=="object","The third argument to an analytic function must be either a string, an array of string or object or an object."),EC(t))i=new TC(o,s,e),t.call(i,i);else if(t.isRawInstance)i={grouping:"columns",type:"analytic",method:o,raw:t,alias:e};else{const a=Array.isArray(t)?t:[t];let u=n||[];u=Array.isArray(u)?u:[u],i={grouping:"columns",type:"analytic",method:o,order:a,alias:e,partitions:u}}return this._statements.push(i),this}rank(...e){return this._analyticMethod("rank")._analytic(...e)}denseRank(...e){return this._analyticMethod("dense_rank")._analytic(...e)}rowNumber(...e){return this._analyticMethod("row_number")._analytic(...e)}_counter(e,t){return t=parseFloat(t),this._method="update",this._single.counter=this._single.counter||{},this._single.counter[e]=t,this}_bool(e){if(arguments.length===1)return this._boolFlag=e,this;const t=this._boolFlag;return this._boolFlag="and",t}_not(e){if(arguments.length===1)return this._notFlag=e,this;const t=this._notFlag;return this._notFlag=!1,t}_joinType(e){if(arguments.length===1)return this._joinFlag=e,this;const t=this._joinFlag||"inner";return this._joinFlag="inner",t}_analyticMethod(e){return arguments.length===1?(this._analyticFlag=e,this):this._analyticFlag||"row_number"}_aggregate(e,t,n={}){return this._statements.push({grouping:"columns",type:t.isRawInstance?"aggregateRaw":"aggregate",method:e,value:t,aggregateDistinct:n.distinct||!1,alias:n.as}),this}_clearGrouping(e){e in this._single?this._single[e]=void 0:this._statements=vC(this._statements,{grouping:e})}_isSelectQuery(){return IC.has(this._method)}_hasLockMode(){return PC.has(this._single.lock)}}f.prototype.select=f.prototype.columns,f.prototype.column=f.prototype.columns,f.prototype.andWhereNot=f.prototype.whereNot,f.prototype.andWhereNotColumn=f.prototype.whereNotColumn,f.prototype.andWhere=f.prototype.where,f.prototype.andWhereColumn=f.prototype.whereColumn,f.prototype.andWhereRaw=f.prototype.whereRaw,f.prototype.andWhereBetween=f.prototype.whereBetween,f.prototype.andWhereNotBetween=f.prototype.whereNotBetween,f.prototype.andWhereJsonObject=f.prototype.whereJsonObject,f.prototype.andWhereNotJsonObject=f.prototype.whereJsonObject,f.prototype.andWhereJsonPath=f.prototype.whereJsonPath,f.prototype.andWhereLike=f.prototype.whereLike,f.prototype.andWhereILike=f.prototype.whereILike,f.prototype.andHaving=f.prototype.having,f.prototype.andHavingIn=f.prototype.havingIn,f.prototype.andHavingNotIn=f.prototype.havingNotIn,f.prototype.andHavingNull=f.prototype.havingNull,f.prototype.andHavingNotNull=f.prototype.havingNotNull,f.prototype.andHavingExists=f.prototype.havingExists,f.prototype.andHavingNotExists=f.prototype.havingNotExists,f.prototype.andHavingBetween=f.prototype.havingBetween,f.prototype.andHavingNotBetween=f.prototype.havingNotBetween,f.prototype.from=f.prototype.table,f.prototype.into=f.prototype.table,f.prototype.del=f.prototype.delete,SC(f),CC(f),f.extend=(r,e)=>{if(Object.prototype.hasOwnProperty.call(f.prototype,r))throw new Error(`Can't extend QueryBuilder with existing method ('${r}').`);bC(f.prototype,{[r]:e})};class NC{constructor(e,t){this.builder=e,this._columns=t}ignore(){return this.builder._single.onConflict=this._columns,this.builder._single.ignore=!0,this.builder}merge(e){return this.builder._single.onConflict=this._columns,this.builder._single.merge={updates:e},this.builder}then(){throw new Error("Incomplete onConflict clause. .onConflict() must be directly followed by either .merge() or .ignore()")}}var _r=f;function jC(r,e,t,n){var i=-1,s=r==null?0:r.length;for(n&&s&&(t=r[++i]);++i<s;)t=e(t,r[i],i,r);return t}var BC=jC;function qC(r,e,t,n,i){return i(r,function(s,o,a){t=n?(n=!1,s):e(t,s,o,a)}),t}var RC=qC,kC=BC,MC=Pe,LC=se,FC=RC,HC=A;function QC(r,e,t){var n=HC(r)?kC:FC,i=arguments.length<3;return n(r,LC(e),t,i,MC)}var gs=QC,WC=Zt,DC=un,UC=xi,JC=se,VC=Ze,GC=A,KC=fe,zC=Ve,YC=j,XC=pe;function ZC(r,e,t){var n=GC(r),i=n||KC(r)||XC(r);if(e=JC(e),t==null){var s=r&&r.constructor;i?t=n?new s:[]:YC(r)?t=zC(s)?DC(VC(r)):{}:t={}}return(i?WC:UC)(r,function(o,a,u){return e(t,o,a,u)}),t}var e1=ZC;const{isObject:t1}=q;function r1(r,e,t,n){const i=t.queryBuilder();return r.call(i,i),t.queryCompiler(i,n.bindings).toSQL(e||i._method||"select")}function n1(r,e,t){const n=e.queryContext();return t.wrapIdentifier((r||"").trim(),n)}function i1(r,e,t){return r===void 0?"":r===null?"null":r&&r.isRawInstance?r.toQuery():e==="bool"?(r==="false"&&(r=0),`'${r?1:0}'`):(e==="json"||e==="jsonb")&&t1(r)?`'${JSON.stringify(r)}'`:t._escapeBinding(r.toString())}var wr={compileCallback:r1,wrapAsIdentifier:n1,formatDefault:i1};const s1=e1,ys=_r,{compileCallback:vr,wrapAsIdentifier:wt}=wr,o1=["asc","desc"],a1=s1(["=","<",">","<=",">=","<>","!=","like","not like","between","not between","ilike","not ilike","exists","not exist","rlike","not rlike","regexp","not regexp","match","&","|","^","<<",">>","~","~=","~*","!~","!~*","#","&&","@>","<@","||","&<","&>","-|-","@@","!!",["?","\\?"],["?|","\\?|"],["?&","\\?&"]],(r,e)=>{Array.isArray(e)?r[e[0]]=e[1]:r[e]=e},{});function u1(r,e,t,n){const i=Array.isArray(r)?r:[r];let s="",o=-1;for(;++o<i.length;)o>0&&(s+=", "),s+=vt(i[o],void 0,e,t,n);return s}function vt(r,e,t,n,i){const s=Re(r,e,t,n,i);if(s)return s;switch(typeof r){case"function":return Me(vr(r,void 0,n,i),!0,t,n);case"object":return c1(r,t,n,i);case"number":return r;default:return ke(r+"",t,n)}}function Re(r,e,t,n,i){let s;if(r instanceof ys)return s=n.queryCompiler(r).toSQL(),s.bindings&&i.bindings.push(...s.bindings),Me(s,e,t,n);if(r&&r.isRawInstance)return r.client=n,t._queryContext&&(r.queryContext=()=>t._queryContext),s=r.toSQL(),s.bindings&&i.bindings.push(...s.bindings),s.sql;e&&i.bindings.push(r)}function l1(r,e,t,n){const i=Re(r,void 0,e,t,n);if(i)return i;const s=a1[(r||"").toLowerCase()];if(!s)throw new TypeError(`The operator "${r}" is not permitted`);return s}function ke(r,e,t){const n=r.toLowerCase().indexOf(" as ");if(n!==-1){const a=r.slice(0,n),u=r.slice(n+4);return t.alias(ke(a,e,t),wt(u,e,t))}const i=[];let s=-1;const o=r.split(".");for(;++s<o.length;)r=o[s],s===0&&o.length>1?i.push(ke((r||"").trim(),e,t)):i.push(wt(r,e,t));return i.join(".")}function c1(r,e,t,n){const i=[];for(const s in r){const o=r[s];if(typeof o=="function"){const a=vr(o,void 0,t,n);a.as=s,i.push(Me(a,!0,e,t))}else o instanceof ys?i.push(t.alias(`(${vt(o,void 0,e,t,n)})`,wt(s,e,t))):i.push(t.alias(vt(o,void 0,e,t,n),wt(s,e,t)))}return i.join(", ")}function Me(r,e,t,n){let i=r.sql||"";return i&&(r.method==="select"||r.method==="first")&&(e||r.as)&&(i=`(${i})`,r.as)?n.alias(i,ke(r.as,t,n)):i}function h1(r,e,t,n,i){return typeof r=="function"?Me(vr(r,e,n,i),void 0,t,n):Re(r,void 0,t,n,i)||""}function d1(r,e,t,n){const i=Re(r,void 0,e,t,n);return i||(o1.indexOf((r||"").toLowerCase())!==-1?r:"asc")}var ve={columnize:u1,direction:d1,operator:l1,outputQuery:Me,rawOrFn:h1,unwrapRaw:Re,wrap:vt,wrapString:ke};const{columnize:ms}=ve;function f1(r,e){const t={bindings:[]},n=r,i=r.bindings.length,s=r.bindings;let o=0;const a=r.sql.replace(/\\?\?\??/g,function(u){if(u==="\\?")return u;const c=s[o++];return u==="??"?ms(c,n,e,t):e.parameter(c,n,t)});if(i!==o)throw new Error(`Expected ${i} bindings, saw ${o}`);return{method:"raw",sql:a,bindings:t.bindings}}function p1(r,e){const t={bindings:[]},n=r,i=r.bindings,s=/\\?(:(\w+):(?=::)|:(\w+):(?!:)|:(\w+))/g;return{method:"raw",sql:r.sql.replace(s,function(a,u,c,l,h){if(a!==u)return u;const d=c||l||h,_=a.trim(),m=_[_.length-1]===":",y=i[d];return y===void 0?(Object.prototype.hasOwnProperty.call(i,d)&&t.bindings.push(y),a):m?a.replace(u,ms(y,n,e,t)):a.replace(u,e.parameter(y,n,t))}),bindings:t.bindings}}var g1={replaceKeyBindings:p1,replaceRawArrBindings:f1};const y1="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",m1="0123456789";function b1(r=21){let e="",t=r;for(;t--;)e+=y1[Math.random()*64|0];return e}function _1(r=21){let e="",t=r;for(;t--;)e+=m1[Math.random()*10|0];return e}var bs={nanoid:b1,nanonum:_1};const{EventEmitter:w1}=E,v1=ae,$1=ie,C1=Ie,T1=gs,{replaceRawArrBindings:O1,replaceKeyBindings:A1}=g1,$r=M,E1=gr,{nanoid:S1}=bs,{isNumber:I1,isObject:x1}=q,{augmentWithBuilderInterface:P1}=yr,N1=v1("knex:bindings");let $t=class extends w1{constructor(e){super(),this.client=e,this.sql="",this.bindings=[],this._wrappedBefore=void 0,this._wrappedAfter=void 0,e&&e.config&&(this._debug=e.config.debug,E1(this,4))}set(e,t){return this.sql=e,this.bindings=x1(t)&&!t.toSQL||t===void 0?t:[t],this}timeout(e,{cancel:t}={}){return I1(e)&&e>0&&(this._timeout=e,t&&(this.client.assertCanCancelQuery(),this._cancelOnTimeout=!0)),this}wrap(e,t){return this._wrappedBefore=e,this._wrappedAfter=t,this}toString(){return this.toQuery()}toSQL(e,t){let n;if(Array.isArray(this.bindings)?n=O1(this,this.client):this.bindings&&C1(this.bindings)?n=A1(this,this.client):n={method:"raw",sql:this.sql,bindings:this.bindings===void 0?[]:[this.bindings]},this._wrappedBefore&&(n.sql=this._wrappedBefore+n.sql),this._wrappedAfter&&(n.sql=n.sql+this._wrappedAfter),n.options=T1(this._options,$1,{}),this._timeout&&(n.timeout=this._timeout,this._cancelOnTimeout&&(n.cancelOnTimeout=this._cancelOnTimeout)),n.bindings=n.bindings||[],$r.containsUndefined(n.bindings)){const i=$r.getUndefinedIndices(this.bindings);throw N1(n.bindings),new Error(`Undefined binding(s) detected for keys [${i}] when compiling RAW query: ${n.sql}`)}return n.__knexQueryUid=S1(),Object.defineProperties(n,{toNative:{value:()=>({sql:this.client.positionBindings(n.sql),bindings:this.client.prepBindings(n.bindings)}),enumerable:!1}}),n}};$t.prototype.isRawInstance=!0,P1($t),$r.addQueryContext($t);var Cr=$t;function j1(r){for(var e=-1,t=r==null?0:r.length,n=0,i=[];++e<t;){var s=r[e];s&&(i[n++]=s)}return i}var B1=j1;function q1(r,e,t,n){for(var i=-1,s=r==null?0:r.length;++i<s;){var o=r[i];e(n,o,t(o),r)}return n}var R1=q1,k1=Pe;function M1(r,e,t,n){return k1(r,function(i,s,o){e(n,i,t(i),o)}),n}var L1=M1,F1=R1,H1=L1,Q1=se,W1=A;function D1(r,e){return function(t,n){var i=W1(t)?F1:H1,s=e?e():{};return i(t,r,Q1(n),s)}}var U1=D1,J1=Ye,V1=U1,G1=Object.prototype,K1=G1.hasOwnProperty,z1=V1(function(r,e,t){K1.call(r,t)?r[t].push(e):J1(r,t,[e])}),Ct=z1,Y1=Object.prototype,X1=Y1.hasOwnProperty;function Z1(r,e){return r!=null&&X1.call(r,e)}var eT=Z1,tT=eT,rT=Yi;function nT(r,e){return r!=null&&rT(r,e,tT)}var _s=nT,iT=Pe,sT=F;function oT(r,e){var t=-1,n=sT(r)?Array(r.length):[];return iT(r,function(i,s,o){n[++t]=e(i,s,o)}),n}var aT=oT,uT=We,lT=se,cT=aT,hT=A;function dT(r,e){var t=hT(r)?uT:cT;return t(r,lT(e))}var fT=dT,pT=rt,gT=gt,yT=nt,ws=j,mT=Ne;function bT(r,e,t,n){if(!ws(r))return r;e=gT(e,r);for(var i=-1,s=e.length,o=s-1,a=r;a!=null&&++i<s;){var u=mT(e[i]),c=t;if(u==="__proto__"||u==="constructor"||u==="prototype")return r;if(i!=o){var l=a[u];c=n?n(l,u,a):void 0,c===void 0&&(c=ws(l)?l:yT(e[i+1])?[]:{})}pT(a,u,c),a=a[u]}return r}var _T=bT,wT=hr,vT=_T,$T=gt;function CT(r,e,t){for(var n=-1,i=e.length,s={};++n<i;){var o=e[n],a=wT(r,o);t(a,o)&&vT(s,$T(o,r),a)}return s}var TT=CT,OT=We,AT=se,ET=TT,ST=ai;function IT(r,e){if(r==null)return{};var t=OT(ST(r),function(n){return[n]});return e=AT(e),ET(r,t,function(n,i){return e(n,i[0])})}var xT=IT,PT=se,NT=Xi,jT=xT;function BT(r,e){return jT(r,NT(PT(e)))}var qT=BT;const RT=M,$e=Cr,Tt=_r,kT=hs,MT=ae,vs=ie,Le=B1,LT=Ct,FT=_s,$s=dt,Cs=fT,HT=qT,QT=gs,{nanoid:WT}=bs,{isString:Tr,isUndefined:DT}=q,{columnize:Q,direction:Ts,operator:Fe,wrap:O,unwrapRaw:Ce,rawOrFn:J}=ve,UT=MT("knex:bindings"),JT=["columns","join","where","union","group","having","order","limit","offset","lock","waitMode"];var VT=class{constructor(e,t,n){this.client=e,this.method=t._method||"select",this.options=t._options,this.single=t._single,this.timeout=t._timeout||!1,this.cancelOnTimeout=t._cancelOnTimeout||!1,this.grouped=LT(t._statements,"grouping"),this.formatter=e.formatter(t),this._emptyInsertValue="default values",this.first=this.select,this.bindings=n||[],this.formatter.bindings=this.bindings,this.bindingsHolder=this,this.builder=this.formatter.builder}toSQL(e,t){this._undefinedInWhereClause=!1,this.undefinedBindingsInfo=[],e=e||this.method;const n=this[e]()||"",i={method:e,options:QT(this.options,vs,{}),timeout:this.timeout,cancelOnTimeout:this.cancelOnTimeout,bindings:this.bindingsHolder.bindings||[],__knexQueryUid:WT()};if(Object.defineProperties(i,{toNative:{value:()=>({sql:this.client.positionBindings(i.sql),bindings:this.client.prepBindings(i.bindings)}),enumerable:!1}}),Tr(n)?i.sql=n:vs(i,n),(e==="select"||e==="first")&&this.single.as&&(i.as=this.single.as),this._undefinedInWhereClause)throw UT(i.bindings),new Error(`Undefined binding(s) detected when compiling ${e.toUpperCase()}. Undefined column(s): [${this.undefinedBindingsInfo.join(", ")}] query: ${i.sql}`);return i}select(){let e=this.with(),t="";const n=[],i=[];JT.forEach(o=>{const a=this[o](this);switch(o){case"union":t=a;break;case"columns":case"join":case"where":n.push(a);break;default:i.push(a);break}});const s=this.grouped.union&&this.grouped.union.map(o=>o.wrap).some(o=>o);if(this.onlyUnions()){const o=Le(n.concat(i)).join(" ");e+=t+(o?" "+o:"")}else{const o=(s?"(":"")+Le(n).join(" ")+(s?")":""),a=Le(i).join(" ");e+=o+(t?" "+t:"")+(a&&" "+a)}return e}pluck(){let e=this.single.pluck;return e.indexOf(".")!==-1&&(e=e.split(".").slice(-1)[0]),{sql:this.select(),pluck:e}}insert(){const e=this.single.insert||[],t=this.with()+`insert into ${this.tableName} `,n=this._insertBody(e);return n===""?"":t+n}_onConflictClause(e){return e instanceof $e?this.formatter.wrap(e):`(${this.formatter.columnize(e)})`}_buildInsertValues(e){let t="",n=-1;for(;++n<e.values.length;)n!==0&&(t+="), ("),t+=this.client.parameterize(e.values[n],this.client.valueForUndefined,this.builder,this.bindingsHolder);return t}_insertBody(e){let t="";if(Array.isArray(e)){if(e.length===0)return""}else if(typeof e=="object"&&$s(e))return t+this._emptyInsertValue;const n=this._prepInsert(e);return typeof n=="string"?t+=n:n.columns.length?(t+=`(${Q(n.columns,this.builder,this.client,this.bindingsHolder)}`,t+=") values ("+this._buildInsertValues(n)+")"):e.length===1&&e[0]?t+=this._emptyInsertValue:t="",t}update(){const e=this.with(),{tableName:t}=this,n=this._prepUpdate(this.single.update),i=this.where();return e+`update ${this.single.only?"only ":""}${t} set `+n.join(", ")+(i?` ${i}`:"")}_hintComments(){let e=this.grouped.hintComments||[];return e=e.map(t=>Le(t.value).join(" ")),e=Le(e).join(" "),e?`/*+ ${e} */ `:""}columns(){let e="";if(this.onlyUnions())return"";const t=this._hintComments(),n=this.grouped.columns||[];let i=-1,s=[];if(n)for(;++i<n.length;){const a=n[i];if(a.distinct&&(e="distinct "),a.distinctOn){e=this.distinctOn(a.value);continue}a.type==="aggregate"?s.push(...this.aggregate(a)):a.type==="aggregateRaw"?s.push(this.aggregateRaw(a)):a.type==="analytic"?s.push(this.analytic(a)):a.type==="json"?s.push(this.json(a)):a.value&&a.value.length>0&&s.push(Q(a.value,this.builder,this.client,this.bindingsHolder))}return s.length===0&&(s=["*"]),`${this.onlyJson()?"":"select "}${t}${e}`+s.join(", ")+(this.tableName?` from ${this.single.only?"only ":""}${this.tableName}`:"")}_aggregate(e,{aliasSeparator:t=" as ",distinctParentheses:n}={}){const i=e.value,s=e.method,o=e.aggregateDistinct?"distinct ":"",a=m=>O(m,void 0,this.builder,this.client,this.bindingsHolder),u=(m,y)=>y?m+t+a(y):m,c=(m,y)=>{let b=m.map(a).join(", ");if(o){const N=n?"(":" ",Oe=n?")":"";b=o.trim()+N+b+Oe}const $=`${s}(${b})`;return u($,y)},l=(m,y)=>{const b=`${s}(${o+a(m)})`;return u(b,y)};if(Array.isArray(i))return[c(i)];if(typeof i=="object"){if(e.alias)throw new Error("When using an object explicit alias can not be used");return Object.entries(i).map(([m,y])=>Array.isArray(y)?c(y,m):l(y,m))}const h=i.toLowerCase().indexOf(" as ");let d=i,{alias:_}=e;if(h!==-1){if(d=i.slice(0,h),_)throw new Error(`Found multiple aliases for same column: ${d}`);_=i.slice(h+4)}return[l(d,_)]}aggregate(e){return this._aggregate(e)}aggregateRaw(e){const t=e.aggregateDistinct?"distinct ":"";return`${e.method}(${t+Ce(e.value,void 0,this.builder,this.client,this.bindingsHolder)})`}_joinTable(e){return e.schema&&!(e.table instanceof $e)?`${e.schema}.${e.table}`:e.table}join(){let e="",t=-1;const n=this.grouped.join;if(!n)return"";for(;++t<n.length;){const i=n[t],s=this._joinTable(i);if(t>0&&(e+=" "),i.joinType==="raw")e+=Ce(i.table,void 0,this.builder,this.client,this.bindingsHolder);else{e+=i.joinType+" join "+O(s,void 0,this.builder,this.client,this.bindingsHolder);let o=-1;for(;++o<i.clauses.length;){const a=i.clauses[o];o>0?e+=` ${a.bool} `:e+=` ${a.type==="onUsing"?"using":"on"} `;const u=this[a.type](a);u&&(e+=u)}}}return e}onBetween(e){return O(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" "+this._not(e,"between")+" "+e.value.map(t=>this.client.parameter(t,this.builder,this.bindingsHolder)).join(" and ")}onNull(e){return O(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" is "+this._not(e,"null")}onExists(e){return this._not(e,"exists")+" ("+J(e.value,void 0,this.builder,this.client,this.bindingsHolder)+")"}onIn(e){if(Array.isArray(e.column))return this.multiOnIn(e);let t;return e.value instanceof $e?t=this.client.parameter(e.value,this.builder,this.formatter):t=this.client.parameterize(e.value,void 0,this.builder,this.bindingsHolder),O(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" "+this._not(e,"in ")+this.wrap(t)}multiOnIn(e){let t=-1,n=`(${Q(e.column,this.builder,this.client,this.bindingsHolder)}) `;for(n+=this._not(e,"in ")+"((";++t<e.value.length;)t!==0&&(n+="),("),n+=this.client.parameterize(e.value[t],void 0,this.builder,this.bindingsHolder);return n+"))"}where(){const e=this.grouped.where;if(!e)return;const t=[];let n=-1;for(;++n<e.length;){const i=e[n];Object.prototype.hasOwnProperty.call(i,"value")&&RT.containsUndefined(i.value)&&(this.undefinedBindingsInfo.push(i.column),this._undefinedInWhereClause=!0);const s=this[i.type](i);s&&(t.length===0?t[0]="where":t.push(i.bool),t.push(s))}return t.length>1?t.join(" "):""}group(){return this._groupsOrders("group")}order(){return this._groupsOrders("order")}having(){const e=this.grouped.having;if(!e)return"";const t=["having"];for(let n=0,i=e.length;n<i;n++){const s=e[n],o=this[s.type](s);o&&(t.length===0&&(t[0]="where"),(t.length>1||t.length===1&&t[0]!=="having")&&t.push(s.bool),t.push(o))}return t.length>1?t.join(" "):""}havingRaw(e){return this._not(e,"")+Ce(e.value,void 0,this.builder,this.client,this.bindingsHolder)}havingWrapped(e){const t=J(e.value,"where",this.builder,this.client,this.bindingsHolder);return t&&this._not(e,"")+"("+t.slice(6)+")"||""}havingBasic(e){return this._not(e,"")+O(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" "+Fe(e.operator,this.builder,this.client,this.bindingsHolder)+" "+this.client.parameter(e.value,this.builder,this.bindingsHolder)}havingNull(e){return O(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" is "+this._not(e,"null")}havingExists(e){return this._not(e,"exists")+" ("+J(e.value,void 0,this.builder,this.client,this.bindingsHolder)+")"}havingBetween(e){return O(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" "+this._not(e,"between")+" "+e.value.map(t=>this.client.parameter(t,this.builder,this.bindingsHolder)).join(" and ")}havingIn(e){return Array.isArray(e.column)?this.multiHavingIn(e):O(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" "+this._not(e,"in ")+this.wrap(this.client.parameterize(e.value,void 0,this.builder,this.bindingsHolder))}multiHavingIn(e){return this.multiOnIn(e)}union(){const e=this.onlyUnions(),t=this.grouped.union;if(!t)return"";let n="";for(let i=0,s=t.length;i<s;i++){const o=t[i];i>0&&(n+=" "),(i>0||!e)&&(n+=o.clause+" ");const a=J(o.value,void 0,this.builder,this.client,this.bindingsHolder);if(a){const u=o.wrap;u&&(n+="("),n+=a,u&&(n+=")")}}return n}onlyUnions(){return(!this.grouped.columns||!!this.grouped.columns[0].value)&&this.grouped.union&&!this.tableName}_getValueOrParameterFromAttribute(e,t){return this.single.skipBinding[e]===!0?t??this.single[e]:this.client.parameter(this.single[e],this.builder,this.bindingsHolder)}onlyJson(){return!this.tableName&&this.grouped.columns&&this.grouped.columns.length===1&&this.grouped.columns[0].type==="json"}limit(){return!this.single.limit&&this.single.limit!==0?"":`limit ${this._getValueOrParameterFromAttribute("limit")}`}offset(){return this.single.offset?`offset ${this._getValueOrParameterFromAttribute("offset")}`:""}del(){const{tableName:e}=this,t=this.with(),n=this.where(),i=this.join(),s=i?e+" ":"";return t+`delete ${s}from ${this.single.only?"only ":""}${e}`+(i?` ${i}`:"")+(n?` ${n}`:"")}truncate(){return`truncate ${this.tableName}`}lock(){if(this.single.lock)return this[this.single.lock]()}waitMode(){if(this.single.waitMode)return this[this.single.waitMode]()}skipLocked(){throw new Error(".skipLocked() is currently only supported on MySQL 8.0+ and PostgreSQL 9.5+")}noWait(){throw new Error(".noWait() is currently only supported on MySQL 8.0+, MariaDB 10.3.0+ and PostgreSQL 9.5+")}distinctOn(e){throw new Error(".distinctOn() is currently only supported on PostgreSQL")}onWrapped(e){const t=this,n=new kT;e.value.call(n,n);let i="";for(let s=0;s<n.clauses.length;s++){const o=n.clauses[s];s>0&&(i+=` ${o.bool} `);const a=t[o.type](o);a&&(i+=a)}return i.length?`(${i})`:""}onBasic(e){const t=e.value instanceof Tt;return O(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" "+Fe(e.operator,this.builder,this.client,this.bindingsHolder)+" "+(t?"(":"")+O(e.value,void 0,this.builder,this.client,this.bindingsHolder)+(t?")":"")}onVal(e){return O(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" "+Fe(e.operator,this.builder,this.client,this.bindingsHolder)+" "+this.client.parameter(e.value,this.builder,this.bindingsHolder)}onRaw(e){return Ce(e.value,void 0,this.builder,this.client,this.bindingsHolder)}onUsing(e){return"("+Q(e.column,this.builder,this.client,this.bindingsHolder)+")"}_valueClause(e){return e.asColumn?O(e.value,void 0,this.builder,this.client,this.bindingsHolder):this.client.parameter(e.value,this.builder,this.bindingsHolder)}_columnClause(e){let t;return Array.isArray(e.column)?t=`(${Q(e.column,this.builder,this.client,this.bindingsHolder)})`:t=O(e.column,void 0,this.builder,this.client,this.bindingsHolder),t}whereIn(e){const t=this.client.values(e.value,this.builder,this.bindingsHolder);return`${this._columnClause(e)} ${this._not(e,"in ")}${t}`}whereLike(e){return`${this._columnClause(e)} ${this._not(e,"like ")}${this._valueClause(e)}`}whereILike(e){return`${this._columnClause(e)} ${this._not(e,"ilike ")}${this._valueClause(e)}`}whereNull(e){return O(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" is "+this._not(e,"null")}whereBasic(e){return this._not(e,"")+O(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" "+Fe(e.operator,this.builder,this.client,this.bindingsHolder)+" "+this._valueClause(e)}whereExists(e){return this._not(e,"exists")+" ("+J(e.value,void 0,this.builder,this.client,this.bindingsHolder)+")"}whereWrapped(e){const t=J(e.value,"where",this.builder,this.client,this.bindingsHolder);return t&&this._not(e,"")+"("+t.slice(6)+")"||""}whereBetween(e){return O(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" "+this._not(e,"between")+" "+e.value.map(t=>this.client.parameter(t,this.builder,this.bindingsHolder)).join(" and ")}whereRaw(e){return this._not(e,"")+Ce(e.value,void 0,this.builder,this.client,this.bindingsHolder)}_jsonWrapValue(e){if(!this.builder._isJsonObject(e))try{return JSON.stringify(JSON.parse(e.replace(/\n|\t/g,"")))}catch{return e}return JSON.stringify(e)}_jsonValueClause(e){return e.value=this._jsonWrapValue(e.value),this._valueClause(e)}whereJsonObject(e){return`${this._columnClause(e)} ${e.not?"!=":"="} ${this._jsonValueClause(e)}`}wrap(e){return e.charAt(0)!=="("?`(${e})`:e}json(e){return this[e.method](e.params)}analytic(e){let t="";const n=this;return t+=e.method+"() over (",e.raw?t+=e.raw:(e.partitions.length&&(t+="partition by ",t+=Cs(e.partitions,function(i){return Tr(i)?n.formatter.columnize(i):n.formatter.columnize(i.column)+(i.order?" "+i.order:"")}).join(", ")+" "),t+="order by ",t+=Cs(e.order,function(i){return Tr(i)?n.formatter.columnize(i):n.formatter.columnize(i.column)+(i.order?" "+i.order:"")}).join(", ")),t+=")",e.alias&&(t+=" as "+e.alias),t}with(){if(!this.grouped.with||!this.grouped.with.length)return"";const e=this.grouped.with;if(!e)return;const t=[];let n=-1,i=!1;for(;++n<e.length;){const s=e[n];s.recursive&&(i=!0);const o=this[s.type](s);t.push(o)}return`with ${i?"recursive ":""}${t.join(", ")} `}withWrapped(e){const t=J(e.value,void 0,this.builder,this.client,this.bindingsHolder),n=e.columnList?"("+Q(e.columnList,this.builder,this.client,this.bindingsHolder)+")":"",i=e.materialized===void 0?"":e.materialized?"materialized ":"not materialized ";return t&&Q(e.alias,this.builder,this.client,this.bindingsHolder)+n+" as "+i+"("+t+")"||""}_not(e,t){return e.not?`not ${t}`:t}_prepInsert(e){const t=J(e,void 0,this.builder,this.client,this.bindingsHolder);if(t)return t;let n=[];const i=[];Array.isArray(e)||(e=e?[e]:[]);let s=-1;for(;++s<e.length&&e[s]!=null;){s===0&&(n=Object.keys(e[s]).sort());const o=new Array(n.length),a=Object.keys(e[s]);let u=-1;for(;++u<a.length;){const c=a[u];let l=n.indexOf(c);if(l===-1){n=n.concat(c).sort(),l=n.indexOf(c);let h=-1;for(;++h<i.length;)i[h].splice(l,0,void 0);o.splice(l,0,void 0)}o[l]=e[s][c]}i.push(o)}return{columns:n,values:i}}_prepUpdate(e={}){const{counter:t={}}=this.single;for(const o of Object.keys(t)){if(FT(e,o)){this.client.logger.warn("increment/decrement called for a column that has already been specified in main .update() call. Ignoring increment/decrement and using value from .update() call.");continue}let a=t[o];const u=a<0?"-":"+";u==="-"&&(a=-a),e[o]=this.client.raw(`?? ${u} ?`,[o,a])}e=HT(e,DT);const n=[],i=Object.keys(e);let s=-1;for(;++s<i.length;)n.push(O(i[s],void 0,this.builder,this.client,this.bindingsHolder)+" = "+this.client.parameter(e[i[s]],this.builder,this.bindingsHolder));if($s(n))throw new Error(["Empty .update() call detected!","Update data does not contain any values to update.","This will result in a faulty query.",this.single.table?`Table: ${this.single.table}.`:"",this.single.update?`Columns: ${Object.keys(this.single.update)}.`:""].join(" "));return n}_formatGroupsItemValue(e,t){const{formatter:n}=this;let i="";t==="last"?i=" is null":t==="first"&&(i=" is not null");let s;return e instanceof $e?s=Ce(e,void 0,this.builder,this.client,this.bindingsHolder):e instanceof Tt||t?s="("+n.columnize(e)+i+")":s=n.columnize(e),s}_basicGroupOrder(e,t){const n=this._formatGroupsItemValue(e.value,e.nulls),i=t==="order"&&e.type!=="orderByRaw"?` ${Ts(e.direction,this.builder,this.client,this.bindingsHolder)}`:"";return n+i}_groupOrder(e,t){return this._basicGroupOrder(e,t)}_groupOrderNulls(e,t){const n=this._formatGroupsItemValue(e.value),i=t==="order"&&e.type!=="orderByRaw"?` ${Ts(e.direction,this.builder,this.client,this.bindingsHolder)}`:"";return e.nulls&&!(e.value instanceof $e)?`${n}${i||""} nulls ${e.nulls}`:n+i}_groupsOrders(e){const t=this.grouped[e];if(!t)return"";const n=t.map(i=>this._groupOrder(i,e));return n.length?e+" by "+n.join(", "):""}get tableName(){if(!this._tableName){let e=this.single.table;const t=this.single.schema;if(e&&t){const n=e instanceof Tt,i=e instanceof $e;!n&&!i&&!(typeof e=="function")&&(e=`${t}.${e}`)}this._tableName=e?O(e,e instanceof Tt,this.builder,this.client,this.bindingsHolder):""}return this._tableName}_jsonPathWrap(e){return this.client.parameter(e.path||e[1],this.builder,this.bindingsHolder)}_jsonExtract(e,t){let n;return Array.isArray(t.column)?n=t.column:n=[t],Array.isArray(e)||(e=[e]),n.map(i=>{let s=`${Q(i.column||i[0],this.builder,this.client,this.bindingsHolder)}, ${this._jsonPathWrap(i)}`;e.forEach(a=>{s=a+"("+s+")"});const o=i.alias||i[2];return o?this.client.alias(s,this.formatter.wrap(o)):s}).join(", ")}_jsonSet(e,t){const n=`${e}(${Q(t.column,this.builder,this.client,this.bindingsHolder)}, ${this.client.parameter(t.path,this.builder,this.bindingsHolder)}, ${this.client.parameter(t.value,this.builder,this.bindingsHolder)})`;return t.alias?this.client.alias(n,this.formatter.wrap(t.alias)):n}_whereJsonPath(e,t){return`${e}(${this._columnClause(t)}, ${this._jsonPathWrap({path:t.jsonPath})}) ${Fe(t.operator,this.builder,this.client,this.bindingsHolder)} ${this._jsonValueClause(t)}`}_onJsonPathEquals(e,t){return e+"("+O(t.columnFirst,void 0,this.builder,this.client,this.bindingsHolder)+", "+this.client.parameter(t.jsonPathFirst,this.builder,this.bindingsHolder)+") = "+e+"("+O(t.columnSecond,void 0,this.builder,this.client,this.bindingsHolder)+", "+this.client.parameter(t.jsonPathSecond,this.builder,this.bindingsHolder)+")"}};const{EventEmitter:GT}=E,KT=mt,zT=ie,{addQueryContext:YT}=M,XT=gr,{augmentWithBuilderInterface:ZT}=yr;let oe=class extends GT{constructor(e){super(),this.client=e,this._sequence=[],e.config&&(this._debug=e.config.debug,XT(this,4))}withSchema(e){return this._schema=e,this}toString(){return this.toQuery()}toSQL(){return this.client.schemaCompiler(this).toSQL()}async generateDdlCommands(){return await this.client.schemaCompiler(this).generateDdlCommands()}};["createTable","createTableIfNotExists","createTableLike","createView","createViewOrReplace","createMaterializedView","refreshMaterializedView","dropView","dropViewIfExists","dropMaterializedView","dropMaterializedViewIfExists","createSchema","createSchemaIfNotExists","dropSchema","dropSchemaIfExists","createExtension","createExtensionIfNotExists","dropExtension","dropExtensionIfExists","table","alterTable","view","alterView","hasTable","hasColumn","dropTable","renameTable","renameView","dropTableIfExists","raw"].forEach(function(r){oe.prototype[r]=function(){return r==="createTableIfNotExists"&&this.client.logger.warn(["Use async .hasTable to check if table exists and then use plain .createTable. Since ",'.createTableIfNotExists actually just generates plain "CREATE TABLE IF NOT EXIST..." ',"query it will not work correctly if there are any alter table queries generated for ","columns afterwards. To not break old migrations this function is left untouched for now",", but it should not be used when writing new code and it is removed from documentation."].join("")),r==="table"&&(r="alterTable"),r==="view"&&(r="alterView"),this._sequence.push({method:r,args:KT(arguments)}),this}}),oe.extend=(r,e)=>{if(Object.prototype.hasOwnProperty.call(oe.prototype,r))throw new Error(`Can't extend SchemaBuilder with existing method ('${r}').`);zT(oe.prototype,{[r]:e})},ZT(oe),YT(oe);var eO=oe;const tO=yt,{isString:Os}=q;function rO(r){r&&(Os(r)&&(r={sql:r}),r.bindings||(r.bindings=this.bindingsHolder.bindings),this.sequence.push(r),this.formatter=this.client.formatter(this._commonBuilder),this.bindings=[],this.formatter.bindings=this.bindings)}function nO(r){const e=new this.constructor(this.client,this.tableCompiler,this.columnBuilder);r.call(e,tO(arguments)),this.sequence.additional=(this.sequence.additional||[]).concat(e.sequence)}function iO(r){r&&(Os(r)&&(r={sql:r}),r.bindings||(r.bindings=this.bindingsHolder.bindings),this.sequence.unshift(r),this.formatter=this.client.formatter(this._commonBuilder),this.bindings=[],this.formatter.bindings=this.bindings)}var Ot={pushAdditional:nO,pushQuery:rO,unshiftQuery:iO};const{pushQuery:sO,pushAdditional:oO,unshiftQuery:aO}=Ot;let S=class{constructor(e,t){this.builder=t,this._commonBuilder=this.builder,this.client=e,this.schema=t._schema,this.bindings=[],this.bindingsHolder=this,this.formatter=e.formatter(t),this.formatter.bindings=this.bindings,this.sequence=[]}createSchema(){St("createSchema")}createSchemaIfNotExists(){St("createSchemaIfNotExists")}dropSchema(){St("dropSchema")}dropSchemaIfExists(){St("dropSchemaIfExists")}dropTable(e){this.pushQuery(this.dropTablePrefix+this.formatter.wrap(Ar(this.schema,e)))}dropTableIfExists(e){this.pushQuery(this.dropTablePrefix+"if exists "+this.formatter.wrap(Ar(this.schema,e)))}dropView(e){this._dropView(e,!1,!1)}dropViewIfExists(e){this._dropView(e,!0,!1)}dropMaterializedView(e){throw new Error("materialized views are not supported by this dialect.")}dropMaterializedViewIfExists(e){throw new Error("materialized views are not supported by this dialect.")}renameView(e,t){throw new Error("rename view is not supported by this dialect (instead drop then create another view).")}refreshMaterializedView(){throw new Error("materialized views are not supported by this dialect.")}_dropView(e,t,n){this.pushQuery((n?this.dropMaterializedViewPrefix:this.dropViewPrefix)+(t?"if exists ":"")+this.formatter.wrap(Ar(this.schema,e)))}raw(e,t){this.sequence.push(this.client.raw(e,t).toSQL())}toSQL(){const e=this.builder._sequence;for(let t=0,n=e.length;t<n;t++){const i=e[t];this[i.method].apply(this,i.args)}return this.sequence}async generateDdlCommands(){const e=this.toSQL();return{pre:[],sql:Array.isArray(e)?e:[e],check:null,post:[]}}};S.prototype.dropTablePrefix="drop table ",S.prototype.dropViewPrefix="drop view ",S.prototype.dropMaterializedViewPrefix="drop materialized view ",S.prototype.alterViewPrefix="alter view ",S.prototype.alterTable=At("alter"),S.prototype.createTable=At("create"),S.prototype.createTableIfNotExists=At("createIfNot"),S.prototype.createTableLike=At("createLike"),S.prototype.createView=Et("create"),S.prototype.createViewOrReplace=Et("createOrReplace"),S.prototype.createMaterializedView=Et("createMaterializedView"),S.prototype.alterView=Et("alter"),S.prototype.pushQuery=sO,S.prototype.pushAdditional=oO,S.prototype.unshiftQuery=aO;function Or(r){const e=this.builder.queryContext();e!==void 0&&r.queryContext()===void 0&&r.queryContext(e),r.setSchema(this.schema);const t=r.toSQL();for(let n=0,i=t.length;n<i;n++)this.sequence.push(t[n])}function At(r){return r==="createLike"?function(e,t,n){const i=this.client.tableBuilder(r,e,t,n);Or.call(this,i)}:function(e,t){const n=this.client.tableBuilder(r,e,null,t);Or.call(this,n)}}function Et(r){return function(e,t){const n=this.client.viewBuilder(r,e,t);Or.call(this,n)}}function Ar(r,e){return r?`${r}.${e}`:e}function St(r){throw new Error(`${r} is not supported for this dialect (only PostgreSQL supports it currently).`)}var uO=S,lO=Z,cO=Wt,hO=ee,dO=cO(function(r,e){lO(e,hO(e),r)}),fO=dO,Er=fO;const pO=Pi,As=Er,gO=ie,It=mt,yO=M,{isString:mO,isFunction:bO,isObject:_O}=q;let V=class{constructor(e,t,n,i,s){if(this.client=e,this._fn=s,this._method=t,this._schemaName=void 0,this._tableName=n,this._tableNameLike=i,this._statements=[],this._single={},!i&&!bO(this._fn))throw new TypeError("A callback function must be supplied to calls against `.createTable` and `.table`")}setSchema(e){this._schemaName=e}toSQL(){return this._method==="alter"&&As(this,Sr),this._fn&&this._fn.call(this,this),this.client.tableCompiler(this).toSQL()}timestamps(e,t,n){_O(e)&&({useTimestamps:e,defaultToNow:t,useCamelCase:n}=e);const i=e===!0?"timestamp":"datetime",s=this[i](n?"createdAt":"created_at"),o=this[i](n?"updatedAt":"updated_at");if(t===!0){const a=this.client.raw("CURRENT_TIMESTAMP");s.notNullable().defaultTo(a),o.notNullable().defaultTo(a)}}comment(e){if(typeof e!="string")throw new TypeError("Table comment must be string");this._single.comment=e}foreign(e,t){const n={column:e,keyName:t};this._statements.push({grouping:"alterTable",method:"foreign",args:[n]});let i={references(s){let o;return mO(s)&&(o=s.split(".")),!o||o.length===1?(n.references=o?o[0]:s,{on(a){if(typeof a!="string")throw new TypeError(`Expected tableName to be a string, got: ${typeof a}`);return n.inTable=a,i},inTable(){return this.on.apply(this,arguments)}}):(n.inTable=o[0],n.references=o[1],i)},withKeyName(s){return n.keyName=s,i},onUpdate(s){return n.onUpdate=s,i},onDelete(s){return n.onDelete=s,i},deferrable:s=>{if(["mysql","mssql","redshift","mysql2","oracledb"].indexOf(this.client.dialect)!==-1)throw new Error(`${this.client.dialect} does not support deferrable`);return n.deferrable=s,i},_columnBuilder(s){return As(s,i),i=s,s}};return i}check(e,t,n){return this._statements.push({grouping:"checks",args:[e,t,n]}),this}};["index","primary","unique","dropPrimary","dropUnique","dropIndex","dropForeign"].forEach(r=>{V.prototype[r]=function(){return this._statements.push({grouping:"alterTable",method:r,args:It(arguments)}),this}}),pO({mysql:["engine","charset","collate"],postgresql:["inherits"]},function(r,e){r.forEach(function(t){V.prototype[t]=function(n){if(this.client.dialect!==e)throw new Error(`Knex only supports ${t} statement with ${e}.`);if(this._method==="alter")throw new Error(`Knex does not support altering the ${t} outside of create table, please use knex.raw statement.`);this._single[t]=n}})}),yO.addQueryContext(V),["tinyint","smallint","mediumint","int","bigint","decimal","float","double","real","bit","boolean","serial","date","datetime","timestamp","time","year","geometry","geography","point","char","varchar","tinytext","tinyText","text","mediumtext","mediumText","longtext","longText","binary","varbinary","tinyblob","tinyBlob","mediumblob","mediumBlob","blob","longblob","longBlob","enum","set","bool","dateTime","increments","bigincrements","bigIncrements","integer","biginteger","bigInteger","string","json","jsonb","uuid","enu","specificType"].forEach(r=>{V.prototype[r]=function(){const e=It(arguments),t=this.client.columnBuilder(this,r,e);return this._statements.push({grouping:"columns",builder:t}),t}});const Sr={renameColumn(r,e){return this._statements.push({grouping:"alterTable",method:"renameColumn",args:[r,e]}),this},dropTimestamps(){return this.dropColumns(arguments[0]===!0?["createdAt","updatedAt"]:["created_at","updated_at"])},setNullable(r){return this._statements.push({grouping:"alterTable",method:"setNullable",args:[r]}),this},check(r,e,t){this._statements.push({grouping:"alterTable",method:"check",args:[r,e,t]})},dropChecks(){this._statements.push({grouping:"alterTable",method:"dropChecks",args:It(arguments)})},dropNullable(r){return this._statements.push({grouping:"alterTable",method:"dropNullable",args:[r]}),this}};Sr.dropColumn=Sr.dropColumns=function(){return this._statements.push({grouping:"alterTable",method:"dropColumn",args:It(arguments)}),this},V.extend=(r,e)=>{if(Object.prototype.hasOwnProperty.call(V.prototype,r))throw new Error(`Can't extend TableBuilder with existing method ('${r}').`);gO(V.prototype,{[r]:e})};var wO=V;function vO(r,e,t,n){for(var i=r.length,s=t+(n?1:-1);n?s--:++s<i;)if(e(r[s],s,r))return s;return-1}var $O=vO;function CO(r){return r!==r}var TO=CO;function OO(r,e,t){for(var n=t-1,i=r.length;++n<i;)if(r[n]===e)return n;return-1}var AO=OO,EO=$O,SO=TO,IO=AO;function xO(r,e,t){return e===e?IO(r,e,t):EO(r,SO,t)}var PO=xO,NO=PO,jO=xn,BO=Math.max;function qO(r,e,t){var n=r==null?0:r.length;if(!n)return-1;var i=t==null?0:jO(t);return i<0&&(i=BO(n+i,0)),NO(r,e,i)}var RO=qO;const{pushAdditional:kO,pushQuery:MO,unshiftQuery:LO}=Ot,FO=M,HO=Ct,QO=RO,Es=dt,WO=yt,{normalizeArr:DO}=M;let L=class{constructor(e,t){this.client=e,this.tableBuilder=t,this._commonBuilder=this.tableBuilder,this.method=t._method,this.schemaNameRaw=t._schemaName,this.tableNameRaw=t._tableName,this.tableNameLikeRaw=t._tableNameLike,this.single=t._single,this.grouped=HO(t._statements,"grouping"),this.formatter=e.formatter(t),this.bindings=[],this.formatter.bindings=this.bindings,this.bindingsHolder=this,this.sequence=[],this._formatting=e.config&&e.config.formatting,this.checksCount=0}toSQL(){return this[this.method](),this.sequence}create(e,t){const i=this.getColumns().map(o=>o.toSQL()),s=this.getColumnTypes(i);this.createAlterTableMethods&&this.alterTableForCreate(s),this.createQuery(s,e,t),this.columnQueries(i),delete this.single.comment,this.alterTable()}createIfNot(){this.create(!0)}createLike(){this.create(!1,!0)}createLikeIfNot(){this.create(!0,!0)}alter(){const t=this.getColumns().map(a=>a.toSQL()),n=this.getColumns("alter"),i=n.map(a=>a.toSQL()),s=this.getColumnTypes(t),o=this.getColumnTypes(i);this.addColumns(s),this.alterColumns(o,n),this.columnQueries(t),this.columnQueries(i),this.alterTable()}foreign(e){if(e.inTable&&e.references){const t=e.keyName?this.formatter.wrap(e.keyName):this._indexCommand("foreign",this.tableNameRaw,e.column),n=this.formatter.columnize(e.column),i=this.formatter.columnize(e.references),s=this.formatter.wrap(e.inTable),o=e.onUpdate?(this.lowerCase?" on update ":" ON UPDATE ")+e.onUpdate:"",a=e.onDelete?(this.lowerCase?" on delete ":" ON DELETE ")+e.onDelete:"",u=e.deferrable?this.lowerCase?` deferrable initially ${e.deferrable.toLowerCase()} `:` DEFERRABLE INITIALLY ${e.deferrable.toUpperCase()} `:"";this.lowerCase?this.pushQuery((this.forCreate?"":`alter table ${this.tableName()} add `)+"constraint "+t+" foreign key ("+n+") references "+s+" ("+i+")"+o+a+u):this.pushQuery((this.forCreate?"":`ALTER TABLE ${this.tableName()} ADD `)+"CONSTRAINT "+t+" FOREIGN KEY ("+n+") REFERENCES "+s+" ("+i+")"+o+a+u)}}getColumnTypes(e){return e.reduce(function(t,n){const i=n[0];return t.sql.push(i.sql),t.bindings.concat(i.bindings),t},{sql:[],bindings:[]})}columnQueries(e){const t=e.reduce(function(n,i){const s=WO(i);return Es(s)?n:n.concat(s)},[]);for(const n of t)this.pushQuery(n)}addColumns(e,t){if(t=t||this.addColumnsPrefix,e.sql.length>0){const n=e.sql.map(i=>t+i);this.pushQuery({sql:(this.lowerCase?"alter table ":"ALTER TABLE ")+this.tableName()+" "+n.join(", "),bindings:e.bindings})}}alterColumns(e,t){e.sql.length>0&&this.addColumns(e,this.alterColumnsPrefix,t)}getColumns(e){const t=this.grouped.columns||[];e=e||"add";const n=this.tableBuilder.queryContext();return t.filter(i=>i.builder._method===e).map(i=>(n!==void 0&&i.builder.queryContext()===void 0&&i.builder.queryContext(n),this.client.columnCompiler(this,i.builder)))}tableName(){const e=this.schemaNameRaw?`${this.schemaNameRaw}.${this.tableNameRaw}`:this.tableNameRaw;return this.formatter.wrap(e)}tableNameLike(){const e=this.schemaNameRaw?`${this.schemaNameRaw}.${this.tableNameLikeRaw}`:this.tableNameLikeRaw;return this.formatter.wrap(e)}alterTable(){const e=this.grouped.alterTable||[];for(let t=0,n=e.length;t<n;t++){const i=e[t];this[i.method]?this[i.method].apply(this,i.args):this.client.logger.error(`Debug: ${i.method} does not exist`)}for(const t in this.single)typeof this[t]=="function"&&this[t](this.single[t])}alterTableForCreate(e){this.forCreate=!0;const t=this.sequence,n=this.grouped.alterTable||[];this.grouped.alterTable=[];for(let i=0,s=n.length;i<s;i++){const o=n[i];if(QO(this.createAlterTableMethods,o.method)<0){this.grouped.alterTable.push(o);continue}this[o.method]?(this.sequence=[],this[o.method].apply(this,o.args),e.sql.push(this.sequence[0].sql)):this.client.logger.error(`Debug: ${o.method} does not exist`)}this.sequence=t,this.forCreate=!1}dropIndex(e){this.pushQuery(`drop index${e}`)}dropUnique(){throw new Error("Method implemented in the dialect driver")}dropForeign(){throw new Error("Method implemented in the dialect driver")}dropColumn(){const e=FO.normalizeArr.apply(null,arguments),t=(Array.isArray(e)?e:[e]).map(n=>this.dropColumnPrefix+this.formatter.wrap(n));this.pushQuery((this.lowerCase?"alter table ":"ALTER TABLE ")+this.tableName()+" "+t.join(", "))}_setNullableState(e,t){const n=this.tableName(),i=this.formatter.columnize(e),s=this.alterColumnsPrefix;return this.pushQuery({sql:"SELECT 1",output:()=>this.client.queryBuilder().from(this.tableNameRaw).columnInfo(e).then(o=>{if(Es(o))throw new Error(`.setNullable: Column ${i} does not exist in table ${n}.`);const a=t?"null":"not null",u=o.type+(o.maxLength?`(${o.maxLength})`:""),c=o.defaultValue!==null&&o.defaultValue!==void 0?`default '${o.defaultValue}'`:"",l=`alter table ${n} ${s} ${i} ${u} ${a} ${c}`;return this.client.raw(l)})})}setNullable(e){return this._setNullableState(e,!0)}dropNullable(e){return this._setNullableState(e,!1)}dropChecks(e){if(e===void 0)return"";e=DO(e);const n=`alter table ${this.tableName()} ${e.map(i=>`drop constraint ${i}`).join(", ")}`;this.pushQuery(n)}check(e,t,n){const i=this.tableName();let s=n;s||(this.checksCount++,s=i+"_"+this.checksCount);const o=`alter table ${i} add constraint ${s} check(${e})`;this.pushQuery(o)}_addChecks(){return this.grouped.checks?", "+this.grouped.checks.map(e=>`${e.args[2]?"constraint "+e.args[2]+" ":""}check (${this.client.raw(e.args[0],e.args[1])})`).join(", "):""}_indexCommand(e,t,n){Array.isArray(n)||(n=n?[n]:[]);const s=(t.replace(/\.|-/g,"_")+"_"+n.join("_")+"_"+e).toLowerCase();return this.formatter.wrap(s)}_getPrimaryKeys(){return(this.grouped.alterTable||[]).filter(e=>e.method==="primary").flatMap(e=>e.args).flat()}_canBeAddPrimaryKey(e){return e.primaryKey&&this._getPrimaryKeys().length===0}_getIncrementsColumnNames(){return this.grouped.columns.filter(e=>e.builder._type==="increments").map(e=>e.builder._args[0])}};L.prototype.pushQuery=MO,L.prototype.pushAdditional=kO,L.prototype.unshiftQuery=LO,L.prototype.lowerCase=!0,L.prototype.createAlterTableMethods=null,L.prototype.addColumnsPrefix="add column ",L.prototype.alterColumnsPrefix="alter column ",L.prototype.modifyColumnPrefix="modify column ",L.prototype.dropColumnPrefix="drop column ";var UO=L;const JO=Er,VO=ie,Ss=mt,{addQueryContext:GO}=M;let W=class{constructor(e,t,n,i){this.client=e,this._method="add",this._single={},this._modifiers={},this._statements=[],this._type=YO[n]||n,this._args=i,this._tableBuilder=t,t._method==="alter"&&JO(this,xt)}references(e){return this._tableBuilder.foreign.call(this._tableBuilder,this._args[0],void 0,this)._columnBuilder(this).references(e)}};const KO=["default","defaultsTo","defaultTo","unsigned","nullable","first","after","comment","collate","check","checkPositive","checkNegative","checkIn","checkNotIn","checkBetween","checkLength","checkRegex"],zO={default:"defaultTo",defaultsTo:"defaultTo"};KO.forEach(function(r){const e=zO[r]||r;W.prototype[r]=function(){return this._modifiers[e]=Ss(arguments),this}}),GO(W),W.prototype.notNull=W.prototype.notNullable=function(){return this.nullable(!1)},["index","primary","unique"].forEach(function(r){W.prototype[r]=function(){return this._type.toLowerCase().indexOf("increments")===-1&&this._tableBuilder[r].apply(this._tableBuilder,[this._args[0]].concat(Ss(arguments))),this}}),W.extend=(r,e)=>{if(Object.prototype.hasOwnProperty.call(W.prototype,r))throw new Error(`Can't extend ColumnBuilder with existing method ('${r}').`);VO(W.prototype,{[r]:e})};const xt={};xt.drop=function(){return this._single.drop=!0,this},xt.alterType=function(r){return this._statements.push({grouping:"alterType",value:r}),this},xt.alter=function({alterNullable:r=!0,alterType:e=!0}={}){return this._method="alter",this.alterNullable=r,this.alterType=e,this};const YO={float:"floating",enum:"enu",boolean:"bool",string:"varchar",bigint:"bigInteger"};var XO=W;function ZO(r){return r&&r.length?r[0]:void 0}var eA=ZO,tA=eA;const Ir=Ot,rA=Ct,nA=tA,iA=_s,sA=yt,{toNumber:Te}=M,{formatDefault:oA}=wr,{operator:xr}=ve;let C=class{constructor(e,t,n){this.client=e,this.tableCompiler=t,this.columnBuilder=n,this._commonBuilder=this.columnBuilder,this.args=n._args,this.type=n._type.toLowerCase(),this.grouped=rA(n._statements,"grouping"),this.modified=n._modifiers,this.isIncrements=this.type.indexOf("increments")!==-1,this.formatter=e.formatter(n),this.bindings=[],this.formatter.bindings=this.bindings,this.bindingsHolder=this,this.sequence=[],this.modifiers=[],this.checksCount=0}_addCheckModifiers(){this.modifiers.push("check","checkPositive","checkNegative","checkIn","checkNotIn","checkBetween","checkLength","checkRegex")}defaults(e){if(Object.prototype.hasOwnProperty.call(this._defaultMap,e))return this._defaultMap[e].bind(this)();throw new Error(`There is no default for the specified identifier ${e}`)}toSQL(){return this.pushQuery(this.compileColumn()),this.sequence.additional&&(this.sequence=this.sequence.concat(this.sequence.additional)),this.sequence}compileColumn(){return this.formatter.wrap(this.getColumnName())+" "+this.getColumnType()+this.getModifiers()}getColumnName(){return nA(this.args)||this.defaults("columnName")}getColumnType(){if(!this._columnType){const e=this[this.type];this._columnType=typeof e=="function"?e.apply(this,sA(this.args)):e}return this._columnType}getModifiers(){const e=[];for(let t=0,n=this.modifiers.length;t<n;t++){const i=this.modifiers[t];if((!this.isIncrements||this.isIncrements&&i==="comment")&&iA(this.modified,i)){const s=this[i].apply(this,this.modified[i]);s&&e.push(s)}}return e.length>0?` ${e.join(" ")}`:""}varchar(e){return`varchar(${Te(e,255)})`}floating(e,t){return`float(${Te(e,8)}, ${Te(t,2)})`}decimal(e,t){if(e===null)throw new Error("Specifying no precision on decimal columns is not supported for that SQL dialect.");return`decimal(${Te(e,8)}, ${Te(t,2)})`}specifictype(e){return e}nullable(e){return e===!1?"not null":"null"}notNullable(){return this.nullable(!1)}defaultTo(e){return`default ${oA(e,this.type,this.client)}`}increments(e={primaryKey:!0}){return"integer not null"+(this.tableCompiler._canBeAddPrimaryKey(e)?" primary key":"")+" autoincrement"}bigincrements(e={primaryKey:!0}){return this.increments(e)}_pushAlterCheckQuery(e,t){let n=t;n||(this.checksCount++,n=this.tableCompiler.tableNameRaw+"_"+this.getColumnName()+"_"+this.checksCount),this.pushAdditional(function(){this.pushQuery(`alter table ${this.tableCompiler.tableName()} add constraint ${n} check(${e})`)})}_checkConstraintName(e){return e?`constraint ${e} `:""}_check(e,t){return this.columnBuilder._method==="alter"?(this._pushAlterCheckQuery(e,t),""):`${this._checkConstraintName(t)}check (${e})`}checkPositive(e){return this._check(`${this.formatter.wrap(this.getColumnName())} ${xr(">",this.columnBuilder,this.bindingsHolder)} 0`,e)}checkNegative(e){return this._check(`${this.formatter.wrap(this.getColumnName())} ${xr("<",this.columnBuilder,this.bindingsHolder)} 0`,e)}_checkIn(e,t,n){return this._check(`${this.formatter.wrap(this.getColumnName())} ${n?"not ":""}in (${e.map(i=>this.client._escapeBinding(i)).join(",")})`,t)}checkIn(e,t){return this._checkIn(e,t)}checkNotIn(e,t){return this._checkIn(e,t,!0)}checkBetween(e,t){e.length===2&&!Array.isArray(e[0])&&!Array.isArray(e[1])&&(e=[e]);const n=e.map(i=>`${this.formatter.wrap(this.getColumnName())} between ${this.client._escapeBinding(i[0])} and ${this.client._escapeBinding(i[1])}`).join(" or ");return this._check(n,t)}checkLength(e,t,n){return this._check(`length(${this.formatter.wrap(this.getColumnName())}) ${xr(e,this.columnBuilder,this.bindingsHolder)} ${Te(t)}`,n)}};C.prototype.binary="blob",C.prototype.bool="boolean",C.prototype.date="date",C.prototype.datetime="datetime",C.prototype.time="time",C.prototype.timestamp="timestamp",C.prototype.geometry="geometry",C.prototype.geography="geography",C.prototype.point="point",C.prototype.enu="varchar",C.prototype.bit=C.prototype.json="text",C.prototype.uuid=({useBinaryUuid:r=!1,primaryKey:e=!1}={})=>r?"binary(16)":"char(36)",C.prototype.integer=C.prototype.smallint=C.prototype.mediumint="integer",C.prototype.biginteger="bigint",C.prototype.text="text",C.prototype.tinyint="tinyint",C.prototype.pushQuery=Ir.pushQuery,C.prototype.pushAdditional=Ir.pushAdditional,C.prototype.unshiftQuery=Ir.unshiftQuery,C.prototype._defaultMap={columnName:function(){if(!this.isIncrements)throw new Error(`You did not specify a column name for the ${this.type} column.`);return"id"}};var aA=C;const uA=Cr;var lA=class extends uA{constructor(e,t){super(e),this.ref=t,this._schema=null,this._alias=null}withSchema(e){return this._schema=e,this}as(e){return this._alias=e,this}toSQL(){const e=this._schema?`${this._schema}.${this.ref}`:this.ref,t=this.client.formatter(this),n=t.columnize(e),i=this._alias?`${n} as ${t.wrap(this._alias)}`:n;return this.set(i,[]),super.toSQL(...arguments)}};const{columnize:cA,wrap:hA}=ve;var dA=class{constructor(e,t){this.client=e,this.builder=t,this.bindings=[]}columnize(e){return cA(e,this.builder,this.client,this)}wrap(e,t){return hA(e,t,this.builder,this.client,this)}},p={};Object.defineProperty(p,"__esModule",{value:!0});var fA=E;function pA(r){if(r&&r.__esModule)return r;var e=Object.create(null);return r&&Object.keys(r).forEach(function(t){if(t!=="default"){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}}),e.default=r,Object.freeze(e)}var Pr=pA(fA);const{env:G={},argv:Is=[],platform:gA=""}=typeof process>"u"?{}:process,yA="NO_COLOR"in G||Is.includes("--no-color"),mA="FORCE_COLOR"in G||Is.includes("--color"),bA=gA==="win32",xs=G.TERM==="dumb",_A=Pr&&Pr.isatty&&Pr.isatty(1)&&G.TERM&&!xs,wA="CI"in G&&("GITHUB_ACTIONS"in G||"GITLAB_CI"in G||"CIRCLECI"in G),Ps=!yA&&(mA||bA&&!xs||_A||wA),Ns=(r,e,t,n,i=e.substring(0,r)+n,s=e.substring(r+t.length),o=s.indexOf(t))=>i+(o<0?s:Ns(o,s,t,n)),vA=(r,e,t,n,i)=>r<0?t+e+n:t+Ns(r,e,n,i)+n,$A=(r,e,t=r,n=r.length+1)=>i=>i||!(i===""||i===void 0)?vA((""+i).indexOf(e,n),i,r,e,t):"",g=(r,e,t)=>$A(`\x1B[${r}m`,`\x1B[${e}m`,t),js={reset:g(0,0),bold:g(1,22,"\x1B[22m\x1B[1m"),dim:g(2,22,"\x1B[22m\x1B[2m"),italic:g(3,23),underline:g(4,24),inverse:g(7,27),hidden:g(8,28),strikethrough:g(9,29),black:g(30,39),red:g(31,39),green:g(32,39),yellow:g(33,39),blue:g(34,39),magenta:g(35,39),cyan:g(36,39),white:g(37,39),gray:g(90,39),bgBlack:g(40,49),bgRed:g(41,49),bgGreen:g(42,49),bgYellow:g(43,49),bgBlue:g(44,49),bgMagenta:g(45,49),bgCyan:g(46,49),bgWhite:g(47,49),blackBright:g(90,39),redBright:g(91,39),greenBright:g(92,39),yellowBright:g(93,39),blueBright:g(94,39),magentaBright:g(95,39),cyanBright:g(96,39),whiteBright:g(97,39),bgBlackBright:g(100,49),bgRedBright:g(101,49),bgGreenBright:g(102,49),bgYellowBright:g(103,49),bgBlueBright:g(104,49),bgMagentaBright:g(105,49),bgCyanBright:g(106,49),bgWhiteBright:g(107,49)},Bs=({useColor:r=Ps}={})=>r?js:Object.keys(js).reduce((e,t)=>({...e,[t]:String}),{}),{reset:CA,bold:TA,dim:OA,italic:AA,underline:EA,inverse:SA,hidden:IA,strikethrough:xA,black:PA,red:NA,green:jA,yellow:BA,blue:qA,magenta:RA,cyan:kA,white:MA,gray:LA,bgBlack:FA,bgRed:HA,bgGreen:QA,bgYellow:WA,bgBlue:DA,bgMagenta:UA,bgCyan:JA,bgWhite:VA,blackBright:GA,redBright:KA,greenBright:zA,yellowBright:YA,blueBright:XA,magentaBright:ZA,cyanBright:eE,whiteBright:tE,bgBlackBright:rE,bgRedBright:nE,bgGreenBright:iE,bgYellowBright:sE,bgBlueBright:oE,bgMagentaBright:aE,bgCyanBright:uE,bgWhiteBright:lE}=Bs();p.bgBlack=FA,p.bgBlackBright=rE,p.bgBlue=DA,p.bgBlueBright=oE,p.bgCyan=JA,p.bgCyanBright=uE,p.bgGreen=QA,p.bgGreenBright=iE,p.bgMagenta=UA,p.bgMagentaBright=aE,p.bgRed=HA,p.bgRedBright=nE,p.bgWhite=VA,p.bgWhiteBright=lE,p.bgYellow=WA,p.bgYellowBright=sE,p.black=PA,p.blackBright=GA,p.blue=qA,p.blueBright=XA,p.bold=TA,p.createColors=Bs,p.cyan=kA,p.cyanBright=eE,p.dim=OA,p.gray=LA,p.green=jA,p.greenBright=zA,p.hidden=IA,p.inverse=SA,p.isColorSupported=Ps,p.italic=AA,p.magenta=RA,p.magentaBright=ZA,p.red=NA,p.redBright=KA,p.reset=CA,p.strikethrough=xA,p.underline=EA,p.white=MA,p.whiteBright=tE,p.yellow=BA,p.yellowBright=YA;const Nr=p,{inspect:cE}=E,{isString:hE,isFunction:qs}=q;let dE=class{constructor(e={}){const{log:{debug:t,warn:n,error:i,deprecate:s,inspectionDepth:o,enableColors:a}={}}=e;this._inspectionDepth=o||5,this._enableColors=fE(a),this._debug=t,this._warn=n,this._error=i,this._deprecate=s}_log(e,t,n){if(t!=null&&!qs(t))throw new TypeError("Extensions to knex logger must be functions!");if(qs(t)){t(e);return}hE(e)||(e=cE(e,{depth:this._inspectionDepth,colors:this._enableColors})),console.log(n?n(e):e)}debug(e){this._log(e,this._debug)}warn(e){this._log(e,this._warn,Nr.yellow)}error(e){this._log(e,this._error,Nr.red)}deprecate(e,t){const n=`${e} is deprecated, please use ${t}`;this._log(n,this._deprecate,Nr.yellow)}};function fE(r){return r??(process&&process.stdout?process.stdout.isTTY:!1)}var pE=dE;const gE=M,yE=Er,mE=ie;let He=class{constructor(e,t,n,i){this.client=e,this._method=t,this._schemaName=void 0,this._columns=void 0,this._fn=i,this._viewName=n,this._statements=[],this._single={}}setSchema(e){this._schemaName=e}columns(e){this._columns=e}as(e){this._selectQuery=e}checkOption(){throw new Error("check option definition is not supported by this dialect.")}localCheckOption(){throw new Error("check option definition is not supported by this dialect.")}cascadedCheckOption(){throw new Error("check option definition is not supported by this dialect.")}toSQL(){return this._method==="alter"&&yE(this,bE),this._fn.call(this,this),this.client.viewCompiler(this).toSQL()}};const bE={column(r){const e=this;return{rename:function(t){return e._statements.push({grouping:"alterView",method:"renameColumn",args:[r,t]}),this},defaultTo:function(t){return e._statements.push({grouping:"alterView",method:"defaultTo",args:[r,t]}),this}}}};gE.addQueryContext(He),He.extend=(r,e)=>{if(Object.prototype.hasOwnProperty.call(He.prototype,r))throw new Error(`Can't extend ViewBuilder with existing method ('${r}').`);mE(He.prototype,{[r]:e})};var _E=He;const{pushQuery:wE}=Ot,vE=Ct,{columnize:$E}=ve;let Rs=class{constructor(e,t){this.client=e,this.viewBuilder=t,this._commonBuilder=this.viewBuilder,this.method=t._method,this.schemaNameRaw=t._schemaName,this.viewNameRaw=t._viewName,this.single=t._single,this.selectQuery=t._selectQuery,this.columns=t._columns,this.grouped=vE(t._statements,"grouping"),this.formatter=e.formatter(t),this.bindings=[],this.formatter.bindings=this.bindings,this.bindingsHolder=this,this.sequence=[]}toSQL(){return this[this.method](),this.sequence}create(){this.createQuery(this.columns,this.selectQuery)}createOrReplace(){throw new Error("replace views is not supported by this dialect.")}createMaterializedView(){throw new Error("materialized views are not supported by this dialect.")}createQuery(e,t,n,i){const s="create "+(n?"materialized ":"")+(i?"or replace ":"")+"view ",o=e?" ("+$E(e,this.viewBuilder,this.client,this.bindingsHolder)+")":"";let a=s+this.viewName()+o;switch(a+=" as ",a+=t.toString(),this.single.checkOption){case"default_option":a+=" with check option";break;case"local":a+=" with local check option";break;case"cascaded":a+=" with cascaded check option";break}this.pushQuery({sql:a})}renameView(e,t){throw new Error("rename view is not supported by this dialect (instead drop, then create another view).")}refreshMaterializedView(){throw new Error("materialized views are not supported by this dialect.")}alter(){this.alterView()}alterView(){const e=this.grouped.alterView||[];for(let t=0,n=e.length;t<n;t++){const i=e[t];this[i.method]?this[i.method].apply(this,i.args):this.client.logger.error(`Debug: ${i.method} does not exist`)}for(const t in this.single)typeof this[t]=="function"&&this[t](this.single[t])}renameColumn(e,t){throw new Error("rename column of views is not supported by this dialect.")}defaultTo(e,t){throw new Error("change default values of views is not supported by this dialect.")}viewName(){const e=this.schemaNameRaw?`${this.schemaNameRaw}.${this.viewNameRaw}`:this.viewNameRaw;return this.formatter.wrap(e)}};Rs.prototype.pushQuery=wE;var CE=Rs;const{Pool:TE,TimeoutError:OE}=gp,{EventEmitter:AE}=E,{promisify:EE}=E,{makeEscape:SE}=_p,IE=Hm,xE=Gm,PE=Vr,NE=tb,jE=Un,{executeQuery:BE,enrichQueryObject:ks}=Si,qE=_r,RE=VT,kE=eO,ME=uO,LE=wO,FE=UO,HE=XO,QE=aA,{KnexTimeoutError:WE}=ge,{outputQuery:DE,unwrapRaw:UE}=ve,{compileCallback:JE}=wr,VE=Cr,GE=lA,KE=dA,zE=pE,{POOL_CONFIG_OPTIONS:YE}=as,XE=_E,ZE=CE,e0=Ie,jr=ae("knex:client");class Ms extends AE{constructor(e={}){if(super(),this.config=e,this.logger=new zE(e),this.dialect&&!this.config.client&&this.logger.warn("Using 'this.dialect' to identify the client is deprecated and support for it will be removed in the future. Please use configuration option 'client' instead."),!(this.config.client||this.dialect))throw new Error("knex: Required configuration option 'client' is missing.");e.version&&(this.version=e.version),e.connection&&e.connection instanceof Function?(this.connectionConfigProvider=e.connection,this.connectionConfigExpirationChecker=()=>!0):(this.connectionSettings=IE(e.connection||{}),this.connectionConfigExpirationChecker=null),this.driverName&&e.connection&&(this.initializeDriver(),(!e.pool||e.pool&&e.pool.max!==0)&&this.initializePool(e)),this.valueForUndefined=this.raw("DEFAULT"),e.useNullAsDefault&&(this.valueForUndefined=null)}formatter(e){return new KE(this,e)}queryBuilder(){return new qE(this)}queryCompiler(e,t){return new RE(this,e,t)}schemaBuilder(){return new kE(this)}schemaCompiler(e){return new ME(this,e)}tableBuilder(e,t,n,i){return new LE(this,e,t,n,i)}viewBuilder(e,t,n){return new XE(this,e,t,n)}tableCompiler(e){return new FE(this,e)}viewCompiler(e){return new ZE(this,e)}columnBuilder(e,t,n){return new HE(this,e,t,n)}columnCompiler(e,t){return new QE(this,e,t)}runner(e){return new NE(this,e)}transaction(e,t,n){return new jE(this,e,t,n)}raw(){return new VE(this).set(...arguments)}ref(){return new GE(this,...arguments)}query(e,t){const n=ks(e,t,this);return BE(e,n,this)}stream(e,t,n,i){const s=ks(e,t,this);return this._stream(e,s,n,i)}prepBindings(e){return e}positionBindings(e){return e}postProcessResponse(e,t){return this.config.postProcessResponse?this.config.postProcessResponse(e,t):e}wrapIdentifier(e,t){return this.customWrapIdentifier(e,this.wrapIdentifierImpl,t)}customWrapIdentifier(e,t,n){return this.config.wrapIdentifier?this.config.wrapIdentifier(e,t,n):t(e)}wrapIdentifierImpl(e){return e!=="*"?`"${e.replace(/"/g,'""')}"`:"*"}initializeDriver(){try{this.driver=this._driver()}catch(e){const t=`Knex: run
$ npm install ${this.driverName} --save`;throw this.logger.error(`${t}
${e.message}
${e.stack}`),new Error(`${t}
${e.message}`)}}poolDefaults(){return{min:2,max:10,propagateCreateError:!0}}getPoolSettings(e){e=xE({},e,this.poolDefaults()),YE.forEach(s=>{s in e&&this.logger.warn([`Pool config option "${s}" is no longer supported.`,"See https://github.com/Vincit/tarn.js for possible pool config options."].join(" "))});const t=6e4,n=[this.config.acquireConnectionTimeout,e.acquireTimeoutMillis].filter(s=>s!==void 0);n.length||n.push(t),e.acquireTimeoutMillis=Math.min(...n);const i=async()=>{if(!this.connectionConfigProvider||!this.connectionConfigExpirationChecker||!this.connectionConfigExpirationChecker())return;const s=await this.connectionConfigProvider();s.expirationChecker?(this.connectionConfigExpirationChecker=s.expirationChecker,delete s.expirationChecker):this.connectionConfigExpirationChecker=null,this.connectionSettings=s};return Object.assign(e,{create:async()=>{await i();const s=await this.acquireRawConnection();return s.__knexUid=PE("__knexUid"),e.afterCreate&&await EE(e.afterCreate)(s),s},destroy:s=>{if(s!==void 0)return this.destroyRawConnection(s)},validate:s=>s.__knex__disposed?(this.logger.warn(`Connection Error: ${s.__knex__disposed}`),!1):this.validateConnection(s)})}initializePool(e=this.config){if(this.pool){this.logger.warn("The pool has already been initialized");return}const t={...this.getPoolSettings(e.pool)};t.afterCreate&&delete t.afterCreate,this.pool=new TE(t)}validateConnection(e){return!0}async acquireConnection(){if(!this.pool)throw new Error("Unable to acquire a connection");try{const e=await this.pool.acquire().promise;return jr("acquired connection from pool: %s",e.__knexUid),e}catch(e){let t=e;throw e instanceof OE&&(t=new WE("Knex: Timeout acquiring a connection. The pool is probably full. Are you missing a .transacting(trx) call?")),t}}releaseConnection(e){return jr("releasing connection to pool: %s",e.__knexUid),this.pool.release(e)||jr("pool refused connection: %s",e.__knexUid),Promise.resolve()}async destroy(e){try{this.pool&&this.pool.destroy&&await this.pool.destroy(),this.pool=void 0,typeof e=="function"&&e()}catch(t){if(typeof e=="function")return e(t);throw t}}database(){return this.connectionSettings.database}toString(){return"[object KnexClient]"}assertCanCancelQuery(){if(!this.canCancelQuery)throw new Error("Query cancelling not supported for this dialect")}cancelQuery(){throw new Error("Query cancelling not supported for this dialect")}alias(e,t){return e+" as "+t}parameter(e,t,n){return typeof e=="function"?DE(JE(e,void 0,this,n),!0,t,this):UE(e,!0,t,this,n)||"?"}parameterize(e,t,n,i){if(typeof e=="function")return this.parameter(e,n,i);e=Array.isArray(e)?e:[e];let s="",o=-1;for(;++o<e.length;){o>0&&(s+=", ");let a=e[o];e0(a)&&(a=JSON.stringify(a)),s+=this.parameter(a===void 0?t:a,n,i)}return s}values(e,t,n){return Array.isArray(e)?Array.isArray(e[0])?`(${e.map(i=>`(${this.parameterize(i,void 0,t,n)})`).join(", ")})`:`(${this.parameterize(e,void 0,t,n)})`:e&&e.isRawInstance?`(${this.parameter(e,t,n)})`:this.parameter(e,t,n)}processPassedConnection(e){}toPathForJson(e){return e}}Object.assign(Ms.prototype,{_escapeBinding:SE({escapeString(r){return`'${r.replace(/'/g,"''")}'`}}),canCancelQuery:!1});var t0=Ms;const Ls=P(t0);class r0 extends Ls{constructor(t={}){super(t);qr(this,"dialect");qr(this,"driverName");this.dialect="db2",this.driverName="odbc",Ls.call(this,t);const{driver:n}=t.connection||{};n||this.logger.warn("Warn: config.connection.driver is needed for connecting to the database")}async _driver(){return await import(this.driverName)}transaction(){return new Xf(this,...arguments)}wrapIdentifierImpl(t){return t}printDebug(t){(void 0).DEBUG}acquireRawConnection(){this.printDebug("acquiring raw connection");const t=this.config.connection;return new Promise((n,i)=>{this.driver.open(this._getConnectionString(t),(s,o)=>s?i(s):n(o))})}async destroyRawConnection(t){return await t.close()}async validateConnection(t){return await t.tables()}_stream(t,n,i,s){throw this._stream(t,n,i,s),new Error("Not yet implemented")}_getConnectionString(t={}){const n=t.connectionStringParams||{},i=Object.keys(n).reduce((s,o)=>{const a=n[o];return`${s}${o}=${a}`},"");return`${`DRIVER=${t.driver};SYSTEM=${t.host};HOSTNAME=${t.host};PORT=${t.port};DATABASE=${t.database};UID=${t.user};PWD=${t.password};`}${i}`}async _query(t,n){(!n||typeof n=="string")&&(n={sql:n});const i=(n.method!=="raw"?n.method:n.sql.split(" ")[0]).toLowerCase();if(n.sqlMethod=i,i==="select"||i==="first"||i==="pluck"){const o=await t.query(n.sql,n.bindings);return o&&(n.response={rows:o,rowCount:o.length}),n}const s=await t.createStatement();return await s.prepare(n.sql),await s.bind(n.bindings),n.response=await s.execute(),n}processResponse(t,n){if(t===null)return null;const i=t.response,s=t.sqlMethod,{rows:o}=i;if(t.output)return t.output.call(n,i);switch(s){case"select":case"pluck":case"first":return s==="pluck"?o.map(t.pluck):s==="first"?o[0]:o;case"insert":case"del":case"delete":case"update":case"counter":return i.rowCount;default:return i}}}return r0});
//# sourceMappingURL=index.umd.js.map
