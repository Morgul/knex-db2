(function(Mt,mt){typeof exports=="object"&&typeof module<"u"?module.exports=mt():typeof define=="function"&&define.amd?define(mt):(Mt=typeof globalThis<"u"?globalThis:Mt||self,Mt.knexDB2=mt())})(this,function(){"use strict";const mt=Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"}));var jt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Fc(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){if(this instanceof n){var i=[null];i.push.apply(i,arguments);var a=Function.bind.apply(e,i);return new a}return e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var i=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return r[n]}})}),t}var Lr={exports:{}},Br={},kr={},Qt={};Object.defineProperty(Qt,"__esModule",{value:!0});let Uc=class extends Error{};Qt.TimeoutError=Uc;var re={},Mr={};Object.defineProperty(Mr,"__esModule",{value:!0});class Hc{constructor(e){this._value=e.value,this._error=e.error}value(){return this._value}reason(){return this._error}isRejected(){return!!this._error}isFulfilled(){return!!this._value}}Mr.PromiseInspection=Hc,Object.defineProperty(re,"__esModule",{value:!0});const Ms=Mr;function Vc(){let r=null,e=null;return{promise:new Promise((n,i)=>{r=n,e=i}),resolve:r,reject:e}}re.defer=Vc;function Wc(){return Date.now()}re.now=Wc;function zc(r,e){return Math.abs(e-r)}re.duration=zc;function Kc(r){return typeof r>"u"?!0:js(r)}re.checkOptionalTime=Kc;function js(r){return typeof r=="number"&&r===Math.round(r)&&r>0}re.checkRequiredTime=js;function Jc(r){return new Promise(e=>setTimeout(e,r))}re.delay=Jc;function Gc(r){return r.then(e=>new Ms.PromiseInspection({value:e})).catch(e=>new Ms.PromiseInspection({error:e}))}re.reflect=Gc;function Yc(r){try{const e=r();return Promise.resolve(e)}catch(e){return Promise.reject(e)}}re.tryPromise=Yc,Object.defineProperty(kr,"__esModule",{value:!0});const Dt=Qt,Xc=re;class Zc{constructor(e){this.timeoutMillis=e,this.deferred=Xc.defer(),this.possibleTimeoutCause=null,this.isRejected=!1,this.promise=eh(this.deferred.promise,e).catch(t=>(t instanceof Dt.TimeoutError&&(this.possibleTimeoutCause?t=new Dt.TimeoutError(this.possibleTimeoutCause.message):t=new Dt.TimeoutError("operation timed out for an unknown reason")),this.isRejected=!0,Promise.reject(t)))}abort(){this.reject(new Error("aborted"))}reject(e){this.deferred.reject(e)}resolve(e){this.deferred.resolve(e)}}kr.PendingOperation=Zc;function eh(r,e){return new Promise((t,n)=>{const i=setTimeout(()=>n(new Dt.TimeoutError),e);r.then(a=>{clearTimeout(i),t(a)}).catch(a=>{clearTimeout(i),n(a)})})}var jr={};Object.defineProperty(jr,"__esModule",{value:!0});const Qs=re;class Qr{constructor(e){this.resource=e,this.resource=e,this.timestamp=Qs.now(),this.deferred=Qs.defer()}get promise(){return this.deferred.promise}resolve(){return this.deferred.resolve(void 0),new Qr(this.resource)}}jr.Resource=Qr;const I=Fc(mt);Object.defineProperty(Br,"__esModule",{value:!0});const Ft=kr,th=jr,X=re,rh=I,Ds=I;let nh=class{constructor(e){if(this.destroyed=!1,this.emitter=new rh.EventEmitter,e=e||{},!e.create)throw new Error("Tarn: opt.create function most be provided");if(!e.destroy)throw new Error("Tarn: opt.destroy function most be provided");if(typeof e.min!="number"||e.min<0||e.min!==Math.round(e.min))throw new Error("Tarn: opt.min must be an integer >= 0");if(typeof e.max!="number"||e.max<=0||e.max!==Math.round(e.max))throw new Error("Tarn: opt.max must be an integer > 0");if(e.min>e.max)throw new Error("Tarn: opt.max is smaller than opt.min");if(!X.checkOptionalTime(e.acquireTimeoutMillis))throw new Error("Tarn: invalid opt.acquireTimeoutMillis "+JSON.stringify(e.acquireTimeoutMillis));if(!X.checkOptionalTime(e.createTimeoutMillis))throw new Error("Tarn: invalid opt.createTimeoutMillis "+JSON.stringify(e.createTimeoutMillis));if(!X.checkOptionalTime(e.destroyTimeoutMillis))throw new Error("Tarn: invalid opt.destroyTimeoutMillis "+JSON.stringify(e.destroyTimeoutMillis));if(!X.checkOptionalTime(e.idleTimeoutMillis))throw new Error("Tarn: invalid opt.idleTimeoutMillis "+JSON.stringify(e.idleTimeoutMillis));if(!X.checkOptionalTime(e.reapIntervalMillis))throw new Error("Tarn: invalid opt.reapIntervalMillis "+JSON.stringify(e.reapIntervalMillis));if(!X.checkOptionalTime(e.createRetryIntervalMillis))throw new Error("Tarn: invalid opt.createRetryIntervalMillis "+JSON.stringify(e.createRetryIntervalMillis));const t={create:!0,validate:!0,destroy:!0,log:!0,min:!0,max:!0,acquireTimeoutMillis:!0,createTimeoutMillis:!0,destroyTimeoutMillis:!0,idleTimeoutMillis:!0,reapIntervalMillis:!0,createRetryIntervalMillis:!0,propagateCreateError:!0};for(const n of Object.keys(e))if(!t[n])throw new Error(`Tarn: unsupported option opt.${n}`);this.creator=e.create,this.destroyer=e.destroy,this.validate=typeof e.validate=="function"?e.validate:()=>!0,this.log=e.log||(()=>{}),this.acquireTimeoutMillis=e.acquireTimeoutMillis||3e4,this.createTimeoutMillis=e.createTimeoutMillis||3e4,this.destroyTimeoutMillis=e.destroyTimeoutMillis||5e3,this.idleTimeoutMillis=e.idleTimeoutMillis||3e4,this.reapIntervalMillis=e.reapIntervalMillis||1e3,this.createRetryIntervalMillis=e.createRetryIntervalMillis||200,this.propagateCreateError=!!e.propagateCreateError,this.min=e.min,this.max=e.max,this.used=[],this.free=[],this.pendingCreates=[],this.pendingAcquires=[],this.pendingDestroys=[],this.pendingValidations=[],this.destroyed=!1,this.interval=null,this.eventId=1}numUsed(){return this.used.length}numFree(){return this.free.length}numPendingAcquires(){return this.pendingAcquires.length}numPendingValidations(){return this.pendingValidations.length}numPendingCreates(){return this.pendingCreates.length}acquire(){const e=this.eventId++;this._executeEventHandlers("acquireRequest",e);const t=new Ft.PendingOperation(this.acquireTimeoutMillis);return this.pendingAcquires.push(t),t.promise=t.promise.then(n=>(this._executeEventHandlers("acquireSuccess",e,n),n)).catch(n=>(this._executeEventHandlers("acquireFail",e,n),Ke(this.pendingAcquires,t),Promise.reject(n))),this._tryAcquireOrCreate(),t}release(e){this._executeEventHandlers("release",e);for(let t=0,n=this.used.length;t<n;++t){const i=this.used[t];if(i.resource===e)return this.used.splice(t,1),this.free.push(i.resolve()),this._tryAcquireOrCreate(),!0}return!1}isEmpty(){return[this.numFree(),this.numUsed(),this.numPendingAcquires(),this.numPendingValidations(),this.numPendingCreates()].reduce((e,t)=>e+t)===0}check(){const e=X.now(),t=[],n=this.min-this.used.length,i=this.free.length-n;let a=0;this.free.forEach(o=>{X.duration(e,o.timestamp)>=this.idleTimeoutMillis&&a<i?(a++,this._destroy(o.resource)):t.push(o)}),this.free=t,this.isEmpty()&&this._stopReaping()}destroy(){const e=this.eventId++;return this._executeEventHandlers("poolDestroyRequest",e),this._stopReaping(),this.destroyed=!0,X.reflect(Promise.all(this.pendingCreates.map(t=>X.reflect(t.promise))).then(()=>new Promise((t,n)=>{if(this.numPendingValidations()===0){t();return}const i=setInterval(()=>{this.numPendingValidations()===0&&(Ds.clearInterval(i),t())},100)})).then(()=>Promise.all(this.used.map(t=>X.reflect(t.promise)))).then(()=>Promise.all(this.pendingAcquires.map(t=>(t.abort(),X.reflect(t.promise))))).then(()=>Promise.all(this.free.map(t=>X.reflect(this._destroy(t.resource))))).then(()=>Promise.all(this.pendingDestroys.map(t=>t.promise))).then(()=>{this.free=[],this.pendingAcquires=[]})).then(t=>(this._executeEventHandlers("poolDestroySuccess",e),this.emitter.removeAllListeners(),t))}on(e,t){this.emitter.on(e,t)}removeListener(e,t){this.emitter.removeListener(e,t)}removeAllListeners(e){this.emitter.removeAllListeners(e)}_tryAcquireOrCreate(){this.destroyed||(this._hasFreeResources()?this._doAcquire():this._shouldCreateMoreResources()&&this._doCreate())}_hasFreeResources(){return this.free.length>0}_doAcquire(){for(;this._canAcquire();){const e=this.pendingAcquires.shift(),t=this.free.pop();if(t===void 0||e===void 0){const i="this.free was empty while trying to acquire resource";throw this.log(`Tarn: ${i}`,"warn"),new Error(`Internal error, should never happen. ${i}`)}this.pendingValidations.push(e),this.used.push(t);const n=new Ft.PendingOperation(this.acquireTimeoutMillis);e.promise.catch(i=>{n.abort()}),n.promise.catch(i=>(this.log("Tarn: resource validator threw an exception "+i.stack,"warn"),!1)).then(i=>{try{i&&!e.isRejected?(this._startReaping(),e.resolve(t.resource)):(Ke(this.used,t),i?this.free.push(t):(this._destroy(t.resource),setTimeout(()=>{this._tryAcquireOrCreate()},0)),e.isRejected||this.pendingAcquires.unshift(e))}finally{Ke(this.pendingValidations,e)}}),this._validateResource(t.resource).then(i=>{n.resolve(i)}).catch(i=>{n.reject(i)})}}_canAcquire(){return this.free.length>0&&this.pendingAcquires.length>0}_validateResource(e){try{return Promise.resolve(this.validate(e))}catch(t){return Promise.reject(t)}}_shouldCreateMoreResources(){return this.used.length+this.pendingCreates.length<this.max&&this.pendingCreates.length<this.pendingAcquires.length}_doCreate(){const e=this.pendingAcquires.slice();this._create().promise.then(()=>(this._tryAcquireOrCreate(),null)).catch(n=>{this.propagateCreateError&&this.pendingAcquires.length!==0&&this.pendingAcquires[0].reject(n),e.forEach(i=>{i.possibleTimeoutCause=n}),X.delay(this.createRetryIntervalMillis).then(()=>this._tryAcquireOrCreate())})}_create(){const e=this.eventId++;this._executeEventHandlers("createRequest",e);const t=new Ft.PendingOperation(this.createTimeoutMillis);return t.promise=t.promise.catch(n=>{throw Ke(this.pendingCreates,t)&&this._executeEventHandlers("createFail",e,n),n}),this.pendingCreates.push(t),ih(this.creator).then(n=>t.isRejected?(this.destroyer(n),null):(Ke(this.pendingCreates,t),this.free.push(new th.Resource(n)),t.resolve(n),this._executeEventHandlers("createSuccess",e,n),null)).catch(n=>(t.isRejected||(Ke(this.pendingCreates,t)&&this._executeEventHandlers("createFail",e,n),t.reject(n)),null)),t}_destroy(e){const t=this.eventId++;this._executeEventHandlers("destroyRequest",t,e);const n=new Ft.PendingOperation(this.destroyTimeoutMillis);return Promise.resolve().then(()=>this.destroyer(e)).then(()=>{n.resolve(e)}).catch(a=>{n.reject(a)}),this.pendingDestroys.push(n),n.promise.then(a=>(this._executeEventHandlers("destroySuccess",t,e),a)).catch(a=>this._logDestroyerError(t,e,a)).then(a=>{const o=this.pendingDestroys.findIndex(s=>s===n);return this.pendingDestroys.splice(o,1),a})}_logDestroyerError(e,t,n){this._executeEventHandlers("destroyFail",e,t,n),this.log("Tarn: resource destroyer threw an exception "+n.stack,"warn")}_startReaping(){this.interval||(this._executeEventHandlers("startReaping"),this.interval=setInterval(()=>this.check(),this.reapIntervalMillis))}_stopReaping(){this.interval!==null&&(this._executeEventHandlers("stopReaping"),Ds.clearInterval(this.interval)),this.interval=null}_executeEventHandlers(e,...t){this.emitter.listeners(e).forEach(i=>{try{i(...t)}catch(a){this.log(`Tarn: event handler "${e}" threw an exception ${a.stack}`,"warn")}})}};Br.Pool=nh;function Ke(r,e){const t=r.indexOf(e);return t===-1?!1:(r.splice(t,1),!0)}function ih(r){return new Promise((e,t)=>{const n=(i,a)=>{i?t(i):e(a)};X.tryPromise(()=>r(n)).then(i=>{i&&e(i)}).catch(i=>{t(i)})})}(function(r,e){Object.defineProperty(e,"__esModule",{value:!0});const t=Br;e.Pool=t.Pool;const n=Qt;e.TimeoutError=n.TimeoutError,r.exports={Pool:t.Pool,TimeoutError:n.TimeoutError}})(Lr,Lr.exports);var sh=Lr.exports;const Ut=/[\0\b\t\n\r\x1a"'\\]/g,Fs={"\0":"\\0","\b":"\\b","	":"\\t","\n":"\\n","\r":"\\r","":"\\Z",'"':'\\"',"'":"\\'","\\":"\\\\"};function oh(r){return function e(t,n={}){return r(t,e,n)}}function ah(r={}){const e=r.escapeDate||Vs,t=r.escapeArray||Dr,n=r.escapeBuffer||Hs,i=r.escapeString||Fr,a=r.escapeObject||Us,o=r.wrap||oh;function s(l,u,h){if(l==null)return"NULL";switch(typeof l){case"boolean":return l?"true":"false";case"number":return l+"";case"object":if(l instanceof Date)l=e(l,u,h);else return Array.isArray(l)?t(l,u,h):Buffer.isBuffer(l)?n(l,u,h):a(l,u,h)}return i(l,u,h)}return o?o(s):s}function Us(r,e,t){return r&&typeof r.toSQL=="function"?r.toSQL(t):JSON.stringify(r)}function Dr(r,e,t){let n="";for(let i=0;i<r.length;i++){const a=r[i];Array.isArray(a)?n+=(i===0?"":", ")+"("+Dr(a,e,t)+")":n+=(i===0?"":", ")+e(a,t)}return n}function Hs(r){return"X"+Fr(r.toString("hex"))}function Fr(r,e,t){let n=Ut.lastIndex=0,i="",a;for(;a=Ut.exec(r);)i+=r.slice(n,a.index)+Fs[a[0]],n=Ut.lastIndex;return n===0?"'"+r+"'":n<r.length?"'"+i+r.slice(n)+"'":"'"+i+"'"}function Vs(r,e,t={}){const n=t.timeZone||"local",i=new Date(r);let a,o,s,l,u,h,c;if(n==="local")a=i.getFullYear(),o=i.getMonth()+1,s=i.getDate(),l=i.getHours(),u=i.getMinutes(),h=i.getSeconds(),c=i.getMilliseconds();else{const d=lh(n);d!==!1&&d!==0&&i.setTime(i.getTime()+d*6e4),a=i.getUTCFullYear(),o=i.getUTCMonth()+1,s=i.getUTCDate(),l=i.getUTCHours(),u=i.getUTCMinutes(),h=i.getUTCSeconds(),c=i.getUTCMilliseconds()}return Re(a,4)+"-"+Re(o,2)+"-"+Re(s,2)+" "+Re(l,2)+":"+Re(u,2)+":"+Re(h,2)+"."+Re(c,3)}function Re(r,e){for(r=r.toString();r.length<e;)r="0"+r;return r}function lh(r){if(r==="Z")return 0;const e=r.match(/([+\-\s])(\d\d):?(\d\d)?/);return e?(e[1]=="-"?-1:1)*(parseInt(e[2],10)+(e[3]?parseInt(e[3],10):0)/60)*60:!1}var Ur={arrayToList:Dr,bufferToString:Hs,dateToString:Vs,escapeString:Fr,charsRegex:Ut,charsMap:Fs,escapeObject:Us,makeEscape:ah};function uh(){this.__data__=[],this.size=0}var ch=uh;function hh(r,e){return r===e||r!==r&&e!==e}var Je=hh,dh=Je;function fh(r,e){for(var t=r.length;t--;)if(dh(r[t][0],e))return t;return-1}var Ht=fh,ph=Ht,mh=Array.prototype,gh=mh.splice;function yh(r){var e=this.__data__,t=ph(e,r);if(t<0)return!1;var n=e.length-1;return t==n?e.pop():gh.call(e,t,1),--this.size,!0}var bh=yh,_h=Ht;function wh(r){var e=this.__data__,t=_h(e,r);return t<0?void 0:e[t][1]}var $h=wh,Ch=Ht;function vh(r){return Ch(this.__data__,r)>-1}var Eh=vh,Th=Ht;function Ah(r,e){var t=this.__data__,n=Th(t,r);return n<0?(++this.size,t.push([r,e])):t[n][1]=e,this}var Oh=Ah,Nh=ch,qh=bh,Rh=$h,Sh=Eh,xh=Oh;function Ge(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}Ge.prototype.clear=Nh,Ge.prototype.delete=qh,Ge.prototype.get=Rh,Ge.prototype.has=Sh,Ge.prototype.set=xh;var Vt=Ge,Ih=Vt;function Ph(){this.__data__=new Ih,this.size=0}var Lh=Ph;function Bh(r){var e=this.__data__,t=e.delete(r);return this.size=e.size,t}var kh=Bh;function Mh(r){return this.__data__.get(r)}var jh=Mh;function Qh(r){return this.__data__.has(r)}var Dh=Qh,Fh=typeof jt=="object"&&jt&&jt.Object===Object&&jt,Ws=Fh,Uh=Ws,Hh=typeof self=="object"&&self&&self.Object===Object&&self,Vh=Uh||Hh||Function("return this")(),ue=Vh,Wh=ue,zh=Wh.Symbol,Se=zh,zs=Se,Ks=Object.prototype,Kh=Ks.hasOwnProperty,Jh=Ks.toString,gt=zs?zs.toStringTag:void 0;function Gh(r){var e=Kh.call(r,gt),t=r[gt];try{r[gt]=void 0;var n=!0}catch{}var i=Jh.call(r);return n&&(e?r[gt]=t:delete r[gt]),i}var Yh=Gh,Xh=Object.prototype,Zh=Xh.toString;function ed(r){return Zh.call(r)}var td=ed,Js=Se,rd=Yh,nd=td,id="[object Null]",sd="[object Undefined]",Gs=Js?Js.toStringTag:void 0;function od(r){return r==null?r===void 0?sd:id:Gs&&Gs in Object(r)?rd(r):nd(r)}var xe=od;function ad(r){var e=typeof r;return r!=null&&(e=="object"||e=="function")}var ne=ad,ld=xe,ud=ne,cd="[object AsyncFunction]",hd="[object Function]",dd="[object GeneratorFunction]",fd="[object Proxy]";function pd(r){if(!ud(r))return!1;var e=ld(r);return e==hd||e==dd||e==cd||e==fd}var Wt=pd,md=ue,gd=md["__core-js_shared__"],yd=gd,Hr=yd,Ys=function(){var r=/[^.]+$/.exec(Hr&&Hr.keys&&Hr.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}();function bd(r){return!!Ys&&Ys in r}var _d=bd,wd=Function.prototype,$d=wd.toString;function Cd(r){if(r!=null){try{return $d.call(r)}catch{}try{return r+""}catch{}}return""}var Xs=Cd,vd=Wt,Ed=_d,Td=ne,Ad=Xs,Od=/[\\^$.*+?()[\]{}|]/g,Nd=/^\[object .+?Constructor\]$/,qd=Function.prototype,Rd=Object.prototype,Sd=qd.toString,xd=Rd.hasOwnProperty,Id=RegExp("^"+Sd.call(xd).replace(Od,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Pd(r){if(!Td(r)||Ed(r))return!1;var e=vd(r)?Id:Nd;return e.test(Ad(r))}var Ld=Pd;function Bd(r,e){return r==null?void 0:r[e]}var kd=Bd,Md=Ld,jd=kd;function Qd(r,e){var t=jd(r,e);return Md(t)?t:void 0}var Ie=Qd,Dd=Ie,Fd=ue,Ud=Dd(Fd,"Map"),Vr=Ud,Hd=Ie,Vd=Hd(Object,"create"),zt=Vd,Zs=zt;function Wd(){this.__data__=Zs?Zs(null):{},this.size=0}var zd=Wd;function Kd(r){var e=this.has(r)&&delete this.__data__[r];return this.size-=e?1:0,e}var Jd=Kd,Gd=zt,Yd="__lodash_hash_undefined__",Xd=Object.prototype,Zd=Xd.hasOwnProperty;function ef(r){var e=this.__data__;if(Gd){var t=e[r];return t===Yd?void 0:t}return Zd.call(e,r)?e[r]:void 0}var tf=ef,rf=zt,nf=Object.prototype,sf=nf.hasOwnProperty;function of(r){var e=this.__data__;return rf?e[r]!==void 0:sf.call(e,r)}var af=of,lf=zt,uf="__lodash_hash_undefined__";function cf(r,e){var t=this.__data__;return this.size+=this.has(r)?0:1,t[r]=lf&&e===void 0?uf:e,this}var hf=cf,df=zd,ff=Jd,pf=tf,mf=af,gf=hf;function Ye(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}Ye.prototype.clear=df,Ye.prototype.delete=ff,Ye.prototype.get=pf,Ye.prototype.has=mf,Ye.prototype.set=gf;var yf=Ye,eo=yf,bf=Vt,_f=Vr;function wf(){this.size=0,this.__data__={hash:new eo,map:new(_f||bf),string:new eo}}var $f=wf;function Cf(r){var e=typeof r;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?r!=="__proto__":r===null}var vf=Cf,Ef=vf;function Tf(r,e){var t=r.__data__;return Ef(e)?t[typeof e=="string"?"string":"hash"]:t.map}var Kt=Tf,Af=Kt;function Of(r){var e=Af(this,r).delete(r);return this.size-=e?1:0,e}var Nf=Of,qf=Kt;function Rf(r){return qf(this,r).get(r)}var Sf=Rf,xf=Kt;function If(r){return xf(this,r).has(r)}var Pf=If,Lf=Kt;function Bf(r,e){var t=Lf(this,r),n=t.size;return t.set(r,e),this.size+=t.size==n?0:1,this}var kf=Bf,Mf=$f,jf=Nf,Qf=Sf,Df=Pf,Ff=kf;function Xe(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}Xe.prototype.clear=Mf,Xe.prototype.delete=jf,Xe.prototype.get=Qf,Xe.prototype.has=Df,Xe.prototype.set=Ff;var Wr=Xe,Uf=Vt,Hf=Vr,Vf=Wr,Wf=200;function zf(r,e){var t=this.__data__;if(t instanceof Uf){var n=t.__data__;if(!Hf||n.length<Wf-1)return n.push([r,e]),this.size=++t.size,this;t=this.__data__=new Vf(n)}return t.set(r,e),this.size=t.size,this}var Kf=zf,Jf=Vt,Gf=Lh,Yf=kh,Xf=jh,Zf=Dh,ep=Kf;function Ze(r){var e=this.__data__=new Jf(r);this.size=e.size}Ze.prototype.clear=Gf,Ze.prototype.delete=Yf,Ze.prototype.get=Xf,Ze.prototype.has=Zf,Ze.prototype.set=ep;var Jt=Ze;function tp(r,e){for(var t=-1,n=r==null?0:r.length;++t<n&&e(r[t],t,r)!==!1;);return r}var zr=tp,rp=Ie,np=function(){try{var r=rp(Object,"defineProperty");return r({},"",{}),r}catch{}}(),to=np,ro=to;function ip(r,e,t){e=="__proto__"&&ro?ro(r,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):r[e]=t}var Gt=ip,sp=Gt,op=Je,ap=Object.prototype,lp=ap.hasOwnProperty;function up(r,e,t){var n=r[e];(!(lp.call(r,e)&&op(n,t))||t===void 0&&!(e in r))&&sp(r,e,t)}var Yt=up,cp=Yt,hp=Gt;function dp(r,e,t,n){var i=!t;t||(t={});for(var a=-1,o=e.length;++a<o;){var s=e[a],l=n?n(t[s],r[s],s,t,r):void 0;l===void 0&&(l=r[s]),i?hp(t,s,l):cp(t,s,l)}return t}var Pe=dp;function fp(r,e){for(var t=-1,n=Array(r);++t<r;)n[t]=e(t);return n}var pp=fp;function mp(r){return r!=null&&typeof r=="object"}var ce=mp,gp=xe,yp=ce,bp="[object Arguments]";function _p(r){return yp(r)&&gp(r)==bp}var wp=_p,no=wp,$p=ce,io=Object.prototype,Cp=io.hasOwnProperty,vp=io.propertyIsEnumerable,Ep=no(function(){return arguments}())?no:function(r){return $p(r)&&Cp.call(r,"callee")&&!vp.call(r,"callee")},yt=Ep,Tp=Array.isArray,F=Tp,Xt={exports:{}};function Ap(){return!1}var Op=Ap;Xt.exports,function(r,e){var t=ue,n=Op,i=e&&!e.nodeType&&e,a=i&&!0&&r&&!r.nodeType&&r,o=a&&a.exports===i,s=o?t.Buffer:void 0,l=s?s.isBuffer:void 0,u=l||n;r.exports=u}(Xt,Xt.exports);var et=Xt.exports,Np=9007199254740991,qp=/^(?:0|[1-9]\d*)$/;function Rp(r,e){var t=typeof r;return e=e??Np,!!e&&(t=="number"||t!="symbol"&&qp.test(r))&&r>-1&&r%1==0&&r<e}var Zt=Rp,Sp=9007199254740991;function xp(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=Sp}var Kr=xp,Ip=xe,Pp=Kr,Lp=ce,Bp="[object Arguments]",kp="[object Array]",Mp="[object Boolean]",jp="[object Date]",Qp="[object Error]",Dp="[object Function]",Fp="[object Map]",Up="[object Number]",Hp="[object Object]",Vp="[object RegExp]",Wp="[object Set]",zp="[object String]",Kp="[object WeakMap]",Jp="[object ArrayBuffer]",Gp="[object DataView]",Yp="[object Float32Array]",Xp="[object Float64Array]",Zp="[object Int8Array]",em="[object Int16Array]",tm="[object Int32Array]",rm="[object Uint8Array]",nm="[object Uint8ClampedArray]",im="[object Uint16Array]",sm="[object Uint32Array]",k={};k[Yp]=k[Xp]=k[Zp]=k[em]=k[tm]=k[rm]=k[nm]=k[im]=k[sm]=!0,k[Bp]=k[kp]=k[Jp]=k[Mp]=k[Gp]=k[jp]=k[Qp]=k[Dp]=k[Fp]=k[Up]=k[Hp]=k[Vp]=k[Wp]=k[zp]=k[Kp]=!1;function om(r){return Lp(r)&&Pp(r.length)&&!!k[Ip(r)]}var am=om;function lm(r){return function(e){return r(e)}}var Jr=lm,er={exports:{}};er.exports,function(r,e){var t=Ws,n=e&&!e.nodeType&&e,i=n&&!0&&r&&!r.nodeType&&r,a=i&&i.exports===n,o=a&&t.process,s=function(){try{var l=i&&i.require&&i.require("util").types;return l||o&&o.binding&&o.binding("util")}catch{}}();r.exports=s}(er,er.exports);var Gr=er.exports,um=am,cm=Jr,so=Gr,oo=so&&so.isTypedArray,hm=oo?cm(oo):um,tt=hm,dm=pp,fm=yt,pm=F,mm=et,gm=Zt,ym=tt,bm=Object.prototype,_m=bm.hasOwnProperty;function wm(r,e){var t=pm(r),n=!t&&fm(r),i=!t&&!n&&mm(r),a=!t&&!n&&!i&&ym(r),o=t||n||i||a,s=o?dm(r.length,String):[],l=s.length;for(var u in r)(e||_m.call(r,u))&&!(o&&(u=="length"||i&&(u=="offset"||u=="parent")||a&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||gm(u,l)))&&s.push(u);return s}var ao=wm,$m=Object.prototype;function Cm(r){var e=r&&r.constructor,t=typeof e=="function"&&e.prototype||$m;return r===t}var bt=Cm;function vm(r,e){return function(t){return r(e(t))}}var lo=vm,Em=lo,Tm=Em(Object.keys,Object),Am=Tm,Om=bt,Nm=Am,qm=Object.prototype,Rm=qm.hasOwnProperty;function Sm(r){if(!Om(r))return Nm(r);var e=[];for(var t in Object(r))Rm.call(r,t)&&t!="constructor"&&e.push(t);return e}var uo=Sm,xm=Wt,Im=Kr;function Pm(r){return r!=null&&Im(r.length)&&!xm(r)}var pe=Pm,Lm=ao,Bm=uo,km=pe;function Mm(r){return km(r)?Lm(r):Bm(r)}var Le=Mm,jm=Pe,Qm=Le;function Dm(r,e){return r&&jm(e,Qm(e),r)}var Fm=Dm;function Um(r){var e=[];if(r!=null)for(var t in Object(r))e.push(t);return e}var Hm=Um,Vm=ne,Wm=bt,zm=Hm,Km=Object.prototype,Jm=Km.hasOwnProperty;function Gm(r){if(!Vm(r))return zm(r);var e=Wm(r),t=[];for(var n in r)n=="constructor"&&(e||!Jm.call(r,n))||t.push(n);return t}var Ym=Gm,Xm=ao,Zm=Ym,eg=pe;function tg(r){return eg(r)?Xm(r,!0):Zm(r)}var Be=tg,rg=Pe,ng=Be;function ig(r,e){return r&&rg(e,ng(e),r)}var sg=ig,tr={exports:{}};tr.exports,function(r,e){var t=ue,n=e&&!e.nodeType&&e,i=n&&!0&&r&&!r.nodeType&&r,a=i&&i.exports===n,o=a?t.Buffer:void 0,s=o?o.allocUnsafe:void 0;function l(u,h){if(h)return u.slice();var c=u.length,d=s?s(c):new u.constructor(c);return u.copy(d),d}r.exports=l}(tr,tr.exports);var co=tr.exports;function og(r,e){var t=-1,n=r.length;for(e||(e=Array(n));++t<n;)e[t]=r[t];return e}var Yr=og;function ag(r,e){for(var t=-1,n=r==null?0:r.length,i=0,a=[];++t<n;){var o=r[t];e(o,t,r)&&(a[i++]=o)}return a}var Xr=ag;function lg(){return[]}var ho=lg,ug=Xr,cg=ho,hg=Object.prototype,dg=hg.propertyIsEnumerable,fo=Object.getOwnPropertySymbols,fg=fo?function(r){return r==null?[]:(r=Object(r),ug(fo(r),function(e){return dg.call(r,e)}))}:cg,Zr=fg,pg=Pe,mg=Zr;function gg(r,e){return pg(r,mg(r),e)}var yg=gg;function bg(r,e){for(var t=-1,n=e.length,i=r.length;++t<n;)r[i+t]=e[t];return r}var en=bg,_g=lo,wg=_g(Object.getPrototypeOf,Object),rr=wg,$g=en,Cg=rr,vg=Zr,Eg=ho,Tg=Object.getOwnPropertySymbols,Ag=Tg?function(r){for(var e=[];r;)$g(e,vg(r)),r=Cg(r);return e}:Eg,po=Ag,Og=Pe,Ng=po;function qg(r,e){return Og(r,Ng(r),e)}var Rg=qg,Sg=en,xg=F;function Ig(r,e,t){var n=e(r);return xg(r)?n:Sg(n,t(r))}var mo=Ig,Pg=mo,Lg=Zr,Bg=Le;function kg(r){return Pg(r,Bg,Lg)}var go=kg,Mg=mo,jg=po,Qg=Be;function Dg(r){return Mg(r,Qg,jg)}var yo=Dg,Fg=Ie,Ug=ue,Hg=Fg(Ug,"DataView"),Vg=Hg,Wg=Ie,zg=ue,Kg=Wg(zg,"Promise"),Jg=Kg,Gg=Ie,Yg=ue,Xg=Gg(Yg,"Set"),bo=Xg,Zg=Ie,ey=ue,ty=Zg(ey,"WeakMap"),ry=ty,tn=Vg,rn=Vr,nn=Jg,sn=bo,on=ry,_o=xe,rt=Xs,wo="[object Map]",ny="[object Object]",$o="[object Promise]",Co="[object Set]",vo="[object WeakMap]",Eo="[object DataView]",iy=rt(tn),sy=rt(rn),oy=rt(nn),ay=rt(sn),ly=rt(on),ke=_o;(tn&&ke(new tn(new ArrayBuffer(1)))!=Eo||rn&&ke(new rn)!=wo||nn&&ke(nn.resolve())!=$o||sn&&ke(new sn)!=Co||on&&ke(new on)!=vo)&&(ke=function(r){var e=_o(r),t=e==ny?r.constructor:void 0,n=t?rt(t):"";if(n)switch(n){case iy:return Eo;case sy:return wo;case oy:return $o;case ay:return Co;case ly:return vo}return e});var nt=ke,uy=Object.prototype,cy=uy.hasOwnProperty;function hy(r){var e=r.length,t=new r.constructor(e);return e&&typeof r[0]=="string"&&cy.call(r,"index")&&(t.index=r.index,t.input=r.input),t}var dy=hy,fy=ue,py=fy.Uint8Array,To=py,Ao=To;function my(r){var e=new r.constructor(r.byteLength);return new Ao(e).set(new Ao(r)),e}var an=my,gy=an;function yy(r,e){var t=e?gy(r.buffer):r.buffer;return new r.constructor(t,r.byteOffset,r.byteLength)}var by=yy,_y=/\w*$/;function wy(r){var e=new r.constructor(r.source,_y.exec(r));return e.lastIndex=r.lastIndex,e}var $y=wy,Oo=Se,No=Oo?Oo.prototype:void 0,qo=No?No.valueOf:void 0;function Cy(r){return qo?Object(qo.call(r)):{}}var vy=Cy,Ey=an;function Ty(r,e){var t=e?Ey(r.buffer):r.buffer;return new r.constructor(t,r.byteOffset,r.length)}var Ro=Ty,Ay=an,Oy=by,Ny=$y,qy=vy,Ry=Ro,Sy="[object Boolean]",xy="[object Date]",Iy="[object Map]",Py="[object Number]",Ly="[object RegExp]",By="[object Set]",ky="[object String]",My="[object Symbol]",jy="[object ArrayBuffer]",Qy="[object DataView]",Dy="[object Float32Array]",Fy="[object Float64Array]",Uy="[object Int8Array]",Hy="[object Int16Array]",Vy="[object Int32Array]",Wy="[object Uint8Array]",zy="[object Uint8ClampedArray]",Ky="[object Uint16Array]",Jy="[object Uint32Array]";function Gy(r,e,t){var n=r.constructor;switch(e){case jy:return Ay(r);case Sy:case xy:return new n(+r);case Qy:return Oy(r,t);case Dy:case Fy:case Uy:case Hy:case Vy:case Wy:case zy:case Ky:case Jy:return Ry(r,t);case Iy:return new n;case Py:case ky:return new n(r);case Ly:return Ny(r);case By:return new n;case My:return qy(r)}}var Yy=Gy,Xy=ne,So=Object.create,Zy=function(){function r(){}return function(e){if(!Xy(e))return{};if(So)return So(e);r.prototype=e;var t=new r;return r.prototype=void 0,t}}(),xo=Zy,eb=xo,tb=rr,rb=bt;function nb(r){return typeof r.constructor=="function"&&!rb(r)?eb(tb(r)):{}}var Io=nb,ib=nt,sb=ce,ob="[object Map]";function ab(r){return sb(r)&&ib(r)==ob}var lb=ab,ub=lb,cb=Jr,Po=Gr,Lo=Po&&Po.isMap,hb=Lo?cb(Lo):ub,db=hb,fb=nt,pb=ce,mb="[object Set]";function gb(r){return pb(r)&&fb(r)==mb}var yb=gb,bb=yb,_b=Jr,Bo=Gr,ko=Bo&&Bo.isSet,wb=ko?_b(ko):bb,$b=wb,Cb=Jt,vb=zr,Eb=Yt,Tb=Fm,Ab=sg,Ob=co,Nb=Yr,qb=yg,Rb=Rg,Sb=go,xb=yo,Ib=nt,Pb=dy,Lb=Yy,Bb=Io,kb=F,Mb=et,jb=db,Qb=ne,Db=$b,Fb=Le,Ub=Be,Hb=1,Vb=2,Wb=4,Mo="[object Arguments]",zb="[object Array]",Kb="[object Boolean]",Jb="[object Date]",Gb="[object Error]",jo="[object Function]",Yb="[object GeneratorFunction]",Xb="[object Map]",Zb="[object Number]",Qo="[object Object]",e_="[object RegExp]",t_="[object Set]",r_="[object String]",n_="[object Symbol]",i_="[object WeakMap]",s_="[object ArrayBuffer]",o_="[object DataView]",a_="[object Float32Array]",l_="[object Float64Array]",u_="[object Int8Array]",c_="[object Int16Array]",h_="[object Int32Array]",d_="[object Uint8Array]",f_="[object Uint8ClampedArray]",p_="[object Uint16Array]",m_="[object Uint32Array]",B={};B[Mo]=B[zb]=B[s_]=B[o_]=B[Kb]=B[Jb]=B[a_]=B[l_]=B[u_]=B[c_]=B[h_]=B[Xb]=B[Zb]=B[Qo]=B[e_]=B[t_]=B[r_]=B[n_]=B[d_]=B[f_]=B[p_]=B[m_]=!0,B[Gb]=B[jo]=B[i_]=!1;function nr(r,e,t,n,i,a){var o,s=e&Hb,l=e&Vb,u=e&Wb;if(t&&(o=i?t(r,n,i,a):t(r)),o!==void 0)return o;if(!Qb(r))return r;var h=kb(r);if(h){if(o=Pb(r),!s)return Nb(r,o)}else{var c=Ib(r),d=c==jo||c==Yb;if(Mb(r))return Ob(r,s);if(c==Qo||c==Mo||d&&!i){if(o=l||d?{}:Bb(r),!s)return l?Rb(r,Ab(o,r)):qb(r,Tb(o,r))}else{if(!B[c])return i?r:{};o=Lb(r,c,s)}}a||(a=new Cb);var p=a.get(r);if(p)return p;a.set(r,o),Db(r)?r.forEach(function(f){o.add(nr(f,e,t,f,r,a))}):jb(r)&&r.forEach(function(f,m){o.set(m,nr(f,e,t,m,r,a))});var g=u?l?xb:Sb:l?Ub:Fb,_=h?void 0:g(r);return vb(_||r,function(f,m){_&&(m=f,f=r[m]),Eb(o,m,nr(f,e,t,m,r,a))}),o}var Do=nr,g_=Do,y_=1,b_=4;function __(r){return g_(r,y_|b_)}var w_=__;function $_(r){return r}var ie=$_;function C_(r,e,t){switch(t.length){case 0:return r.call(e);case 1:return r.call(e,t[0]);case 2:return r.call(e,t[0],t[1]);case 3:return r.call(e,t[0],t[1],t[2])}return r.apply(e,t)}var v_=C_,E_=v_,Fo=Math.max;function T_(r,e,t){return e=Fo(e===void 0?r.length-1:e,0),function(){for(var n=arguments,i=-1,a=Fo(n.length-e,0),o=Array(a);++i<a;)o[i]=n[e+i];i=-1;for(var s=Array(e+1);++i<e;)s[i]=n[i];return s[e]=t(o),E_(r,this,s)}}var A_=T_;function O_(r){return function(){return r}}var Uo=O_,N_=Uo,Ho=to,q_=ie,R_=Ho?function(r,e){return Ho(r,"toString",{configurable:!0,enumerable:!1,value:N_(e),writable:!0})}:q_,S_=R_,x_=800,I_=16,P_=Date.now;function L_(r){var e=0,t=0;return function(){var n=P_(),i=I_-(n-t);if(t=n,i>0){if(++e>=x_)return arguments[0]}else e=0;return r.apply(void 0,arguments)}}var B_=L_,k_=S_,M_=B_,j_=M_(k_),Q_=j_,D_=ie,F_=A_,U_=Q_;function H_(r,e){return U_(F_(r,e,D_),r+"")}var ln=H_,V_=Je,W_=pe,z_=Zt,K_=ne;function J_(r,e,t){if(!K_(t))return!1;var n=typeof e;return(n=="number"?W_(t)&&z_(e,t.length):n=="string"&&e in t)?V_(t[e],r):!1}var ir=J_,G_=ln,Y_=Je,X_=ir,Z_=Be,Vo=Object.prototype,ew=Vo.hasOwnProperty,tw=G_(function(r,e){r=Object(r);var t=-1,n=e.length,i=n>2?e[2]:void 0;for(i&&X_(e[0],e[1],i)&&(n=1);++t<n;)for(var a=e[t],o=Z_(a),s=-1,l=o.length;++s<l;){var u=o[s],h=r[u];(h===void 0||Y_(h,Vo[u])&&!ew.call(r,u))&&(r[u]=a[u])}return r}),Wo=tw;function rw(r,e){for(var t=-1,n=r==null?0:r.length,i=Array(n);++t<n;)i[t]=e(r[t],t,r);return i}var sr=rw,nw=xe,iw=ce,sw="[object Symbol]";function ow(r){return typeof r=="symbol"||iw(r)&&nw(r)==sw}var or=ow,zo=Se,aw=sr,lw=F,uw=or,cw=1/0,Ko=zo?zo.prototype:void 0,Jo=Ko?Ko.toString:void 0;function Go(r){if(typeof r=="string")return r;if(lw(r))return aw(r,Go)+"";if(uw(r))return Jo?Jo.call(r):"";var e=r+"";return e=="0"&&1/r==-cw?"-0":e}var hw=Go,dw=hw;function fw(r){return r==null?"":dw(r)}var Yo=fw,pw=Yo,mw=0;function gw(r){var e=++mw;return pw(r)+e}var Xo=gw,we={};let Zo=class extends Error{constructor(e){super(e),this.name="KnexTimeoutError"}};function yw(r,e){return new Promise(function(t,n){const i=setTimeout(function(){n(new Zo("operation timed out"))},e);function a(s){clearTimeout(i),t(s)}function o(s){clearTimeout(i),n(s)}r.then(a,o)})}we.KnexTimeoutError=Zo,we.timeout=yw;function bw(r){r.client.emit("start",r.builder),r.builder.emit("start",r.builder);const e=r.builder.toSQL();return r.builder._debug&&r.client.logger.debug(e),Array.isArray(e)?r.queryArray(e):r.query(e)}function _w(r,e){try{const t=r.builder.toSQL();if(Array.isArray(t)&&e.hasHandler)throw new Error("The stream may only be used with a single query statement.");return r.client.stream(r.connection,t,e.stream,e.options)}catch(t){throw e.stream.emit("error",t),t}}var ww={ensureConnectionCallback:bw,ensureConnectionStreamCallback:_w};const{KnexTimeoutError:ea}=we,{timeout:$w}=we,{ensureConnectionCallback:Cw,ensureConnectionStreamCallback:vw}=ww;let un;var Ew=class Dc{constructor(e,t){this.client=e,this.builder=t,this.queries=[],this.connection=void 0}async run(){const e=this;try{const t=await this.ensureConnection(Cw);return e.builder.emit("end"),t}catch(t){throw e.builder._events&&e.builder._events.error&&e.builder.emit("error",t),t}}stream(e,t){const n=typeof e=="function"&&arguments.length===1,i=n?{}:e,a=n?e:t,o=typeof a=="function";un=un||I.Transform;const s=this.builder.queryContext(),l=new un({objectMode:!0,transform:(h,c,d)=>{d(null,this.client.postProcessResponse(h,s))}});l.on("close",()=>{this.client.releaseConnection(this.connection)});const u=this.ensureConnection(vw,{options:i,hasHandler:o,stream:l}).catch(h=>{this.connection||l.emit("error",h)});return o?(a(l),u):l}pipe(e,t){return this.stream(t).pipe(e)}async query(e){const{__knexUid:t,__knexTxId:n}=this.connection;this.builder.emit("query",Object.assign({__knexUid:t,__knexTxId:n},e));const i=this,a=this.builder.queryContext();e!==null&&typeof e=="object"&&(e.queryContext=a);let o=this.client.query(this.connection,e);return e.timeout&&(o=$w(o,e.timeout)),o.then(s=>this.client.processResponse(s,i)).then(s=>{const l=this.client.postProcessResponse(s,a);return this.builder.emit("query-response",l,Object.assign({__knexUid:t,__knexTxId:n},e),this.builder),this.client.emit("query-response",l,Object.assign({__knexUid:t,__knexTxId:n},e),this.builder),l}).catch(s=>{if(!(s instanceof ea))return Promise.reject(s);const{timeout:l,sql:u,bindings:h}=e;let c;return e.cancelOnTimeout?c=this.client.cancelQuery(this.connection):(this.connection.__knex__disposed=s,c=Promise.resolve()),c.catch(d=>{throw this.connection.__knex__disposed=s,Object.assign(d,{message:`After query timeout of ${l}ms exceeded, cancelling of query failed.`,sql:u,bindings:h,timeout:l})}).then(()=>{throw Object.assign(s,{message:`Defined query timeout of ${l}ms exceeded when running query.`,sql:u,bindings:h,timeout:l})})}).catch(s=>{throw this.builder.emit("query-error",s,Object.assign({__knexUid:t,__knexTxId:n,queryContext:a},e)),s})}async queryArray(e){if(e.length===1){const n=e[0];if(!n.statementsProducer)return this.query(n);const i=await n.statementsProducer(void 0,this.connection),a=i.sql.map(u=>({sql:u,bindings:n.bindings})),o=i.pre.map(u=>({sql:u,bindings:n.bindings})),s=i.post.map(u=>({sql:u,bindings:n.bindings}));let l=[];await this.queryArray(o);try{await this.client.transaction(async u=>{const h=new Dc(u.client,this.builder);if(h.connection=this.connection,l=await h.queryArray(a),i.check&&(await u.raw(i.check)).length>0)throw new Error("FOREIGN KEY constraint failed")},{connection:this.connection})}finally{await this.queryArray(s)}return l}const t=[];for(const n of e)t.push(await this.queryArray([n]));return t}async ensureConnection(e,t){if(this.builder._connection&&(this.connection=this.builder._connection),this.connection)return e(this,t);let n;try{n=await this.client.acquireConnection()}catch(i){if(!(i instanceof ea))return Promise.reject(i);throw this.builder&&(i.sql=this.builder.sql,i.bindings=this.builder.bindings),i}try{return this.connection=n,await e(this,t)}finally{await this.client.releaseConnection(n)}}},cn={exports:{}},hn,ta;function Tw(){if(ta)return hn;ta=1;var r=1e3,e=r*60,t=e*60,n=t*24,i=n*7,a=n*365.25;hn=function(h,c){c=c||{};var d=typeof h;if(d==="string"&&h.length>0)return o(h);if(d==="number"&&isFinite(h))return c.long?l(h):s(h);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(h))};function o(h){if(h=String(h),!(h.length>100)){var c=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(h);if(c){var d=parseFloat(c[1]),p=(c[2]||"ms").toLowerCase();switch(p){case"years":case"year":case"yrs":case"yr":case"y":return d*a;case"weeks":case"week":case"w":return d*i;case"days":case"day":case"d":return d*n;case"hours":case"hour":case"hrs":case"hr":case"h":return d*t;case"minutes":case"minute":case"mins":case"min":case"m":return d*e;case"seconds":case"second":case"secs":case"sec":case"s":return d*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return d;default:return}}}}function s(h){var c=Math.abs(h);return c>=n?Math.round(h/n)+"d":c>=t?Math.round(h/t)+"h":c>=e?Math.round(h/e)+"m":c>=r?Math.round(h/r)+"s":h+"ms"}function l(h){var c=Math.abs(h);return c>=n?u(h,c,n,"day"):c>=t?u(h,c,t,"hour"):c>=e?u(h,c,e,"minute"):c>=r?u(h,c,r,"second"):h+" ms"}function u(h,c,d,p){var g=c>=d*1.5;return Math.round(h/d)+" "+p+(g?"s":"")}return hn}function Aw(r){t.debug=t,t.default=t,t.coerce=l,t.disable=a,t.enable=i,t.enabled=o,t.humanize=Tw(),t.destroy=u,Object.keys(r).forEach(h=>{t[h]=r[h]}),t.names=[],t.skips=[],t.formatters={};function e(h){let c=0;for(let d=0;d<h.length;d++)c=(c<<5)-c+h.charCodeAt(d),c|=0;return t.colors[Math.abs(c)%t.colors.length]}t.selectColor=e;function t(h){let c,d=null,p,g;function _(...f){if(!_.enabled)return;const m=_,y=Number(new Date),w=y-(c||y);m.diff=w,m.prev=c,m.curr=y,c=y,f[0]=t.coerce(f[0]),typeof f[0]!="string"&&f.unshift("%O");let $=0;f[0]=f[0].replace(/%([a-zA-Z%])/g,(C,T)=>{if(C==="%%")return"%";$++;const N=t.formatters[T];if(typeof N=="function"){const P=f[$];C=N.call(m,P),f.splice($,1),$--}return C}),t.formatArgs.call(m,f),(m.log||t.log).apply(m,f)}return _.namespace=h,_.useColors=t.useColors(),_.color=t.selectColor(h),_.extend=n,_.destroy=t.destroy,Object.defineProperty(_,"enabled",{enumerable:!0,configurable:!1,get:()=>d!==null?d:(p!==t.namespaces&&(p=t.namespaces,g=t.enabled(h)),g),set:f=>{d=f}}),typeof t.init=="function"&&t.init(_),_}function n(h,c){const d=t(this.namespace+(typeof c>"u"?":":c)+h);return d.log=this.log,d}function i(h){t.save(h),t.namespaces=h,t.names=[],t.skips=[];let c;const d=(typeof h=="string"?h:"").split(/[\s,]+/),p=d.length;for(c=0;c<p;c++)d[c]&&(h=d[c].replace(/\*/g,".*?"),h[0]==="-"?t.skips.push(new RegExp("^"+h.slice(1)+"$")):t.names.push(new RegExp("^"+h+"$")))}function a(){const h=[...t.names.map(s),...t.skips.map(s).map(c=>"-"+c)].join(",");return t.enable(""),h}function o(h){if(h[h.length-1]==="*")return!0;let c,d;for(c=0,d=t.skips.length;c<d;c++)if(t.skips[c].test(h))return!1;for(c=0,d=t.names.length;c<d;c++)if(t.names[c].test(h))return!0;return!1}function s(h){return h.toString().substring(2,h.toString().length-2).replace(/\.\*\?$/,"*")}function l(h){return h instanceof Error?h.stack||h.message:h}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}var Ow=Aw;(function(r,e){e.formatArgs=n,e.save=i,e.load=a,e.useColors=t,e.storage=o(),e.destroy=(()=>{let l=!1;return()=>{l||(l=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function n(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+r.exports.humanize(this.diff),!this.useColors)return;const u="color: "+this.color;l.splice(1,0,u,"color: inherit");let h=0,c=0;l[0].replace(/%[a-zA-Z%]/g,d=>{d!=="%%"&&(h++,d==="%c"&&(c=h))}),l.splice(c,0,u)}e.log=console.debug||console.log||(()=>{});function i(l){try{l?e.storage.setItem("debug",l):e.storage.removeItem("debug")}catch{}}function a(){let l;try{l=e.storage.getItem("debug")}catch{}return!l&&typeof process<"u"&&"env"in process&&(l=process.env.DEBUG),l}function o(){try{return localStorage}catch{}}r.exports=Ow(e);const{formatters:s}=r.exports;s.j=function(l){try{return JSON.stringify(l)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}}})(cn,cn.exports);var ae=cn.exports,ar=function(){},Nw=class{constructor(e){this.client=e}now(e){return typeof e=="number"?this.client.raw(`CURRENT_TIMESTAMP(${e})`):this.client.raw("CURRENT_TIMESTAMP")}uuidToBin(e,t=!0){const n=Buffer.from(e.replace(/-/g,""),"hex");return t?Buffer.concat([n.slice(6,8),n.slice(4,6),n.slice(0,4),n.slice(8,16)]):Buffer.concat([n.slice(0,4),n.slice(4,6),n.slice(6,8),n.slice(8,16)])}binToUuid(e,t=!0){const n=Buffer.from(e,"hex");return t?[n.toString("hex",4,8),n.toString("hex",2,4),n.toString("hex",0,2),n.toString("hex",8,10),n.toString("hex",10,16)].join("-"):[n.toString("hex",0,4),n.toString("hex",4,6),n.toString("hex",6,8),n.toString("hex",8,10),n.toString("hex",10,16)].join("-")}},ra=["with","withRecursive","withMaterialized","withNotMaterialized","select","as","columns","column","from","fromJS","fromRaw","into","withSchema","table","distinct","join","joinRaw","innerJoin","leftJoin","leftOuterJoin","rightJoin","rightOuterJoin","outerJoin","fullOuterJoin","crossJoin","where","andWhere","orWhere","whereNot","orWhereNot","whereLike","andWhereLike","orWhereLike","whereILike","andWhereILike","orWhereILike","whereRaw","whereWrapped","havingWrapped","orWhereRaw","whereExists","orWhereExists","whereNotExists","orWhereNotExists","whereIn","orWhereIn","whereNotIn","orWhereNotIn","whereNull","orWhereNull","whereNotNull","orWhereNotNull","whereBetween","whereNotBetween","andWhereBetween","andWhereNotBetween","orWhereBetween","orWhereNotBetween","groupBy","groupByRaw","orderBy","orderByRaw","union","unionAll","intersect","having","havingRaw","orHaving","orHavingRaw","offset","limit","count","countDistinct","min","max","sum","sumDistinct","avg","avgDistinct","increment","decrement","first","debug","pluck","clearSelect","clearWhere","clearGroup","clearOrder","clearHaving","insert","update","returning","del","delete","truncate","transacting","connection","jsonExtract","jsonSet","jsonInsert","jsonRemove","whereJsonObject","orWhereJsonObject","andWhereJsonObject","whereNotJsonObject","orWhereNotJsonObject","andWhereNotJsonObject","whereJsonPath","orWhereJsonPath","andWhereJsonPath","whereJsonSupersetOf","orWhereJsonSupersetOf","andWhereJsonSupersetOf","whereJsonNotSupersetOf","orWhereJsonNotSupersetOf","andWhereJsonNotSupersetOf","whereJsonSubsetOf","orWhereJsonSubsetOf","andWhereJsonSubsetOf","whereJsonNotSubsetOf","orWhereJsonNotSubsetOf","andWhereJsonNotSubsetOf"],qw=Gt,Rw=Je;function Sw(r,e,t){(t!==void 0&&!Rw(r[e],t)||t===void 0&&!(e in r))&&qw(r,e,t)}var na=Sw;function xw(r){return function(e,t,n){for(var i=-1,a=Object(e),o=n(e),s=o.length;s--;){var l=o[r?s:++i];if(t(a[l],l,a)===!1)break}return e}}var Iw=xw,Pw=Iw,Lw=Pw(),ia=Lw,Bw=pe,kw=ce;function Mw(r){return kw(r)&&Bw(r)}var jw=Mw,Qw=xe,Dw=rr,Fw=ce,Uw="[object Object]",Hw=Function.prototype,Vw=Object.prototype,sa=Hw.toString,Ww=Vw.hasOwnProperty,zw=sa.call(Object);function Kw(r){if(!Fw(r)||Qw(r)!=Uw)return!1;var e=Dw(r);if(e===null)return!0;var t=Ww.call(e,"constructor")&&e.constructor;return typeof t=="function"&&t instanceof t&&sa.call(t)==zw}var $e=Kw;function Jw(r,e){if(!(e==="constructor"&&typeof r[e]=="function")&&e!="__proto__")return r[e]}var oa=Jw,Gw=Pe,Yw=Be;function Xw(r){return Gw(r,Yw(r))}var Zw=Xw,aa=na,e$=co,t$=Ro,r$=Yr,n$=Io,la=yt,ua=F,i$=jw,s$=et,o$=Wt,a$=ne,l$=$e,u$=tt,ca=oa,c$=Zw;function h$(r,e,t,n,i,a,o){var s=ca(r,t),l=ca(e,t),u=o.get(l);if(u){aa(r,t,u);return}var h=a?a(s,l,t+"",r,e,o):void 0,c=h===void 0;if(c){var d=ua(l),p=!d&&s$(l),g=!d&&!p&&u$(l);h=l,d||p||g?ua(s)?h=s:i$(s)?h=r$(s):p?(c=!1,h=e$(l,!0)):g?(c=!1,h=t$(l,!0)):h=[]:l$(l)||la(l)?(h=s,la(s)?h=c$(s):(!a$(s)||o$(s))&&(h=n$(l))):c=!1}c&&(o.set(l,h),i(h,l,n,a,o),o.delete(l)),aa(r,t,h)}var d$=h$,f$=Jt,p$=na,m$=ia,g$=d$,y$=ne,b$=Be,_$=oa;function ha(r,e,t,n,i){r!==e&&m$(e,function(a,o){if(i||(i=new f$),y$(a))g$(r,e,o,t,ha,n,i);else{var s=n?n(_$(r,o),a,o+"",r,e,i):void 0;s===void 0&&(s=a),p$(r,o,s)}},b$)}var w$=ha,$$=ln,C$=ir;function v$(r){return $$(function(e,t){var n=-1,i=t.length,a=i>1?t[i-1]:void 0,o=i>2?t[2]:void 0;for(a=r.length>3&&typeof a=="function"?(i--,a):void 0,o&&C$(t[0],t[1],o)&&(a=i<3?void 0:a,i=1),e=Object(e);++n<i;){var s=t[n];s&&r(e,s,n,a)}return e})}var dn=v$,E$=w$,T$=dn,A$=T$(function(r,e,t){E$(r,e,t)}),O$=A$;function N$(r,e,t){var n=-1,i=r.length;e<0&&(e=-e>i?0:i+e),t=t>i?i:t,t<0&&(t+=i),i=e>t?0:t-e>>>0,e>>>=0;for(var a=Array(i);++n<i;)a[n]=r[n+e];return a}var da=N$,q$=/\s/;function R$(r){for(var e=r.length;e--&&q$.test(r.charAt(e)););return e}var S$=R$,x$=S$,I$=/^\s+/;function P$(r){return r&&r.slice(0,x$(r)+1).replace(I$,"")}var L$=P$,B$=L$,fa=ne,k$=or,pa=0/0,M$=/^[-+]0x[0-9a-f]+$/i,j$=/^0b[01]+$/i,Q$=/^0o[0-7]+$/i,D$=parseInt;function F$(r){if(typeof r=="number")return r;if(k$(r))return pa;if(fa(r)){var e=typeof r.valueOf=="function"?r.valueOf():r;r=fa(e)?e+"":e}if(typeof r!="string")return r===0?r:+r;r=B$(r);var t=j$.test(r);return t||Q$.test(r)?D$(r.slice(2),t?2:8):M$.test(r)?pa:+r}var U$=F$,H$=U$,ma=1/0,V$=17976931348623157e292;function W$(r){if(!r)return r===0?r:0;if(r=H$(r),r===ma||r===-ma){var e=r<0?-1:1;return e*V$}return r===r?r:0}var z$=W$,K$=z$;function J$(r){var e=K$(r),t=e%1;return e===e?t?e-t:e:0}var ga=J$,G$=da,Y$=ir,X$=ga,Z$=Math.ceil,eC=Math.max;function tC(r,e,t){(t?Y$(r,e,t):e===void 0)?e=1:e=eC(X$(e),0);var n=r==null?0:r.length;if(!n||e<1)return[];for(var i=0,a=0,o=Array(Z$(n/e));i<n;)o[a++]=G$(r,i,i+=e);return o}var rC=tC,ya=Se,nC=yt,iC=F,ba=ya?ya.isConcatSpreadable:void 0;function sC(r){return iC(r)||nC(r)||!!(ba&&r&&r[ba])}var oC=sC,aC=en,lC=oC;function _a(r,e,t,n,i){var a=-1,o=r.length;for(t||(t=lC),i||(i=[]);++a<o;){var s=r[a];e>0&&t(s)?e>1?_a(s,e-1,t,n,i):aC(i,s):n||(i[i.length]=s)}return i}var uC=_a,cC=uC;function hC(r){var e=r==null?0:r.length;return e?cC(r,1):[]}var wa=hC,dC=r=>new Promise(e=>setTimeout(e,r));function fC(r){return typeof r=="string"}function pC(r){return typeof r=="number"}function mC(r){return typeof r=="boolean"}function gC(r){return typeof r>"u"}function yC(r){return typeof r=="object"&&r!==null}function bC(r){return typeof r=="function"}var M={isString:fC,isNumber:pC,isBoolean:mC,isUndefined:gC,isObject:yC,isFunction:bC};const _C=rC,wC=wa,$C=dC,{isNumber:CC}=M;function vC(r,e,t,n=1e3){let i,a=null;if(!CC(n)||n<1)throw new TypeError(`Invalid chunkSize: ${n}`);if(!Array.isArray(t))throw new TypeError(`Invalid batch: Expected array, got ${typeof t}`);const o=_C(t,n),s=l=>a?l(a):r.transaction(l);return Object.assign(Promise.resolve().then(async()=>(await $C(1),s(async l=>{const u=[];for(const h of o)u.push(await l(e).insert(h,i));return wC(u)}))),{returning(l){return i=l,this},transacting(l){return a=l,this}})}var EC=vC;const{EventEmitter:TC}=I,{Migrator:AC}=ar,OC=ar,NC=Nw,$a=ra,qC=O$,RC=EC,{isObject:SC}=M,Ca={client:{get(){return this.context.client},set(r){this.context.client=r},configurable:!0},userParams:{get(){return this.context.userParams},set(r){this.context.userParams=r},configurable:!0},schema:{get(){return this.client.schemaBuilder()},configurable:!0},migrate:{get(){return new AC(this)},configurable:!0},seed:{get(){return new OC},configurable:!0},fn:{get(){return new NC(this.client)},configurable:!0}},xC=["raw","batchInsert","transaction","transactionProvider","initialize","destroy","ref","withUserParams","queryBuilder","disableProcessing","enableProcessing"];for(const r of xC)Ca[r]={value:function(...e){return this.context[r](...e)},configurable:!0};function IC(r){function e(t,n){return Ea(e.context,t,n)}return va(e,r),e}function PC(r){const e=r.context||{};Object.assign(e,{queryBuilder(){return this.client.queryBuilder()},raw(){return this.client.raw.apply(this.client,arguments)},batchInsert(t,n,i=1e3){return RC(this,t,n,i)},transaction(t,n){!n&&SC(t)&&(n=t,t=null);const i=Object.assign({},n);return i.userParams=this.userParams||{},i.doNotRejectOnRollback===void 0&&(i.doNotRejectOnRollback=!0),this._transaction(t,i)},_transaction(t,n,i=null){return t?this.client.transaction(t,n,i):new Promise((a,o)=>{this.client.transaction(a,n,i).catch(o)})},transactionProvider(t){let n;return()=>(n||(n=this.transaction(void 0,t)),n)},initialize(t){return this.client.initializePool(t)},destroy(t){return this.client.destroy(t)},ref(t){return this.client.ref(t)},disableProcessing(){this.userParams.isProcessingDisabled||(this.userParams.wrapIdentifier=this.client.config.wrapIdentifier,this.userParams.postProcessResponse=this.client.config.postProcessResponse,this.client.config.wrapIdentifier=null,this.client.config.postProcessResponse=null,this.userParams.isProcessingDisabled=!0)},enableProcessing(){this.userParams.isProcessingDisabled&&(this.client.config.wrapIdentifier=this.userParams.wrapIdentifier,this.client.config.postProcessResponse=this.userParams.postProcessResponse,this.userParams.isProcessingDisabled=!1)},withUserParams(t){const n=LC(r);return this.client&&(n.client=Object.create(this.client.constructor.prototype),qC(n.client,this.client),n.client.config=Object.assign({},this.client.config)),va(n,n.client),lr("query",r,n),lr("query-error",r,n),lr("query-response",r,n),lr("start",r,n),n.userParams=t,n}}),r.context||(r.context=e)}function lr(r,e,t){e.listeners(r).forEach(i=>{t.on(r,i)})}function va(r,e){for(let n=0;n<$a.length;n++){const i=$a[n];r[i]=function(){const a=this.queryBuilder();return a[i].apply(a,arguments)}}Object.defineProperties(r,Ca),PC(r),r.client=e,r.userParams={};const t=new TC;for(const n in t)r[n]=t[n];r._internalListeners&&r._internalListeners.forEach(({eventName:n,listener:i})=>{r.client.removeListener(n,i)}),r._internalListeners=[],ur(r,"start",n=>{r.emit("start",n)}),ur(r,"query",n=>{r.emit("query",n)}),ur(r,"query-error",(n,i)=>{r.emit("query-error",n,i)}),ur(r,"query-response",(n,i,a)=>{r.emit("query-response",n,i,a)})}function ur(r,e,t){r.client.on(e,t),r._internalListeners.push({eventName:e,listener:t})}function Ea(r,e,t){const n=r.queryBuilder();return e||r.client.logger.warn("calling knex without a tableName is deprecated. Use knex.queryBuilder() instead."),e?n.table(e,t):n}function LC(r){const e=Object.create(Object.getPrototypeOf(r),Object.getOwnPropertyDescriptors(r)),t={},i=((a,o)=>Ea(t,a,o)).bind(e);return Object.assign(i,r),i.context=t,i}var Ta=IC;const BC=ar,kC=r=>Object.assign(r,{finally(e){return this.then().finally(e)}});var Aa=Promise.prototype.finally?kC:BC;const{EventEmitter:MC}=I,jC=ae,QC=Xo,{callbackify:DC}=I,FC=Ta,{timeout:Oa,KnexTimeoutError:Na}=we,UC=Aa,_t=jC("knex:tx");function HC(){return{userParams:{},doNotRejectOnRollback:!0}}const qa=["read uncommitted","read committed","snapshot","repeatable read","serializable"];let Ra=class extends MC{constructor(e,t,n=HC(),i=null){super(),this.userParams=n.userParams,this.doNotRejectOnRollback=n.doNotRejectOnRollback;const a=this.txid=QC("trx");this.client=e,this.logger=e.logger,this.outerTx=i,this.trxClient=void 0,this._completed=!1,this._debug=e.config&&e.config.debug,n.isolationLevel&&this.setIsolationLevel(n.isolationLevel),_t("%s: Starting %s transaction",a,i?"nested":"top level"),this._lastChild=Promise.resolve();const s=(i?i._lastChild:Promise.resolve()).then(()=>this._evaluateContainer(n,t));this._promise=s.then(l=>l),i&&(i._lastChild=s.catch(()=>{}))}isCompleted(){return this._completed||this.outerTx&&this.outerTx.isCompleted()||!1}begin(e){return(this.isolationLevel?this.query(e,`SET TRANSACTION ISOLATION LEVEL ${this.isolationLevel};`):Promise.resolve()).then(()=>this.query(e,"BEGIN;"))}savepoint(e){return this.query(e,`SAVEPOINT ${this.txid};`)}commit(e,t){return this.query(e,"COMMIT;",1,t)}release(e,t){return this.query(e,`RELEASE SAVEPOINT ${this.txid};`,1,t)}setIsolationLevel(e){if(!qa.includes(e))throw new Error(`Invalid isolationLevel, supported isolation levels are: ${JSON.stringify(qa)}`);return this.isolationLevel=e,this}rollback(e,t){return Oa(this.query(e,"ROLLBACK",2,t),5e3).catch(n=>{if(!(n instanceof Na))return Promise.reject(n);this._rejecter(t)})}rollbackTo(e,t){return Oa(this.query(e,`ROLLBACK TO SAVEPOINT ${this.txid}`,2,t),5e3).catch(n=>{if(!(n instanceof Na))return Promise.reject(n);this._rejecter(t)})}query(e,t,n,i){const a=this.trxClient.query(e,t).catch(o=>{n=2,i=o,this._completed=!0,_t("%s error running transaction query",this.txid)}).then(o=>{if(n===1&&this._resolver(i),n===2){if(i===void 0){if(this.doNotRejectOnRollback&&/^ROLLBACK\b/i.test(t)){this._resolver();return}i=new Error(`Transaction rejected with non-error: ${i}`)}this._rejecter(i)}return o});return(n===1||n===2)&&(this._completed=!0),a}debug(e){return this._debug=arguments.length?e:!0,this}async _evaluateContainer(e,t){return this.acquireConnection(e,n=>{const i=this.trxClient=WC(this,this.client,n),a=this.client.transacting?this.savepoint(n):this.begin(n),o=new Promise((s,l)=>{this._resolver=s,this._rejecter=l});return a.then(()=>VC(this,n,i)).then(s=>{s.executionPromise=o;let l;try{l=t(s)}catch(u){l=Promise.reject(u)}return l&&l.then&&typeof l.then=="function"&&l.then(u=>s.commit(u)).catch(u=>s.rollback(u)),null}).catch(s=>this._rejecter(s)),o})}async acquireConnection(e,t){const n=e&&e.connection,i=n||await this.client.acquireConnection();try{return i.__knexTxId=this.txid,await t(i)}finally{n?_t("%s: not releasing external connection",this.txid):(_t("%s: releasing connection",this.txid),this.client.releaseConnection(i))}}then(e,t){return this._promise.then(e,t)}catch(...e){return this._promise.catch(...e)}asCallback(e){return DC(()=>this._promise)(e),this._promise}};UC(Ra.prototype);function VC(r,e,t){const n=FC(t);return n.context.withUserParams=()=>{throw new Error("Cannot set user params on a transaction - it can only inherit params from main knex instance")},n.isTransaction=!0,n.userParams=r.userParams||{},n.context.transaction=function(i,a){return a?a.doNotRejectOnRollback===void 0&&(a.doNotRejectOnRollback=!0):a={doNotRejectOnRollback:!0},this._transaction(i,a,r)},n.savepoint=function(i,a){return n.transaction(i,a)},r.client.transacting?(n.commit=i=>r.release(e,i),n.rollback=i=>r.rollbackTo(e,i)):(n.commit=i=>r.commit(e,i),n.rollback=i=>r.rollback(e,i)),n.isCompleted=()=>r.isCompleted(),n}function WC(r,e,t){const n=Object.create(e.constructor.prototype);n.version=e.version,n.config=e.config,n.driver=e.driver,n.connectionSettings=e.connectionSettings,n.transacting=!0,n.valueForUndefined=e.valueForUndefined,n.logger=e.logger,n.on("start",function(o){r.emit("start",o),e.emit("start",o)}),n.on("query",function(o){r.emit("query",o),e.emit("query",o)}),n.on("query-error",function(o,s){r.emit("query-error",o,s),e.emit("query-error",o,s)}),n.on("query-response",function(o,s,l){r.emit("query-response",o,s,l),e.emit("query-response",o,s,l)});const i=n.query;n.query=function(o,s){const l=r.isCompleted();return new Promise(function(u,h){try{if(o!==t)throw new Error("Invalid connection for transaction query.");l&&Sa(r,s),u(i.call(n,o,s))}catch(c){h(c)}})};const a=n.stream;return n.stream=function(o,s,l,u){const h=r.isCompleted();return new Promise(function(c,d){try{if(o!==t)throw new Error("Invalid connection for transaction query.");h&&Sa(r,s),c(a.call(n,o,s,l,u))}catch(p){d(p)}})},n.acquireConnection=function(){return Promise.resolve(t)},n.releaseConnection=function(){return Promise.resolve()},n}function Sa(r,e){const t=typeof e=="string"?e:e&&e.sql;throw _t("%s: Transaction completed: %s",r.txid,t),new Error("Transaction query already complete, run with DEBUG=knex:tx for more info")}var Ce=Ra;const zC=ae("knex:query"),KC=ae("knex:bindings"),JC=(r,e)=>zC(r.replace(/%/g,"%%"),e),{isString:GC}=M;function xa(r,e,t,n){e=e==null?[]:[].concat(e);let i=0;return r.replace(/\\?\?/g,a=>{if(a==="\\?")return"?";if(i===e.length)return a;const o=e[i++];return n._escapeBinding(o,{timeZone:t})})}function YC(r,e,t){const n=GC(e)?{sql:e}:e;n.bindings=t.prepBindings(n.bindings),n.sql=t.positionBindings(n.sql);const{__knexUid:i,__knexTxId:a}=r;return t.emit("query",Object.assign({__knexUid:i,__knexTxId:a},n)),JC(n.sql,a),KC(n.bindings,a),n}function XC(r,e,t){return t._query(r,e).catch(n=>{throw t.config&&t.config.compileSqlOnError===!1?n.message=e.sql+" - "+n.message:n.message=xa(e.sql,e.bindings,void 0,t)+" - "+n.message,t.emit("query-error",n,Object.assign({__knexUid:r.__knexUid,__knexTxId:r.__knexUid},e)),n})}var Ia={enrichQueryObject:YC,executeQuery:XC,formatQuery:xa},ZC=Yt,ev=Pe,tv=dn,rv=pe,nv=bt,iv=Le,sv=Object.prototype,ov=sv.hasOwnProperty,av=tv(function(r,e){if(nv(e)||rv(e)){ev(e,iv(e),r);return}for(var t in e)ov.call(e,t)&&ZC(r,t,e[t])}),Me=av,lv=Do,uv=4;function cv(r){return lv(r,uv)}var fn=cv,hv=ia,dv=Le;function fv(r,e){return r&&hv(r,e,dv)}var Pa=fv,pv=pe;function mv(r,e){return function(t,n){if(t==null)return t;if(!pv(t))return r(t,n);for(var i=t.length,a=e?i:-1,o=Object(t);(e?a--:++a<i)&&n(o[a],a,o)!==!1;);return t}}var gv=mv,yv=Pa,bv=gv,_v=bv(yv),it=_v,wv=ie;function $v(r){return typeof r=="function"?r:wv}var Cv=$v,vv=zr,Ev=it,Tv=Cv,Av=F;function Ov(r,e){var t=Av(r)?vv:Ev;return t(r,Tv(e))}var Nv=Ov,wt=Nv,qv=uo,Rv=nt,Sv=yt,xv=F,Iv=pe,Pv=et,Lv=bt,Bv=tt,kv="[object Map]",Mv="[object Set]",jv=Object.prototype,Qv=jv.hasOwnProperty;function Dv(r){if(r==null)return!0;if(Iv(r)&&(xv(r)||typeof r=="string"||typeof r.splice=="function"||Pv(r)||Bv(r)||Sv(r)))return!r.length;var e=Rv(r);if(e==kv||e==Mv)return!r.size;if(Lv(r))return!qv(r).length;for(var t in r)if(Qv.call(r,t))return!1;return!0}var le=Dv;function Fv(r){var e=r==null?0:r.length;return e?r[e-1]:void 0}var Uv=Fv,Hv=it;function Vv(r,e){var t=[];return Hv(r,function(n,i,a){e(n,i,a)&&t.push(n)}),t}var La=Vv,pn,Ba;function Wv(){if(Ba)return pn;Ba=1;var r="__lodash_hash_undefined__";function e(t){return this.__data__.set(t,r),this}return pn=e,pn}var mn,ka;function zv(){if(ka)return mn;ka=1;function r(e){return this.__data__.has(e)}return mn=r,mn}var gn,Ma;function ja(){if(Ma)return gn;Ma=1;var r=Wr,e=Wv(),t=zv();function n(i){var a=-1,o=i==null?0:i.length;for(this.__data__=new r;++a<o;)this.add(i[a])}return n.prototype.add=n.prototype.push=e,n.prototype.has=t,gn=n,gn}var yn,Qa;function Da(){if(Qa)return yn;Qa=1;function r(e,t){for(var n=-1,i=e==null?0:e.length;++n<i;)if(t(e[n],n,e))return!0;return!1}return yn=r,yn}var bn,Fa;function Ua(){if(Fa)return bn;Fa=1;function r(e,t){return e.has(t)}return bn=r,bn}var Kv=ja(),Jv=Da(),Gv=Ua(),Yv=1,Xv=2;function Zv(r,e,t,n,i,a){var o=t&Yv,s=r.length,l=e.length;if(s!=l&&!(o&&l>s))return!1;var u=a.get(r),h=a.get(e);if(u&&h)return u==e&&h==r;var c=-1,d=!0,p=t&Xv?new Kv:void 0;for(a.set(r,e),a.set(e,r);++c<s;){var g=r[c],_=e[c];if(n)var f=o?n(_,g,c,e,r,a):n(g,_,c,r,e,a);if(f!==void 0){if(f)continue;d=!1;break}if(p){if(!Jv(e,function(m,y){if(!Gv(p,y)&&(g===m||i(g,m,t,n,a)))return p.push(y)})){d=!1;break}}else if(!(g===_||i(g,_,t,n,a))){d=!1;break}}return a.delete(r),a.delete(e),d}var Ha=Zv;function eE(r){var e=-1,t=Array(r.size);return r.forEach(function(n,i){t[++e]=[i,n]}),t}var Va=eE;function tE(r){var e=-1,t=Array(r.size);return r.forEach(function(n){t[++e]=n}),t}var cr=tE,Wa=Se,za=To,rE=Je,nE=Ha,iE=Va,sE=cr,oE=1,aE=2,lE="[object Boolean]",uE="[object Date]",cE="[object Error]",hE="[object Map]",dE="[object Number]",fE="[object RegExp]",pE="[object Set]",mE="[object String]",gE="[object Symbol]",yE="[object ArrayBuffer]",bE="[object DataView]",Ka=Wa?Wa.prototype:void 0,_n=Ka?Ka.valueOf:void 0;function _E(r,e,t,n,i,a,o){switch(t){case bE:if(r.byteLength!=e.byteLength||r.byteOffset!=e.byteOffset)return!1;r=r.buffer,e=e.buffer;case yE:return!(r.byteLength!=e.byteLength||!a(new za(r),new za(e)));case lE:case uE:case dE:return rE(+r,+e);case cE:return r.name==e.name&&r.message==e.message;case fE:case mE:return r==e+"";case hE:var s=iE;case pE:var l=n&oE;if(s||(s=sE),r.size!=e.size&&!l)return!1;var u=o.get(r);if(u)return u==e;n|=aE,o.set(r,e);var h=nE(s(r),s(e),n,i,a,o);return o.delete(r),h;case gE:if(_n)return _n.call(r)==_n.call(e)}return!1}var wE=_E,Ja=go,$E=1,CE=Object.prototype,vE=CE.hasOwnProperty;function EE(r,e,t,n,i,a){var o=t&$E,s=Ja(r),l=s.length,u=Ja(e),h=u.length;if(l!=h&&!o)return!1;for(var c=l;c--;){var d=s[c];if(!(o?d in e:vE.call(e,d)))return!1}var p=a.get(r),g=a.get(e);if(p&&g)return p==e&&g==r;var _=!0;a.set(r,e),a.set(e,r);for(var f=o;++c<l;){d=s[c];var m=r[d],y=e[d];if(n)var w=o?n(y,m,d,e,r,a):n(m,y,d,r,e,a);if(!(w===void 0?m===y||i(m,y,t,n,a):w)){_=!1;break}f||(f=d=="constructor")}if(_&&!f){var $=r.constructor,E=e.constructor;$!=E&&"constructor"in r&&"constructor"in e&&!(typeof $=="function"&&$ instanceof $&&typeof E=="function"&&E instanceof E)&&(_=!1)}return a.delete(r),a.delete(e),_}var TE=EE,wn=Jt,AE=Ha,OE=wE,NE=TE,Ga=nt,Ya=F,Xa=et,qE=tt,RE=1,Za="[object Arguments]",el="[object Array]",hr="[object Object]",SE=Object.prototype,tl=SE.hasOwnProperty;function xE(r,e,t,n,i,a){var o=Ya(r),s=Ya(e),l=o?el:Ga(r),u=s?el:Ga(e);l=l==Za?hr:l,u=u==Za?hr:u;var h=l==hr,c=u==hr,d=l==u;if(d&&Xa(r)){if(!Xa(e))return!1;o=!0,h=!1}if(d&&!h)return a||(a=new wn),o||qE(r)?AE(r,e,t,n,i,a):OE(r,e,l,t,n,i,a);if(!(t&RE)){var p=h&&tl.call(r,"__wrapped__"),g=c&&tl.call(e,"__wrapped__");if(p||g){var _=p?r.value():r,f=g?e.value():e;return a||(a=new wn),i(_,f,t,n,a)}}return d?(a||(a=new wn),NE(r,e,t,n,i,a)):!1}var IE=xE,PE=IE,rl=ce;function nl(r,e,t,n,i){return r===e?!0:r==null||e==null||!rl(r)&&!rl(e)?r!==r&&e!==e:PE(r,e,t,n,nl,i)}var il=nl,LE=Jt,BE=il,kE=1,ME=2;function jE(r,e,t,n){var i=t.length,a=i,o=!n;if(r==null)return!a;for(r=Object(r);i--;){var s=t[i];if(o&&s[2]?s[1]!==r[s[0]]:!(s[0]in r))return!1}for(;++i<a;){s=t[i];var l=s[0],u=r[l],h=s[1];if(o&&s[2]){if(u===void 0&&!(l in r))return!1}else{var c=new LE;if(n)var d=n(u,h,l,r,e,c);if(!(d===void 0?BE(h,u,kE|ME,n,c):d))return!1}}return!0}var QE=jE,DE=ne;function FE(r){return r===r&&!DE(r)}var sl=FE,UE=sl,HE=Le;function VE(r){for(var e=HE(r),t=e.length;t--;){var n=e[t],i=r[n];e[t]=[n,i,UE(i)]}return e}var WE=VE;function zE(r,e){return function(t){return t==null?!1:t[r]===e&&(e!==void 0||r in Object(t))}}var ol=zE,KE=QE,JE=WE,GE=ol;function YE(r){var e=JE(r);return e.length==1&&e[0][2]?GE(e[0][0],e[0][1]):function(t){return t===r||KE(t,r,e)}}var XE=YE,ZE=F,eT=or,tT=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,rT=/^\w*$/;function nT(r,e){if(ZE(r))return!1;var t=typeof r;return t=="number"||t=="symbol"||t=="boolean"||r==null||eT(r)?!0:rT.test(r)||!tT.test(r)||e!=null&&r in Object(e)}var $n=nT,al=Wr,iT="Expected a function";function Cn(r,e){if(typeof r!="function"||e!=null&&typeof e!="function")throw new TypeError(iT);var t=function(){var n=arguments,i=e?e.apply(this,n):n[0],a=t.cache;if(a.has(i))return a.get(i);var o=r.apply(this,n);return t.cache=a.set(i,o)||a,o};return t.cache=new(Cn.Cache||al),t}Cn.Cache=al;var sT=Cn,oT=sT,aT=500;function lT(r){var e=oT(r,function(n){return t.size===aT&&t.clear(),n}),t=e.cache;return e}var uT=lT,cT=uT,hT=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,dT=/\\(\\)?/g,fT=cT(function(r){var e=[];return r.charCodeAt(0)===46&&e.push(""),r.replace(hT,function(t,n,i,a){e.push(i?a.replace(dT,"$1"):n||t)}),e}),pT=fT,mT=F,gT=$n,yT=pT,bT=Yo;function _T(r,e){return mT(r)?r:gT(r,e)?[r]:yT(bT(r))}var dr=_T,wT=or,$T=1/0;function CT(r){if(typeof r=="string"||wT(r))return r;var e=r+"";return e=="0"&&1/r==-$T?"-0":e}var $t=CT,vT=dr,ET=$t;function TT(r,e){e=vT(e,r);for(var t=0,n=e.length;r!=null&&t<n;)r=r[ET(e[t++])];return t&&t==n?r:void 0}var vn=TT,AT=vn;function OT(r,e,t){var n=r==null?void 0:AT(r,e);return n===void 0?t:n}var NT=OT;function qT(r,e){return r!=null&&e in Object(r)}var RT=qT,ST=dr,xT=yt,IT=F,PT=Zt,LT=Kr,BT=$t;function kT(r,e,t){e=ST(e,r);for(var n=-1,i=e.length,a=!1;++n<i;){var o=BT(e[n]);if(!(a=r!=null&&t(r,o)))break;r=r[o]}return a||++n!=i?a:(i=r==null?0:r.length,!!i&&LT(i)&&PT(o,i)&&(IT(r)||xT(r)))}var ll=kT,MT=RT,jT=ll;function QT(r,e){return r!=null&&jT(r,e,MT)}var DT=QT,FT=il,UT=NT,HT=DT,VT=$n,WT=sl,zT=ol,KT=$t,JT=1,GT=2;function YT(r,e){return VT(r)&&WT(e)?zT(KT(r),e):function(t){var n=UT(t,r);return n===void 0&&n===e?HT(t,r):FT(e,n,JT|GT)}}var XT=YT;function ZT(r){return function(e){return e==null?void 0:e[r]}}var eA=ZT,tA=vn;function rA(r){return function(e){return tA(e,r)}}var nA=rA,iA=eA,sA=nA,oA=$n,aA=$t;function lA(r){return oA(r)?iA(aA(r)):sA(r)}var uA=lA,cA=XE,hA=XT,dA=ie,fA=F,pA=uA;function mA(r){return typeof r=="function"?r:r==null?dA:typeof r=="object"?fA(r)?hA(r[0],r[1]):cA(r):pA(r)}var me=mA,gA="Expected a function";function yA(r){if(typeof r!="function")throw new TypeError(gA);return function(){var e=arguments;switch(e.length){case 0:return!r.call(this);case 1:return!r.call(this,e[0]);case 2:return!r.call(this,e[0],e[1]);case 3:return!r.call(this,e[0],e[1],e[2])}return!r.apply(this,e)}}var ul=yA,bA=Xr,_A=La,wA=me,$A=F,CA=ul;function vA(r,e){var t=$A(r)?bA:_A;return t(r,CA(wA(e)))}var EA=vA,TA=da;function AA(r){var e=r==null?0:r.length;return e?TA(r,1,e):[]}var fr=AA,OA=xe,NA=F,qA=ce,RA="[object String]";function SA(r){return typeof r=="string"||!NA(r)&&qA(r)&&OA(r)==RA}var xA=SA;function IA(r){for(var e,t=[];!(e=r.next()).done;)t.push(e.value);return t}var PA=IA;function LA(r){return r.split("")}var BA=LA,kA="\\ud800-\\udfff",MA="\\u0300-\\u036f",jA="\\ufe20-\\ufe2f",QA="\\u20d0-\\u20ff",DA=MA+jA+QA,FA="\\ufe0e\\ufe0f",UA="\\u200d",HA=RegExp("["+UA+kA+DA+FA+"]");function VA(r){return HA.test(r)}var WA=VA,cl="\\ud800-\\udfff",zA="\\u0300-\\u036f",KA="\\ufe20-\\ufe2f",JA="\\u20d0-\\u20ff",GA=zA+KA+JA,YA="\\ufe0e\\ufe0f",XA="["+cl+"]",En="["+GA+"]",Tn="\\ud83c[\\udffb-\\udfff]",ZA="(?:"+En+"|"+Tn+")",hl="[^"+cl+"]",dl="(?:\\ud83c[\\udde6-\\uddff]){2}",fl="[\\ud800-\\udbff][\\udc00-\\udfff]",eO="\\u200d",pl=ZA+"?",ml="["+YA+"]?",tO="(?:"+eO+"(?:"+[hl,dl,fl].join("|")+")"+ml+pl+")*",rO=ml+pl+tO,nO="(?:"+[hl+En+"?",En,dl,fl,XA].join("|")+")",iO=RegExp(Tn+"(?="+Tn+")|"+nO+rO,"g");function sO(r){return r.match(iO)||[]}var oO=sO,aO=BA,lO=WA,uO=oO;function cO(r){return lO(r)?uO(r):aO(r)}var hO=cO,dO=sr;function fO(r,e){return dO(e,function(t){return r[t]})}var pO=fO,mO=pO,gO=Le;function yO(r){return r==null?[]:mO(r,gO(r))}var gl=yO,yl=Se,bO=Yr,_O=nt,wO=pe,$O=xA,CO=PA,vO=Va,EO=cr,TO=hO,AO=gl,OO="[object Map]",NO="[object Set]",An=yl?yl.iterator:void 0;function qO(r){if(!r)return[];if(wO(r))return $O(r)?TO(r):bO(r);if(An&&r[An])return CO(r[An]());var e=_O(r),t=e==OO?vO:e==NO?EO:AO;return t(r)}var Ct=qO;const bl=Object.freeze({pg:"postgres",postgresql:"postgres",sqlite:"sqlite3"}),RO=Object.freeze(["mssql","mysql","mysql2","oracledb","postgres","pgnative","redshift","sqlite3","cockroachdb","better-sqlite3"].concat(Object.keys(bl))),SO=Object.freeze({MsSQL:"mssql",MySQL:"mysql",MySQL2:"mysql2",Oracle:"oracledb",PostgreSQL:"pg",PgNative:"pgnative",Redshift:"pg-redshift",SQLite:"sqlite3",CockroachDB:"cockroachdb",BetterSQLite3:"better-sqlite3"}),xO=Object.freeze(["maxWaitingClients","testOnBorrow","fifo","priorityRange","autostart","evictionRunIntervalMillis","numTestsPerRun","softIdleTimeoutMillis","Promise"]);var On={CLIENT_ALIASES:bl,SUPPORTED_CLIENTS:RO,POOL_CONFIG_OPTIONS:xO,COMMA_NO_PAREN_REGEX:/,[\s](?![^(]*\))/g,DRIVER_NAMES:SO};const _l=$e,IO=tt,{CLIENT_ALIASES:PO}=On,{isFunction:LO}=M;function BO(...r){return Array.isArray(r[0])?r[0]:r}function vt(r){let e=!1;if(IO(r))return!1;if(r&&LO(r.toSQL))return e;if(Array.isArray(r))for(let t=0;t<r.length&&!e;t++)e=vt(r[t]);else _l(r)?Object.keys(r).forEach(t=>{e||(e=vt(r[t]))}):e=r===void 0;return e}function kO(r){const e=[];return Array.isArray(r)?r.forEach((t,n)=>{vt(t)&&e.push(n)}):_l(r)?Object.keys(r).forEach(t=>{vt(r[t])&&e.push(t)}):e.push(0),e}function MO(r){r.prototype.queryContext=function(e){return e===void 0?this._queryContext:(this._queryContext=e,this)}}function jO(r){return PO[r]||r}function QO(r,e){if(r==null)return e;const t=parseInt(r,10);return isNaN(t)?e:t}var z={addQueryContext:MO,containsUndefined:vt,getUndefinedIndices:kO,normalizeArr:BO,resolveClientNameWithAliases:jO,toNumber:QO};const wl=I;function $l(r,e,t,n,i){if(typeof t=="function")return{type:"onWrapped",value:t,bool:e};switch(arguments.length){case 3:return{type:"onRaw",value:t,bool:e};case 4:return{type:r,column:t,operator:"=",value:n,bool:e};default:return{type:r,column:t,operator:n,value:i,bool:e}}}let D=class{constructor(e,t,n){this.schema=n,this.table=e,this.joinType=t,this.and=this,this.clauses=[]}get or(){return this._bool("or")}on(e){if(typeof e=="object"&&typeof e.toSQL!="function"){const n=Object.keys(e);let i=-1;const a=this._bool()==="or"?"orOn":"on";for(;++i<n.length;)this[a](n[i],e[n[i]]);return this}const t=$l("onBasic",this._bool(),...arguments);return t&&this.clauses.push(t),this}orOn(e,t,n){return this._bool("or").on.apply(this,arguments)}onJsonPathEquals(e,t,n,i){return this.clauses.push({type:"onJsonPathEquals",columnFirst:e,jsonPathFirst:t,columnSecond:n,jsonPathSecond:i,bool:this._bool(),not:this._not()}),this}orOnJsonPathEquals(e,t,n,i){return this._bool("or").onJsonPathEquals.apply(this,arguments)}using(e){return this.clauses.push({type:"onUsing",column:e,bool:this._bool()})}onVal(e){if(typeof e=="object"&&typeof e.toSQL!="function"){const n=Object.keys(e);let i=-1;const a=this._bool()==="or"?"orOnVal":"onVal";for(;++i<n.length;)this[a](n[i],e[n[i]]);return this}const t=$l("onVal",this._bool(),...arguments);return t&&this.clauses.push(t),this}andOnVal(){return this.onVal(...arguments)}orOnVal(){return this._bool("or").onVal(...arguments)}onBetween(e,t){return wl(Array.isArray(t),"The second argument to onBetween must be an array."),wl(t.length===2,"You must specify 2 values for the onBetween clause"),this.clauses.push({type:"onBetween",column:e,value:t,bool:this._bool(),not:this._not()}),this}onNotBetween(e,t){return this._not(!0).onBetween(e,t)}orOnBetween(e,t){return this._bool("or").onBetween(e,t)}orOnNotBetween(e,t){return this._bool("or")._not(!0).onBetween(e,t)}onIn(e,t){return Array.isArray(t)&&t.length===0?this.on(1,"=",0):(this.clauses.push({type:"onIn",column:e,value:t,not:this._not(),bool:this._bool()}),this)}onNotIn(e,t){return this._not(!0).onIn(e,t)}orOnIn(e,t){return this._bool("or").onIn(e,t)}orOnNotIn(e,t){return this._bool("or")._not(!0).onIn(e,t)}onNull(e){return this.clauses.push({type:"onNull",column:e,not:this._not(),bool:this._bool()}),this}orOnNull(e){return this._bool("or").onNull(e)}onNotNull(e){return this._not(!0).onNull(e)}orOnNotNull(e){return this._not(!0)._bool("or").onNull(e)}onExists(e){return this.clauses.push({type:"onExists",value:e,not:this._not(),bool:this._bool()}),this}orOnExists(e){return this._bool("or").onExists(e)}onNotExists(e){return this._not(!0).onExists(e)}orOnNotExists(e){return this._not(!0)._bool("or").onExists(e)}type(e){return this.joinType=e,this}_bool(e){if(arguments.length===1)return this._boolFlag=e,this;const t=this._boolFlag||"and";return this._boolFlag="and",t}_not(e){if(arguments.length===1)return this._notFlag=e,this;const t=this._notFlag;return this._notFlag=!1,t}};Object.assign(D.prototype,{grouping:"join"}),D.prototype.andOn=D.prototype.on,D.prototype.andOnIn=D.prototype.onIn,D.prototype.andOnNotIn=D.prototype.onNotIn,D.prototype.andOnNull=D.prototype.onNull,D.prototype.andOnNotNull=D.prototype.onNotNull,D.prototype.andOnExists=D.prototype.onExists,D.prototype.andOnNotExists=D.prototype.onNotExists,D.prototype.andOnBetween=D.prototype.onBetween,D.prototype.andOnNotBetween=D.prototype.onNotBetween,D.prototype.andOnJsonPathEquals=D.prototype.onJsonPathEquals;var Cl=D;const vl=I;var DO=class{constructor(e,t,n,i,a){this.schema=t,this.type="analytic",this.method=e,this.order=i||[],this.partitions=a||[],this.alias=n,this.and=this,this.grouping="columns"}partitionBy(e,t){return vl(Array.isArray(e)||typeof e=="string",`The argument to an analytic partitionBy function must be either a string
            or an array of string.`),Array.isArray(e)?this.partitions=this.partitions.concat(e):this.partitions.push({column:e,order:t}),this}orderBy(e,t){return vl(Array.isArray(e)||typeof e=="string",`The argument to an analytic orderBy function must be either a string
            or an array of string.`),Array.isArray(e)?this.order=this.order.concat(e):this.order.push({column:e,order:t}),this}},Nn=function(e,t){e.client.config.asyncStackTraces&&(e._asyncStack={error:new Error,lines:t})},FO={lockMode:{forShare:"forShare",forUpdate:"forUpdate",forNoKeyUpdate:"forNoKeyUpdate",forKeyShare:"forKeyShare"},waitMode:{skipLocked:"skipLocked",noWait:"noWait"}};const UO=fn,HO=le,{callbackify:VO}=I,WO=Aa,{formatQuery:zO}=Ia;function KO(r){r.prototype.toQuery=function(e){let t=this.toSQL(this._method,e);return Array.isArray(t)||(t=[t]),t.length?t.map(n=>zO(n.sql,n.bindings,e,this.client)).reduce((n,i)=>n.concat(n.endsWith(";")?`
`:`;
`,i)):""},r.prototype.then=function(){let e=this.client.runner(this).run();return this.client.config.asyncStackTraces&&(e=e.catch(t=>{t.originalStack=t.stack;const n=t.stack.split(`
`)[0],{error:i,lines:a}=this._asyncStack,s=i.stack.split(`
`).slice(a);throw s.unshift(n),t.stack=s.join(`
`),t})),e.then.apply(e,arguments)},r.prototype.options=function(e){return this._options=this._options||[],this._options.push(UO(e)||{}),this},r.prototype.connection=function(e){return this._connection=e,this.client.processPassedConnection(e),this},r.prototype.debug=function(e){return this._debug=arguments.length?e:!0,this},r.prototype.transacting=function(e){if(e&&e.client&&(e.client.transacting?this.client=e.client:e.client.logger.warn(`Invalid transaction value: ${e.client}`)),HO(e))throw this.client.logger.error("Invalid value on transacting call, potential bug"),Error("Invalid transacting value (null, undefined or empty object)");return this},r.prototype.stream=function(e){return this.client.runner(this).stream(e)},r.prototype.pipe=function(e,t){return this.client.runner(this).pipe(e,t)},r.prototype.asCallback=function(e){const t=this.then();return VO(()=>t)(e),t},r.prototype.catch=function(e){return this.then().catch(e)},Object.defineProperty(r.prototype,Symbol.toStringTag,{get:()=>"object"}),WO(r.prototype)}var qn={augmentWithBuilderInterface:KO};const st=I,{EventEmitter:JO}=I,GO=Me,pr=fn,YO=wt,ot=le,El=$e,XO=Uv,ZO=EA,eN=fr,Tl=Ct,{addQueryContext:tN,normalizeArr:Et}=z,Rn=Cl,rN=DO,nN=Nn,{isBoolean:Tt,isNumber:iN,isObject:ge,isString:Sn,isFunction:sN}=M,{lockMode:ve,waitMode:mr}=FO,{augmentWithBuilderInterface:oN}=qn,aN=new Set(["pluck","first","select"]),lN=new Set(["with","select","columns","hintComments","where","union","join","group","order","having","limit","offset","counter","counters"]),uN=new Set([ve.forShare,ve.forUpdate,ve.forNoKeyUpdate,ve.forKeyShare]);class q extends JO{constructor(e){super(),this.client=e,this.and=this,this._single={},this._statements=[],this._method="select",e.config&&(nN(this,5),this._debug=e.config.debug),this._joinFlag="inner",this._boolFlag="and",this._notFlag=!1,this._asColumnFlag=!1}toString(){return this.toQuery()}toSQL(e,t){return this.client.queryCompiler(this).toSQL(e||this._method,t)}clone(){const e=new this.constructor(this.client);return e._method=this._method,e._single=pr(this._single),e._statements=pr(this._statements),e._debug=this._debug,this._options!==void 0&&(e._options=pr(this._options)),this._queryContext!==void 0&&(e._queryContext=pr(this._queryContext)),this._connection!==void 0&&(e._connection=this._connection),e}timeout(e,{cancel:t}={}){return iN(e)&&e>0&&(this._timeout=e,t&&(this.client.assertCanCancelQuery(),this._cancelOnTimeout=!0)),this}isValidStatementArg(e){return typeof e=="function"||e instanceof q||e&&e.isRawInstance}_validateWithArgs(e,t,n,i){const[a,o]=typeof n>"u"?[t,void 0]:[n,t];if(typeof e!="string")throw new Error(`${i}() first argument must be a string`);if(this.isValidStatementArg(a)&&typeof o>"u")return;if(!(Array.isArray(o)&&o.length>0&&o.every(l=>typeof l=="string")))throw new Error(`${i}() second argument must be a statement or non-empty column name list.`);if(!this.isValidStatementArg(a))throw new Error(`${i}() third argument must be a function / QueryBuilder or a raw when its second argument is a column name list`)}with(e,t,n){return this._validateWithArgs(e,t,n,"with"),this.withWrapped(e,t,n)}withMaterialized(e,t,n){throw new Error("With materialized is not supported by this dialect")}withNotMaterialized(e,t,n){throw new Error("With materialized is not supported by this dialect")}withWrapped(e,t,n,i){const[a,o]=typeof n>"u"?[t,void 0]:[n,t],s={grouping:"with",type:"withWrapped",alias:e,columnList:o,value:a};return i!==void 0&&(s.materialized=i),this._statements.push(s),this}withRecursive(e,t,n){return this._validateWithArgs(e,t,n,"withRecursive"),this.withRecursiveWrapped(e,t,n)}withRecursiveWrapped(e,t,n){return this.withWrapped(e,t,n),this._statements[this._statements.length-1].recursive=!0,this}columns(e){return!e&&e!==0?this:(this._statements.push({grouping:"columns",value:Et(...arguments)}),this)}as(e){return this._single.as=e,this}hintComment(e){if(e=Array.isArray(e)?e:[e],e.some(t=>!Sn(t)))throw new Error("Hint comment must be a string");if(e.some(t=>t.includes("/*")||t.includes("*/")))throw new Error('Hint comment cannot include "/*" or "*/"');if(e.some(t=>t.includes("?")))throw new Error('Hint comment cannot include "?"');return this._statements.push({grouping:"hintComments",value:e}),this}withSchema(e){return this._single.schema=e,this}table(e,t={}){return this._single.table=e,this._single.only=t.only===!0,this}distinct(...e){return this._statements.push({grouping:"columns",value:Et(...e),distinct:!0}),this}distinctOn(...e){if(ot(e))throw new Error("distinctOn requires at least on argument");return this._statements.push({grouping:"columns",value:Et(...e),distinctOn:!0}),this}join(e,t,...n){let i;const a=e instanceof q||typeof e=="function"?void 0:this._single.schema,o=this._joinType();return typeof t=="function"?(i=new Rn(e,o,a),t.call(i,i)):o==="raw"?i=new Rn(this.client.raw(e,t),"raw"):(i=new Rn(e,o,a),t&&i.on(t,...n)),this._statements.push(i),this}using(e){throw new Error("'using' function is only available in PostgreSQL dialect with Delete statements.")}innerJoin(...e){return this._joinType("inner").join(...e)}leftJoin(...e){return this._joinType("left").join(...e)}leftOuterJoin(...e){return this._joinType("left outer").join(...e)}rightJoin(...e){return this._joinType("right").join(...e)}rightOuterJoin(...e){return this._joinType("right outer").join(...e)}outerJoin(...e){return this._joinType("outer").join(...e)}fullOuterJoin(...e){return this._joinType("full outer").join(...e)}crossJoin(...e){return this._joinType("cross").join(...e)}joinRaw(...e){return this._joinType("raw").join(...e)}get or(){return this._bool("or")}get not(){return this._not(!0)}where(e,t,n){const i=arguments.length;if(e===!1||e===!0)return this.where(1,"=",e?1:0);if(typeof e=="function")return this.whereWrapped(e);if(ge(e)&&!e.isRawInstance)return this._objectWhere(e);if(e&&e.isRawInstance&&i===1)return this.whereRaw(e);if(i===2&&(n=t,t="=",n===null))return this.whereNull(e);const a=`${t}`.toLowerCase().trim();if(i===3){if(a==="in"||a==="not in")return this._not(a==="not in").whereIn(e,n);if(a==="between"||a==="not between")return this._not(a==="not between").whereBetween(e,n)}return n===null&&(a==="is"||a==="is not")?this._not(a==="is not").whereNull(e):(this._statements.push({grouping:"where",type:"whereBasic",column:e,operator:t,value:n,not:this._not(),bool:this._bool(),asColumn:this._asColumnFlag}),this)}whereColumn(...e){return this._asColumnFlag=!0,this.where(...e),this._asColumnFlag=!1,this}orWhere(e,...t){this._bool("or");const n=e;return ge(n)&&!n.isRawInstance?this.whereWrapped(function(){for(const i in n)this.andWhere(i,n[i])}):this.where(e,...t)}orWhereColumn(e,...t){this._bool("or");const n=e;return ge(n)&&!n.isRawInstance?this.whereWrapped(function(){for(const i in n)this.andWhereColumn(i,"=",n[i])}):this.whereColumn(e,...t)}whereNot(e,...t){return t.length>=2&&(t[0]==="in"||t[0]==="between")&&this.client.logger.warn('whereNot is not suitable for "in" and "between" type subqueries. You should use "not in" and "not between" instead.'),this._not(!0).where(e,...t)}whereNotColumn(...e){return this._not(!0).whereColumn(...e)}orWhereNot(...e){return this._bool("or").whereNot(...e)}orWhereNotColumn(...e){return this._bool("or").whereNotColumn(...e)}_objectWhere(e){const t=this._bool(),n=this._not()?"Not":"";for(const i in e)this[t+"Where"+n](i,e[i]);return this}whereRaw(e,t){const n=e.isRawInstance?e:this.client.raw(e,t);return this._statements.push({grouping:"where",type:"whereRaw",value:n,not:this._not(),bool:this._bool()}),this}orWhereRaw(e,t){return this._bool("or").whereRaw(e,t)}whereWrapped(e){return this._statements.push({grouping:"where",type:"whereWrapped",value:e,not:this._not(),bool:this._bool()}),this}whereExists(e){return this._statements.push({grouping:"where",type:"whereExists",value:e,not:this._not(),bool:this._bool()}),this}orWhereExists(e){return this._bool("or").whereExists(e)}whereNotExists(e){return this._not(!0).whereExists(e)}orWhereNotExists(e){return this._bool("or").whereNotExists(e)}whereIn(e,t){return Array.isArray(t)&&ot(t)?this.where(this._not()):(this._statements.push({grouping:"where",type:"whereIn",column:e,value:t,not:this._not(),bool:this._bool()}),this)}orWhereIn(e,t){return this._bool("or").whereIn(e,t)}whereNotIn(e,t){return this._not(!0).whereIn(e,t)}orWhereNotIn(e,t){return this._bool("or")._not(!0).whereIn(e,t)}whereNull(e){return this._statements.push({grouping:"where",type:"whereNull",column:e,not:this._not(),bool:this._bool()}),this}orWhereNull(e){return this._bool("or").whereNull(e)}whereNotNull(e){return this._not(!0).whereNull(e)}orWhereNotNull(e){return this._bool("or").whereNotNull(e)}whereBetween(e,t){return st(Array.isArray(t),"The second argument to whereBetween must be an array."),st(t.length===2,"You must specify 2 values for the whereBetween clause"),this._statements.push({grouping:"where",type:"whereBetween",column:e,value:t,not:this._not(),bool:this._bool()}),this}whereNotBetween(e,t){return this._not(!0).whereBetween(e,t)}orWhereBetween(e,t){return this._bool("or").whereBetween(e,t)}orWhereNotBetween(e,t){return this._bool("or").whereNotBetween(e,t)}_whereLike(e,t,n){return this._statements.push({grouping:"where",type:e,column:t,value:n,not:this._not(),bool:this._bool(),asColumn:this._asColumnFlag}),this}whereLike(e,t){return this._whereLike("whereLike",e,t)}orWhereLike(e,t){return this._bool("or")._whereLike("whereLike",e,t)}whereILike(e,t){return this._whereLike("whereILike",e,t)}orWhereILike(e,t){return this._bool("or")._whereLike("whereILike",e,t)}groupBy(e){return e&&e.isRawInstance?this.groupByRaw.apply(this,arguments):(this._statements.push({grouping:"group",type:"groupByBasic",value:Et(...arguments)}),this)}groupByRaw(e,t){const n=e.isRawInstance?e:this.client.raw(e,t);return this._statements.push({grouping:"group",type:"groupByRaw",value:n}),this}orderBy(e,t,n=""){return Array.isArray(e)?this._orderByArray(e):(this._statements.push({grouping:"order",type:"orderByBasic",value:e,direction:t,nulls:n}),this)}_orderByArray(e){for(let t=0;t<e.length;t++){const n=e[t];ge(n)?this._statements.push({grouping:"order",type:"orderByBasic",value:n.column,direction:n.order,nulls:n.nulls}):Sn(n)&&this._statements.push({grouping:"order",type:"orderByBasic",value:n})}return this}orderByRaw(e,t){const n=e.isRawInstance?e:this.client.raw(e,t);return this._statements.push({grouping:"order",type:"orderByRaw",value:n}),this}_union(e,t){let n=t[0],i=t[1];if(t.length===1||t.length===2&&Tt(i)){Array.isArray(n)||(n=[n]);for(let a=0,o=n.length;a<o;a++)this._statements.push({grouping:"union",clause:e,value:n[a],wrap:i||!1})}else n=Tl(t).slice(0,t.length-1),i=t[t.length-1],Tt(i)||(n.push(i),i=!1),this._union(e,[n,i]);return this}union(...e){return this._union("union",e)}unionAll(...e){return this._union("union all",e)}intersect(e,t){if(arguments.length===1||arguments.length===2&&Tt(t)){Array.isArray(e)||(e=[e]);for(let n=0,i=e.length;n<i;n++)this._statements.push({grouping:"union",clause:"intersect",value:e[n],wrap:t||!1})}else e=Tl(arguments).slice(0,arguments.length-1),t=arguments[arguments.length-1],Tt(t)||(e.push(t),t=!1),this.intersect(e,t);return this}having(e,t,n){return e.isRawInstance&&arguments.length===1?this.havingRaw(e):typeof e=="function"?this.havingWrapped(e):(this._statements.push({grouping:"having",type:"havingBasic",column:e,operator:t,value:n,bool:this._bool(),not:this._not()}),this)}orHaving(e,...t){this._bool("or");const n=e;return ge(n)&&!n.isRawInstance?this.havingWrapped(function(){for(const i in n)this.andHaving(i,n[i])}):this.having(e,...t)}havingWrapped(e){return this._statements.push({grouping:"having",type:"havingWrapped",value:e,bool:this._bool(),not:this._not()}),this}havingNull(e){return this._statements.push({grouping:"having",type:"havingNull",column:e,not:this._not(),bool:this._bool()}),this}orHavingNull(e){return this._bool("or").havingNull(e)}havingNotNull(e){return this._not(!0).havingNull(e)}orHavingNotNull(e){return this._not(!0)._bool("or").havingNull(e)}havingExists(e){return this._statements.push({grouping:"having",type:"havingExists",value:e,not:this._not(),bool:this._bool()}),this}orHavingExists(e){return this._bool("or").havingExists(e)}havingNotExists(e){return this._not(!0).havingExists(e)}orHavingNotExists(e){return this._not(!0)._bool("or").havingExists(e)}havingBetween(e,t){return st(Array.isArray(t),"The second argument to havingBetween must be an array."),st(t.length===2,"You must specify 2 values for the havingBetween clause"),this._statements.push({grouping:"having",type:"havingBetween",column:e,value:t,not:this._not(),bool:this._bool()}),this}orHavingBetween(e,t){return this._bool("or").havingBetween(e,t)}havingNotBetween(e,t){return this._not(!0).havingBetween(e,t)}orHavingNotBetween(e,t){return this._not(!0)._bool("or").havingBetween(e,t)}havingIn(e,t){return Array.isArray(t)&&ot(t)?this.where(this._not()):(this._statements.push({grouping:"having",type:"havingIn",column:e,value:t,not:this._not(),bool:this._bool()}),this)}orHavingIn(e,t){return this._bool("or").havingIn(e,t)}havingNotIn(e,t){return this._not(!0).havingIn(e,t)}orHavingNotIn(e,t){return this._bool("or")._not(!0).havingIn(e,t)}havingRaw(e,t){const n=e.isRawInstance?e:this.client.raw(e,t);return this._statements.push({grouping:"having",type:"havingRaw",value:n,bool:this._bool(),not:this._not()}),this}orHavingRaw(e,t){return this._bool("or").havingRaw(e,t)}_setSkipBinding(e,t){let n=t;ge(t)&&(n=t.skipBinding),this._single.skipBinding=this._single.skipBinding||{},this._single.skipBinding[e]=n}offset(e,t){if(e==null||e.isRawInstance||e instanceof q)this._single.offset=e;else{const n=parseInt(e,10);if(isNaN(n))this.client.logger.warn("A valid integer must be provided to offset");else{if(n<0)throw new Error("A non-negative integer must be provided to offset.");this._single.offset=n}}return this._setSkipBinding("offset",t),this}limit(e,t){const n=parseInt(e,10);return isNaN(n)?this.client.logger.warn("A valid integer must be provided to limit"):(this._single.limit=n,this._setSkipBinding("limit",t)),this}count(e,t){return this._aggregate("count",e||"*",t)}min(e,t){return this._aggregate("min",e,t)}max(e,t){return this._aggregate("max",e,t)}sum(e,t){return this._aggregate("sum",e,t)}avg(e,t){return this._aggregate("avg",e,t)}countDistinct(...e){let t;return e.length>1&&El(XO(e))&&([t]=e.splice(e.length-1,1)),e.length?e.length===1&&(e=e[0]):e="*",this._aggregate("count",e,{...t,distinct:!0})}sumDistinct(e,t){return this._aggregate("sum",e,{...t,distinct:!0})}avgDistinct(e,t){return this._aggregate("avg",e,{...t,distinct:!0})}increment(e,t=1){if(ge(e)){for(const n in e)this._counter(n,e[n]);return this}return this._counter(e,t)}decrement(e,t=1){if(ge(e)){for(const n in e)this._counter(n,-e[n]);return this}return this._counter(e,-t)}clearCounters(){return this._single.counter={},this}first(...e){if(this._method&&this._method!=="select")throw new Error(`Cannot chain .first() on "${this._method}" query`);return this.select(Et(...e)),this._method="first",this.limit(1),this}connection(e){return this._connection=e,this.client.processPassedConnection(e),this}pluck(e){if(this._method&&this._method!=="select")throw new Error(`Cannot chain .pluck() on "${this._method}" query`);return this._method="pluck",this._single.pluck=e,this._statements.push({grouping:"columns",type:"pluck",value:e}),this}clearSelect(){return this._clearGrouping("columns"),this}clearWhere(){return this._clearGrouping("where"),this}clearGroup(){return this._clearGrouping("group"),this}clearOrder(){return this._clearGrouping("order"),this}clearHaving(){return this._clearGrouping("having"),this}clear(e){if(!lN.has(e))throw new Error(`Knex Error: unknown statement '${e}'`);return e.startsWith("counter")?this.clearCounters():(e==="select"&&(e="columns"),this._clearGrouping(e),this)}insert(e,t,n){return this._method="insert",ot(t)||this.returning(t,n),this._single.insert=e,this}update(e,t,n){let i;const a=this._single.update||{};if(this._method="update",Sn(e))El(t)?a[e]=JSON.stringify(t):a[e]=t,arguments.length>2&&(i=arguments[2]);else{const o=Object.keys(e);this._single.update&&this.client.logger.warn("Update called multiple times with objects.");let s=-1;for(;++s<o.length;)a[o[s]]=e[o[s]];i=arguments[1]}return ot(i)||this.returning(i,n),this._single.update=a,this}returning(e,t){return this._single.returning=e,this._single.options=t,this}onConflict(e){return typeof e=="string"&&(e=[e]),new cN(this,e||!0)}delete(e,t){return this._method="del",ot(e)||this.returning(e,t),this}truncate(e){return this._method="truncate",e&&(this._single.table=e),this}columnInfo(e){return this._method="columnInfo",this._single.columnInfo=e,this}forUpdate(...e){return this._single.lock=ve.forUpdate,e.length===1&&Array.isArray(e[0])?this._single.lockTables=e[0]:this._single.lockTables=e,this}forShare(...e){return this._single.lock=ve.forShare,this._single.lockTables=e,this}forNoKeyUpdate(...e){return this._single.lock=ve.forNoKeyUpdate,this._single.lockTables=e,this}forKeyShare(...e){return this._single.lock=ve.forKeyShare,this._single.lockTables=e,this}skipLocked(){if(!this._isSelectQuery())throw new Error(`Cannot chain .skipLocked() on "${this._method}" query!`);if(!this._hasLockMode())throw new Error(".skipLocked() can only be used after a call to .forShare() or .forUpdate()!");if(this._single.waitMode===mr.noWait)throw new Error(".skipLocked() cannot be used together with .noWait()!");return this._single.waitMode=mr.skipLocked,this}noWait(){if(!this._isSelectQuery())throw new Error(`Cannot chain .noWait() on "${this._method}" query!`);if(!this._hasLockMode())throw new Error(".noWait() can only be used after a call to .forShare() or .forUpdate()!");if(this._single.waitMode===mr.skipLocked)throw new Error(".noWait() cannot be used together with .skipLocked()!");return this._single.waitMode=mr.noWait,this}fromJS(e){return YO(e,(t,n)=>{typeof this[n]!="function"&&this.client.logger.warn(`Knex Error: unknown key ${n}`),Array.isArray(t)?this[n].apply(this,t):this[n](t)}),this}fromRaw(e,t){const n=e.isRawInstance?e:this.client.raw(e,t);return this.from(n)}modify(e){return e.apply(this,[this].concat(eN(arguments))),this}upsert(e,t,n){throw new Error(`Upsert is not yet supported for dialect ${this.client.dialect}`)}_json(e,t){return this._statements.push({grouping:"columns",type:"json",method:e,params:t}),this}jsonExtract(){const e=arguments[0];let t,n,i=!0;return arguments.length>=2&&(t=arguments[1]),arguments.length>=3&&(n=arguments[2]),arguments.length===4&&(i=arguments[3]),arguments.length===2&&Array.isArray(arguments[0])&&Tt(arguments[1])&&(i=arguments[1]),this._json("jsonExtract",{column:e,path:t,alias:n,singleValue:i})}jsonSet(e,t,n,i){return this._json("jsonSet",{column:e,path:t,value:n,alias:i})}jsonInsert(e,t,n,i){return this._json("jsonInsert",{column:e,path:t,value:n,alias:i})}jsonRemove(e,t,n){return this._json("jsonRemove",{column:e,path:t,alias:n})}_isJsonObject(e){return ge(e)&&!(e instanceof q)}_whereJsonWrappedValue(e,t,n){const i={grouping:"where",type:e,column:t,value:n,not:this._not(),bool:this._bool(),asColumn:this._asColumnFlag};arguments[3]&&(i.operator=arguments[3]),arguments[4]&&(i.jsonPath=arguments[4]),this._statements.push(i)}whereJsonObject(e,t){return this._whereJsonWrappedValue("whereJsonObject",e,t),this}orWhereJsonObject(e,t){return this._bool("or").whereJsonObject(e,t)}whereNotJsonObject(e,t){return this._not(!0).whereJsonObject(e,t)}orWhereNotJsonObject(e,t){return this._bool("or").whereNotJsonObject(e,t)}whereJsonPath(e,t,n,i){return this._whereJsonWrappedValue("whereJsonPath",e,i,n,t),this}orWhereJsonPath(e,t,n,i){return this._bool("or").whereJsonPath(e,t,n,i)}whereJsonSupersetOf(e,t){return this._whereJsonWrappedValue("whereJsonSupersetOf",e,t),this}whereJsonNotSupersetOf(e,t){return this._not(!0).whereJsonSupersetOf(e,t)}orWhereJsonSupersetOf(e,t){return this._bool("or").whereJsonSupersetOf(e,t)}orWhereJsonNotSupersetOf(e,t){return this._bool("or").whereJsonNotSupersetOf(e,t)}whereJsonSubsetOf(e,t){return this._whereJsonWrappedValue("whereJsonSubsetOf",e,t),this}whereJsonNotSubsetOf(e,t){return this._not(!0).whereJsonSubsetOf(e,t)}orWhereJsonSubsetOf(e,t){return this._bool("or").whereJsonSubsetOf(e,t)}orWhereJsonNotSubsetOf(e,t){return this._bool("or").whereJsonNotSubsetOf(e,t)}whereJsonHasNone(e,t){return this._not(!0).whereJsonHasAll(e,t),this}_analytic(e,t,n){let i;const{schema:a}=this._single,o=this._analyticMethod();if(e=typeof e=="string"?e:null,st(typeof t=="function"||t.isRawInstance||Array.isArray(t)||typeof t=="string"||typeof t=="object",`The second argument to an analytic function must be either a function, a raw,
       an array of string or object, an object or a single string.`),n&&st(Array.isArray(n)||typeof n=="string"||typeof n=="object","The third argument to an analytic function must be either a string, an array of string or object or an object."),sN(t))i=new rN(o,a,e),t.call(i,i);else if(t.isRawInstance)i={grouping:"columns",type:"analytic",method:o,raw:t,alias:e};else{const s=Array.isArray(t)?t:[t];let l=n||[];l=Array.isArray(l)?l:[l],i={grouping:"columns",type:"analytic",method:o,order:s,alias:e,partitions:l}}return this._statements.push(i),this}rank(...e){return this._analyticMethod("rank")._analytic(...e)}denseRank(...e){return this._analyticMethod("dense_rank")._analytic(...e)}rowNumber(...e){return this._analyticMethod("row_number")._analytic(...e)}_counter(e,t){return t=parseFloat(t),this._method="update",this._single.counter=this._single.counter||{},this._single.counter[e]=t,this}_bool(e){if(arguments.length===1)return this._boolFlag=e,this;const t=this._boolFlag;return this._boolFlag="and",t}_not(e){if(arguments.length===1)return this._notFlag=e,this;const t=this._notFlag;return this._notFlag=!1,t}_joinType(e){if(arguments.length===1)return this._joinFlag=e,this;const t=this._joinFlag||"inner";return this._joinFlag="inner",t}_analyticMethod(e){return arguments.length===1?(this._analyticFlag=e,this):this._analyticFlag||"row_number"}_aggregate(e,t,n={}){return this._statements.push({grouping:"columns",type:t.isRawInstance?"aggregateRaw":"aggregate",method:e,value:t,aggregateDistinct:n.distinct||!1,alias:n.as}),this}_clearGrouping(e){e in this._single?this._single[e]=void 0:this._statements=ZO(this._statements,{grouping:e})}_isSelectQuery(){return aN.has(this._method)}_hasLockMode(){return uN.has(this._single.lock)}}q.prototype.select=q.prototype.columns,q.prototype.column=q.prototype.columns,q.prototype.andWhereNot=q.prototype.whereNot,q.prototype.andWhereNotColumn=q.prototype.whereNotColumn,q.prototype.andWhere=q.prototype.where,q.prototype.andWhereColumn=q.prototype.whereColumn,q.prototype.andWhereRaw=q.prototype.whereRaw,q.prototype.andWhereBetween=q.prototype.whereBetween,q.prototype.andWhereNotBetween=q.prototype.whereNotBetween,q.prototype.andWhereJsonObject=q.prototype.whereJsonObject,q.prototype.andWhereNotJsonObject=q.prototype.whereJsonObject,q.prototype.andWhereJsonPath=q.prototype.whereJsonPath,q.prototype.andWhereLike=q.prototype.whereLike,q.prototype.andWhereILike=q.prototype.whereILike,q.prototype.andHaving=q.prototype.having,q.prototype.andHavingIn=q.prototype.havingIn,q.prototype.andHavingNotIn=q.prototype.havingNotIn,q.prototype.andHavingNull=q.prototype.havingNull,q.prototype.andHavingNotNull=q.prototype.havingNotNull,q.prototype.andHavingExists=q.prototype.havingExists,q.prototype.andHavingNotExists=q.prototype.havingNotExists,q.prototype.andHavingBetween=q.prototype.havingBetween,q.prototype.andHavingNotBetween=q.prototype.havingNotBetween,q.prototype.from=q.prototype.table,q.prototype.into=q.prototype.table,q.prototype.del=q.prototype.delete,oN(q),tN(q),q.extend=(r,e)=>{if(Object.prototype.hasOwnProperty.call(q.prototype,r))throw new Error(`Can't extend QueryBuilder with existing method ('${r}').`);GO(q.prototype,{[r]:e})};class cN{constructor(e,t){this.builder=e,this._columns=t}ignore(){return this.builder._single.onConflict=this._columns,this.builder._single.ignore=!0,this.builder}merge(e){return this.builder._single.onConflict=this._columns,this.builder._single.merge={updates:e},this.builder}then(){throw new Error("Incomplete onConflict clause. .onConflict() must be directly followed by either .merge() or .ignore()")}}var Ee=q;function hN(r,e,t,n){var i=-1,a=r==null?0:r.length;for(n&&a&&(t=r[++i]);++i<a;)t=e(t,r[i],i,r);return t}var dN=hN;function fN(r,e,t,n,i){return i(r,function(a,o,s){t=n?(n=!1,a):e(t,a,o,s)}),t}var pN=fN,mN=dN,gN=it,yN=me,bN=pN,_N=F;function wN(r,e,t){var n=_N(r)?mN:bN,i=arguments.length<3;return n(r,yN(e),t,i,gN)}var At=wN,$N=zr,CN=xo,vN=Pa,EN=me,TN=rr,AN=F,ON=et,NN=Wt,qN=ne,RN=tt;function SN(r,e,t){var n=AN(r),i=n||ON(r)||RN(r);if(e=EN(e),t==null){var a=r&&r.constructor;i?t=n?new a:[]:qN(r)?t=NN(a)?CN(TN(r)):{}:t={}}return(i?$N:vN)(r,function(o,s,l){return e(t,o,s,l)}),t}var xN=SN;const{isObject:IN}=M;function PN(r,e,t,n){const i=t.queryBuilder();return r.call(i,i),t.queryCompiler(i,n.bindings).toSQL(e||i._method||"select")}function LN(r,e,t){const n=e.queryContext();return t.wrapIdentifier((r||"").trim(),n)}function BN(r,e,t){return r===void 0?"":r===null?"null":r&&r.isRawInstance?r.toQuery():e==="bool"?(r==="false"&&(r=0),`'${r?1:0}'`):(e==="json"||e==="jsonb")&&IN(r)?`'${JSON.stringify(r)}'`:t._escapeBinding(r.toString())}var je={compileCallback:PN,wrapAsIdentifier:LN,formatDefault:BN};const kN=xN,Al=Ee,{compileCallback:xn,wrapAsIdentifier:gr}=je,MN=["asc","desc"],jN=kN(["=","<",">","<=",">=","<>","!=","like","not like","between","not between","ilike","not ilike","exists","not exist","rlike","not rlike","regexp","not regexp","match","&","|","^","<<",">>","~","~=","~*","!~","!~*","#","&&","@>","<@","||","&<","&>","-|-","@@","!!",["?","\\?"],["?|","\\?|"],["?&","\\?&"]],(r,e)=>{Array.isArray(e)?r[e[0]]=e[1]:r[e]=e},{});function QN(r,e,t,n){const i=Array.isArray(r)?r:[r];let a="",o=-1;for(;++o<i.length;)o>0&&(a+=", "),a+=yr(i[o],void 0,e,t,n);return a}function yr(r,e,t,n,i){const a=Ot(r,e,t,n,i);if(a)return a;switch(typeof r){case"function":return qt(xn(r,void 0,n,i),!0,t,n);case"object":return FN(r,t,n,i);case"number":return r;default:return Nt(r+"",t,n)}}function Ot(r,e,t,n,i){let a;if(r instanceof Al)return a=n.queryCompiler(r).toSQL(),a.bindings&&i.bindings.push(...a.bindings),qt(a,e,t,n);if(r&&r.isRawInstance)return r.client=n,t._queryContext&&(r.queryContext=()=>t._queryContext),a=r.toSQL(),a.bindings&&i.bindings.push(...a.bindings),a.sql;e&&i.bindings.push(r)}function DN(r,e,t,n){const i=Ot(r,void 0,e,t,n);if(i)return i;const a=jN[(r||"").toLowerCase()];if(!a)throw new TypeError(`The operator "${r}" is not permitted`);return a}function Nt(r,e,t){const n=r.toLowerCase().indexOf(" as ");if(n!==-1){const s=r.slice(0,n),l=r.slice(n+4);return t.alias(Nt(s,e,t),gr(l,e,t))}const i=[];let a=-1;const o=r.split(".");for(;++a<o.length;)r=o[a],a===0&&o.length>1?i.push(Nt((r||"").trim(),e,t)):i.push(gr(r,e,t));return i.join(".")}function FN(r,e,t,n){const i=[];for(const a in r){const o=r[a];if(typeof o=="function"){const s=xn(o,void 0,t,n);s.as=a,i.push(qt(s,!0,e,t))}else o instanceof Al?i.push(t.alias(`(${yr(o,void 0,e,t,n)})`,gr(a,e,t))):i.push(t.alias(yr(o,void 0,e,t,n),gr(a,e,t)))}return i.join(", ")}function qt(r,e,t,n){let i=r.sql||"";return i&&(r.method==="select"||r.method==="first")&&(e||r.as)&&(i=`(${i})`,r.as)?n.alias(i,Nt(r.as,t,n)):i}function UN(r,e,t,n,i){return typeof r=="function"?qt(xn(r,e,n,i),void 0,t,n):Ot(r,void 0,t,n,i)||""}function HN(r,e,t,n){const i=Ot(r,void 0,e,t,n);return i||(MN.indexOf((r||"").toLowerCase())!==-1?r:"asc")}var K={columnize:QN,direction:HN,operator:DN,outputQuery:qt,rawOrFn:UN,unwrapRaw:Ot,wrap:yr,wrapString:Nt};const{columnize:Ol}=K;function VN(r,e){const t={bindings:[]},n=r,i=r.bindings.length,a=r.bindings;let o=0;const s=r.sql.replace(/\\?\?\??/g,function(l){if(l==="\\?")return l;const u=a[o++];return l==="??"?Ol(u,n,e,t):e.parameter(u,n,t)});if(i!==o)throw new Error(`Expected ${i} bindings, saw ${o}`);return{method:"raw",sql:s,bindings:t.bindings}}function WN(r,e){const t={bindings:[]},n=r,i=r.bindings,a=/\\?(:(\w+):(?=::)|:(\w+):(?!:)|:(\w+))/g;return{method:"raw",sql:r.sql.replace(a,function(s,l,u,h,c){if(s!==l)return l;const d=u||h||c,p=s.trim(),g=p[p.length-1]===":",_=i[d];return _===void 0?(Object.prototype.hasOwnProperty.call(i,d)&&t.bindings.push(_),s):g?s.replace(l,Ol(_,n,e,t)):s.replace(l,e.parameter(_,n,t))}),bindings:t.bindings}}var zN={replaceKeyBindings:WN,replaceRawArrBindings:VN};const KN="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",JN="0123456789";function GN(r=21){let e="",t=r;for(;t--;)e+=KN[Math.random()*64|0];return e}function YN(r=21){let e="",t=r;for(;t--;)e+=JN[Math.random()*10|0];return e}var In={nanoid:GN,nanonum:YN};const{EventEmitter:XN}=I,ZN=ae,eq=Me,tq=$e,rq=At,{replaceRawArrBindings:nq,replaceKeyBindings:iq}=zN,Pn=z,sq=Nn,{nanoid:oq}=In,{isNumber:aq,isObject:lq}=M,{augmentWithBuilderInterface:uq}=qn,cq=ZN("knex:bindings");let br=class extends XN{constructor(e){super(),this.client=e,this.sql="",this.bindings=[],this._wrappedBefore=void 0,this._wrappedAfter=void 0,e&&e.config&&(this._debug=e.config.debug,sq(this,4))}set(e,t){return this.sql=e,this.bindings=lq(t)&&!t.toSQL||t===void 0?t:[t],this}timeout(e,{cancel:t}={}){return aq(e)&&e>0&&(this._timeout=e,t&&(this.client.assertCanCancelQuery(),this._cancelOnTimeout=!0)),this}wrap(e,t){return this._wrappedBefore=e,this._wrappedAfter=t,this}toString(){return this.toQuery()}toSQL(e,t){let n;if(Array.isArray(this.bindings)?n=nq(this,this.client):this.bindings&&tq(this.bindings)?n=iq(this,this.client):n={method:"raw",sql:this.sql,bindings:this.bindings===void 0?[]:[this.bindings]},this._wrappedBefore&&(n.sql=this._wrappedBefore+n.sql),this._wrappedAfter&&(n.sql=n.sql+this._wrappedAfter),n.options=rq(this._options,eq,{}),this._timeout&&(n.timeout=this._timeout,this._cancelOnTimeout&&(n.cancelOnTimeout=this._cancelOnTimeout)),n.bindings=n.bindings||[],Pn.containsUndefined(n.bindings)){const i=Pn.getUndefinedIndices(this.bindings);throw cq(n.bindings),new Error(`Undefined binding(s) detected for keys [${i}] when compiling RAW query: ${n.sql}`)}return n.__knexQueryUid=oq(),Object.defineProperties(n,{toNative:{value:()=>({sql:this.client.positionBindings(n.sql),bindings:this.client.prepBindings(n.bindings)}),enumerable:!1}}),n}};br.prototype.isRawInstance=!0,uq(br),Pn.addQueryContext(br);var at=br;function hq(r){for(var e=-1,t=r==null?0:r.length,n=0,i=[];++e<t;){var a=r[e];a&&(i[n++]=a)}return i}var Ln=hq;function dq(r,e,t,n){for(var i=-1,a=r==null?0:r.length;++i<a;){var o=r[i];e(n,o,t(o),r)}return n}var fq=dq,pq=it;function mq(r,e,t,n){return pq(r,function(i,a,o){e(n,i,t(i),o)}),n}var gq=mq,yq=fq,bq=gq,_q=me,wq=F;function $q(r,e){return function(t,n){var i=wq(t)?yq:bq,a=e?e():{};return i(t,r,_q(n),a)}}var Cq=$q,vq=Gt,Eq=Cq,Tq=Object.prototype,Aq=Tq.hasOwnProperty,Oq=Eq(function(r,e,t){Aq.call(r,t)?r[t].push(e):vq(r,t,[e])}),_r=Oq,Nq=Object.prototype,qq=Nq.hasOwnProperty;function Rq(r,e){return r!=null&&qq.call(r,e)}var Sq=Rq,xq=Sq,Iq=ll;function Pq(r,e){return r!=null&&Iq(r,e,xq)}var wr=Pq,Lq=it,Bq=pe;function kq(r,e){var t=-1,n=Bq(r)?Array(r.length):[];return Lq(r,function(i,a,o){n[++t]=e(i,a,o)}),n}var Mq=kq,jq=sr,Qq=me,Dq=Mq,Fq=F;function Uq(r,e){var t=Fq(r)?jq:Dq;return t(r,Qq(e))}var Qe=Uq,Hq=Yt,Vq=dr,Wq=Zt,Nl=ne,zq=$t;function Kq(r,e,t,n){if(!Nl(r))return r;e=Vq(e,r);for(var i=-1,a=e.length,o=a-1,s=r;s!=null&&++i<a;){var l=zq(e[i]),u=t;if(l==="__proto__"||l==="constructor"||l==="prototype")return r;if(i!=o){var h=s[l];u=n?n(h,l,s):void 0,u===void 0&&(u=Nl(h)?h:Wq(e[i+1])?[]:{})}Hq(s,l,u),s=s[l]}return r}var Jq=Kq,Gq=vn,Yq=Jq,Xq=dr;function Zq(r,e,t){for(var n=-1,i=e.length,a={};++n<i;){var o=e[n],s=Gq(r,o);t(s,o)&&Yq(a,Xq(o,r),s)}return a}var eR=Zq,tR=sr,rR=me,nR=eR,iR=yo;function sR(r,e){if(r==null)return{};var t=tR(iR(r),function(n){return[n]});return e=rR(e),nR(r,t,function(n,i){return e(n,i[0])})}var oR=sR,aR=me,lR=ul,uR=oR;function cR(r,e){return uR(r,lR(aR(e)))}var hR=cR;const dR=z,lt=at,$r=Ee,fR=Cl,pR=ae,ql=Me,Rt=Ln,mR=_r,gR=wr,Rl=le,Sl=Qe,yR=hR,bR=At,{nanoid:_R}=In,{isString:Bn,isUndefined:wR}=M,{columnize:ye,direction:xl,operator:St,wrap:U,unwrapRaw:ut,rawOrFn:Te}=K,$R=pR("knex:bindings"),CR=["columns","join","where","union","group","having","order","limit","offset","lock","waitMode"];var De=class{constructor(e,t,n){this.client=e,this.method=t._method||"select",this.options=t._options,this.single=t._single,this.timeout=t._timeout||!1,this.cancelOnTimeout=t._cancelOnTimeout||!1,this.grouped=mR(t._statements,"grouping"),this.formatter=e.formatter(t),this._emptyInsertValue="default values",this.first=this.select,this.bindings=n||[],this.formatter.bindings=this.bindings,this.bindingsHolder=this,this.builder=this.formatter.builder}toSQL(e,t){this._undefinedInWhereClause=!1,this.undefinedBindingsInfo=[],e=e||this.method;const n=this[e]()||"",i={method:e,options:bR(this.options,ql,{}),timeout:this.timeout,cancelOnTimeout:this.cancelOnTimeout,bindings:this.bindingsHolder.bindings||[],__knexQueryUid:_R()};if(Object.defineProperties(i,{toNative:{value:()=>({sql:this.client.positionBindings(i.sql),bindings:this.client.prepBindings(i.bindings)}),enumerable:!1}}),Bn(n)?i.sql=n:ql(i,n),(e==="select"||e==="first")&&this.single.as&&(i.as=this.single.as),this._undefinedInWhereClause)throw $R(i.bindings),new Error(`Undefined binding(s) detected when compiling ${e.toUpperCase()}. Undefined column(s): [${this.undefinedBindingsInfo.join(", ")}] query: ${i.sql}`);return i}select(){let e=this.with(),t="";const n=[],i=[];CR.forEach(o=>{const s=this[o](this);switch(o){case"union":t=s;break;case"columns":case"join":case"where":n.push(s);break;default:i.push(s);break}});const a=this.grouped.union&&this.grouped.union.map(o=>o.wrap).some(o=>o);if(this.onlyUnions()){const o=Rt(n.concat(i)).join(" ");e+=t+(o?" "+o:"")}else{const o=(a?"(":"")+Rt(n).join(" ")+(a?")":""),s=Rt(i).join(" ");e+=o+(t?" "+t:"")+(s&&" "+s)}return e}pluck(){let e=this.single.pluck;return e.indexOf(".")!==-1&&(e=e.split(".").slice(-1)[0]),{sql:this.select(),pluck:e}}insert(){const e=this.single.insert||[],t=this.with()+`insert into ${this.tableName} `,n=this._insertBody(e);return n===""?"":t+n}_onConflictClause(e){return e instanceof lt?this.formatter.wrap(e):`(${this.formatter.columnize(e)})`}_buildInsertValues(e){let t="",n=-1;for(;++n<e.values.length;)n!==0&&(t+="), ("),t+=this.client.parameterize(e.values[n],this.client.valueForUndefined,this.builder,this.bindingsHolder);return t}_insertBody(e){let t="";if(Array.isArray(e)){if(e.length===0)return""}else if(typeof e=="object"&&Rl(e))return t+this._emptyInsertValue;const n=this._prepInsert(e);return typeof n=="string"?t+=n:n.columns.length?(t+=`(${ye(n.columns,this.builder,this.client,this.bindingsHolder)}`,t+=") values ("+this._buildInsertValues(n)+")"):e.length===1&&e[0]?t+=this._emptyInsertValue:t="",t}update(){const e=this.with(),{tableName:t}=this,n=this._prepUpdate(this.single.update),i=this.where();return e+`update ${this.single.only?"only ":""}${t} set `+n.join(", ")+(i?` ${i}`:"")}_hintComments(){let e=this.grouped.hintComments||[];return e=e.map(t=>Rt(t.value).join(" ")),e=Rt(e).join(" "),e?`/*+ ${e} */ `:""}columns(){let e="";if(this.onlyUnions())return"";const t=this._hintComments(),n=this.grouped.columns||[];let i=-1,a=[];if(n)for(;++i<n.length;){const s=n[i];if(s.distinct&&(e="distinct "),s.distinctOn){e=this.distinctOn(s.value);continue}s.type==="aggregate"?a.push(...this.aggregate(s)):s.type==="aggregateRaw"?a.push(this.aggregateRaw(s)):s.type==="analytic"?a.push(this.analytic(s)):s.type==="json"?a.push(this.json(s)):s.value&&s.value.length>0&&a.push(ye(s.value,this.builder,this.client,this.bindingsHolder))}return a.length===0&&(a=["*"]),`${this.onlyJson()?"":"select "}${t}${e}`+a.join(", ")+(this.tableName?` from ${this.single.only?"only ":""}${this.tableName}`:"")}_aggregate(e,{aliasSeparator:t=" as ",distinctParentheses:n}={}){const i=e.value,a=e.method,o=e.aggregateDistinct?"distinct ":"",s=g=>U(g,void 0,this.builder,this.client,this.bindingsHolder),l=(g,_)=>_?g+t+s(_):g,u=(g,_)=>{let f=g.map(s).join(", ");if(o){const y=n?"(":" ",w=n?")":"";f=o.trim()+y+f+w}const m=`${a}(${f})`;return l(m,_)},h=(g,_)=>{const f=`${a}(${o+s(g)})`;return l(f,_)};if(Array.isArray(i))return[u(i)];if(typeof i=="object"){if(e.alias)throw new Error("When using an object explicit alias can not be used");return Object.entries(i).map(([g,_])=>Array.isArray(_)?u(_,g):h(_,g))}const c=i.toLowerCase().indexOf(" as ");let d=i,{alias:p}=e;if(c!==-1){if(d=i.slice(0,c),p)throw new Error(`Found multiple aliases for same column: ${d}`);p=i.slice(c+4)}return[h(d,p)]}aggregate(e){return this._aggregate(e)}aggregateRaw(e){const t=e.aggregateDistinct?"distinct ":"";return`${e.method}(${t+ut(e.value,void 0,this.builder,this.client,this.bindingsHolder)})`}_joinTable(e){return e.schema&&!(e.table instanceof lt)?`${e.schema}.${e.table}`:e.table}join(){let e="",t=-1;const n=this.grouped.join;if(!n)return"";for(;++t<n.length;){const i=n[t],a=this._joinTable(i);if(t>0&&(e+=" "),i.joinType==="raw")e+=ut(i.table,void 0,this.builder,this.client,this.bindingsHolder);else{e+=i.joinType+" join "+U(a,void 0,this.builder,this.client,this.bindingsHolder);let o=-1;for(;++o<i.clauses.length;){const s=i.clauses[o];o>0?e+=` ${s.bool} `:e+=` ${s.type==="onUsing"?"using":"on"} `;const l=this[s.type](s);l&&(e+=l)}}}return e}onBetween(e){return U(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" "+this._not(e,"between")+" "+e.value.map(t=>this.client.parameter(t,this.builder,this.bindingsHolder)).join(" and ")}onNull(e){return U(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" is "+this._not(e,"null")}onExists(e){return this._not(e,"exists")+" ("+Te(e.value,void 0,this.builder,this.client,this.bindingsHolder)+")"}onIn(e){if(Array.isArray(e.column))return this.multiOnIn(e);let t;return e.value instanceof lt?t=this.client.parameter(e.value,this.builder,this.formatter):t=this.client.parameterize(e.value,void 0,this.builder,this.bindingsHolder),U(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" "+this._not(e,"in ")+this.wrap(t)}multiOnIn(e){let t=-1,n=`(${ye(e.column,this.builder,this.client,this.bindingsHolder)}) `;for(n+=this._not(e,"in ")+"((";++t<e.value.length;)t!==0&&(n+="),("),n+=this.client.parameterize(e.value[t],void 0,this.builder,this.bindingsHolder);return n+"))"}where(){const e=this.grouped.where;if(!e)return;const t=[];let n=-1;for(;++n<e.length;){const i=e[n];Object.prototype.hasOwnProperty.call(i,"value")&&dR.containsUndefined(i.value)&&(this.undefinedBindingsInfo.push(i.column),this._undefinedInWhereClause=!0);const a=this[i.type](i);a&&(t.length===0?t[0]="where":t.push(i.bool),t.push(a))}return t.length>1?t.join(" "):""}group(){return this._groupsOrders("group")}order(){return this._groupsOrders("order")}having(){const e=this.grouped.having;if(!e)return"";const t=["having"];for(let n=0,i=e.length;n<i;n++){const a=e[n],o=this[a.type](a);o&&(t.length===0&&(t[0]="where"),(t.length>1||t.length===1&&t[0]!=="having")&&t.push(a.bool),t.push(o))}return t.length>1?t.join(" "):""}havingRaw(e){return this._not(e,"")+ut(e.value,void 0,this.builder,this.client,this.bindingsHolder)}havingWrapped(e){const t=Te(e.value,"where",this.builder,this.client,this.bindingsHolder);return t&&this._not(e,"")+"("+t.slice(6)+")"||""}havingBasic(e){return this._not(e,"")+U(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" "+St(e.operator,this.builder,this.client,this.bindingsHolder)+" "+this.client.parameter(e.value,this.builder,this.bindingsHolder)}havingNull(e){return U(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" is "+this._not(e,"null")}havingExists(e){return this._not(e,"exists")+" ("+Te(e.value,void 0,this.builder,this.client,this.bindingsHolder)+")"}havingBetween(e){return U(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" "+this._not(e,"between")+" "+e.value.map(t=>this.client.parameter(t,this.builder,this.bindingsHolder)).join(" and ")}havingIn(e){return Array.isArray(e.column)?this.multiHavingIn(e):U(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" "+this._not(e,"in ")+this.wrap(this.client.parameterize(e.value,void 0,this.builder,this.bindingsHolder))}multiHavingIn(e){return this.multiOnIn(e)}union(){const e=this.onlyUnions(),t=this.grouped.union;if(!t)return"";let n="";for(let i=0,a=t.length;i<a;i++){const o=t[i];i>0&&(n+=" "),(i>0||!e)&&(n+=o.clause+" ");const s=Te(o.value,void 0,this.builder,this.client,this.bindingsHolder);if(s){const l=o.wrap;l&&(n+="("),n+=s,l&&(n+=")")}}return n}onlyUnions(){return(!this.grouped.columns||!!this.grouped.columns[0].value)&&this.grouped.union&&!this.tableName}_getValueOrParameterFromAttribute(e,t){return this.single.skipBinding[e]===!0?t??this.single[e]:this.client.parameter(this.single[e],this.builder,this.bindingsHolder)}onlyJson(){return!this.tableName&&this.grouped.columns&&this.grouped.columns.length===1&&this.grouped.columns[0].type==="json"}limit(){return!this.single.limit&&this.single.limit!==0?"":`limit ${this._getValueOrParameterFromAttribute("limit")}`}offset(){return this.single.offset?`offset ${this._getValueOrParameterFromAttribute("offset")}`:""}del(){const{tableName:e}=this,t=this.with(),n=this.where(),i=this.join(),a=i?e+" ":"";return t+`delete ${a}from ${this.single.only?"only ":""}${e}`+(i?` ${i}`:"")+(n?` ${n}`:"")}truncate(){return`truncate ${this.tableName}`}lock(){if(this.single.lock)return this[this.single.lock]()}waitMode(){if(this.single.waitMode)return this[this.single.waitMode]()}skipLocked(){throw new Error(".skipLocked() is currently only supported on MySQL 8.0+ and PostgreSQL 9.5+")}noWait(){throw new Error(".noWait() is currently only supported on MySQL 8.0+, MariaDB 10.3.0+ and PostgreSQL 9.5+")}distinctOn(e){throw new Error(".distinctOn() is currently only supported on PostgreSQL")}onWrapped(e){const t=this,n=new fR;e.value.call(n,n);let i="";for(let a=0;a<n.clauses.length;a++){const o=n.clauses[a];a>0&&(i+=` ${o.bool} `);const s=t[o.type](o);s&&(i+=s)}return i.length?`(${i})`:""}onBasic(e){const t=e.value instanceof $r;return U(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" "+St(e.operator,this.builder,this.client,this.bindingsHolder)+" "+(t?"(":"")+U(e.value,void 0,this.builder,this.client,this.bindingsHolder)+(t?")":"")}onVal(e){return U(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" "+St(e.operator,this.builder,this.client,this.bindingsHolder)+" "+this.client.parameter(e.value,this.builder,this.bindingsHolder)}onRaw(e){return ut(e.value,void 0,this.builder,this.client,this.bindingsHolder)}onUsing(e){return"("+ye(e.column,this.builder,this.client,this.bindingsHolder)+")"}_valueClause(e){return e.asColumn?U(e.value,void 0,this.builder,this.client,this.bindingsHolder):this.client.parameter(e.value,this.builder,this.bindingsHolder)}_columnClause(e){let t;return Array.isArray(e.column)?t=`(${ye(e.column,this.builder,this.client,this.bindingsHolder)})`:t=U(e.column,void 0,this.builder,this.client,this.bindingsHolder),t}whereIn(e){const t=this.client.values(e.value,this.builder,this.bindingsHolder);return`${this._columnClause(e)} ${this._not(e,"in ")}${t}`}whereLike(e){return`${this._columnClause(e)} ${this._not(e,"like ")}${this._valueClause(e)}`}whereILike(e){return`${this._columnClause(e)} ${this._not(e,"ilike ")}${this._valueClause(e)}`}whereNull(e){return U(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" is "+this._not(e,"null")}whereBasic(e){return this._not(e,"")+U(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" "+St(e.operator,this.builder,this.client,this.bindingsHolder)+" "+this._valueClause(e)}whereExists(e){return this._not(e,"exists")+" ("+Te(e.value,void 0,this.builder,this.client,this.bindingsHolder)+")"}whereWrapped(e){const t=Te(e.value,"where",this.builder,this.client,this.bindingsHolder);return t&&this._not(e,"")+"("+t.slice(6)+")"||""}whereBetween(e){return U(e.column,void 0,this.builder,this.client,this.bindingsHolder)+" "+this._not(e,"between")+" "+e.value.map(t=>this.client.parameter(t,this.builder,this.bindingsHolder)).join(" and ")}whereRaw(e){return this._not(e,"")+ut(e.value,void 0,this.builder,this.client,this.bindingsHolder)}_jsonWrapValue(e){if(!this.builder._isJsonObject(e))try{return JSON.stringify(JSON.parse(e.replace(/\n|\t/g,"")))}catch{return e}return JSON.stringify(e)}_jsonValueClause(e){return e.value=this._jsonWrapValue(e.value),this._valueClause(e)}whereJsonObject(e){return`${this._columnClause(e)} ${e.not?"!=":"="} ${this._jsonValueClause(e)}`}wrap(e){return e.charAt(0)!=="("?`(${e})`:e}json(e){return this[e.method](e.params)}analytic(e){let t="";const n=this;return t+=e.method+"() over (",e.raw?t+=e.raw:(e.partitions.length&&(t+="partition by ",t+=Sl(e.partitions,function(i){return Bn(i)?n.formatter.columnize(i):n.formatter.columnize(i.column)+(i.order?" "+i.order:"")}).join(", ")+" "),t+="order by ",t+=Sl(e.order,function(i){return Bn(i)?n.formatter.columnize(i):n.formatter.columnize(i.column)+(i.order?" "+i.order:"")}).join(", ")),t+=")",e.alias&&(t+=" as "+e.alias),t}with(){if(!this.grouped.with||!this.grouped.with.length)return"";const e=this.grouped.with;if(!e)return;const t=[];let n=-1,i=!1;for(;++n<e.length;){const a=e[n];a.recursive&&(i=!0);const o=this[a.type](a);t.push(o)}return`with ${i?"recursive ":""}${t.join(", ")} `}withWrapped(e){const t=Te(e.value,void 0,this.builder,this.client,this.bindingsHolder),n=e.columnList?"("+ye(e.columnList,this.builder,this.client,this.bindingsHolder)+")":"",i=e.materialized===void 0?"":e.materialized?"materialized ":"not materialized ";return t&&ye(e.alias,this.builder,this.client,this.bindingsHolder)+n+" as "+i+"("+t+")"||""}_not(e,t){return e.not?`not ${t}`:t}_prepInsert(e){const t=Te(e,void 0,this.builder,this.client,this.bindingsHolder);if(t)return t;let n=[];const i=[];Array.isArray(e)||(e=e?[e]:[]);let a=-1;for(;++a<e.length&&e[a]!=null;){a===0&&(n=Object.keys(e[a]).sort());const o=new Array(n.length),s=Object.keys(e[a]);let l=-1;for(;++l<s.length;){const u=s[l];let h=n.indexOf(u);if(h===-1){n=n.concat(u).sort(),h=n.indexOf(u);let c=-1;for(;++c<i.length;)i[c].splice(h,0,void 0);o.splice(h,0,void 0)}o[h]=e[a][u]}i.push(o)}return{columns:n,values:i}}_prepUpdate(e={}){const{counter:t={}}=this.single;for(const o of Object.keys(t)){if(gR(e,o)){this.client.logger.warn("increment/decrement called for a column that has already been specified in main .update() call. Ignoring increment/decrement and using value from .update() call.");continue}let s=t[o];const l=s<0?"-":"+";l==="-"&&(s=-s),e[o]=this.client.raw(`?? ${l} ?`,[o,s])}e=yR(e,wR);const n=[],i=Object.keys(e);let a=-1;for(;++a<i.length;)n.push(U(i[a],void 0,this.builder,this.client,this.bindingsHolder)+" = "+this.client.parameter(e[i[a]],this.builder,this.bindingsHolder));if(Rl(n))throw new Error(["Empty .update() call detected!","Update data does not contain any values to update.","This will result in a faulty query.",this.single.table?`Table: ${this.single.table}.`:"",this.single.update?`Columns: ${Object.keys(this.single.update)}.`:""].join(" "));return n}_formatGroupsItemValue(e,t){const{formatter:n}=this;let i="";t==="last"?i=" is null":t==="first"&&(i=" is not null");let a;return e instanceof lt?a=ut(e,void 0,this.builder,this.client,this.bindingsHolder):e instanceof $r||t?a="("+n.columnize(e)+i+")":a=n.columnize(e),a}_basicGroupOrder(e,t){const n=this._formatGroupsItemValue(e.value,e.nulls),i=t==="order"&&e.type!=="orderByRaw"?` ${xl(e.direction,this.builder,this.client,this.bindingsHolder)}`:"";return n+i}_groupOrder(e,t){return this._basicGroupOrder(e,t)}_groupOrderNulls(e,t){const n=this._formatGroupsItemValue(e.value),i=t==="order"&&e.type!=="orderByRaw"?` ${xl(e.direction,this.builder,this.client,this.bindingsHolder)}`:"";return e.nulls&&!(e.value instanceof lt)?`${n}${i||""} nulls ${e.nulls}`:n+i}_groupsOrders(e){const t=this.grouped[e];if(!t)return"";const n=t.map(i=>this._groupOrder(i,e));return n.length?e+" by "+n.join(", "):""}get tableName(){if(!this._tableName){let e=this.single.table;const t=this.single.schema;if(e&&t){const n=e instanceof $r,i=e instanceof lt;!n&&!i&&!(typeof e=="function")&&(e=`${t}.${e}`)}this._tableName=e?U(e,e instanceof $r,this.builder,this.client,this.bindingsHolder):""}return this._tableName}_jsonPathWrap(e){return this.client.parameter(e.path||e[1],this.builder,this.bindingsHolder)}_jsonExtract(e,t){let n;return Array.isArray(t.column)?n=t.column:n=[t],Array.isArray(e)||(e=[e]),n.map(i=>{let a=`${ye(i.column||i[0],this.builder,this.client,this.bindingsHolder)}, ${this._jsonPathWrap(i)}`;e.forEach(s=>{a=s+"("+a+")"});const o=i.alias||i[2];return o?this.client.alias(a,this.formatter.wrap(o)):a}).join(", ")}_jsonSet(e,t){const n=`${e}(${ye(t.column,this.builder,this.client,this.bindingsHolder)}, ${this.client.parameter(t.path,this.builder,this.bindingsHolder)}, ${this.client.parameter(t.value,this.builder,this.bindingsHolder)})`;return t.alias?this.client.alias(n,this.formatter.wrap(t.alias)):n}_whereJsonPath(e,t){return`${e}(${this._columnClause(t)}, ${this._jsonPathWrap({path:t.jsonPath})}) ${St(t.operator,this.builder,this.client,this.bindingsHolder)} ${this._jsonValueClause(t)}`}_onJsonPathEquals(e,t){return e+"("+U(t.columnFirst,void 0,this.builder,this.client,this.bindingsHolder)+", "+this.client.parameter(t.jsonPathFirst,this.builder,this.bindingsHolder)+") = "+e+"("+U(t.columnSecond,void 0,this.builder,this.client,this.bindingsHolder)+", "+this.client.parameter(t.jsonPathSecond,this.builder,this.bindingsHolder)+")"}};const{EventEmitter:vR}=I,ER=Ct,TR=Me,{addQueryContext:AR}=z,OR=Nn,{augmentWithBuilderInterface:NR}=qn;let Fe=class extends vR{constructor(e){super(),this.client=e,this._sequence=[],e.config&&(this._debug=e.config.debug,OR(this,4))}withSchema(e){return this._schema=e,this}toString(){return this.toQuery()}toSQL(){return this.client.schemaCompiler(this).toSQL()}async generateDdlCommands(){return await this.client.schemaCompiler(this).generateDdlCommands()}};["createTable","createTableIfNotExists","createTableLike","createView","createViewOrReplace","createMaterializedView","refreshMaterializedView","dropView","dropViewIfExists","dropMaterializedView","dropMaterializedViewIfExists","createSchema","createSchemaIfNotExists","dropSchema","dropSchemaIfExists","createExtension","createExtensionIfNotExists","dropExtension","dropExtensionIfExists","table","alterTable","view","alterView","hasTable","hasColumn","dropTable","renameTable","renameView","dropTableIfExists","raw"].forEach(function(r){Fe.prototype[r]=function(){return r==="createTableIfNotExists"&&this.client.logger.warn(["Use async .hasTable to check if table exists and then use plain .createTable. Since ",'.createTableIfNotExists actually just generates plain "CREATE TABLE IF NOT EXIST..." ',"query it will not work correctly if there are any alter table queries generated for ","columns afterwards. To not break old migrations this function is left untouched for now",", but it should not be used when writing new code and it is removed from documentation."].join("")),r==="table"&&(r="alterTable"),r==="view"&&(r="alterView"),this._sequence.push({method:r,args:ER(arguments)}),this}}),Fe.extend=(r,e)=>{if(Object.prototype.hasOwnProperty.call(Fe.prototype,r))throw new Error(`Can't extend SchemaBuilder with existing method ('${r}').`);TR(Fe.prototype,{[r]:e})},NR(Fe),AR(Fe);var Il=Fe;const qR=fr,{isString:Pl}=M;function RR(r){r&&(Pl(r)&&(r={sql:r}),r.bindings||(r.bindings=this.bindingsHolder.bindings),this.sequence.push(r),this.formatter=this.client.formatter(this._commonBuilder),this.bindings=[],this.formatter.bindings=this.bindings)}function SR(r){const e=new this.constructor(this.client,this.tableCompiler,this.columnBuilder);r.call(e,qR(arguments)),this.sequence.additional=(this.sequence.additional||[]).concat(e.sequence)}function xR(r){r&&(Pl(r)&&(r={sql:r}),r.bindings||(r.bindings=this.bindingsHolder.bindings),this.sequence.unshift(r),this.formatter=this.client.formatter(this._commonBuilder),this.bindings=[],this.formatter.bindings=this.bindings)}var Cr={pushAdditional:SR,pushQuery:RR,unshiftQuery:xR};const{pushQuery:IR,pushAdditional:PR,unshiftQuery:LR}=Cr;let J=class{constructor(e,t){this.builder=t,this._commonBuilder=this.builder,this.client=e,this.schema=t._schema,this.bindings=[],this.bindingsHolder=this,this.formatter=e.formatter(t),this.formatter.bindings=this.bindings,this.sequence=[]}createSchema(){Tr("createSchema")}createSchemaIfNotExists(){Tr("createSchemaIfNotExists")}dropSchema(){Tr("dropSchema")}dropSchemaIfExists(){Tr("dropSchemaIfExists")}dropTable(e){this.pushQuery(this.dropTablePrefix+this.formatter.wrap(Mn(this.schema,e)))}dropTableIfExists(e){this.pushQuery(this.dropTablePrefix+"if exists "+this.formatter.wrap(Mn(this.schema,e)))}dropView(e){this._dropView(e,!1,!1)}dropViewIfExists(e){this._dropView(e,!0,!1)}dropMaterializedView(e){throw new Error("materialized views are not supported by this dialect.")}dropMaterializedViewIfExists(e){throw new Error("materialized views are not supported by this dialect.")}renameView(e,t){throw new Error("rename view is not supported by this dialect (instead drop then create another view).")}refreshMaterializedView(){throw new Error("materialized views are not supported by this dialect.")}_dropView(e,t,n){this.pushQuery((n?this.dropMaterializedViewPrefix:this.dropViewPrefix)+(t?"if exists ":"")+this.formatter.wrap(Mn(this.schema,e)))}raw(e,t){this.sequence.push(this.client.raw(e,t).toSQL())}toSQL(){const e=this.builder._sequence;for(let t=0,n=e.length;t<n;t++){const i=e[t];this[i.method].apply(this,i.args)}return this.sequence}async generateDdlCommands(){const e=this.toSQL();return{pre:[],sql:Array.isArray(e)?e:[e],check:null,post:[]}}};J.prototype.dropTablePrefix="drop table ",J.prototype.dropViewPrefix="drop view ",J.prototype.dropMaterializedViewPrefix="drop materialized view ",J.prototype.alterViewPrefix="alter view ",J.prototype.alterTable=vr("alter"),J.prototype.createTable=vr("create"),J.prototype.createTableIfNotExists=vr("createIfNot"),J.prototype.createTableLike=vr("createLike"),J.prototype.createView=Er("create"),J.prototype.createViewOrReplace=Er("createOrReplace"),J.prototype.createMaterializedView=Er("createMaterializedView"),J.prototype.alterView=Er("alter"),J.prototype.pushQuery=IR,J.prototype.pushAdditional=PR,J.prototype.unshiftQuery=LR;function kn(r){const e=this.builder.queryContext();e!==void 0&&r.queryContext()===void 0&&r.queryContext(e),r.setSchema(this.schema);const t=r.toSQL();for(let n=0,i=t.length;n<i;n++)this.sequence.push(t[n])}function vr(r){return r==="createLike"?function(e,t,n){const i=this.client.tableBuilder(r,e,t,n);kn.call(this,i)}:function(e,t){const n=this.client.tableBuilder(r,e,null,t);kn.call(this,n)}}function Er(r){return function(e,t){const n=this.client.viewBuilder(r,e,t);kn.call(this,n)}}function Mn(r,e){return r?`${r}.${e}`:e}function Tr(r){throw new Error(`${r} is not supported for this dialect (only PostgreSQL supports it currently).`)}var ct=J,BR=Pe,kR=dn,MR=Be,jR=kR(function(r,e){BR(e,MR(e),r)}),QR=jR,Ar=QR;const DR=wt,Ll=Ar,FR=Me,Or=Ct,UR=z,{isString:HR,isFunction:VR,isObject:WR}=M;let Ae=class{constructor(e,t,n,i,a){if(this.client=e,this._fn=a,this._method=t,this._schemaName=void 0,this._tableName=n,this._tableNameLike=i,this._statements=[],this._single={},!i&&!VR(this._fn))throw new TypeError("A callback function must be supplied to calls against `.createTable` and `.table`")}setSchema(e){this._schemaName=e}toSQL(){return this._method==="alter"&&Ll(this,jn),this._fn&&this._fn.call(this,this),this.client.tableCompiler(this).toSQL()}timestamps(e,t,n){WR(e)&&({useTimestamps:e,defaultToNow:t,useCamelCase:n}=e);const i=e===!0?"timestamp":"datetime",a=this[i](n?"createdAt":"created_at"),o=this[i](n?"updatedAt":"updated_at");if(t===!0){const s=this.client.raw("CURRENT_TIMESTAMP");a.notNullable().defaultTo(s),o.notNullable().defaultTo(s)}}comment(e){if(typeof e!="string")throw new TypeError("Table comment must be string");this._single.comment=e}foreign(e,t){const n={column:e,keyName:t};this._statements.push({grouping:"alterTable",method:"foreign",args:[n]});let i={references(a){let o;return HR(a)&&(o=a.split(".")),!o||o.length===1?(n.references=o?o[0]:a,{on(s){if(typeof s!="string")throw new TypeError(`Expected tableName to be a string, got: ${typeof s}`);return n.inTable=s,i},inTable(){return this.on.apply(this,arguments)}}):(n.inTable=o[0],n.references=o[1],i)},withKeyName(a){return n.keyName=a,i},onUpdate(a){return n.onUpdate=a,i},onDelete(a){return n.onDelete=a,i},deferrable:a=>{if(["mysql","mssql","redshift","mysql2","oracledb"].indexOf(this.client.dialect)!==-1)throw new Error(`${this.client.dialect} does not support deferrable`);return n.deferrable=a,i},_columnBuilder(a){return Ll(a,i),i=a,a}};return i}check(e,t,n){return this._statements.push({grouping:"checks",args:[e,t,n]}),this}};["index","primary","unique","dropPrimary","dropUnique","dropIndex","dropForeign"].forEach(r=>{Ae.prototype[r]=function(){return this._statements.push({grouping:"alterTable",method:r,args:Or(arguments)}),this}}),DR({mysql:["engine","charset","collate"],postgresql:["inherits"]},function(r,e){r.forEach(function(t){Ae.prototype[t]=function(n){if(this.client.dialect!==e)throw new Error(`Knex only supports ${t} statement with ${e}.`);if(this._method==="alter")throw new Error(`Knex does not support altering the ${t} outside of create table, please use knex.raw statement.`);this._single[t]=n}})}),UR.addQueryContext(Ae),["tinyint","smallint","mediumint","int","bigint","decimal","float","double","real","bit","boolean","serial","date","datetime","timestamp","time","year","geometry","geography","point","char","varchar","tinytext","tinyText","text","mediumtext","mediumText","longtext","longText","binary","varbinary","tinyblob","tinyBlob","mediumblob","mediumBlob","blob","longblob","longBlob","enum","set","bool","dateTime","increments","bigincrements","bigIncrements","integer","biginteger","bigInteger","string","json","jsonb","uuid","enu","specificType"].forEach(r=>{Ae.prototype[r]=function(){const e=Or(arguments),t=this.client.columnBuilder(this,r,e);return this._statements.push({grouping:"columns",builder:t}),t}});const jn={renameColumn(r,e){return this._statements.push({grouping:"alterTable",method:"renameColumn",args:[r,e]}),this},dropTimestamps(){return this.dropColumns(arguments[0]===!0?["createdAt","updatedAt"]:["created_at","updated_at"])},setNullable(r){return this._statements.push({grouping:"alterTable",method:"setNullable",args:[r]}),this},check(r,e,t){this._statements.push({grouping:"alterTable",method:"check",args:[r,e,t]})},dropChecks(){this._statements.push({grouping:"alterTable",method:"dropChecks",args:Or(arguments)})},dropNullable(r){return this._statements.push({grouping:"alterTable",method:"dropNullable",args:[r]}),this}};jn.dropColumn=jn.dropColumns=function(){return this._statements.push({grouping:"alterTable",method:"dropColumn",args:Or(arguments)}),this},Ae.extend=(r,e)=>{if(Object.prototype.hasOwnProperty.call(Ae.prototype,r))throw new Error(`Can't extend TableBuilder with existing method ('${r}').`);FR(Ae.prototype,{[r]:e})};var Bl=Ae;function zR(r,e,t,n){for(var i=r.length,a=t+(n?1:-1);n?a--:++a<i;)if(e(r[a],a,r))return a;return-1}var KR=zR;function JR(r){return r!==r}var GR=JR;function YR(r,e,t){for(var n=t-1,i=r.length;++n<i;)if(r[n]===e)return n;return-1}var XR=YR,ZR=KR,eS=GR,tS=XR;function rS(r,e,t){return e===e?tS(r,e,t):ZR(r,eS,t)}var kl=rS,nS=kl,iS=ga,sS=Math.max;function oS(r,e,t){var n=r==null?0:r.length;if(!n)return-1;var i=t==null?0:iS(t);return i<0&&(i=sS(n+i,0)),nS(r,e,i)}var aS=oS;const{pushAdditional:lS,pushQuery:uS,unshiftQuery:cS}=Cr,hS=z,dS=_r,fS=aS,Ml=le,pS=fr,{normalizeArr:mS}=z;let he=class{constructor(e,t){this.client=e,this.tableBuilder=t,this._commonBuilder=this.tableBuilder,this.method=t._method,this.schemaNameRaw=t._schemaName,this.tableNameRaw=t._tableName,this.tableNameLikeRaw=t._tableNameLike,this.single=t._single,this.grouped=dS(t._statements,"grouping"),this.formatter=e.formatter(t),this.bindings=[],this.formatter.bindings=this.bindings,this.bindingsHolder=this,this.sequence=[],this._formatting=e.config&&e.config.formatting,this.checksCount=0}toSQL(){return this[this.method](),this.sequence}create(e,t){const i=this.getColumns().map(o=>o.toSQL()),a=this.getColumnTypes(i);this.createAlterTableMethods&&this.alterTableForCreate(a),this.createQuery(a,e,t),this.columnQueries(i),delete this.single.comment,this.alterTable()}createIfNot(){this.create(!0)}createLike(){this.create(!1,!0)}createLikeIfNot(){this.create(!0,!0)}alter(){const t=this.getColumns().map(s=>s.toSQL()),n=this.getColumns("alter"),i=n.map(s=>s.toSQL()),a=this.getColumnTypes(t),o=this.getColumnTypes(i);this.addColumns(a),this.alterColumns(o,n),this.columnQueries(t),this.columnQueries(i),this.alterTable()}foreign(e){if(e.inTable&&e.references){const t=e.keyName?this.formatter.wrap(e.keyName):this._indexCommand("foreign",this.tableNameRaw,e.column),n=this.formatter.columnize(e.column),i=this.formatter.columnize(e.references),a=this.formatter.wrap(e.inTable),o=e.onUpdate?(this.lowerCase?" on update ":" ON UPDATE ")+e.onUpdate:"",s=e.onDelete?(this.lowerCase?" on delete ":" ON DELETE ")+e.onDelete:"",l=e.deferrable?this.lowerCase?` deferrable initially ${e.deferrable.toLowerCase()} `:` DEFERRABLE INITIALLY ${e.deferrable.toUpperCase()} `:"";this.lowerCase?this.pushQuery((this.forCreate?"":`alter table ${this.tableName()} add `)+"constraint "+t+" foreign key ("+n+") references "+a+" ("+i+")"+o+s+l):this.pushQuery((this.forCreate?"":`ALTER TABLE ${this.tableName()} ADD `)+"CONSTRAINT "+t+" FOREIGN KEY ("+n+") REFERENCES "+a+" ("+i+")"+o+s+l)}}getColumnTypes(e){return e.reduce(function(t,n){const i=n[0];return t.sql.push(i.sql),t.bindings.concat(i.bindings),t},{sql:[],bindings:[]})}columnQueries(e){const t=e.reduce(function(n,i){const a=pS(i);return Ml(a)?n:n.concat(a)},[]);for(const n of t)this.pushQuery(n)}addColumns(e,t){if(t=t||this.addColumnsPrefix,e.sql.length>0){const n=e.sql.map(i=>t+i);this.pushQuery({sql:(this.lowerCase?"alter table ":"ALTER TABLE ")+this.tableName()+" "+n.join(", "),bindings:e.bindings})}}alterColumns(e,t){e.sql.length>0&&this.addColumns(e,this.alterColumnsPrefix,t)}getColumns(e){const t=this.grouped.columns||[];e=e||"add";const n=this.tableBuilder.queryContext();return t.filter(i=>i.builder._method===e).map(i=>(n!==void 0&&i.builder.queryContext()===void 0&&i.builder.queryContext(n),this.client.columnCompiler(this,i.builder)))}tableName(){const e=this.schemaNameRaw?`${this.schemaNameRaw}.${this.tableNameRaw}`:this.tableNameRaw;return this.formatter.wrap(e)}tableNameLike(){const e=this.schemaNameRaw?`${this.schemaNameRaw}.${this.tableNameLikeRaw}`:this.tableNameLikeRaw;return this.formatter.wrap(e)}alterTable(){const e=this.grouped.alterTable||[];for(let t=0,n=e.length;t<n;t++){const i=e[t];this[i.method]?this[i.method].apply(this,i.args):this.client.logger.error(`Debug: ${i.method} does not exist`)}for(const t in this.single)typeof this[t]=="function"&&this[t](this.single[t])}alterTableForCreate(e){this.forCreate=!0;const t=this.sequence,n=this.grouped.alterTable||[];this.grouped.alterTable=[];for(let i=0,a=n.length;i<a;i++){const o=n[i];if(fS(this.createAlterTableMethods,o.method)<0){this.grouped.alterTable.push(o);continue}this[o.method]?(this.sequence=[],this[o.method].apply(this,o.args),e.sql.push(this.sequence[0].sql)):this.client.logger.error(`Debug: ${o.method} does not exist`)}this.sequence=t,this.forCreate=!1}dropIndex(e){this.pushQuery(`drop index${e}`)}dropUnique(){throw new Error("Method implemented in the dialect driver")}dropForeign(){throw new Error("Method implemented in the dialect driver")}dropColumn(){const e=hS.normalizeArr.apply(null,arguments),t=(Array.isArray(e)?e:[e]).map(n=>this.dropColumnPrefix+this.formatter.wrap(n));this.pushQuery((this.lowerCase?"alter table ":"ALTER TABLE ")+this.tableName()+" "+t.join(", "))}_setNullableState(e,t){const n=this.tableName(),i=this.formatter.columnize(e),a=this.alterColumnsPrefix;return this.pushQuery({sql:"SELECT 1",output:()=>this.client.queryBuilder().from(this.tableNameRaw).columnInfo(e).then(o=>{if(Ml(o))throw new Error(`.setNullable: Column ${i} does not exist in table ${n}.`);const s=t?"null":"not null",l=o.type+(o.maxLength?`(${o.maxLength})`:""),u=o.defaultValue!==null&&o.defaultValue!==void 0?`default '${o.defaultValue}'`:"",h=`alter table ${n} ${a} ${i} ${l} ${s} ${u}`;return this.client.raw(h)})})}setNullable(e){return this._setNullableState(e,!0)}dropNullable(e){return this._setNullableState(e,!1)}dropChecks(e){if(e===void 0)return"";e=mS(e);const n=`alter table ${this.tableName()} ${e.map(i=>`drop constraint ${i}`).join(", ")}`;this.pushQuery(n)}check(e,t,n){const i=this.tableName();let a=n;a||(this.checksCount++,a=i+"_"+this.checksCount);const o=`alter table ${i} add constraint ${a} check(${e})`;this.pushQuery(o)}_addChecks(){return this.grouped.checks?", "+this.grouped.checks.map(e=>`${e.args[2]?"constraint "+e.args[2]+" ":""}check (${this.client.raw(e.args[0],e.args[1])})`).join(", "):""}_indexCommand(e,t,n){Array.isArray(n)||(n=n?[n]:[]);const a=(t.replace(/\.|-/g,"_")+"_"+n.join("_")+"_"+e).toLowerCase();return this.formatter.wrap(a)}_getPrimaryKeys(){return(this.grouped.alterTable||[]).filter(e=>e.method==="primary").flatMap(e=>e.args).flat()}_canBeAddPrimaryKey(e){return e.primaryKey&&this._getPrimaryKeys().length===0}_getIncrementsColumnNames(){return this.grouped.columns.filter(e=>e.builder._type==="increments").map(e=>e.builder._args[0])}};he.prototype.pushQuery=uS,he.prototype.pushAdditional=lS,he.prototype.unshiftQuery=cS,he.prototype.lowerCase=!0,he.prototype.createAlterTableMethods=null,he.prototype.addColumnsPrefix="add column ",he.prototype.alterColumnsPrefix="alter column ",he.prototype.modifyColumnPrefix="modify column ",he.prototype.dropColumnPrefix="drop column ";var ht=he;const gS=Ar,yS=Me,jl=Ct,{addQueryContext:bS}=z;let be=class{constructor(e,t,n,i){this.client=e,this._method="add",this._single={},this._modifiers={},this._statements=[],this._type=$S[n]||n,this._args=i,this._tableBuilder=t,t._method==="alter"&&gS(this,Nr)}references(e){return this._tableBuilder.foreign.call(this._tableBuilder,this._args[0],void 0,this)._columnBuilder(this).references(e)}};const _S=["default","defaultsTo","defaultTo","unsigned","nullable","first","after","comment","collate","check","checkPositive","checkNegative","checkIn","checkNotIn","checkBetween","checkLength","checkRegex"],wS={default:"defaultTo",defaultsTo:"defaultTo"};_S.forEach(function(r){const e=wS[r]||r;be.prototype[r]=function(){return this._modifiers[e]=jl(arguments),this}}),bS(be),be.prototype.notNull=be.prototype.notNullable=function(){return this.nullable(!1)},["index","primary","unique"].forEach(function(r){be.prototype[r]=function(){return this._type.toLowerCase().indexOf("increments")===-1&&this._tableBuilder[r].apply(this._tableBuilder,[this._args[0]].concat(jl(arguments))),this}}),be.extend=(r,e)=>{if(Object.prototype.hasOwnProperty.call(be.prototype,r))throw new Error(`Can't extend ColumnBuilder with existing method ('${r}').`);yS(be.prototype,{[r]:e})};const Nr={};Nr.drop=function(){return this._single.drop=!0,this},Nr.alterType=function(r){return this._statements.push({grouping:"alterType",value:r}),this},Nr.alter=function({alterNullable:r=!0,alterType:e=!0}={}){return this._method="alter",this.alterNullable=r,this.alterType=e,this};const $S={float:"floating",enum:"enu",boolean:"bool",string:"varchar",bigint:"bigInteger"};var qr=be;function CS(r){return r&&r.length?r[0]:void 0}var vS=CS,ES=vS;const Qn=Cr,TS=_r,AS=ES,OS=wr,NS=fr,{toNumber:dt}=z,{formatDefault:qS}=je,{operator:Dn}=K;let j=class{constructor(e,t,n){this.client=e,this.tableCompiler=t,this.columnBuilder=n,this._commonBuilder=this.columnBuilder,this.args=n._args,this.type=n._type.toLowerCase(),this.grouped=TS(n._statements,"grouping"),this.modified=n._modifiers,this.isIncrements=this.type.indexOf("increments")!==-1,this.formatter=e.formatter(n),this.bindings=[],this.formatter.bindings=this.bindings,this.bindingsHolder=this,this.sequence=[],this.modifiers=[],this.checksCount=0}_addCheckModifiers(){this.modifiers.push("check","checkPositive","checkNegative","checkIn","checkNotIn","checkBetween","checkLength","checkRegex")}defaults(e){if(Object.prototype.hasOwnProperty.call(this._defaultMap,e))return this._defaultMap[e].bind(this)();throw new Error(`There is no default for the specified identifier ${e}`)}toSQL(){return this.pushQuery(this.compileColumn()),this.sequence.additional&&(this.sequence=this.sequence.concat(this.sequence.additional)),this.sequence}compileColumn(){return this.formatter.wrap(this.getColumnName())+" "+this.getColumnType()+this.getModifiers()}getColumnName(){return AS(this.args)||this.defaults("columnName")}getColumnType(){if(!this._columnType){const e=this[this.type];this._columnType=typeof e=="function"?e.apply(this,NS(this.args)):e}return this._columnType}getModifiers(){const e=[];for(let t=0,n=this.modifiers.length;t<n;t++){const i=this.modifiers[t];if((!this.isIncrements||this.isIncrements&&i==="comment")&&OS(this.modified,i)){const a=this[i].apply(this,this.modified[i]);a&&e.push(a)}}return e.length>0?` ${e.join(" ")}`:""}varchar(e){return`varchar(${dt(e,255)})`}floating(e,t){return`float(${dt(e,8)}, ${dt(t,2)})`}decimal(e,t){if(e===null)throw new Error("Specifying no precision on decimal columns is not supported for that SQL dialect.");return`decimal(${dt(e,8)}, ${dt(t,2)})`}specifictype(e){return e}nullable(e){return e===!1?"not null":"null"}notNullable(){return this.nullable(!1)}defaultTo(e){return`default ${qS(e,this.type,this.client)}`}increments(e={primaryKey:!0}){return"integer not null"+(this.tableCompiler._canBeAddPrimaryKey(e)?" primary key":"")+" autoincrement"}bigincrements(e={primaryKey:!0}){return this.increments(e)}_pushAlterCheckQuery(e,t){let n=t;n||(this.checksCount++,n=this.tableCompiler.tableNameRaw+"_"+this.getColumnName()+"_"+this.checksCount),this.pushAdditional(function(){this.pushQuery(`alter table ${this.tableCompiler.tableName()} add constraint ${n} check(${e})`)})}_checkConstraintName(e){return e?`constraint ${e} `:""}_check(e,t){return this.columnBuilder._method==="alter"?(this._pushAlterCheckQuery(e,t),""):`${this._checkConstraintName(t)}check (${e})`}checkPositive(e){return this._check(`${this.formatter.wrap(this.getColumnName())} ${Dn(">",this.columnBuilder,this.bindingsHolder)} 0`,e)}checkNegative(e){return this._check(`${this.formatter.wrap(this.getColumnName())} ${Dn("<",this.columnBuilder,this.bindingsHolder)} 0`,e)}_checkIn(e,t,n){return this._check(`${this.formatter.wrap(this.getColumnName())} ${n?"not ":""}in (${e.map(i=>this.client._escapeBinding(i)).join(",")})`,t)}checkIn(e,t){return this._checkIn(e,t)}checkNotIn(e,t){return this._checkIn(e,t,!0)}checkBetween(e,t){e.length===2&&!Array.isArray(e[0])&&!Array.isArray(e[1])&&(e=[e]);const n=e.map(i=>`${this.formatter.wrap(this.getColumnName())} between ${this.client._escapeBinding(i[0])} and ${this.client._escapeBinding(i[1])}`).join(" or ");return this._check(n,t)}checkLength(e,t,n){return this._check(`length(${this.formatter.wrap(this.getColumnName())}) ${Dn(e,this.columnBuilder,this.bindingsHolder)} ${dt(t)}`,n)}};j.prototype.binary="blob",j.prototype.bool="boolean",j.prototype.date="date",j.prototype.datetime="datetime",j.prototype.time="time",j.prototype.timestamp="timestamp",j.prototype.geometry="geometry",j.prototype.geography="geography",j.prototype.point="point",j.prototype.enu="varchar",j.prototype.bit=j.prototype.json="text",j.prototype.uuid=({useBinaryUuid:r=!1,primaryKey:e=!1}={})=>r?"binary(16)":"char(36)",j.prototype.integer=j.prototype.smallint=j.prototype.mediumint="integer",j.prototype.biginteger="bigint",j.prototype.text="text",j.prototype.tinyint="tinyint",j.prototype.pushQuery=Qn.pushQuery,j.prototype.pushAdditional=Qn.pushAdditional,j.prototype.unshiftQuery=Qn.unshiftQuery,j.prototype._defaultMap={columnName:function(){if(!this.isIncrements)throw new Error(`You did not specify a column name for the ${this.type} column.`);return"id"}};var Ue=j;const RS=at;var SS=class extends RS{constructor(e,t){super(e),this.ref=t,this._schema=null,this._alias=null}withSchema(e){return this._schema=e,this}as(e){return this._alias=e,this}toSQL(){const e=this._schema?`${this._schema}.${this.ref}`:this.ref,t=this.client.formatter(this),n=t.columnize(e),i=this._alias?`${n} as ${t.wrap(this._alias)}`:n;return this.set(i,[]),super.toSQL(...arguments)}};const{columnize:xS,wrap:IS}=K;var Rr=class{constructor(e,t){this.client=e,this.builder=t,this.bindings=[]}columnize(e){return xS(e,this.builder,this.client,this)}wrap(e,t){return IS(e,t,this.builder,this.client,this)}},R={};Object.defineProperty(R,"__esModule",{value:!0});var PS=I;function LS(r){if(r&&r.__esModule)return r;var e=Object.create(null);return r&&Object.keys(r).forEach(function(t){if(t!=="default"){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}}),e.default=r,Object.freeze(e)}var Fn=LS(PS);const{env:Oe={},argv:Ql=[],platform:BS=""}=typeof process>"u"?{}:process,kS="NO_COLOR"in Oe||Ql.includes("--no-color"),MS="FORCE_COLOR"in Oe||Ql.includes("--color"),jS=BS==="win32",Dl=Oe.TERM==="dumb",QS=Fn&&Fn.isatty&&Fn.isatty(1)&&Oe.TERM&&!Dl,DS="CI"in Oe&&("GITHUB_ACTIONS"in Oe||"GITLAB_CI"in Oe||"CIRCLECI"in Oe),Fl=!kS&&(MS||jS&&!Dl||QS||DS),Ul=(r,e,t,n,i=e.substring(0,r)+n,a=e.substring(r+t.length),o=a.indexOf(t))=>i+(o<0?a:Ul(o,a,t,n)),FS=(r,e,t,n,i)=>r<0?t+e+n:t+Ul(r,e,n,i)+n,US=(r,e,t=r,n=r.length+1)=>i=>i||!(i===""||i===void 0)?FS((""+i).indexOf(e,n),i,r,e,t):"",S=(r,e,t)=>US(`\x1B[${r}m`,`\x1B[${e}m`,t),Hl={reset:S(0,0),bold:S(1,22,"\x1B[22m\x1B[1m"),dim:S(2,22,"\x1B[22m\x1B[2m"),italic:S(3,23),underline:S(4,24),inverse:S(7,27),hidden:S(8,28),strikethrough:S(9,29),black:S(30,39),red:S(31,39),green:S(32,39),yellow:S(33,39),blue:S(34,39),magenta:S(35,39),cyan:S(36,39),white:S(37,39),gray:S(90,39),bgBlack:S(40,49),bgRed:S(41,49),bgGreen:S(42,49),bgYellow:S(43,49),bgBlue:S(44,49),bgMagenta:S(45,49),bgCyan:S(46,49),bgWhite:S(47,49),blackBright:S(90,39),redBright:S(91,39),greenBright:S(92,39),yellowBright:S(93,39),blueBright:S(94,39),magentaBright:S(95,39),cyanBright:S(96,39),whiteBright:S(97,39),bgBlackBright:S(100,49),bgRedBright:S(101,49),bgGreenBright:S(102,49),bgYellowBright:S(103,49),bgBlueBright:S(104,49),bgMagentaBright:S(105,49),bgCyanBright:S(106,49),bgWhiteBright:S(107,49)},Vl=({useColor:r=Fl}={})=>r?Hl:Object.keys(Hl).reduce((e,t)=>({...e,[t]:String}),{}),{reset:HS,bold:VS,dim:WS,italic:zS,underline:KS,inverse:JS,hidden:GS,strikethrough:YS,black:XS,red:ZS,green:e1,yellow:t1,blue:r1,magenta:n1,cyan:i1,white:s1,gray:o1,bgBlack:a1,bgRed:l1,bgGreen:u1,bgYellow:c1,bgBlue:h1,bgMagenta:d1,bgCyan:f1,bgWhite:p1,blackBright:m1,redBright:g1,greenBright:y1,yellowBright:b1,blueBright:_1,magentaBright:w1,cyanBright:$1,whiteBright:C1,bgBlackBright:v1,bgRedBright:E1,bgGreenBright:T1,bgYellowBright:A1,bgBlueBright:O1,bgMagentaBright:N1,bgCyanBright:q1,bgWhiteBright:R1}=Vl();R.bgBlack=a1,R.bgBlackBright=v1,R.bgBlue=h1,R.bgBlueBright=O1,R.bgCyan=f1,R.bgCyanBright=q1,R.bgGreen=u1,R.bgGreenBright=T1,R.bgMagenta=d1,R.bgMagentaBright=N1,R.bgRed=l1,R.bgRedBright=E1,R.bgWhite=p1,R.bgWhiteBright=R1,R.bgYellow=c1,R.bgYellowBright=A1,R.black=XS,R.blackBright=m1,R.blue=r1,R.blueBright=_1,R.bold=VS,R.createColors=Vl,R.cyan=i1,R.cyanBright=$1,R.dim=WS,R.gray=o1,R.green=e1,R.greenBright=y1,R.hidden=GS,R.inverse=JS,R.isColorSupported=Fl,R.italic=zS,R.magenta=n1,R.magentaBright=w1,R.red=ZS,R.redBright=g1,R.reset=HS,R.strikethrough=YS,R.underline=KS,R.white=s1,R.whiteBright=C1,R.yellow=t1,R.yellowBright=b1;const Un=R,{inspect:S1}=I,{isString:x1,isFunction:Wl}=M;let I1=class{constructor(e={}){const{log:{debug:t,warn:n,error:i,deprecate:a,inspectionDepth:o,enableColors:s}={}}=e;this._inspectionDepth=o||5,this._enableColors=P1(s),this._debug=t,this._warn=n,this._error=i,this._deprecate=a}_log(e,t,n){if(t!=null&&!Wl(t))throw new TypeError("Extensions to knex logger must be functions!");if(Wl(t)){t(e);return}x1(e)||(e=S1(e,{depth:this._inspectionDepth,colors:this._enableColors})),console.log(n?n(e):e)}debug(e){this._log(e,this._debug)}warn(e){this._log(e,this._warn,Un.yellow)}error(e){this._log(e,this._error,Un.red)}deprecate(e,t){const n=`${e} is deprecated, please use ${t}`;this._log(n,this._deprecate,Un.yellow)}};function P1(r){return r??(process&&process.stdout?process.stdout.isTTY:!1)}var L1=I1;const B1=z,k1=Ar,M1=Me;let xt=class{constructor(e,t,n,i){this.client=e,this._method=t,this._schemaName=void 0,this._columns=void 0,this._fn=i,this._viewName=n,this._statements=[],this._single={}}setSchema(e){this._schemaName=e}columns(e){this._columns=e}as(e){this._selectQuery=e}checkOption(){throw new Error("check option definition is not supported by this dialect.")}localCheckOption(){throw new Error("check option definition is not supported by this dialect.")}cascadedCheckOption(){throw new Error("check option definition is not supported by this dialect.")}toSQL(){return this._method==="alter"&&k1(this,j1),this._fn.call(this,this),this.client.viewCompiler(this).toSQL()}};const j1={column(r){const e=this;return{rename:function(t){return e._statements.push({grouping:"alterView",method:"renameColumn",args:[r,t]}),this},defaultTo:function(t){return e._statements.push({grouping:"alterView",method:"defaultTo",args:[r,t]}),this}}}};B1.addQueryContext(xt),xt.extend=(r,e)=>{if(Object.prototype.hasOwnProperty.call(xt.prototype,r))throw new Error(`Can't extend ViewBuilder with existing method ('${r}').`);M1(xt.prototype,{[r]:e})};var It=xt;const{pushQuery:Q1}=Cr,D1=_r,{columnize:F1}=K;let zl=class{constructor(e,t){this.client=e,this.viewBuilder=t,this._commonBuilder=this.viewBuilder,this.method=t._method,this.schemaNameRaw=t._schemaName,this.viewNameRaw=t._viewName,this.single=t._single,this.selectQuery=t._selectQuery,this.columns=t._columns,this.grouped=D1(t._statements,"grouping"),this.formatter=e.formatter(t),this.bindings=[],this.formatter.bindings=this.bindings,this.bindingsHolder=this,this.sequence=[]}toSQL(){return this[this.method](),this.sequence}create(){this.createQuery(this.columns,this.selectQuery)}createOrReplace(){throw new Error("replace views is not supported by this dialect.")}createMaterializedView(){throw new Error("materialized views are not supported by this dialect.")}createQuery(e,t,n,i){const a="create "+(n?"materialized ":"")+(i?"or replace ":"")+"view ",o=e?" ("+F1(e,this.viewBuilder,this.client,this.bindingsHolder)+")":"";let s=a+this.viewName()+o;switch(s+=" as ",s+=t.toString(),this.single.checkOption){case"default_option":s+=" with check option";break;case"local":s+=" with local check option";break;case"cascaded":s+=" with cascaded check option";break}this.pushQuery({sql:s})}renameView(e,t){throw new Error("rename view is not supported by this dialect (instead drop, then create another view).")}refreshMaterializedView(){throw new Error("materialized views are not supported by this dialect.")}alter(){this.alterView()}alterView(){const e=this.grouped.alterView||[];for(let t=0,n=e.length;t<n;t++){const i=e[t];this[i.method]?this[i.method].apply(this,i.args):this.client.logger.error(`Debug: ${i.method} does not exist`)}for(const t in this.single)typeof this[t]=="function"&&this[t](this.single[t])}renameColumn(e,t){throw new Error("rename column of views is not supported by this dialect.")}defaultTo(e,t){throw new Error("change default values of views is not supported by this dialect.")}viewName(){const e=this.schemaNameRaw?`${this.schemaNameRaw}.${this.viewNameRaw}`:this.viewNameRaw;return this.formatter.wrap(e)}};zl.prototype.pushQuery=Q1;var ft=zl;const{Pool:U1,TimeoutError:H1}=sh,{EventEmitter:V1}=I,{promisify:W1}=I,{makeEscape:z1}=Ur,K1=w_,J1=Wo,G1=Xo,Y1=Ew,X1=Ce,{executeQuery:Z1,enrichQueryObject:Kl}=Ia,ex=Ee,tx=De,rx=Il,nx=ct,ix=Bl,sx=ht,ox=qr,ax=Ue,{KnexTimeoutError:lx}=we,{outputQuery:ux,unwrapRaw:cx}=K,{compileCallback:hx}=je,dx=at,fx=SS,px=Rr,mx=L1,{POOL_CONFIG_OPTIONS:gx}=On,yx=It,bx=ft,_x=$e,Hn=ae("knex:client");let Jl=class extends V1{constructor(e={}){if(super(),this.config=e,this.logger=new mx(e),this.dialect&&!this.config.client&&this.logger.warn("Using 'this.dialect' to identify the client is deprecated and support for it will be removed in the future. Please use configuration option 'client' instead."),!(this.config.client||this.dialect))throw new Error("knex: Required configuration option 'client' is missing.");e.version&&(this.version=e.version),e.connection&&e.connection instanceof Function?(this.connectionConfigProvider=e.connection,this.connectionConfigExpirationChecker=()=>!0):(this.connectionSettings=K1(e.connection||{}),this.connectionConfigExpirationChecker=null),this.driverName&&e.connection&&(this.initializeDriver(),(!e.pool||e.pool&&e.pool.max!==0)&&this.initializePool(e)),this.valueForUndefined=this.raw("DEFAULT"),e.useNullAsDefault&&(this.valueForUndefined=null)}formatter(e){return new px(this,e)}queryBuilder(){return new ex(this)}queryCompiler(e,t){return new tx(this,e,t)}schemaBuilder(){return new rx(this)}schemaCompiler(e){return new nx(this,e)}tableBuilder(e,t,n,i){return new ix(this,e,t,n,i)}viewBuilder(e,t,n){return new yx(this,e,t,n)}tableCompiler(e){return new sx(this,e)}viewCompiler(e){return new bx(this,e)}columnBuilder(e,t,n){return new ox(this,e,t,n)}columnCompiler(e,t){return new ax(this,e,t)}runner(e){return new Y1(this,e)}transaction(e,t,n){return new X1(this,e,t,n)}raw(){return new dx(this).set(...arguments)}ref(){return new fx(this,...arguments)}query(e,t){const n=Kl(e,t,this);return Z1(e,n,this)}stream(e,t,n,i){const a=Kl(e,t,this);return this._stream(e,a,n,i)}prepBindings(e){return e}positionBindings(e){return e}postProcessResponse(e,t){return this.config.postProcessResponse?this.config.postProcessResponse(e,t):e}wrapIdentifier(e,t){return this.customWrapIdentifier(e,this.wrapIdentifierImpl,t)}customWrapIdentifier(e,t,n){return this.config.wrapIdentifier?this.config.wrapIdentifier(e,t,n):t(e)}wrapIdentifierImpl(e){return e!=="*"?`"${e.replace(/"/g,'""')}"`:"*"}initializeDriver(){try{this.driver=this._driver()}catch(e){const t=`Knex: run
$ npm install ${this.driverName} --save`;throw this.logger.error(`${t}
${e.message}
${e.stack}`),new Error(`${t}
${e.message}`)}}poolDefaults(){return{min:2,max:10,propagateCreateError:!0}}getPoolSettings(e){e=J1({},e,this.poolDefaults()),gx.forEach(a=>{a in e&&this.logger.warn([`Pool config option "${a}" is no longer supported.`,"See https://github.com/Vincit/tarn.js for possible pool config options."].join(" "))});const t=6e4,n=[this.config.acquireConnectionTimeout,e.acquireTimeoutMillis].filter(a=>a!==void 0);n.length||n.push(t),e.acquireTimeoutMillis=Math.min(...n);const i=async()=>{if(!this.connectionConfigProvider||!this.connectionConfigExpirationChecker||!this.connectionConfigExpirationChecker())return;const a=await this.connectionConfigProvider();a.expirationChecker?(this.connectionConfigExpirationChecker=a.expirationChecker,delete a.expirationChecker):this.connectionConfigExpirationChecker=null,this.connectionSettings=a};return Object.assign(e,{create:async()=>{await i();const a=await this.acquireRawConnection();return a.__knexUid=G1("__knexUid"),e.afterCreate&&await W1(e.afterCreate)(a),a},destroy:a=>{if(a!==void 0)return this.destroyRawConnection(a)},validate:a=>a.__knex__disposed?(this.logger.warn(`Connection Error: ${a.__knex__disposed}`),!1):this.validateConnection(a)})}initializePool(e=this.config){if(this.pool){this.logger.warn("The pool has already been initialized");return}const t={...this.getPoolSettings(e.pool)};t.afterCreate&&delete t.afterCreate,this.pool=new U1(t)}validateConnection(e){return!0}async acquireConnection(){if(!this.pool)throw new Error("Unable to acquire a connection");try{const e=await this.pool.acquire().promise;return Hn("acquired connection from pool: %s",e.__knexUid),e}catch(e){let t=e;throw e instanceof H1&&(t=new lx("Knex: Timeout acquiring a connection. The pool is probably full. Are you missing a .transacting(trx) call?")),t}}releaseConnection(e){return Hn("releasing connection to pool: %s",e.__knexUid),this.pool.release(e)||Hn("pool refused connection: %s",e.__knexUid),Promise.resolve()}async destroy(e){try{this.pool&&this.pool.destroy&&await this.pool.destroy(),this.pool=void 0,typeof e=="function"&&e()}catch(t){if(typeof e=="function")return e(t);throw t}}database(){return this.connectionSettings.database}toString(){return"[object KnexClient]"}assertCanCancelQuery(){if(!this.canCancelQuery)throw new Error("Query cancelling not supported for this dialect")}cancelQuery(){throw new Error("Query cancelling not supported for this dialect")}alias(e,t){return e+" as "+t}parameter(e,t,n){return typeof e=="function"?ux(hx(e,void 0,this,n),!0,t,this):cx(e,!0,t,this,n)||"?"}parameterize(e,t,n,i){if(typeof e=="function")return this.parameter(e,n,i);e=Array.isArray(e)?e:[e];let a="",o=-1;for(;++o<e.length;){o>0&&(a+=", ");let s=e[o];_x(s)&&(s=JSON.stringify(s)),a+=this.parameter(s===void 0?t:s,n,i)}return a}values(e,t,n){return Array.isArray(e)?Array.isArray(e[0])?`(${e.map(i=>`(${this.parameterize(i,void 0,t,n)})`).join(", ")})`:`(${this.parameterize(e,void 0,t,n)})`:e&&e.isRawInstance?`(${this.parameter(e,t,n)})`:this.parameter(e,t,n)}processPassedConnection(e){}toPathForJson(e){return e}};Object.assign(Jl.prototype,{_escapeBinding:z1({escapeString(r){return`'${r.replace(/'/g,"''")}'`}}),canCancelQuery:!1});var He=Jl,wx=I,Vn=I;function Wn(r){if(r.charAt(0)==="/"){var t=r.split(" ");return{host:t[0],database:t[1]}}var e=wx.parse(/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(r)?encodeURI(r).replace(/\%25(\d\d)/g,"%$1"):r,!0),t=e.query;for(var n in t)Array.isArray(t[n])&&(t[n]=t[n][t[n].length-1]);var i=(e.auth||":").split(":");if(t.user=i[0],t.password=i.splice(1).join(":"),t.port=e.port,e.protocol=="socket:")return t.host=decodeURI(e.pathname),t.database=e.query.db,t.client_encoding=e.query.encoding,t;t.host||(t.host=e.hostname);var a=e.pathname;if(!t.host&&a&&/^%2f/i.test(a)){var o=a.split("/");t.host=decodeURIComponent(o[0]),a=o.splice(1).join("/")}switch(a&&a.charAt(0)==="/"&&(a=a.slice(1)||null),t.database=a&&decodeURI(a),(t.ssl==="true"||t.ssl==="1")&&(t.ssl=!0),t.ssl==="0"&&(t.ssl=!1),(t.sslcert||t.sslkey||t.sslrootcert||t.sslmode)&&(t.ssl={}),t.sslcert&&(t.ssl.cert=Vn.readFileSync(t.sslcert).toString()),t.sslkey&&(t.ssl.key=Vn.readFileSync(t.sslkey).toString()),t.sslrootcert&&(t.ssl.ca=Vn.readFileSync(t.sslrootcert).toString()),t.sslmode){case"disable":{t.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{t.ssl.rejectUnauthorized=!1;break}}return t}var $x=Wn;Wn.parse=Wn;const{parse:Cx}=$x,vx=Cx,Ex=process&&process.platform&&process.platform==="win32";function Tx(r){try{return new URL(r)}catch{return null}}var Ax=function(e){const t=Tx(e),n=Ex&&t&&t.protocol.length===2;if(!t||n)return{client:"sqlite3",connection:{filename:e}};let{protocol:i}=t;i.slice(-1)===":"&&(i=i.slice(0,-1));const a=["postgresql","postgres"].includes(i);return{client:i,connection:a?vx(e):Ox(t)}};function Ox(r){const e={};let t=r.pathname;if(t[0]==="/"&&(t=t.slice(1)),e.database=t,r.hostname&&(r.protocol.indexOf("mssql")===0?e.server=r.hostname:e.host=r.hostname),r.port&&(e.port=r.port),(r.username||r.password)&&(e.user=decodeURIComponent(r.username)),r.password&&(e.password=decodeURIComponent(r.password)),r.searchParams)for(const[n,i]of r.searchParams.entries())if(["mysql:","mariadb:","mssql:"].includes(r.protocol))try{e[n]=JSON.parse(i)}catch{e[n]=i}else e[n]=i;return e}var Sr={},zn,Gl;function Nx(){if(Gl)return zn;Gl=1;const r=Ce;class e extends r{begin(n){return this.isolationLevel&&this.client.logger.warn("sqlite3 only supports serializable transactions, ignoring the isolation level param"),this.query(n,"BEGIN;")}}return zn=e,zn}var Kn,Yl;function qx(){if(Yl)return Kn;Yl=1;const r=Uo,e=wt,t=ie,n=le,i=At,a=De,o=ar,{isString:s}=M,{wrapString:l,columnize:u}=K,h=r("");class c extends a{constructor(p,g,_){super(p,g,_),this.forShare=h,this.forKeyShare=h,this.forUpdate=h,this.forNoKeyUpdate=h}insert(){const p=this.single.insert||[];let g=this.with()+`insert into ${this.tableName} `;if(Array.isArray(p)){if(p.length===0)return"";if(p.length===1&&p[0]&&n(p[0]))return{sql:g+this._emptyInsertValue}}else if(typeof p=="object"&&n(p))return{sql:g+this._emptyInsertValue};const _=this._prepInsert(p);if(s(_))return{sql:g+_};if(_.columns.length===0)return{sql:""};if(g+=`(${this.formatter.columnize(_.columns)})`,this.client.valueForUndefined!==null&&_.values.forEach(C=>{e(C,T=>{if(T===void 0)throw new TypeError("`sqlite` does not support inserting default values. Specify values explicitly or use the `useNullAsDefault` config flag. (see docs https://knexjs.org/guide/query-builder.html#insert).")})}),_.values.length===1){const C=this.client.parameterize(_.values[0],this.client.valueForUndefined,this.builder,this.bindingsHolder);g+=` values (${C})`;const{onConflict:T,ignore:N,merge:P}=this.single;if(T&&N)g+=this._ignore(T);else if(T&&P){g+=this._merge(P.updates,T,p);const G=this.where();G&&(g+=` ${G}`)}const{returning:L}=this.single;return L&&(g+=this._returning(L)),{sql:g,returning:L}}const f=[];let m=-1;for(;++m<_.values.length;){let C=-1;const T=f[m]=[];let N=_.values[m];for(N=N===void 0?this.client.valueForUndefined:N;++C<_.columns.length;)T.push(this.client.alias(this.client.parameter(N[C],this.builder,this.bindingsHolder),this.formatter.wrap(_.columns[C])));f[m]=T.join(", ")}g+=" select "+f.join(" union all select ");const{onConflict:y,ignore:w,merge:$}=this.single;y&&w?g+=" where true"+this._ignore(y):y&&$&&(g+=" where true"+this._merge($.updates,y,p));const{returning:E}=this.single;return E&&(g+=this._returning(E)),{sql:g,returning:E}}update(){const p=this.with(),g=this._prepUpdate(this.single.update),_=this.where(),{returning:f}=this.single;return{sql:p+`update ${this.single.only?"only ":""}${this.tableName} set ${g.join(", ")}`+(_?` ${_}`:"")+this._returning(f),returning:f}}_ignore(p){return p===!0?" on conflict do nothing":` on conflict ${this._onConflictClause(p)} do nothing`}_merge(p,g,_){let f=` on conflict ${this._onConflictClause(g)} do update set `;if(p&&Array.isArray(p))return f+=p.map(m=>l(m.split(".").pop(),this.formatter.builder,this.client,this.formatter)).map(m=>`${m} = excluded.${m}`).join(", "),f;if(p&&typeof p=="object"){const m=this._prepUpdate(p);return typeof m=="string"?f+=m:f+=m.join(","),f}else{const m=this._prepInsert(_);if(typeof m=="string")throw new Error("If using merge with a raw insert query, then updates must be provided");return f+=m.columns.map(y=>l(y.split(".").pop(),this.builder,this.client)).map(y=>`${y} = excluded.${y}`).join(", "),f}}_returning(p){return p?` returning ${this.formatter.columnize(p)}`:""}truncate(){const{table:p}=this.single;return{sql:`delete from ${this.tableName}`,output(){return this.query({sql:`delete from sqlite_sequence where name = '${p}'`}).catch(o)}}}columnInfo(){const p=this.single.columnInfo;return{sql:`PRAGMA table_info(\`${this.client.customWrapIdentifier(this.single.table,t)}\`)`,output(_){const f=/.*\((\d+)\)/,m=i(_,function(y,w){let{type:$}=w,E=$.match(f);return E&&(E=E[1]),$=E?$.split("(")[0]:$,y[w.name]={type:$.toLowerCase(),maxLength:E,nullable:!w.notnull,defaultValue:w.dflt_value},y},{});return p&&m[p]||m}}}limit(){const p=!this.single.limit&&this.single.limit!==0;return p&&!this.single.offset?"":(this.single.limit=p?-1:this.single.limit,`limit ${this._getValueOrParameterFromAttribute("limit")}`)}jsonExtract(p){return this._jsonExtract("json_extract",p)}jsonSet(p){return this._jsonSet("json_set",p)}jsonInsert(p){return this._jsonSet("json_insert",p)}jsonRemove(p){const g=`json_remove(${u(p.column,this.builder,this.client,this.bindingsHolder)},${this.client.parameter(p.path,this.builder,this.bindingsHolder)})`;return p.alias?this.client.alias(g,this.formatter.wrap(p.alias)):g}whereJsonPath(p){return this._whereJsonPath("json_extract",p)}whereJsonSupersetOf(p){throw new Error("Json superset where clause not actually supported by SQLite")}whereJsonSubsetOf(p){throw new Error("Json subset where clause not actually supported by SQLite")}onJsonPathEquals(p){return this._onJsonPathEquals("json_extract",p)}}return Kn=c,Kn}var Jn,Xl;function Rx(){if(Xl)return Jn;Xl=1;var r=it;function e(t,n){var i;return r(t,function(a,o,s){return i=n(a,o,s),!i}),!!i}return Jn=e,Jn}var Gn,Zl;function Sx(){if(Zl)return Gn;Zl=1;var r=Da(),e=me,t=Rx(),n=F,i=ir;function a(o,s,l){var u=n(o)?r:t;return l&&i(o,s,l)&&(s=void 0),u(o,e(s))}return Gn=a,Gn}var Yn,eu;function xx(){if(eu)return Yn;eu=1;const r=ct,e=Sx();class t extends r{constructor(i,a){super(i,a)}hasTable(i){const a=`select * from sqlite_master where type = 'table' and name = ${this.client.parameter(this.formatter.wrap(i).replace(/`/g,""),this.builder,this.bindingsHolder)}`;this.pushQuery({sql:a,output:o=>o.length>0})}hasColumn(i,a){this.pushQuery({sql:`PRAGMA table_info(${this.formatter.wrap(i)})`,output(o){return e(o,s=>this.client.wrapIdentifier(s.name.toLowerCase())===this.client.wrapIdentifier(a.toLowerCase()))}})}renameTable(i,a){this.pushQuery(`alter table ${this.formatter.wrap(i)} rename to ${this.formatter.wrap(a)}`)}async generateDdlCommands(){const i=this.builder._sequence;for(let o=0,s=i.length;o<s;o++){const l=i[o];this[l.method].apply(this,l.args)}const a=this.sequence;if(a.length===1&&a[0].statementsProducer)return a[0].statementsProducer();{const o=[];for(const s of a){const l=s.sql;Array.isArray(l)?o.push(...l):o.push(l)}return{pre:[],sql:o,check:null,post:[]}}}}return Yn=t,Yn}var Xn,tu;function Ix(){if(tu)return Xn;tu=1;const r=Ue;class e extends r{constructor(){super(...arguments),this.modifiers=["nullable","defaultTo"],this._addCheckModifiers()}enu(n){return`text check (${this.formatter.wrap(this.args[0])} in ('${n.join("', '")}'))`}_pushAlterCheckQuery(n,i){throw new Error("Alter table with to add constraints is not permitted in SQLite")}checkRegex(n,i){return this._check(`${this.formatter.wrap(this.getColumnName())} REGEXP ${this.client._escapeBinding(n)}`,i)}}return e.prototype.json="json",e.prototype.jsonb="json",e.prototype.double=e.prototype.decimal=e.prototype.floating="float",e.prototype.timestamp="datetime",e.prototype.increments=e.prototype.bigincrements="integer not null primary key autoincrement",Xn=e,Xn}var Zn,ru;function Px(){if(ru)return Zn;ru=1;var r=Xr,e=La,t=me,n=F;function i(a,o){var s=n(a)?r:e;return s(a,t(o))}return Zn=i,Zn}var ei,nu;function Lx(){if(nu)return ei;nu=1;const r=Px(),e=gl,t=ie,{isObject:n}=M,i=ht,{formatDefault:a}=je;class o extends i{constructor(){super(...arguments)}createQuery(l,u,h){let d=(u?"create table if not exists ":"create table ")+this.tableName();h&&this.tableNameLike()?d+=" as select * from "+this.tableNameLike()+" where 0=1":(d+=" ("+l.sql.join(", "),d+=this.foreignKeys()||"",d+=this.primaryKeys()||"",d+=this._addChecks(),d+=")"),this.pushQuery(d),h&&this.addColumns(l,this.addColumnsPrefix)}addColumns(l,u,h){if(u===this.alterColumnsPrefix){const c=this,d=h.map(p=>{const g=this.client.customWrapIdentifier(p.getColumnName(),t,p.columnBuilder.queryContext()),_=p.getColumnType(),f=p.modified.defaultTo?a(p.modified.defaultTo[0],p.type,this.client):null,m=p.modified.nullable&&p.modified.nullable[0]===!1;return{name:g,type:_,defaultTo:f,notNull:m}});this.pushQuery({sql:`PRAGMA table_info(${this.tableName()})`,statementsProducer(p,g){return c.client.ddl(c,p,g).alterColumn(d)}})}else for(let c=0,d=l.sql.length;c<d;c++)this.pushQuery({sql:`alter table ${this.tableName()} add column ${l.sql[c]}`,bindings:l.bindings[c]})}dropUnique(l,u){u=u?this.formatter.wrap(u):this._indexCommand("unique",this.tableNameRaw,l),this.pushQuery(`drop index ${u}`)}dropForeign(l,u){const h=this;l=Array.isArray(l)?l:[l],l=l.map(c=>this.client.customWrapIdentifier(c,t)),u=this.client.customWrapIdentifier(u,t),this.pushQuery({sql:`PRAGMA table_info(${this.tableName()})`,output(c){return h.client.ddl(h,c,this.connection).dropForeign(l,u)}})}dropPrimary(l){const u=this;l=this.client.customWrapIdentifier(l,t),this.pushQuery({sql:`PRAGMA table_info(${this.tableName()})`,output(h){return u.client.ddl(u,h,this.connection).dropPrimary(l)}})}dropIndex(l,u){u=u?this.formatter.wrap(u):this._indexCommand("index",this.tableNameRaw,l),this.pushQuery(`drop index ${u}`)}unique(l,u){let h,c;n(u)&&({indexName:u,deferrable:h,predicate:c}=u),h&&h!=="not deferrable"&&this.client.logger.warn(`sqlite3: unique index \`${u}\` will not be deferrable ${h} because sqlite3 does not support deferred constraints.`),u=u?this.formatter.wrap(u):this._indexCommand("unique",this.tableNameRaw,l),l=this.formatter.columnize(l);const d=c?" "+this.client.queryCompiler(c).where():"";this.pushQuery(`create unique index ${u} on ${this.tableName()} (${l})${d}`)}index(l,u,h){u=u?this.formatter.wrap(u):this._indexCommand("index",this.tableNameRaw,l),l=this.formatter.columnize(l);let c;n(h)&&({predicate:c}=h);const d=c?" "+this.client.queryCompiler(c).where():"";this.pushQuery(`create index ${u} on ${this.tableName()} (${l})${d}`)}primary(l,u){const h=this;l=Array.isArray(l)?l:[l],l=l.map(d=>this.client.customWrapIdentifier(d,t));let c;n(u)&&({constraintName:u,deferrable:c}=u),c&&c!=="not deferrable"&&this.client.logger.warn(`sqlite3: primary key constraint \`${u}\` will not be deferrable ${c} because sqlite3 does not support deferred constraints.`),u=this.client.customWrapIdentifier(u,t),this.method!=="create"&&this.method!=="createIfNot"&&this.pushQuery({sql:`PRAGMA table_info(${this.tableName()})`,output(d){return h.client.ddl(h,d,this.connection).primary(l,u)}})}foreign(l){const u=this;this.method!=="create"&&this.method!=="createIfNot"&&(l.column=Array.isArray(l.column)?l.column:[l.column],l.column=l.column.map(h=>this.client.customWrapIdentifier(h,t)),l.inTable=this.client.customWrapIdentifier(l.inTable,t),l.references=Array.isArray(l.references)?l.references:[l.references],l.references=l.references.map(h=>this.client.customWrapIdentifier(h,t)),this.pushQuery({sql:`PRAGMA table_info(${this.tableName()})`,statementsProducer(h,c){return u.client.ddl(u,h,c).foreign(l)}}))}primaryKeys(){const l=r(this.grouped.alterTable||[],{method:"primary"});if(l.length>0&&l[0].args.length>0){const u=l[0].args[0];let h=l[0].args[1]||"";h&&(h=" constraint "+this.formatter.wrap(h));const c=this.grouped.columns.filter(d=>d.builder._type==="increments").length>0;return`,${h} ${c?"unique":"primary key"} (${this.formatter.columnize(u)})`}}foreignKeys(){let l="";const u=r(this.grouped.alterTable||[],{method:"foreign"});for(let h=0,c=u.length;h<c;h++){const d=u[h].args[0],p=this.formatter.columnize(d.column),g=this.formatter.columnize(d.references),_=this.formatter.wrap(d.inTable);let f=d.keyName||"";f&&(f=" constraint "+this.formatter.wrap(f)),l+=`,${f} foreign key(${p}) references ${_}(${g})`,d.onDelete&&(l+=` on delete ${d.onDelete}`),d.onUpdate&&(l+=` on update ${d.onUpdate}`)}return l}createTableBlock(){return this.getColumns().concat().join(",")}renameColumn(l,u){this.pushQuery({sql:`alter table ${this.tableName()} rename ${this.formatter.wrap(l)} to ${this.formatter.wrap(u)}`})}_setNullableState(l,u){const h=this;this.pushQuery({sql:`PRAGMA table_info(${this.tableName()})`,statementsProducer(c,d){return h.client.ddl(h,c,d).setNullable(l,u)}})}dropColumn(){const l=this,h=e(arguments).map(c=>this.client.customWrapIdentifier(c,t));this.pushQuery({sql:`PRAGMA table_info(${this.tableName()})`,output(c){return l.client.ddl(l,c,this.connection).dropColumn(h)}})}}return ei=o,ei}var ti,iu;function Bx(){if(iu)return ti;iu=1;const r=ft,{columnize:e}=K;class t extends r{constructor(i,a){super(i,a)}createOrReplace(){const i=this.columns,a=this.selectQuery.toString(),o=this.viewName(),s=i?" ("+e(i,this.viewBuilder,this.client,this.bindingsHolder)+")":"",l=`drop view if exists ${o}`,u=`create view ${o}${s} as ${a}`;this.pushQuery({sql:l}),this.pushQuery({sql:u})}}return ti=t,ti}var ri,su;function kx(){if(su)return ri;su=1;function r(s,l,u){return`INSERT INTO "${l}" SELECT ${u===void 0?"*":u.map(h=>`"${h}"`).join(", ")} FROM "${s}";`}function e(s){return`DROP TABLE "${s}"`}function t(s,l){return`ALTER TABLE "${s}" RENAME TO "${l}"`}function n(s){return`SELECT type, sql FROM sqlite_master WHERE (type='table' OR (type='index' AND sql IS NOT NULL)) AND tbl_name='${s}'`}function i(){return"PRAGMA foreign_keys"}function a(s){return`PRAGMA foreign_keys = ${s?"ON":"OFF"}`}function o(){return"PRAGMA foreign_key_check"}return ri={copyData:r,dropOriginal:e,renameTable:t,getTableSql:n,isForeignCheckEnabled:i,setForeignCheck:a,executeForeignCheck:o},ri}var ni,ou;function Mx(){if(ou)return ni;ou=1;function r(e,t){const n=new RegExp(Object.entries(t).map(([o,s])=>`(?<${o}>${s.source})`).join("|"),"yi");let i=0;const a=[];for(;i<e.length;){n.lastIndex=i;const o=e.match(n);if(o!==null){const[s,l]=Object.entries(o.groups).find(([u,h])=>h!==void 0);i+=l.length,s.startsWith("_")||a.push({type:s,text:l})}else throw new Error(`No matching tokenizer rule found at: [${e.substring(i)}]`)}return a}return ni={tokenize:r},ni}var ii,au;function jx(){if(au)return ii;au=1;function r(u,h=c=>c){return function({index:c=0,input:d}){let p=c;const g=[];for(const _ of u){const f=_({index:p,input:d});if(f.success)p=f.index,g.push(f.ast);else return f}return{success:!0,ast:h(g),index:p,input:d}}}function e(u,h=c=>c){return function({index:c=0,input:d}){for(const p of u){const g=p({index:c,input:d});if(g.success)return{success:!0,ast:h(g.ast),index:g.index,input:d}}return{success:!1,ast:null,index:c,input:d}}}function t(u,h=c=>c){return function({index:c=0,input:d}){let p={},g=c;const _=[];do p=u({index:g,input:d}),p.success&&(g=p.index,_.push(p.ast));while(p.success);return _.length>0?{success:!0,ast:h(_),index:g,input:d}:{success:!1,ast:null,index:g,input:d}}}function n(u,h=c=>c){return function({index:c=0,input:d}){const p=u({index:c,input:d});return p.success?{success:!0,ast:h(p.ast),index:p.index,input:d}:{success:!0,ast:h(null),index:c,input:d}}}function i(u,h=c=>c){return function({index:c=0,input:d}){const p=u.do({index:c,input:d});return p.success&&u.next({index:p.index,input:d}).success?{success:!0,ast:h(p.ast),index:p.index,input:d}:{success:!1,ast:null,index:c,input:d}}}function a(u,h=c=>c){return function({index:c=0,input:d}){const p=u.do({index:c,input:d});return p.success&&!u.not({index:c,input:d}).success?{success:!0,ast:h(p.ast),index:p.index,input:d}:{success:!1,ast:null,index:c,input:d}}}function o(u,h=c=>c.text){return function({index:c=0,input:d}){const p=d[c];return p!==void 0&&(u.type===void 0||u.type===p.type)&&(u.text===void 0||u.text.toUpperCase()===p.text.toUpperCase())?{success:!0,ast:h(p),index:c+1,input:d}:{success:!1,ast:null,index:c,input:d}}}return ii={s:r,a:e,m:t,o:n,l:i,n:a,t:o,e:function({index:u=0,input:h}){return{success:!0,ast:null,index:u,input:h}},f:function({index:u=0,input:h}){return{success:u===h.length,ast:null,index:u,input:h}}},ii}var si,lu;function Qx(){if(lu)return si;lu=1;const{tokenize:r}=Mx(),{s:e,a:t,m:n,o:i,l:a,n:o,t:s,e:l,f:u}=jx(),h={keyword:/(?:ABORT|ACTION|ADD|AFTER|ALL|ALTER|ALWAYS|ANALYZE|AND|AS|ASC|ATTACH|AUTOINCREMENT|BEFORE|BEGIN|BETWEEN|BY|CASCADE|CASE|CAST|CHECK|COLLATE|COLUMN|COMMIT|CONFLICT|CONSTRAINT|CREATE|CROSS|CURRENT|CURRENT_DATE|CURRENT_TIME|CURRENT_TIMESTAMP|DATABASE|DEFAULT|DEFERRED|DEFERRABLE|DELETE|DESC|DETACH|DISTINCT|DO|DROP|END|EACH|ELSE|ESCAPE|EXCEPT|EXCLUSIVE|EXCLUDE|EXISTS|EXPLAIN|FAIL|FILTER|FIRST|FOLLOWING|FOR|FOREIGN|FROM|FULL|GENERATED|GLOB|GROUP|GROUPS|HAVING|IF|IGNORE|IMMEDIATE|IN|INDEX|INDEXED|INITIALLY|INNER|INSERT|INSTEAD|INTERSECT|INTO|IS|ISNULL|JOIN|KEY|LAST|LEFT|LIKE|LIMIT|MATCH|MATERIALIZED|NATURAL|NO|NOT|NOTHING|NOTNULL|NULL|NULLS|OF|OFFSET|ON|OR|ORDER|OTHERS|OUTER|OVER|PARTITION|PLAN|PRAGMA|PRECEDING|PRIMARY|QUERY|RAISE|RANGE|RECURSIVE|REFERENCES|REGEXP|REINDEX|RELEASE|RENAME|REPLACE|RESTRICT|RETURNING|RIGHT|ROLLBACK|ROW|ROWS|SAVEPOINT|SELECT|SET|TABLE|TEMP|TEMPORARY|THEN|TIES|TO|TRANSACTION|TRIGGER|UNBOUNDED|UNION|UNIQUE|UPDATE|USING|VACUUM|VALUES|VIEW|VIRTUAL|WHEN|WHERE|WINDOW|WITH|WITHOUT)(?=\s+|-|\(|\)|;|\+|\*|\/|%|==|=|<=|<>|<<|<|>=|>>|>|!=|,|&|~|\|\||\||\.)/,id:/"[^"]*(?:""[^"]*)*"|`[^`]*(?:``[^`]*)*`|\[[^[\]]*\]|[a-z_][a-z0-9_$]*/,string:/'[^']*(?:''[^']*)*'/,blob:/x'(?:[0-9a-f][0-9a-f])+'/,numeric:/(?:\d+(?:\.\d*)?|\.\d+)(?:e(?:\+|-)?\d+)?|0x[0-9a-f]+/,variable:/\?\d*|[@$:][a-z0-9_$]+/,operator:/-|\(|\)|;|\+|\*|\/|%|==|=|<=|<>|<<|<|>=|>>|>|!=|,|&|~|\|\||\||\./,_ws:/\s+/};function c(O){const b=p({input:r(O,h)});if(!b.success)throw new Error(`Parsing CREATE TABLE failed at [${b.input.slice(b.index).map(x=>x.text).join(" ")}] of "${O}"`);return b.ast}function d(O){const b=kt({input:r(O,h)});if(!b.success)throw new Error(`Parsing CREATE INDEX failed at [${b.input.slice(b.index).map(x=>x.text).join(" ")}] of "${O}"`);return b.ast}function p(O){return e([s({text:"CREATE"},b=>null),g,s({text:"TABLE"},b=>null),de,fe,A,s({text:"("},b=>null),f,ee,s({text:")"},b=>null),_,u],b=>Object.assign({},...b.filter(x=>x!==null)))(O)}function g(O){return t([s({text:"TEMP"}),s({text:"TEMPORARY"}),l],b=>({temporary:b!==null}))(O)}function _(O){return i(e([s({text:"WITHOUT"}),s({text:"ROWID"})]),b=>({rowid:b!==null}))(O)}function f(O){return t([e([m,s({text:","}),f],b=>({columns:[b[0]].concat(b[2].columns)})),e([m],b=>({columns:[b[0]]}))])(O)}function m(O){return e([e([qe],b=>({name:b[0]})),y,w],b=>Object.assign({},...b))(O)}function y(O){return i(e([n(s({type:"id"})),t([e([s({text:"("}),Pr,s({text:","}),Pr,s({text:")"})],b=>`(${b[1]}, ${b[3]})`),e([s({text:"("}),Pr,s({text:")"})],b=>`(${b[1]})`),l])],b=>`${b[0].join(" ")}${b[1]||""}`),b=>({type:b}))(O)}function w(O){return i(n($),b=>({constraints:Object.assign({primary:null,notnull:null,null:null,unique:null,check:null,default:null,collate:null,references:null,as:null},...b||[])}))(O)}function $(O){return t([E,T,N,P,L,G,H,Q,_e])(O)}function E(O){return e([Y,s({text:"PRIMARY"},b=>null),s({text:"KEY"},b=>null),ks,Z,C],b=>({primary:Object.assign({},...b.filter(x=>x!==null))}))(O)}function C(O){return i(s({text:"AUTOINCREMENT"}),b=>({autoincrement:b!==null}))(O)}function T(O){return e([Y,s({text:"NOT"},b=>null),s({text:"NULL"},b=>null),Z],b=>({notnull:Object.assign({},...b.filter(x=>x!==null))}))(O)}function N(O){return e([Y,s({text:"NULL"},b=>null),Z],b=>({null:Object.assign({},...b.filter(x=>x!==null))}))(O)}function P(O){return e([Y,s({text:"UNIQUE"},b=>null),Z],b=>({unique:Object.assign({},...b.filter(x=>x!==null))}))(O)}function L(O){return e([Y,s({text:"CHECK"},b=>null),s({text:"("},b=>null),e([ze],b=>({expression:b[0]})),s({text:")"},b=>null)],b=>({check:Object.assign({},...b.filter(x=>x!==null))}))(O)}function G(O){return e([Y,s({text:"DEFAULT"},b=>null),t([e([s({text:"("}),ze,s({text:")"})],b=>({value:b[1],expression:!0})),e([m0],b=>({value:b[0],expression:!1})),e([Pr],b=>({value:b[0],expression:!1}))])],b=>({default:Object.assign({},...b.filter(x=>x!==null))}))(O)}function H(O){return e([Y,s({text:"COLLATE"},b=>null),s({type:"id"},b=>({collation:b.text}))],b=>({collate:Object.assign({},...b.filter(x=>x!==null))}))(O)}function Q(O){return e([Y,e([Lt],b=>b[0].references)],b=>({references:Object.assign({},...b.filter(x=>x!==null))}))(O)}function _e(O){return e([Y,i(e([s({text:"GENERATED"}),s({text:"ALWAYS"})]),b=>({generated:b!==null})),s({text:"AS"},b=>null),s({text:"("},b=>null),e([ze],b=>({expression:b[0]})),s({text:")"},b=>null),t([s({text:"STORED"}),s({text:"VIRTUAL"}),l],b=>({mode:b?b.toUpperCase():null}))],b=>({as:Object.assign({},...b.filter(x=>x!==null))}))(O)}function ee(O){return i(n(e([s({text:","}),se],b=>b[1])),b=>({constraints:b||[]}))(O)}function se(O){return t([te,W,We,Ir])(O)}function te(O){return e([Y,s({text:"PRIMARY"},b=>null),s({text:"KEY"},b=>null),s({text:"("},b=>null),oe,s({text:")"},b=>null),Z],b=>Object.assign({type:"PRIMARY KEY"},...b.filter(x=>x!==null)))(O)}function W(O){return e([Y,s({text:"UNIQUE"},b=>null),s({text:"("},b=>null),oe,s({text:")"},b=>null),Z],b=>Object.assign({type:"UNIQUE"},...b.filter(x=>x!==null)))(O)}function Z(O){return i(e([s({text:"ON"}),s({text:"CONFLICT"}),t([s({text:"ROLLBACK"}),s({text:"ABORT"}),s({text:"FAIL"}),s({text:"IGNORE"}),s({text:"REPLACE"})])],b=>b[2]),b=>({conflict:b?b.toUpperCase():null}))(O)}function We(O){return e([Y,s({text:"CHECK"},b=>null),s({text:"("},b=>null),e([ze],b=>({expression:b[0]})),s({text:")"},b=>null)],b=>Object.assign({type:"CHECK"},...b.filter(x=>x!==null)))(O)}function Ir(O){return e([Y,s({text:"FOREIGN"},b=>null),s({text:"KEY"},b=>null),s({text:"("},b=>null),pt,s({text:")"},b=>null),Lt],b=>Object.assign({type:"FOREIGN KEY"},...b.filter(x=>x!==null)))(O)}function Lt(O){return e([s({text:"REFERENCES"},b=>null),A,xs,i(n(t([Is,Bt,Ps])),b=>Object.assign({delete:null,update:null,match:null},...b||[])),Ls],b=>({references:Object.assign({},...b.filter(x=>x!==null))}))(O)}function xs(O){return i(e([s({text:"("}),pt,s({text:")"})],b=>b[1]),b=>({columns:b?b.columns:[]}))(O)}function pt(O){return e([i(n(e([qe,s({text:","})],b=>b[0])),b=>b!==null?b:[]),qe],b=>({columns:b[0].concat([b[1]])}))(O)}function Is(O){return e([s({text:"ON"}),s({text:"DELETE"}),Qc],b=>({delete:b[2]}))(O)}function Bt(O){return e([s({text:"ON"}),s({text:"UPDATE"}),Qc],b=>({update:b[2]}))(O)}function Ps(O){return e([s({text:"MATCH"}),t([s({type:"keyword"}),s({type:"id"})])],b=>({match:b[1]}))(O)}function Ls(O){return i(e([i(s({text:"NOT"})),s({text:"DEFERRABLE"}),i(e([s({text:"INITIALLY"}),t([s({text:"DEFERRED"}),s({text:"IMMEDIATE"})])],b=>b[1].toUpperCase()))]),b=>({deferrable:b?{not:b[0]!==null,initially:b[2]}:null}))(O)}function Y(O){return i(e([s({text:"CONSTRAINT"}),qe],b=>b[1]),b=>({name:b}))(O)}function kt(O){return e([s({text:"CREATE"},b=>null),Bs,s({text:"INDEX"},b=>null),de,fe,v,s({text:"ON"},b=>null),A,s({text:"("},b=>null),oe,s({text:")"},b=>null),V,u],b=>Object.assign({},...b.filter(x=>x!==null)))(O)}function Bs(O){return i(s({text:"UNIQUE"}),b=>({unique:b!==null}))(O)}function de(O){return i(e([s({text:"IF"}),s({text:"NOT"}),s({text:"EXISTS"})]),b=>({exists:b!==null}))(O)}function fe(O){return i(e([qe,s({text:"."})],b=>b[0]),b=>({schema:b}))(O)}function v(O){return e([qe],b=>({index:b[0]}))(O)}function A(O){return e([qe],b=>({table:b[0]}))(O)}function V(O){return i(e([s({text:"WHERE"}),ze],b=>b[1]),b=>({where:b}))(O)}function oe(O){return t([e([kc,s({text:","}),oe],b=>({columns:[b[0]].concat(b[2].columns)})),e([Mc,s({text:","}),oe],b=>({columns:[b[0]].concat(b[2].columns)})),a({do:kc,next:s({text:")"})},b=>({columns:[b]})),a({do:Mc,next:s({text:")"})},b=>({columns:[b]}))])(O)}function kc(O){return e([e([qe],b=>({name:b[0],expression:!1})),jc,ks],b=>Object.assign({},...b.filter(x=>x!==null)))(O)}function Mc(O){return e([e([p0],b=>({name:b[0],expression:!0})),jc,ks],b=>Object.assign({},...b.filter(x=>x!==null)))(O)}function jc(O){return i(e([s({text:"COLLATE"}),s({type:"id"})],b=>b[1]),b=>({collation:b}))(O)}function ks(O){return t([s({text:"ASC"}),s({text:"DESC"}),l],b=>({order:b?b.toUpperCase():null}))(O)}function p0(O){return n(t([o({do:s({type:"keyword"}),not:t([s({text:"COLLATE"}),s({text:"ASC"}),s({text:"DESC"})])}),s({type:"id"}),s({type:"string"}),s({type:"blob"}),s({type:"numeric"}),s({type:"variable"}),o({do:s({type:"operator"}),not:t([s({text:"("}),s({text:")"}),s({text:","})])}),e([s({text:"("}),i(ze),s({text:")"})],b=>b[1]||[])]))(O)}function ze(O){return n(t([s({type:"keyword"}),s({type:"id"}),s({type:"string"}),s({type:"blob"}),s({type:"numeric"}),s({type:"variable"}),o({do:s({type:"operator"}),not:t([s({text:"("}),s({text:")"})])}),e([s({text:"("}),i(ze),s({text:")"})],b=>b[1]||[])]))(O)}function qe(O){return t([s({type:"id"}),s({type:"string"})],b=>/^["`['][^]*["`\]']$/.test(b)?b.substring(1,b.length-1):b)(O)}function Qc(O){return t([e([s({text:"SET"}),s({text:"NULL"})],b=>`${b[0]} ${b[1]}`),e([s({text:"SET"}),s({text:"DEFAULT"})],b=>`${b[0]} ${b[1]}`),s({text:"CASCADE"}),s({text:"RESTRICT"}),e([s({text:"NO"}),s({text:"ACTION"})],b=>`${b[0]} ${b[1]}`)],b=>b.toUpperCase())(O)}function m0(O){return t([s({type:"numeric"}),s({type:"string"}),s({type:"id"}),s({type:"blob"}),s({text:"NULL"}),s({text:"TRUE"}),s({text:"FALSE"}),s({text:"CURRENT_TIME"}),s({text:"CURRENT_DATE"}),s({text:"CURRENT_TIMESTAMP"})])(O)}function Pr(O){return e([t([s({text:"+"}),s({text:"-"}),l]),s({type:"numeric"})],b=>`${b[0]||""}${b[1]}`)(O)}return si={parseCreateTable:c,parseCreateIndex:d},si}var oi,uu;function Dx(){if(uu)return oi;uu=1;function r(v,A=V=>V){return t(v,A)}function e(v,A=V=>V){return Z(v,A)}function t(v,A){return`CREATE${n(v)} TABLE${Ir(v)} ${Lt(v,A)}${pt(v,A)} (${a(v,A)}${w(v,A)})${i(v)}`}function n(v,A){return v.temporary?" TEMP":""}function i(v,A){return v.rowid?" WITHOUT ROWID":""}function a(v,A){return v.columns.map(V=>o(V,A)).join(", ")}function o(v,A){return`${fe(v.name,A)}${s(v)}${l(v.constraints,A)}`}function s(v,A){return v.type!==null?` ${v.type}`:""}function l(v,A){return`${u(v,A)}${c(v,A)}${d(v,A)}${p(v,A)}${g(v,A)}${_(v,A)}${f(v,A)}${m(v,A)}${y(v,A)}`}function u(v,A){return v.primary!==null?` ${W(v.primary,A)}PRIMARY KEY${kt(v.primary)}${T(v.primary)}${h(v.primary)}`:""}function h(v,A){return v.autoincrement?" AUTOINCREMENT":""}function c(v,A){return v.notnull!==null?` ${W(v.notnull,A)}NOT NULL${T(v.notnull)}`:""}function d(v,A){return v.null!==null?` ${W(v.null,A)}NULL${T(v.null)}`:""}function p(v,A){return v.unique!==null?` ${W(v.unique,A)}UNIQUE${T(v.unique)}`:""}function g(v,A){return v.check!==null?` ${W(v.check,A)}CHECK (${de(v.check.expression)})`:""}function _(v,A){return v.default!==null?` ${W(v.default,A)}DEFAULT ${v.default.expression?`(${de(v.default.value)})`:v.default.value}`:""}function f(v,A){return v.collate!==null?` ${W(v.collate,A)}COLLATE ${v.collate.collation}`:""}function m(v,A){return v.references!==null?` ${W(v.references,A)}${L(v.references,A)}`:""}function y(v,A){return v.as!==null?` ${W(v.as,A)}${v.as.generated?"GENERATED ALWAYS ":""}AS (${de(v.as.expression)})${v.as.mode!==null?` ${v.as.mode}`:""}`:""}function w(v,A){return v.constraints.reduce((V,oe)=>`${V}, ${$(oe,A)}`,"")}function $(v,A){switch(v.type){case"PRIMARY KEY":return E(v,A);case"UNIQUE":return C(v,A);case"CHECK":return N(v,A);case"FOREIGN KEY":return P(v,A)}}function E(v,A){return`${W(v,A)}PRIMARY KEY (${Bt(v,A)})${T(v)}`}function C(v,A){return`${W(v,A)}UNIQUE (${Bt(v,A)})${T(v)}`}function T(v,A){return v.conflict!==null?` ON CONFLICT ${v.conflict}`:""}function N(v,A){return`${W(v,A)}CHECK (${de(v.expression)})`}function P(v,A){return`${W(v,A)}FOREIGN KEY (${H(v,A)}) ${L(v.references,A)}`}function L(v,A){return`REFERENCES ${pt(v,A)}${G(v,A)}${Q(v)}${te(v.deferrable)}`}function G(v,A){return v.columns.length>0?` (${H(v,A)})`:""}function H(v,A){return v.columns.map(V=>fe(V,A)).join(", ")}function Q(v,A){return`${_e(v)}${ee(v)}${se(v)}`}function _e(v,A){return v.delete!==null?` ON DELETE ${v.delete}`:""}function ee(v,A){return v.update!==null?` ON UPDATE ${v.update}`:""}function se(v,A){return v.match!==null?` MATCH ${v.match}`:""}function te(v,A){return v!==null?` ${v.not?"NOT ":""}DEFERRABLE${v.initially!==null?` INITIALLY ${v.initially}`:""}`:""}function W(v,A){return v.name!==null?`CONSTRAINT ${fe(v.name,A)} `:""}function Z(v,A){return`CREATE${We(v)} INDEX${Ir(v)} ${Lt(v,A)}${xs(v,A)} on ${pt(v,A)} (${Bt(v,A)})${Is(v)}`}function We(v,A){return v.unique?" UNIQUE":""}function Ir(v,A){return v.exists?" IF NOT EXISTS":""}function Lt(v,A){return v.schema!==null?`${fe(v.schema,A)}.`:""}function xs(v,A){return fe(v.index,A)}function pt(v,A){return fe(v.table,A)}function Is(v,A){return v.where!==null?` where ${de(v.where)}`:""}function Bt(v,A){return v.columns.map(V=>V.expression?Ls(V):Ps(V,A)).join(", ")}function Ps(v,A){return`${fe(v.name,A)}${Y(v)}${kt(v)}`}function Ls(v,A){return`${Bs(v.name)}${Y(v)}${kt(v)}`}function Y(v,A){return v.collation!==null?` COLLATE ${v.collation}`:""}function kt(v,A){return v.order!==null?` ${v.order}`:""}function Bs(v,A){return de(v)}function de(v,A){return v.reduce((V,oe)=>Array.isArray(oe)?`${V}(${de(oe)})`:V?`${V} ${oe}`:oe,"")}function fe(v,A){return A(v)}return oi={compileCreateTable:r,compileCreateIndex:e},oi}var ai,cu;function Fx(){if(cu)return ai;cu=1;function r(t,n){return t.toLowerCase()===n.toLowerCase()}function e(t,n){return t.some(i=>r(i,n))}return ai={isEqualId:r,includesId:e},ai}var li,hu;function Ux(){if(hu)return li;hu=1;const r=ie,{nanonum:e}=In,{copyData:t,dropOriginal:n,renameTable:i,getTableSql:a,isForeignCheckEnabled:o,setForeignCheck:s,executeForeignCheck:l}=kx(),{parseCreateTable:u,parseCreateIndex:h}=Qx(),{compileCreateTable:c,compileCreateIndex:d}=Dx(),{isEqualId:p,includesId:g}=Fx();class _{constructor(m,y,w,$){this.client=m,this.tableCompiler=y,this.pragma=w,this.tableNameRaw=this.tableCompiler.tableNameRaw,this.alteredName=`_knex_temp_alter${e(3)}`,this.connection=$,this.formatter=E=>this.client.customWrapIdentifier(E,r),this.wrap=E=>this.client.wrapIdentifierImpl(E)}tableName(){return this.formatter(this.tableNameRaw)}getTableSql(){const m=this.tableName();return this.client.transaction(async y=>{y.disableProcessing();const w=await y.raw(a(m));return y.enableProcessing(),{createTable:w.filter($=>$.type==="table")[0].sql,createIndices:w.filter($=>$.type==="index").map($=>$.sql)}},{connection:this.connection})}async isForeignCheckEnabled(){return(await this.client.raw(o()).connection(this.connection))[0].foreign_keys===1}async setForeignCheck(m){await this.client.raw(s(m)).connection(this.connection)}renameTable(m){return m.raw(i(this.alteredName,this.tableName()))}dropOriginal(m){return m.raw(n(this.tableName()))}copyData(m,y){return m.raw(t(this.tableName(),this.alteredName,y))}async alterColumn(m){const{createTable:y,createIndices:w}=await this.getTableSql(),$=u(y);$.table=this.alteredName,$.columns=$.columns.map(C=>{const T=m.find(N=>p(N.name,C.name));return T&&(C.type=T.type,C.constraints.default=T.defaultTo!==null?{name:null,value:T.defaultTo,expression:!1}:null,C.constraints.notnull=T.notNull?{name:null,conflict:null}:null,C.constraints.null=T.notNull?null:C.constraints.null),C});const E=c($,this.wrap);return this.generateAlterCommands(E,w)}async dropColumn(m){const{createTable:y,createIndices:w}=await this.getTableSql(),$=u(y);if($.table=this.alteredName,$.columns=$.columns.filter(N=>N.expression||!g(m,N.name)),$.columns.length===0)throw new Error("Unable to drop last column from table");$.constraints=$.constraints.filter(N=>N.type==="PRIMARY KEY"||N.type==="UNIQUE"?N.columns.every(P=>P.expression||!g(m,P.name)):N.type==="FOREIGN KEY"?N.columns.every(P=>!g(m,P))&&(N.references.table!==$.table||N.references.columns.every(P=>!g(m,P))):!0);const E=$.columns.map(N=>N.name),C=c($,this.wrap),T=[];for(const N of w){const P=h(N);P.columns=P.columns.filter(L=>L.expression||!g(m,L.name)),P.columns.length>0&&T.push(d(P,this.wrap))}return this.alter(C,T,E)}async dropForeign(m,y){const{createTable:w,createIndices:$}=await this.getTableSql(),E=u(w);E.table=this.alteredName,y||(E.columns=E.columns.map(T=>({...T,references:g(m,T.name)?null:T.references}))),E.constraints=E.constraints.filter(T=>T.type==="FOREIGN KEY"?y?!T.name||!p(T.name,y):T.columns.every(N=>!g(m,N)):!0);const C=c(E,this.wrap);return this.alter(C,$)}async dropPrimary(m){const{createTable:y,createIndices:w}=await this.getTableSql(),$=u(y);$.table=this.alteredName,$.columns=$.columns.map(C=>({...C,primary:null})),$.constraints=$.constraints.filter(C=>C.type==="PRIMARY KEY"?m?!C.name||!p(C.name,m):!1:!0);const E=c($,this.wrap);return this.alter(E,w)}async primary(m,y){const{createTable:w,createIndices:$}=await this.getTableSql(),E=u(w);E.table=this.alteredName,E.columns=E.columns.map(T=>({...T,primary:null})),E.constraints=E.constraints.filter(T=>T.type!=="PRIMARY KEY"),E.constraints.push({type:"PRIMARY KEY",name:y||null,columns:m.map(T=>({name:T,expression:!1,collation:null,order:null})),conflict:null});const C=c(E,this.wrap);return this.alter(C,$)}async foreign(m){const{createTable:y,createIndices:w}=await this.getTableSql(),$=u(y);$.table=this.alteredName,$.constraints.push({type:"FOREIGN KEY",name:m.keyName||null,columns:m.column,references:{table:m.inTable,columns:m.references,delete:m.onDelete||null,update:m.onUpdate||null,match:null,deferrable:null}});const E=c($,this.wrap);return this.generateAlterCommands(E,w)}async setNullable(m,y){const{createTable:w,createIndices:$}=await this.getTableSql(),E=u(w);E.table=this.alteredName;const C=E.columns.find(N=>p(m,N.name));if(!C)throw new Error(`.setNullable: Column ${m} does not exist in table ${this.tableName()}.`);C.constraints.notnull=y?null:{name:null,conflict:null},C.constraints.null=y?C.constraints.null:null;const T=c(E,this.wrap);return this.generateAlterCommands(T,$)}async alter(m,y,w){const $=await this.isForeignCheckEnabled();$&&await this.setForeignCheck(!1);try{await this.client.transaction(async E=>{await E.raw(m),await this.copyData(E,w),await this.dropOriginal(E),await this.renameTable(E);for(const C of y)await E.raw(C);if($&&(await E.raw(l())).length>0)throw new Error("FOREIGN KEY constraint failed")},{connection:this.connection})}finally{$&&await this.setForeignCheck(!0)}}async generateAlterCommands(m,y,w){const $=[],E=[],C=[];let T=null;$.push(m),$.push(t(this.tableName(),this.alteredName,w)),$.push(n(this.tableName())),$.push(i(this.alteredName,this.tableName()));for(const P of y)$.push(P);return await this.isForeignCheckEnabled()&&(E.push(s(!1)),C.push(s(!0)),T=l()),{pre:E,sql:$,check:T,post:C}}}return li=_,li}var ui,du;function Hx(){if(du)return ui;du=1;const r=Ee;return ui=class extends r{withMaterialized(t,n,i){return this._validateWithArgs(t,n,i,"with"),this.withWrapped(t,n,i,!0)}withNotMaterialized(t,n,i){return this._validateWithArgs(t,n,i,"with"),this.withWrapped(t,n,i,!1)}},ui}var ci,fu;function pu(){if(fu)return ci;fu=1;const r=Wo,e=Qe,{promisify:t}=I,n=He,i=at,a=Nx(),o=qx(),s=xx(),l=Ix(),u=Lx(),h=Bx(),c=Ux(),d=Rr,p=Hx();class g extends n{constructor(f){super(f),f.connection&&f.connection.filename===void 0&&this.logger.warn("Could not find `connection.filename` in config. Please specify the database path and name to avoid errors. (see docs https://knexjs.org/guide/#configuration-options)"),f.useNullAsDefault===void 0&&this.logger.warn("sqlite does not support inserting default values. Set the `useNullAsDefault` flag to hide this warning. (see docs https://knexjs.org/guide/query-builder.html#insert).")}_driver(){return I}schemaCompiler(){return new s(this,...arguments)}transaction(){return new a(this,...arguments)}queryCompiler(f,m){return new o(this,f,m)}queryBuilder(){return new p(this)}viewCompiler(f,m){return new h(this,f,m)}columnCompiler(){return new l(this,...arguments)}tableCompiler(){return new u(this,...arguments)}ddl(f,m,y){return new c(this,f,m,y)}wrapIdentifierImpl(f){return f!=="*"?`\`${f.replace(/`/g,"``")}\``:"*"}acquireRawConnection(){return new Promise((f,m)=>{let y=this.driver.OPEN_READWRITE|this.driver.OPEN_CREATE;if(this.connectionSettings.flags){if(!Array.isArray(this.connectionSettings.flags))throw new Error("flags must be an array of strings");this.connectionSettings.flags.forEach($=>{if(!$.startsWith("OPEN_")||!this.driver[$])throw new Error(`flag ${$} not supported by node-sqlite3`);y=y|this.driver[$]})}const w=new this.driver.Database(this.connectionSettings.filename,y,$=>{if($)return m($);f(w)})})}async destroyRawConnection(f){return t(y=>f.close(y))()}_query(f,m){if(!m.sql)throw new Error("The query is empty");const{method:y}=m;let w;switch(y){case"insert":case"update":w=m.returning?"all":"run";break;case"counter":case"del":w="run";break;default:w="all"}return new Promise(function($,E){if(!f||!f[w])return E(new Error(`Error calling ${w} on connection.`));f[w](m.sql,m.bindings,function(C,T){return C?E(C):(m.response=T,m.context=this,$(m))})})}_stream(f,m,y){if(!m.sql)throw new Error("The query is empty");const w=this;return new Promise(function($,E){return y.on("error",E),y.on("end",$),w._query(f,m).then(C=>C.response).then(C=>C.forEach(T=>y.write(T))).catch(function(C){y.emit("error",C)}).then(function(){y.end()})})}processResponse(f,m){const y=f.context,{response:w,returning:$}=f;if(f.output)return f.output.call(m,w);switch(f.method){case"select":return w;case"first":return w[0];case"pluck":return e(w,f.pluck);case"insert":return $&&w?w:[y.lastID];case"update":return $&&w?w:y.changes;case"del":case"counter":return y.changes;default:return w}}poolDefaults(){return r({min:1,max:1},super.poolDefaults())}formatter(f){return new d(this,f)}values(f,m,y){return Array.isArray(f)?Array.isArray(f[0])?`( values ${f.map(w=>`(${this.parameterize(w,void 0,m,y)})`).join(", ")})`:`(${this.parameterize(f,void 0,m,y)})`:f instanceof i?`(${this.parameter(f,m,y)})`:this.parameter(f,m,y)}}return Object.assign(g.prototype,{dialect:"sqlite3",driverName:"sqlite3"}),ci=g,ci}var hi,mu;function Vx(){if(mu)return hi;mu=1;const r=pu();class e extends r{_driver(){return I}async acquireRawConnection(){return new this.driver(this.connectionSettings.filename)}async destroyRawConnection(n){return n.close()}async _query(n,i){if(!i.sql)throw new Error("The query is empty");if(!n)throw new Error("No connection provided");const a=n.prepare(i.sql),o=this._formatBindings(i.bindings);if(a.reader){const l=await a.all(o);return i.response=l,i}const s=await a.run(o);return i.response=s,i.context={lastID:s.lastInsertRowid,changes:s.changes},i}_formatBindings(n){return n?n.map(i=>i instanceof Date?i.valueOf():typeof i=="boolean"?Number(i):i):[]}}return Object.assign(e.prototype,{driverName:"better-sqlite3"}),hi=e,hi}var di,gu;function yu(){if(gu)return di;gu=1;const r=Ce;class e extends r{begin(n){return this.isolationLevel?this.query(n,`BEGIN ISOLATION LEVEL ${this.isolationLevel};`):this.query(n,"BEGIN;")}}return di=e,di}var fi,bu;function pi(){if(bu)return fi;bu=1;const r=ie,e=At,t=De,{wrapString:n,columnize:i,operator:a,wrap:o}=K;class s extends t{constructor(u,h,c){super(u,h,c),this._defaultInsertValue="default"}truncate(){return`truncate ${this.tableName} restart identity`}insert(){let u=super.insert();if(u==="")return u;const{returning:h,onConflict:c,ignore:d,merge:p,insert:g}=this.single;if(c&&d&&(u+=this._ignore(c)),c&&p){u+=this._merge(p.updates,c,g);const _=this.where();_&&(u+=` ${_}`)}return h&&(u+=this._returning(h)),{sql:u,returning:h}}update(){const u=this.with(),h=this._prepUpdate(this.single.update),c=this.where(),{returning:d}=this.single;return{sql:u+`update ${this.single.only?"only ":""}${this.tableName} set ${h.join(", ")}`+(c?` ${c}`:"")+this._returning(d),returning:d}}using(){const u=this.single.using;if(!u)return;let h="using ";return Array.isArray(u)?h+=u.map(c=>this.formatter.wrap(c)).join(","):h+=this.formatter.wrap(u),h}del(){const{tableName:u}=this,h=this.with();let c=this.where()||"",d=this.using()||"";const p=this.grouped.join,g=[];if(Array.isArray(p)){for(const m of p){g.push(o(this._joinTable(m),void 0,this.builder,this.client,this.bindingsHolder));const y=[];for(const w of m.clauses)y.push(this.whereBasic({column:w.column,operator:"=",value:w.value,asColumn:!0}));y.length>0&&(c+=(c?" and ":"where ")+y.join(" and "))}g.length>0&&(d+=(d?",":"using ")+g.join(","))}const _=h+`delete from ${this.single.only?"only ":""}${u}`+(d?` ${d}`:"")+(c?` ${c}`:""),{returning:f}=this.single;return{sql:_+this._returning(f),returning:f}}aggregate(u){return this._aggregate(u,{distinctParentheses:!0})}_returning(u){return u?` returning ${this.formatter.columnize(u)}`:""}_ignore(u){return u===!0?" on conflict do nothing":` on conflict ${this._onConflictClause(u)} do nothing`}_merge(u,h,c){let d=` on conflict ${this._onConflictClause(h)} do update set `;if(u&&Array.isArray(u))return d+=u.map(p=>n(p.split(".").pop(),this.formatter.builder,this.client,this.formatter)).map(p=>`${p} = excluded.${p}`).join(", "),d;if(u&&typeof u=="object"){const p=this._prepUpdate(u);return typeof p=="string"?d+=p:d+=p.join(","),d}else{const p=this._prepInsert(c);if(typeof p=="string")throw new Error("If using merge with a raw insert query, then updates must be provided");return d+=p.columns.map(g=>n(g.split(".").pop(),this.builder,this.client)).map(g=>`${g} = excluded.${g}`).join(", "),d}}_tableNames(u){const h=this.single.schema,c=[];for(let d=0;d<u.length;d++){let p=u[d];p&&(h&&(p=`${h}.${p}`),c.push(this.formatter.wrap(p)))}return c.join(", ")}_lockingClause(u){const h=this.single.lockTables||[];return u+(h.length?" of "+this._tableNames(h):"")}_groupOrder(u,h){return super._groupOrderNulls(u,h)}forUpdate(){return this._lockingClause("for update")}forShare(){return this._lockingClause("for share")}forNoKeyUpdate(){return this._lockingClause("for no key update")}forKeyShare(){return this._lockingClause("for key share")}skipLocked(){return"skip locked"}noWait(){return"nowait"}columnInfo(){const u=this.single.columnInfo;let h=this.single.schema;const c=this.client.customWrapIdentifier(this.single.table,r);h&&(h=this.client.customWrapIdentifier(h,r));const d="select * from information_schema.columns where table_name = ? and table_catalog = current_database()",p=[c];return this._buildColumnInfoQuery(h,d,p,u)}_buildColumnInfoQuery(u,h,c,d){return u?(h+=" and table_schema = ?",c.push(u)):h+=" and table_schema = current_schema()",{sql:h,bindings:c,output(p){const g=e(p.rows,function(_,f){return _[f.column_name]={type:f.data_type,maxLength:f.character_maximum_length,nullable:f.is_nullable==="YES",defaultValue:f.column_default},_},{});return d&&g[d]||g}}}distinctOn(u){return"distinct on ("+this.formatter.columnize(u)+") "}jsonExtract(u){return this._jsonExtract("jsonb_path_query",u)}jsonSet(u){return this._jsonSet("jsonb_set",Object.assign({},u,{path:this.client.toPathForJson(u.path)}))}jsonInsert(u){return this._jsonSet("jsonb_insert",Object.assign({},u,{path:this.client.toPathForJson(u.path)}))}jsonRemove(u){const h=`${i(u.column,this.builder,this.client,this.bindingsHolder)} #- ${this.client.parameter(this.client.toPathForJson(u.path),this.builder,this.bindingsHolder)}`;return u.alias?this.client.alias(h,this.formatter.wrap(u.alias)):h}whereJsonPath(u){let h="";return!isNaN(u.value)&&parseInt(u.value)?h="::int":!isNaN(u.value)&&parseFloat(u.value)?h="::float":h=" #>> '{}'",`jsonb_path_query_first(${this._columnClause(u)}, ${this.client.parameter(u.jsonPath,this.builder,this.bindingsHolder)})${h} ${a(u.operator,this.builder,this.client,this.bindingsHolder)} ${this._jsonValueClause(u)}`}whereJsonSupersetOf(u){return this._not(u,`${o(u.column,void 0,this.builder,this.client,this.bindingsHolder)} @> ${this._jsonValueClause(u)}`)}whereJsonSubsetOf(u){return this._not(u,`${i(u.column,this.builder,this.client,this.bindingsHolder)} <@ ${this._jsonValueClause(u)}`)}onJsonPathEquals(u){return this._onJsonPathEquals("jsonb_path_query_first",u)}}return fi=s,fi}var mi,_u;function Wx(){if(_u)return mi;_u=1;const r=Ee;return mi=class extends r{using(t){return this._single.using=t,this}withMaterialized(t,n,i){return this._validateWithArgs(t,n,i,"with"),this.withWrapped(t,n,i,!0)}withNotMaterialized(t,n,i){return this._validateWithArgs(t,n,i,"with"),this.withWrapped(t,n,i,!1)}},mi}var gi,wu;function yi(){if(wu)return gi;wu=1;const r=Ue,{isObject:e}=M,{toNumber:t}=z,n=new RegExp("(?<!')'(?!')","g");class i extends r{constructor(s,l,u){super(s,l,u),this.modifiers=["nullable","defaultTo","comment"],this._addCheckModifiers()}bit(s){return s.length!==!1?`bit(${s.length})`:"bit"}enu(s,l){l=l||{};const u=l.useNative&&l.existingType?void 0:s.join("', '");if(l.useNative){let h="";const c=l.schemaName||this.tableCompiler.schemaNameRaw;return c&&(h+=`"${c}".`),h+=`"${l.enumName}"`,l.existingType||this.tableCompiler.unshiftQuery(`create type ${h} as enum ('${u}')`),h}return`text check (${this.formatter.wrap(this.args[0])} in ('${u}'))`}decimal(s,l){return s===null?"decimal":`decimal(${t(s,8)}, ${t(l,2)})`}json(s){return s&&this.client.logger.deprecate("json(true)","jsonb()"),a(this.client,s)}jsonb(){return a(this.client,!0)}checkRegex(s,l){return this._check(`${this.formatter.wrap(this.getColumnName())} ~ ${this.client._escapeBinding(s)}`,l)}datetime(s=!1,l){let u;return e(s)?{useTz:u,precision:l}=s:u=!s,u=typeof u=="boolean"?u:!0,l=l!=null?"("+l+")":"",`${u?"timestamptz":"timestamp"}${l}`}timestamp(s=!1,l){return this.datetime(s,l)}comment(s){const l=this.args[0]||this.defaults("columnName"),u=s?`'${s.replace(n,"''")}'`:"NULL";this.pushAdditional(function(){this.pushQuery(`comment on column ${this.tableCompiler.tableName()}.`+this.formatter.wrap(l)+` is ${u}`)},s)}increments(s={primaryKey:!0}){return"serial"+(this.tableCompiler._canBeAddPrimaryKey(s)?" primary key":"")}bigincrements(s={primaryKey:!0}){return"bigserial"+(this.tableCompiler._canBeAddPrimaryKey(s)?" primary key":"")}uuid(s={primaryKey:!1}){return"uuid"+(this.tableCompiler._canBeAddPrimaryKey(s)?" primary key":"")}}i.prototype.bigint="bigint",i.prototype.binary="bytea",i.prototype.bool="boolean",i.prototype.double="double precision",i.prototype.floating="real",i.prototype.smallint="smallint",i.prototype.tinyint="smallint";function a(o,s){return!o.version||o.config.client==="cockroachdb"||o.config.jsonbSupport===!0||parseFloat(o.version)>=9.2?s?"jsonb":"json":"text"}return gi=i,gi}var bi,$u;function _i(){if($u)return bi;$u=1;const r=wr,e=ht,{isObject:t,isString:n}=M;class i extends e{constructor(o,s){super(o,s)}renameColumn(o,s){return this.pushQuery({sql:`alter table ${this.tableName()} rename ${this.formatter.wrap(o)} to ${this.formatter.wrap(s)}`})}_setNullableState(o,s){const l=s?"drop not null":"set not null",u=`alter table ${this.tableName()} alter column ${this.formatter.wrap(o)} ${l}`;return this.pushQuery({sql:u})}compileAdd(o){const s=this.formatter.wrap(o),l=this.prefixArray("add column",this.getColumns(o));return this.pushQuery({sql:`alter table ${s} ${l.join(", ")}`})}createQuery(o,s,l){const u=s?"create table if not exists ":"create table ",h=` (${o.sql.join(", ")}${this.primaryKeys()||""}${this._addChecks()})`;let c=u+this.tableName()+(l&&this.tableNameLike()?" (like "+this.tableNameLike()+" including all"+(o.sql.length?", "+o.sql.join(", "):"")+")":h);this.single.inherits&&(c+=` inherits (${this.formatter.wrap(this.single.inherits)})`),this.pushQuery({sql:c,bindings:o.bindings}),r(this.single,"comment")&&this.comment(this.single.comment)}primaryKeys(){const o=(this.grouped.alterTable||[]).filter(s=>s.method==="primary");if(o.length>0&&o[0].args.length>0){const s=o[0].args[0];let l=o[0].args[1]||"",u;return t(l)&&({constraintName:l,deferrable:u}=l),u=u?` deferrable initially ${u}`:"",l=l?this.formatter.wrap(l):this.formatter.wrap(`${this.tableNameRaw}_pkey`),`, constraint ${l} primary key (${this.formatter.columnize(s)})${u}`}}addColumns(o,s,l){if(s===this.alterColumnsPrefix)for(const u of l)this._addColumn(u);else super.addColumns(o,s)}_addColumn(o){const s=this.tableName(),l=o.getColumnType(),u=this.client.wrapIdentifier(o.getColumnName(),o.columnBuilder.queryContext()),h=o.type==="enu";this.pushQuery({sql:`alter table ${s} alter column ${u} drop default`,bindings:[]});const c=o.columnBuilder.alterNullable;c&&this.pushQuery({sql:`alter table ${s} alter column ${u} drop not null`,bindings:[]}),o.columnBuilder.alterType&&this.pushQuery({sql:`alter table ${s} alter column ${u} type ${l} using (${u}${h?"::text::":"::"}${l})`,bindings:[]});const p=o.modified.defaultTo;if(p){const g=o.defaultTo.apply(o,p);this.pushQuery({sql:`alter table ${s} alter column ${u} set ${g}`,bindings:[]})}if(c){const g=o.modified.nullable;g&&g[0]===!1&&this.pushQuery({sql:`alter table ${s} alter column ${u} set not null`,bindings:[]})}}comment(o){this.pushQuery(`comment on table ${this.tableName()} is '${this.single.comment}'`)}primary(o,s){let l;t(s)&&({constraintName:s,deferrable:l}=s),l=l?` deferrable initially ${l}`:"",s=s?this.formatter.wrap(s):this.formatter.wrap(`${this.tableNameRaw}_pkey`),this.method!=="create"&&this.method!=="createIfNot"&&this.pushQuery(`alter table ${this.tableName()} add constraint ${s} primary key (${this.formatter.columnize(o)})${l}`)}unique(o,s){let l,u=!0,h;if(t(s)&&({indexName:s,deferrable:l,useConstraint:u,predicate:h}=s,u===void 0&&(u=!!l||!h)),!u&&l&&l!=="not deferrable")throw new Error("postgres cannot create deferrable index");if(u&&h)throw new Error("postgres cannot create constraint with predicate");if(l=l?` deferrable initially ${l}`:"",s=s?this.formatter.wrap(s):this._indexCommand("unique",this.tableNameRaw,o),u)this.pushQuery(`alter table ${this.tableName()} add constraint ${s} unique (`+this.formatter.columnize(o)+")"+l);else{const c=h?" "+this.client.queryCompiler(h).where():"";this.pushQuery(`create unique index ${s} on ${this.tableName()} (${this.formatter.columnize(o)})${c}`)}}index(o,s,l){s=s?this.formatter.wrap(s):this._indexCommand("index",this.tableNameRaw,o);let u,h;n(l)?h=l:t(l)&&({indexType:h,predicate:u}=l);const c=u?" "+this.client.queryCompiler(u).where():"";this.pushQuery(`create index ${s} on ${this.tableName()}${h&&` using ${h}`||""} (`+this.formatter.columnize(o)+`)${c}`)}dropPrimary(o){o=o?this.formatter.wrap(o):this.formatter.wrap(this.tableNameRaw+"_pkey"),this.pushQuery(`alter table ${this.tableName()} drop constraint ${o}`)}dropIndex(o,s){s=s?this.formatter.wrap(s):this._indexCommand("index",this.tableNameRaw,o),s=this.schemaNameRaw?`${this.formatter.wrap(this.schemaNameRaw)}.${s}`:s,this.pushQuery(`drop index ${s}`)}dropUnique(o,s){s=s?this.formatter.wrap(s):this._indexCommand("unique",this.tableNameRaw,o),this.pushQuery(`alter table ${this.tableName()} drop constraint ${s}`)}dropForeign(o,s){s=s?this.formatter.wrap(s):this._indexCommand("foreign",this.tableNameRaw,o),this.pushQuery(`alter table ${this.tableName()} drop constraint ${s}`)}}return bi=i,bi}var wi,Cu;function $i(){if(Cu)return wi;Cu=1;const r=ft;class e extends r{constructor(n,i){super(n,i)}renameColumn(n,i){return this.pushQuery({sql:`alter view ${this.viewName()} rename ${this.formatter.wrap(n)} to ${this.formatter.wrap(i)}`})}defaultTo(n,i){return this.pushQuery({sql:`alter view ${this.viewName()} alter ${this.formatter.wrap(n)} set default ${i}`})}createOrReplace(){this.createQuery(this.columns,this.selectQuery,!1,!0)}createMaterializedView(){this.createQuery(this.columns,this.selectQuery,!0)}}return wi=e,wi}var Ci,vu;function zx(){if(vu)return Ci;vu=1;const r=It;class e extends r{constructor(){super(...arguments)}checkOption(){this._single.checkOption="default_option"}localCheckOption(){this._single.checkOption="local"}cascadedCheckOption(){this._single.checkOption="cascaded"}}return Ci=e,Ci}var vi,Eu;function Tu(){if(Eu)return vi;Eu=1;const r=ct;class e extends r{constructor(n,i){super(n,i)}hasTable(n){let i="select * from information_schema.tables where table_name = ?";const a=[n];this.schema?(i+=" and table_schema = ?",a.push(this.schema)):i+=" and table_schema = current_schema()",this.pushQuery({sql:i,bindings:a,output(o){return o.rows.length>0}})}hasColumn(n,i){let a="select * from information_schema.columns where table_name = ? and column_name = ?";const o=[n,i];this.schema?(a+=" and table_schema = ?",o.push(this.schema)):a+=" and table_schema = current_schema()",this.pushQuery({sql:a,bindings:o,output(s){return s.rows.length>0}})}qualifiedTableName(n){const i=this.schema?`${this.schema}.${n}`:n;return this.formatter.wrap(i)}renameTable(n,i){this.pushQuery(`alter table ${this.qualifiedTableName(n)} rename to ${this.formatter.wrap(i)}`)}createSchema(n){this.pushQuery(`create schema ${this.formatter.wrap(n)}`)}createSchemaIfNotExists(n){this.pushQuery(`create schema if not exists ${this.formatter.wrap(n)}`)}dropSchema(n,i=!1){this.pushQuery(`drop schema ${this.formatter.wrap(n)}${i?" cascade":""}`)}dropSchemaIfExists(n,i=!1){this.pushQuery(`drop schema if exists ${this.formatter.wrap(n)}${i?" cascade":""}`)}dropExtension(n){this.pushQuery(`drop extension ${this.formatter.wrap(n)}`)}dropExtensionIfExists(n){this.pushQuery(`drop extension if exists ${this.formatter.wrap(n)}`)}createExtension(n){this.pushQuery(`create extension ${this.formatter.wrap(n)}`)}createExtensionIfNotExists(n){this.pushQuery(`create extension if not exists ${this.formatter.wrap(n)}`)}renameView(n,i){this.pushQuery(this.alterViewPrefix+`${this.formatter.wrap(n)} rename to ${this.formatter.wrap(i)}`)}refreshMaterializedView(n,i=!1){this.pushQuery({sql:`refresh materialized view${i?" concurrently":""} ${this.formatter.wrap(n)}`})}dropMaterializedView(n){this._dropView(n,!1,!0)}dropMaterializedViewIfExists(n){this._dropView(n,!0,!0)}}return vi=e,vi}var Ei,Au;function xr(){if(Au)return Ei;Au=1;const r=Ar,e=Qe,{promisify:t}=I,n=He,i=yu(),a=pi(),o=Wx(),s=yi(),l=_i(),u=$i(),h=zx(),c=Tu(),{makeEscape:d}=Ur,{isString:p}=M;class g extends n{constructor(m){super(m),m.returning&&(this.defaultReturning=m.returning),m.searchPath&&(this.searchPath=m.searchPath)}transaction(){return new i(this,...arguments)}queryBuilder(){return new o(this)}queryCompiler(m,y){return new a(this,m,y)}columnCompiler(){return new s(this,...arguments)}schemaCompiler(){return new c(this,...arguments)}tableCompiler(){return new l(this,...arguments)}viewCompiler(){return new u(this,...arguments)}viewBuilder(){return new h(this,...arguments)}_driver(){return I}wrapIdentifierImpl(m){if(m==="*")return m;let y="";const w=m.match(/(.*?)(\[[0-9]+\])/);return w&&(m=w[1],y=w[2]),`"${m.replace(/"/g,'""')}"${y}`}_acquireOnlyConnection(){const m=new this.driver.Client(this.connectionSettings);return m.connect().then(()=>m)}acquireRawConnection(){const m=this;return this._acquireOnlyConnection().then(function(y){return y.on("error",w=>{y.__knex__disposed=w}),y.on("end",w=>{y.__knex__disposed=w||"Connection ended unexpectedly"}),m.version?y:m.checkVersion(y).then(function(w){return m.version=w,y})}).then(async function(w){return await m.setSchemaSearchPath(w),w})}async destroyRawConnection(m){return t(w=>m.end(w))()}checkVersion(m){return new Promise((y,w)=>{m.query("select version();",($,E)=>{if($)return w($);y(this._parseVersion(E.rows[0].version))})})}_parseVersion(m){return/^PostgreSQL (.*?)( |$)/.exec(m)[1]}positionBindings(m){let y=0;return m.replace(/(\\*)(\?)/g,function(w,$){return $.length%2?"?":(y++,`$${y}`)})}setSchemaSearchPath(m,y){let w=y||this.searchPath;if(!w)return Promise.resolve(!0);if(!Array.isArray(w)&&!p(w))throw new TypeError(`knex: Expected searchPath to be Array/String, got: ${typeof w}`);if(p(w)){if(w.includes(",")){const E=`[${w.split(",").map(C=>`'${C}'`).join(", ")}]`;this.logger.warn(`Detected comma in searchPath "${w}".If you are trying to specify multiple schemas, use Array syntax: ${E}`)}w=[w]}return w=w.map($=>`"${$}"`).join(","),new Promise(function($,E){m.query(`set search_path to ${w}`,function(C){if(C)return E(C);$(!0)})})}_stream(m,y,w,$){if(!y.sql)throw new Error("The query is empty");const E=process.browser?void 0:I,C=y.sql;return new Promise(function(T,N){const P=m.query(new E(C,y.bindings,$));P.on("error",function(L){N(L),w.emit("error",L)}),w.on("end",T),P.pipe(w)})}_query(m,y){if(!y.sql)throw new Error("The query is empty");let w={text:y.sql,values:y.bindings||[]};return y.options&&(w=r(w,y.options)),new Promise(function($,E){m.query(w,function(C,T){if(C)return E(C);y.response=T,$(y)})})}processResponse(m,y){const w=m.response;if(m.output)return m.output.call(y,w);if(m.method==="raw")return w;const{returning:$}=m;if(w.command==="SELECT")return m.method==="first"?w.rows[0]:m.method==="pluck"?e(w.rows,m.pluck):w.rows;if($){const E=[];for(let C=0,T=w.rows.length;C<T;C++){const N=w.rows[C];E[C]=N}return E}return w.command==="UPDATE"||w.command==="DELETE"?w.rowCount:w}async cancelQuery(m){const y=await this.acquireRawConnection();try{return await this._wrappedCancelQueryCall(y,m)}finally{await this.destroyRawConnection(y).catch(w=>{this.logger.warn(`Connection Error: ${w}`)})}}_wrappedCancelQueryCall(m,y){return this._query(m,{sql:"SELECT pg_cancel_backend($1);",bindings:[y.processID],options:{}})}toPathForJson(m){const y=/^{.*}$/;return m.match(y)?m:"{"+m.replace(/^(\$\.)/,"").replace(".",",").replace(/\[([0-9]+)]/,",$1")+"}"}}Object.assign(g.prototype,{dialect:"postgresql",driverName:"pg",canCancelQuery:!0,_escapeBinding:d({escapeArray(f,m){return m(_(f,m))},escapeString(f){let m=!1,y="'";for(let w=0;w<f.length;w++){const $=f[w];$==="'"?y+=$+$:$==="\\"?(y+=$+$,m=!0):y+=$}return y+="'",m===!0&&(y="E"+y),y},escapeObject(f,m,y,w=[]){if(f&&typeof f.toPostgres=="function"){if(w=w||[],w.indexOf(f)!==-1)throw new Error(`circular reference detected while preparing "${f}" for query`);return w.push(f),m(f.toPostgres(m),w)}return JSON.stringify(f)}})});function _(f,m){let y="{";for(let w=0;w<f.length;w++){w>0&&(y+=",");const $=f[w];$===null||typeof $>"u"?y+="NULL":Array.isArray($)?y+=_($,m):typeof $=="number"?y+=$:y+=JSON.stringify(typeof $=="string"?$:m($))}return y+"}"}return Ei=g,Ei}var Ti,Ou;function Kx(){if(Ou)return Ti;Ou=1;const r=pi(),{columnize:e,wrap:t,operator:n}=K;class i extends r{truncate(){return`truncate ${this.tableName}`}upsert(){let o=this._upsert();if(o==="")return o;const{returning:s}=this.single;return s&&(o+=this._returning(s)),{sql:o,returning:s}}_upsert(){const o=this.single.upsert||[],s=this.with()+`upsert into ${this.tableName} `,l=this._insertBody(o);return l===""?"":s+l}_groupOrder(o,s){return this._basicGroupOrder(o,s)}whereJsonPath(o){let s="";return!isNaN(o.value)&&parseInt(o.value)?s="::int":!isNaN(o.value)&&parseFloat(o.value)?s="::float":s=" #>> '{}'",`json_extract_path(${this._columnClause(o)}, ${this.client.toArrayPathFromJsonPath(o.jsonPath,this.builder,this.bindingsHolder)})${s} ${n(o.operator,this.builder,this.client,this.bindingsHolder)} ${this._jsonValueClause(o)}`}_jsonExtract(o,s){let l;return Array.isArray(s.column)?l=s.column:l=[s],l.map(u=>{const h=`json_extract_path(${e(u.column||u[0],this.builder,this.client,this.bindingsHolder)}, ${this.client.toArrayPathFromJsonPath(u.path||u[1],this.builder,this.bindingsHolder)})`,c=u.alias||u[2];return c?this.client.alias(h,this.formatter.wrap(c)):h}).join(", ")}_onJsonPathEquals(o,s){return"json_extract_path("+t(s.columnFirst,void 0,this.builder,this.client,this.bindingsHolder)+", "+this.client.toArrayPathFromJsonPath(s.jsonPathFirst,this.builder,this.bindingsHolder)+") = json_extract_path("+t(s.columnSecond,void 0,this.builder,this.client,this.bindingsHolder)+", "+this.client.toArrayPathFromJsonPath(s.jsonPathSecond,this.builder,this.bindingsHolder)+")"}}return Ti=i,Ti}var Ai,Nu;function Jx(){if(Nu)return Ai;Nu=1;const r=yi();class e extends r{uuid(n={primaryKey:!1}){return"uuid"+(this.tableCompiler._canBeAddPrimaryKey(n)?" primary key default gen_random_uuid()":"")}}return Ai=e,Ai}var Oi,qu;function Gx(){if(qu)return Oi;qu=1;const r=_i();class e extends r{constructor(n,i){super(n,i)}addColumns(n,i,a){if(i===this.alterColumnsPrefix)for(const o of a)this.client.logger.warn("Experimental alter column in use, see issue: https://github.com/cockroachdb/cockroach/issues/49329"),this.pushQuery({sql:"SET enable_experimental_alter_column_type_general = true",bindings:[]}),super._addColumn(o);else super.addColumns(n,i)}dropUnique(n,i){i=i?this.formatter.wrap(i):this._indexCommand("unique",this.tableNameRaw,n),this.pushQuery(`drop index ${this.tableName()}@${i} cascade `)}}return Oi=e,Oi}var Ni,Ru;function Yx(){if(Ru)return Ni;Ru=1;const r=$i();class e extends r{renameColumn(n,i){throw new Error("rename column of views is not supported by this dialect.")}defaultTo(n,i){throw new Error("change default values of views is not supported by this dialect.")}}return Ni=e,Ni}var qi,Su;function Xx(){if(Su)return qi;Su=1;const r=Ee,e=le;return qi=class extends r{upsert(n,i,a){return this._method="upsert",e(i)||this.returning(i,a),this._single.upsert=n,this}},qi}var Ri,xu;function Zx(){if(xu)return Ri;xu=1;const r=xr(),e=yu(),t=Kx(),n=Jx(),i=Gx(),a=Yx(),o=Xx();class s extends r{transaction(){return new e(this,...arguments)}queryCompiler(u,h){return new t(this,u,h)}columnCompiler(){return new n(this,...arguments)}tableCompiler(){return new i(this,...arguments)}viewCompiler(){return new a(this,...arguments)}queryBuilder(){return new o(this)}_parseVersion(u){return u.split(" ")[2]}async cancelQuery(u){try{return await this._wrappedCancelQueryCall(null,u)}catch(h){throw this.logger.warn(`Connection Error: ${h}`),h}}_wrappedCancelQueryCall(u,h){if(!(h.activeQuery.processID===0&&h.activeQuery.secretKey===0))return h.cancel(h,h.activeQuery)}toArrayPathFromJsonPath(u,h,c){return u.replace(/^(\$\.)/,"").replace(/\[([0-9]+)]/,".$1").split(".").map((function(d){return this.parameter(d,h,c)}).bind(this)).join(", ")}}return Object.assign(s.prototype,{driverName:"cockroachdb"}),Ri=s,Ri}var Si,Iu;function eI(){if(Iu)return Si;Iu=1;function r(e){return e==null}return Si=r,Si}var xi,Pu;function tI(){if(Pu)return xi;Pu=1;const r=Rr;class e extends r{columnizeWithPrefix(n,i){const a=typeof i=="string"?[i]:i;let o="",s=-1;for(;++s<a.length;)s>0&&(o+=", "),o+=n+this.wrap(a[s]);return o}escapingStringDelimiters(n){return(n||"").replace(/'/g,"''")}}return xi=e,xi}var Ii,Lu;function rI(){if(Lu)return Ii;Lu=1;const r=Ce,e=ae("knex:tx");class t extends r{begin(s){return e("transaction::begin id=%s",this.txid),new Promise((l,u)=>{s.beginTransaction(h=>{if(h)return e("transaction::begin error id=%s message=%s",this.txid,h.message),u(h);l()},this.outerTx?this.txid:void 0,n(this.isolationLevel))}).then(this._resolver,this._rejecter)}savepoint(s){return e("transaction::savepoint id=%s",this.txid),new Promise((l,u)=>{s.saveTransaction(h=>{if(h)return e("transaction::savepoint id=%s message=%s",this.txid,h.message),u(h);this.trxClient.emit("query",{__knexUid:this.trxClient.__knexUid,__knexTxId:this.trxClient.__knexTxId,autogenerated:!0,sql:this.outerTx?`SAVE TRANSACTION [${this.txid}]`:"SAVE TRANSACTION"}),l()},this.outerTx?this.txid:void 0)})}commit(s,l){return e("transaction::commit id=%s",this.txid),new Promise((u,h)=>{s.commitTransaction(c=>{if(c)return e("transaction::commit error id=%s message=%s",this.txid,c.message),h(c);this._completed=!0,u(l)},this.outerTx?this.txid:void 0)}).then(()=>this._resolver(l),this._rejecter)}release(s,l){return this._resolver(l)}rollback(s,l){return this._completed=!0,e("transaction::rollback id=%s",this.txid),new Promise((u,h)=>{if(!s.inTransaction)return h(l||new Error("Transaction rejected with non-error: undefined"));if(s.state.name!=="LoggedIn")return h(new Error("Can't rollback transaction. There is a request in progress"));s.rollbackTransaction(c=>{c&&e("transaction::rollback error id=%s message=%s",this.txid,c.message),h(c||l||new Error("Transaction rejected with non-error: undefined"))},this.outerTx?this.txid:void 0)}).catch(u=>{if(!l&&this.doNotRejectOnRollback){this._resolver();return}if(l)try{u.originalError=l}catch{}this._rejecter(u)})}rollbackTo(s,l){return this.rollback(s,l).then(()=>void this.trxClient.emit("query",{__knexUid:this.trxClient.__knexUid,__knexTxId:this.trxClient.__knexTxId,autogenerated:!0,sql:"ROLLBACK TRANSACTION"}))}}Ii=t;function n(o){if(!o)return;o=o.toUpperCase().replace(" ","_");const s=i[o];if(!s)throw new Error(`Unknown Isolation level, was expecting one of: ${JSON.stringify(a)}`);return s}const i={READ_UNCOMMITTED:1,READ_COMMITTED:2,REPEATABLE_READ:3,SERIALIZABLE:4,SNAPSHOT:5},a=Object.keys(i).map(o=>o.toLowerCase().replace("_"," "));return Ii}var Pi,Bu;function nI(){if(Bu)return Pi;Bu=1;const r=De,e=Ln,t=ie,n=le,i=at,{columnize:a}=K,o=["columns","join","lock","where","union","group","having","order","limit","offset"];class s extends r{constructor(u,h,c){super(u,h,c);const{onConflict:d}=this.single;if(d)throw new Error(".onConflict() is not supported for mssql.");this._emptyInsertValue="default values"}with(){const u=[];if(this.grouped.with)for(const c of this.grouped.with)c.recursive&&(u.push(c),c.recursive=!1);const h=super.with();for(const c of u)c.recursive=!0;return h}select(){const u=this.with(),h=o.map(c=>this[c](this));return u+e(h).join(" ")}insert(){return this.single.options&&this.single.options.includeTriggerModifications?this.insertWithTriggers():this.standardInsert()}insertWithTriggers(){const u=this.single.insert||[],{returning:h}=this.single;let c=this.with()+`${this._buildTempTable(h)}insert into ${this.tableName} `;const d=h?this._returning("insert",h,!0)+" ":"";if(Array.isArray(u)){if(u.length===0)return""}else if(typeof u=="object"&&n(u))return{sql:c+d+this._emptyInsertValue+this._buildReturningSelect(h),returning:h};return c+=this._buildInsertData(u,d),h&&(c+=this._buildReturningSelect(h)),{sql:c,returning:h}}_buildInsertData(u,h){let c="";const d=this._prepInsert(u);if(typeof d=="string")c+=d;else if(d.columns.length)c+=`(${this.formatter.columnize(d.columns)}`,c+=`) ${h}values (`+this._buildInsertValues(d)+")";else if(u.length===1&&u[0])c+=h+this._emptyInsertValue;else return"";return c}standardInsert(){const u=this.single.insert||[];let h=this.with()+`insert into ${this.tableName} `;const{returning:c}=this.single,d=c?this._returning("insert",c)+" ":"";if(Array.isArray(u)){if(u.length===0)return""}else if(typeof u=="object"&&n(u))return{sql:h+d+this._emptyInsertValue,returning:c};return h+=this._buildInsertData(u,d),{sql:h,returning:c}}update(){return this.single.options&&this.single.options.includeTriggerModifications?this.updateWithTriggers():this.standardUpdate()}updateWithTriggers(){const u=this.top(),h=this.with(),c=this._prepUpdate(this.single.update),d=this.join(),p=this.where(),g=this.order(),{returning:_}=this.single,f=this._buildTempTable(_);return{sql:h+f+`update ${u?u+" ":""}${this.tableName} set `+c.join(", ")+(_?` ${this._returning("update",_,!0)}`:"")+(d?` from ${this.tableName} ${d}`:"")+(p?` ${p}`:"")+(g?` ${g}`:"")+(_?this._buildReturningSelect(_):this._returning("rowcount","@@rowcount")),returning:_||"@@rowcount"}}_formatGroupsItemValue(u,h){const c=super._formatGroupsItemValue(u);if(h&&!(u instanceof i)){const d=`IIF(${c} is null,`;if(h==="first")return`${d}0,1)`;if(h==="last")return`${d}1,0)`}return c}standardUpdate(){const u=this.top(),h=this.with(),c=this._prepUpdate(this.single.update),d=this.join(),p=this.where(),g=this.order(),{returning:_}=this.single;return{sql:h+`update ${u?u+" ":""}${this.tableName} set `+c.join(", ")+(_?` ${this._returning("update",_)}`:"")+(d?` from ${this.tableName} ${d}`:"")+(p?` ${p}`:"")+(g?` ${g}`:"")+(_?"":this._returning("rowcount","@@rowcount")),returning:_||"@@rowcount"}}del(){return this.single.options&&this.single.options.includeTriggerModifications?this.deleteWithTriggers():this.standardDelete()}deleteWithTriggers(){const u=this.with(),{tableName:h}=this,c=this.where(),d=this.join(),{returning:p}=this.single,g=p?` ${this._returning("del",p,!0)}`:"",_=d?`${h}${g} `:"";return{sql:u+`${this._buildTempTable(p)}delete ${_}from ${h}`+(d?"":g)+(d?` ${d}`:"")+(c?` ${c}`:"")+(p?this._buildReturningSelect(p):this._returning("rowcount","@@rowcount")),returning:p||"@@rowcount"}}standardDelete(){const u=this.with(),{tableName:h}=this,c=this.where(),d=this.join(),{returning:p}=this.single,g=p?` ${this._returning("del",p)}`:"",_=d?`${h}${g} `:"";return{sql:u+`delete ${_}from ${h}`+(d?"":g)+(d?` ${d}`:"")+(c?` ${c}`:"")+(p?"":this._returning("rowcount","@@rowcount")),returning:p||"@@rowcount"}}columns(){let u="";if(this.onlyUnions())return"";const h=this.top(),c=this._hintComments(),d=this.grouped.columns||[];let p=-1,g=[];if(d)for(;++p<d.length;){const f=d[p];if(f.distinct&&(u="distinct "),f.distinctOn){u=this.distinctOn(f.value);continue}f.type==="aggregate"?g.push(...this.aggregate(f)):f.type==="aggregateRaw"?g.push(this.aggregateRaw(f)):f.type==="analytic"?g.push(this.analytic(f)):f.type==="json"?g.push(this.json(f)):f.value&&f.value.length>0&&g.push(this.formatter.columnize(f.value))}return g.length===0&&(g=["*"]),`${this.onlyJson()?"":"select "}${c}${u}`+(h?h+" ":"")+g.join(", ")+(this.tableName?` from ${this.tableName}`:"")}_returning(u,h,c){switch(u){case"update":case"insert":return h?`output ${this.formatter.columnizeWithPrefix("inserted.",h)}${c?" into #out":""}`:"";case"del":return h?`output ${this.formatter.columnizeWithPrefix("deleted.",h)}${c?" into #out":""}`:"";case"rowcount":return h?";select @@rowcount":""}}_buildTempTable(u){if(u&&u.length>0){let h="";Array.isArray(u)?h=u.map(d=>`[t].${this.formatter.columnize(d)}`).join(","):h=`[t].${this.formatter.columnize(u)}`;let c=`select top(0) ${h} into #out `;return c+=`from ${this.tableName} as t `,c+=`left join ${this.tableName} on 0=1;`,c}return""}_buildReturningSelect(u){if(u&&u.length>0){let h="";Array.isArray(u)?h=u.map(d=>`${this.formatter.columnize(d)}`).join(","):h=this.formatter.columnize(u);let c=`; select ${h} from #out; `;return c+="drop table #out;",c}return""}truncate(){return`truncate table ${this.tableName}`}forUpdate(){return"with (UPDLOCK)"}forShare(){return"with (HOLDLOCK)"}columnInfo(){const u=this.single.columnInfo;let h=this.single.schema;const c=this.client.customWrapIdentifier(this.single.table,t);h&&(h=this.client.customWrapIdentifier(h,t));let d="select [COLUMN_NAME], [COLUMN_DEFAULT], [DATA_TYPE], [CHARACTER_MAXIMUM_LENGTH], [IS_NULLABLE] from INFORMATION_SCHEMA.COLUMNS where table_name = ? and table_catalog = ?";const p=[c,this.client.database()];return h?(d+=" and table_schema = ?",p.push(h)):d+=" and table_schema = 'dbo'",{sql:d,bindings:p,output(g){const _=g.reduce((f,m)=>(f[m[0].value]={defaultValue:m[1].value,type:m[2].value,maxLength:m[3].value,nullable:m[4].value==="YES"},f),{});return u&&_[u]||_}}}top(){const u=!this.single.limit&&this.single.limit!==0,h=!this.single.offset;return u||!h?"":`top (${this._getValueOrParameterFromAttribute("limit")})`}limit(){return""}offset(){const u=!this.single.limit&&this.single.limit!==0,h=!this.single.offset;if(h)return"";let c=`offset ${h?"0":this._getValueOrParameterFromAttribute("offset")} rows`;return u||(c+=` fetch next ${this._getValueOrParameterFromAttribute("limit")} rows only`),c}whereLike(u){return`${this._columnClause(u)} collate SQL_Latin1_General_CP1_CS_AS ${this._not(u,"like ")}${this._valueClause(u)}`}whereILike(u){return`${this._columnClause(u)} collate SQL_Latin1_General_CP1_CI_AS ${this._not(u,"like ")}${this._valueClause(u)}`}jsonExtract(u){return this._jsonExtract(u.singleValue?"JSON_VALUE":"JSON_QUERY",u)}jsonSet(u){return this._jsonSet("JSON_MODIFY",u)}jsonInsert(u){return this._jsonSet("JSON_MODIFY",u)}jsonRemove(u){const h=`JSON_MODIFY(${a(u.column,this.builder,this.client,this.bindingsHolder)},${this.client.parameter(u.path,this.builder,this.bindingsHolder)}, NULL)`;return u.alias?this.client.alias(h,this.formatter.wrap(u.alias)):h}whereJsonPath(u){return this._whereJsonPath("JSON_VALUE",u)}whereJsonSupersetOf(u){throw new Error("Json superset where clause not actually supported by MSSQL")}whereJsonSubsetOf(u){throw new Error("Json subset where clause not actually supported by MSSQL")}_getExtracts(u,h){const c=a(u.column,this.builder,this.client,this.bindingsHolder);return(Array.isArray(u.values)?u.values:[u.values]).map(function(d){return"JSON_VALUE("+c+","+this.client.parameter(d,this.builder,this.bindingsHolder)+")"},this).join(h)}onJsonPathEquals(u){return this._onJsonPathEquals("JSON_VALUE",u)}}return Pi=s,Pi}var Li,ku;function iI(){if(ku)return Li;ku=1;const r=ct;class e extends r{constructor(i,a){super(i,a)}dropTableIfExists(i){const a=this.formatter.wrap(t(this.schema,i));this.pushQuery(`if object_id('${a}', 'U') is not null DROP TABLE ${a}`)}dropViewIfExists(i){const a=this.formatter.wrap(t(this.schema,i));this.pushQuery(`if object_id('${a}', 'V') is not null DROP VIEW ${a}`)}renameTable(i,a){this.pushQuery(`exec sp_rename ${this.client.parameter(t(this.schema,i),this.builder,this.bindingsHolder)}, ${this.client.parameter(a,this.builder,this.bindingsHolder)}`)}renameView(i,a){this.pushQuery(`exec sp_rename ${this.client.parameter(t(this.schema,i),this.builder,this.bindingsHolder)}, ${this.client.parameter(a,this.builder,this.bindingsHolder)}`)}hasTable(i){const a=this.client.parameter(t(this.schema,i),this.builder,this.bindingsHolder),o=[i];let s=`SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = ${a}`;this.schema&&(s+=" AND TABLE_SCHEMA = ?",o.push(this.schema)),this.pushQuery({sql:s,bindings:o,output:l=>l.length>0})}hasColumn(i,a){const o=this.client.parameter(a,this.builder,this.bindingsHolder),s=this.client.parameter(this.formatter.wrap(t(this.schema,i)),this.builder,this.bindingsHolder),l=`select object_id from sys.columns where name = ${o} and object_id = object_id(${s})`;this.pushQuery({sql:l,output:u=>u.length>0})}}e.prototype.dropTablePrefix="DROP TABLE ";function t(n,i){return n?`${n}.${i}`:i}return Li=e,Li}var Bi,Mu;function sI(){if(Mu)return Bi;Mu=1;const r=ht,e=z,{isObject:t}=M;class n extends r{constructor(a,o){super(a,o)}createQuery(a,o,s){let l=o?`if object_id('${this.tableName()}', 'U') is null `:"";s?l+=`SELECT * INTO ${this.tableName()} FROM ${this.tableNameLike()} WHERE 0=1`:l+="CREATE TABLE "+this.tableName()+(this._formatting?` (
    `:" (")+a.sql.join(this._formatting?`,
    `:", ")+this._addChecks()+")",this.pushQuery(l),this.single.comment&&this.comment(this.single.comment),s&&this.addColumns(a,this.addColumnsPrefix)}comment(a){if(!a)return;a.length>7500/2&&this.client.logger.warn("Your comment might be longer than the max comment length for MSSQL of 7,500 bytes.");const o=this.formatter.escapingStringDelimiters(a),s=this.formatter.escapingStringDelimiters(this.schemaNameRaw||"dbo"),l=this.formatter.escapingStringDelimiters(this.tableNameRaw),u=`N'MS_Description', N'${o}', N'Schema', N'${s}', N'Table', N'${l}'`,h=`EXISTS(SELECT * FROM sys.fn_listextendedproperty(N'MS_Description', N'Schema', N'${s}', N'Table', N'${l}', NULL, NULL))`;this.pushQuery(`IF ${h}
  EXEC sys.sp_updateextendedproperty ${u}
ELSE
  EXEC sys.sp_addextendedproperty ${u}`)}addColumns(a,o){o=o||this.addColumnsPrefix,a.sql.length>0&&this.pushQuery({sql:(this.lowerCase?"alter table ":"ALTER TABLE ")+this.tableName()+" "+o+a.sql.join(", "),bindings:a.bindings})}alterColumns(a,o){for(let s=0,l=o.length;s<l;s++){const u=o[s];if(u.modified.defaultTo){const c=`
              DECLARE @constraint varchar(100) = (SELECT default_constraints.name
                                                  FROM sys.all_columns
                                                  INNER JOIN sys.tables
                                                    ON all_columns.object_id = tables.object_id
                                                  INNER JOIN sys.schemas
                                                    ON tables.schema_id = schemas.schema_id
                                                  INNER JOIN sys.default_constraints
                                                    ON all_columns.default_object_id = default_constraints.object_id
                                                  WHERE schemas.name = '${this.schemaNameRaw||"dbo"}'
                                                  AND tables.name = '${this.tableNameRaw}'
                                                  AND all_columns.name = '${u.getColumnName()}')

              IF @constraint IS NOT NULL EXEC('ALTER TABLE ${this.tableNameRaw} DROP CONSTRAINT ' + @constraint)`;this.pushQuery(c)}}a.sql.forEach(s=>{this.pushQuery({sql:(this.lowerCase?"alter table ":"ALTER TABLE ")+this.tableName()+" "+(this.lowerCase?this.alterColumnPrefix.toLowerCase():this.alterColumnPrefix)+s,bindings:a.bindings})})}dropColumn(){const a=this,o=e.normalizeArr.apply(null,arguments),l=(Array.isArray(o)?o:[o]).map(h=>a.formatter.wrap(h)),u=this.schemaNameRaw||"dbo";for(const h of o){const c=`
              DECLARE @constraint varchar(100) = (SELECT default_constraints.name
                                                  FROM sys.all_columns
                                                  INNER JOIN sys.tables
                                                    ON all_columns.object_id = tables.object_id
                                                  INNER JOIN sys.schemas
                                                    ON tables.schema_id = schemas.schema_id
                                                  INNER JOIN sys.default_constraints
                                                    ON all_columns.default_object_id = default_constraints.object_id
                                                  WHERE schemas.name = '${u}'
                                                  AND tables.name = '${this.tableNameRaw}'
                                                  AND all_columns.name = '${h}')

              IF @constraint IS NOT NULL EXEC('ALTER TABLE ${this.tableNameRaw} DROP CONSTRAINT ' + @constraint)`;this.pushQuery(c)}this.pushQuery((this.lowerCase?"alter table ":"ALTER TABLE ")+this.tableName()+" "+this.dropColumnPrefix+l.join(", "))}changeType(){}renameColumn(a,o){this.pushQuery(`exec sp_rename ${this.client.parameter(this.tableName()+"."+a,this.tableBuilder,this.bindingsHolder)}, ${this.client.parameter(o,this.tableBuilder,this.bindingsHolder)}, 'COLUMN'`)}dropFKRefs(a,o){const s=this.client.formatter(this.tableBuilder);return Promise.all(o.map(function(l){const u=s.wrap(l.CONSTRAINT_NAME),h=s.wrap(l.TABLE_NAME);return a.query({sql:`ALTER TABLE ${h} DROP CONSTRAINT ${u}`})}))}createFKRefs(a,o){const s=this.client.formatter(this.tableBuilder);return Promise.all(o.map(function(l){const u=s.wrap(l.TABLE_NAME),h=s.wrap(l.CONSTRAINT_NAME),c=s.columnize(l.COLUMN_NAME),d=s.columnize(l.REFERENCED_COLUMN_NAME),p=s.wrap(l.REFERENCED_TABLE_NAME),g=` ON UPDATE ${l.UPDATE_RULE}`,_=` ON DELETE ${l.DELETE_RULE}`;return a.query({sql:`ALTER TABLE ${u} ADD CONSTRAINT ${h} FOREIGN KEY (`+c+") REFERENCES "+p+" ("+d+")"+g+_})}))}index(a,o,s){o=o?this.formatter.wrap(o):this._indexCommand("index",this.tableNameRaw,a);let l;t(s)&&({predicate:l}=s);const u=l?" "+this.client.queryCompiler(l).where():"";this.pushQuery(`CREATE INDEX ${o} ON ${this.tableName()} (${this.formatter.columnize(a)})${u}`)}primary(a,o){let s;t(o)&&({constraintName:o,deferrable:s}=o),s&&s!=="not deferrable"&&this.client.logger.warn(`mssql: primary key constraint [${o}] will not be deferrable ${s} because mssql does not support deferred constraints.`),o=o?this.formatter.wrap(o):this.formatter.wrap(`${this.tableNameRaw}_pkey`),this.forCreate?this.pushQuery(`CONSTRAINT ${o} PRIMARY KEY (${this.formatter.columnize(a)})`):this.pushQuery(`ALTER TABLE ${this.tableName()} ADD CONSTRAINT ${o} PRIMARY KEY (${this.formatter.columnize(a)})`)}unique(a,o){let s,l=!1,u;if(t(o)&&({indexName:o,deferrable:s,useConstraint:l,predicate:u}=o),s&&s!=="not deferrable"&&this.client.logger.warn(`mssql: unique index [${o}] will not be deferrable ${s} because mssql does not support deferred constraints.`),l&&u)throw new Error("mssql cannot create constraint with predicate");if(o=o?this.formatter.wrap(o):this._indexCommand("unique",this.tableNameRaw,a),Array.isArray(a)||(a=[a]),l)this.pushQuery(`ALTER TABLE ${this.tableName()} ADD CONSTRAINT ${o} UNIQUE (${this.formatter.columnize(a)})`);else{const h=u?" "+this.client.queryCompiler(u).where():" WHERE "+a.map(c=>this.formatter.columnize(c)+" IS NOT NULL").join(" AND ");this.pushQuery(`CREATE UNIQUE INDEX ${o} ON ${this.tableName()} (${this.formatter.columnize(a)})${h}`)}}dropIndex(a,o){o=o?this.formatter.wrap(o):this._indexCommand("index",this.tableNameRaw,a),this.pushQuery(`DROP INDEX ${o} ON ${this.tableName()}`)}dropForeign(a,o){o=o?this.formatter.wrap(o):this._indexCommand("foreign",this.tableNameRaw,a),this.pushQuery(`ALTER TABLE ${this.tableName()} DROP CONSTRAINT ${o}`)}dropPrimary(a){a=a?this.formatter.wrap(a):this.formatter.wrap(`${this.tableNameRaw}_pkey`),this.pushQuery(`ALTER TABLE ${this.tableName()} DROP CONSTRAINT ${a}`)}dropUnique(a,o){o=o?this.formatter.wrap(o):this._indexCommand("unique",this.tableNameRaw,a),this.pushQuery(`DROP INDEX ${o} ON ${this.tableName()}`)}}return n.prototype.createAlterTableMethods=["foreign","primary"],n.prototype.lowerCase=!1,n.prototype.addColumnsPrefix="ADD ",n.prototype.dropColumnPrefix="DROP COLUMN ",n.prototype.alterColumnPrefix="ALTER COLUMN ",Bi=n,Bi}var ki,ju;function oI(){if(ju)return ki;ju=1;const r=ft,{columnize:e}=K;class t extends r{constructor(i,a){super(i,a)}createQuery(i,a,o,s){let u="CREATE "+(s?"OR ALTER ":"")+"VIEW "+this.viewName();const h=i?" ("+e(i,this.viewBuilder,this.client,this.bindingsHolder)+")":"";u+=h,u+=" AS ",u+=a.toString(),this.pushQuery({sql:u})}renameColumn(i,a){this.pushQuery(`exec sp_rename ${this.client.parameter(this.viewName()+"."+i,this.viewBuilder,this.bindingsHolder)}, ${this.client.parameter(a,this.viewBuilder,this.bindingsHolder)}, 'COLUMN'`)}createOrReplace(){this.createQuery(this.columns,this.selectQuery,!1,!0)}}return ki=t,ki}var Mi,Qu;function aI(){if(Qu)return Mi;Qu=1;const r=Ue,{toNumber:e}=z,{formatDefault:t}=je,{operator:n}=K;class i extends r{constructor(o,s,l){super(o,s,l),this.modifiers=["nullable","defaultTo","first","after","comment"],this._addCheckModifiers()}double(o,s){return"float"}floating(o,s){return"float"}integer(){return"int"}tinyint(){return"tinyint"}varchar(o){return`nvarchar(${e(o,255)})`}timestamp({useTz:o=!1}={}){return o?"datetimeoffset":"datetime2"}bit(o){return o>1&&this.client.logger.warn("Bit field is exactly 1 bit length for MSSQL"),"bit"}binary(o){return o?`varbinary(${e(o)})`:"varbinary(max)"}first(){return this.client.logger.warn("Column first modifier not available for MSSQL"),""}after(o){return this.client.logger.warn("Column after modifier not available for MSSQL"),""}defaultTo(o,{constraintName:s}={}){const l=t(o,this.type,this.client);return s=typeof s<"u"?s:`${this.tableCompiler.tableNameRaw}_${this.getColumnName()}_default`.toLowerCase(),this.columnBuilder._method==="alter"?(this.pushAdditional(function(){this.pushQuery(`ALTER TABLE ${this.tableCompiler.tableName()} ADD CONSTRAINT ${this.formatter.wrap(s)} DEFAULT ${l} FOR ${this.formatter.wrap(this.getColumnName())}`)}),""):s?`CONSTRAINT ${this.formatter.wrap(s)} DEFAULT ${l}`:`DEFAULT ${l}`}comment(o){if(!o)return;o&&o.length>7500/2&&this.client.logger.warn("Your comment might be longer than the max comment length for MSSQL of 7,500 bytes.");const s=this.formatter.escapingStringDelimiters(o),l=this.tableCompiler.schemaNameRaw||"dbo",u=this.formatter.escapingStringDelimiters(this.tableCompiler.tableNameRaw),h=this.formatter.escapingStringDelimiters(this.args[0]||this.defaults("columnName")),c=`N'MS_Description', N'${s}', N'Schema', N'${l}', N'Table', N'${u}', N'Column', N'${h}'`;return this.pushAdditional(function(){const d=`EXISTS(SELECT * FROM sys.fn_listextendedproperty(N'MS_Description', N'Schema', N'${l}', N'Table', N'${u}', N'Column', N'${h}'))`;this.pushQuery(`IF ${d}
  EXEC sys.sp_updateextendedproperty ${c}
ELSE
  EXEC sys.sp_addextendedproperty ${c}`)}),""}checkLength(o,s,l){return this._check(`LEN(${this.formatter.wrap(this.getColumnName())}) ${n(o,this.columnBuilder,this.bindingsHolder)} ${e(s)}`,l)}checkRegex(o,s){return this._check(`${this.formatter.wrap(this.getColumnName())} LIKE ${this.client._escapeBinding("%"+o+"%")}`,s)}increments(o={primaryKey:!0}){return"int identity(1,1) not null"+(this.tableCompiler._canBeAddPrimaryKey(o)?" primary key":"")}bigincrements(o={primaryKey:!0}){return"bigint identity(1,1) not null"+(this.tableCompiler._canBeAddPrimaryKey(o)?" primary key":"")}}return i.prototype.bigint="bigint",i.prototype.mediumint="int",i.prototype.smallint="smallint",i.prototype.text="nvarchar(max)",i.prototype.mediumtext="nvarchar(max)",i.prototype.longtext="nvarchar(max)",i.prototype.json=i.prototype.jsonb="nvarchar(max)",i.prototype.enu="nvarchar(100)",i.prototype.uuid=({useBinaryUuid:a=!1}={})=>a?"binary(16)":"uniqueidentifier",i.prototype.datetime="datetime2",i.prototype.bool="bit",Mi=i,Mi}var ji,Du;function lI(){if(Du)return ji;Du=1;const r=Qe,e=eI(),t=He,n=tI(),i=rI(),a=nI(),o=iI(),s=sI(),l=oI(),u=aI(),h=Ee,c=ae("knex:mssql"),d={MIN:-2147483648,MAX:2147483647},p={MIN:-9007199254740991,MAX:9007199254740991};class g extends t{constructor(f={}){super(f)}_generateConnection(){const f=this.connectionSettings;f.options=f.options||{};const m={authentication:{type:f.type||"default",options:{userName:f.userName||f.user,password:f.password,domain:f.domain,token:f.token,clientId:f.clientId,clientSecret:f.clientSecret,tenantId:f.tenantId,msiEndpoint:f.msiEndpoint}},server:f.server||f.host,options:{database:f.database,encrypt:f.encrypt||!1,port:f.port||1433,connectTimeout:f.connectionTimeout||f.timeout||15e3,requestTimeout:e(f.requestTimeout)?15e3:f.requestTimeout,rowCollectionOnDone:!1,rowCollectionOnRequestCompletion:!1,useColumnNames:!1,tdsVersion:f.options.tdsVersion||"7_4",appName:f.options.appName||"knex",trustServerCertificate:!1,...f.options}};return m.options.instanceName&&delete m.options.port,isNaN(m.options.requestTimeout)&&(m.options.requestTimeout=15e3),m.options.requestTimeout===1/0&&(m.options.requestTimeout=0),m.options.requestTimeout<0&&(m.options.requestTimeout=0),f.debug&&(m.options.debug={packet:!0,token:!0,data:!0,payload:!0}),m}_driver(){return I}formatter(){return new n(this,...arguments)}transaction(){return new i(this,...arguments)}queryCompiler(){return new a(this,...arguments)}schemaCompiler(){return new o(this,...arguments)}tableCompiler(){return new s(this,...arguments)}viewCompiler(){return new l(this,...arguments)}queryBuilder(){return new h(this)}columnCompiler(){return new u(this,...arguments)}wrapIdentifierImpl(f){return f==="*"?"*":`[${f.replace(/[[\]]+/g,"")}]`}acquireRawConnection(){return new Promise((f,m)=>{c("connection::connection new connection requested");const y=this._driver(),w=Object.assign({},this._generateConnection()),$=new y.Connection(w);$.connect(E=>E?(c("connection::connect error: %s",E.message),m(E)):(c("connection::connect connected to server"),$.connected=!0,$.on("error",C=>{c("connection::error message=%s",C.message),$.__knex__disposed=C,$.connected=!1}),$.once("end",()=>{$.connected=!1,$.__knex__disposed="Connection to server was terminated.",c("connection::end connection ended.")}),f($)))})}validateConnection(f){return f&&f.connected}destroyRawConnection(f){return c("connection::destroy"),new Promise(m=>{f.once("end",()=>{m()}),f.close()})}positionBindings(f){let m=-1;return f.replace(/\\?\?/g,y=>y==="\\?"?"?":(m+=1,`@p${m}`))}_chomp(f){if(f.state.name==="LoggedIn"){const m=this.requestQueue.pop();m&&(c("connection::query executing query, %d more in queue",this.requestQueue.length),f.execSql(m))}}_enqueueRequest(f,m){this.requestQueue.push(f),this._chomp(m)}_makeRequest(f,m){const y=this._driver(),w=typeof f=="string"?f:f.sql;let $=0;if(!w)throw new Error("The query is empty");c("request::request sql=%s",w);const E=new y.Request(w,(C,T)=>{if(C)return c("request::error message=%s",C.message),m(C);$=T,c("request::callback rowCount=%d",$)});return E.on("prepared",()=>{c("request %s::request prepared",this.id)}),E.on("done",(C,T)=>{c("request::done rowCount=%d more=%s",C,T)}),E.on("doneProc",(C,T)=>{c("request::doneProc id=%s rowCount=%d more=%s",E.id,C,T)}),E.on("doneInProc",(C,T)=>{c("request::doneInProc id=%s rowCount=%d more=%s",E.id,C,T)}),E.once("requestCompleted",()=>(c("request::completed id=%s",E.id),m(null,$))),E.on("error",C=>(c("request::error id=%s message=%s",E.id,C.message),m(C))),E}_stream(f,m,y){return new Promise((w,$)=>{const E=this._makeRequest(m,C=>{if(C)return y.emit("error",C),$(C);w()});E.on("row",C=>{y.write(C.reduce((T,N)=>({...T,[N.metadata.colName]:N.value}),{}))}),E.on("error",C=>{y.emit("error",C),$(C)}),E.once("requestCompleted",()=>{y.end(),w()}),this._assignBindings(E,m.bindings),this._enqueueRequest(E,f)})}_assignBindings(f,m){if(Array.isArray(m))for(let y=0;y<m.length;y++){const w=m[y];this._setReqInput(f,y,w)}}_scaleForBinding(f){if(f%1===0)throw new Error(`The binding value ${f} must be a decimal number.`);return{scale:10}}_typeForBinding(f){const m=this._driver();if(this.connectionSettings.options&&this.connectionSettings.options.mapBinding){const y=this.connectionSettings.options.mapBinding(f);if(y)return[y.value,y.type]}switch(typeof f){case"string":return[f,m.TYPES.NVarChar];case"boolean":return[f,m.TYPES.Bit];case"number":{if(f%1!==0)return[f,m.TYPES.Float];if(f<d.MIN||f>d.MAX){if(f<p.MIN||f>p.MAX)throw new Error(`Bigint must be safe integer or must be passed as string, saw ${f}`);return[f,m.TYPES.BigInt]}return[f,m.TYPES.Int]}default:return f instanceof Date?[f,m.TYPES.DateTime]:f instanceof Buffer?[f,m.TYPES.VarBinary]:[f,m.TYPES.NVarChar]}}_query(f,m){return new Promise((y,w)=>{const $=[],E=this._makeRequest(m,(C,T)=>{if(C)return w(C);m.response=$,process.nextTick(()=>this._chomp(f)),y(m)});E.on("row",C=>{c("request::row"),$.push(C)}),this._assignBindings(E,m.bindings),this._enqueueRequest(E,f)})}_setReqInput(f,m,y){const[w,$]=this._typeForBinding(y),E="p".concat(m);let C;typeof w=="number"&&w%1!==0&&(C=this._scaleForBinding(w)),c("request::binding pos=%d type=%s value=%s",m,$.name,w),Buffer.isBuffer(w)&&(C={length:"max"}),f.addParameter(E,$,w,C)}processResponse(f,m){if(f==null)return;let{response:y}=f;const{method:w}=f;if(f.output||(y=y.map($=>$.reduce((E,C)=>{const T=C.metadata.colName;return E[T]?(Array.isArray(E[T])||(E[T]=[E[T]]),E[T].push(C.value)):E[T]=C.value,E},{})),f.output))return f.output.call(m,y);switch(w){case"select":return y;case"first":return y[0];case"pluck":return r(y,f.pluck);case"insert":case"del":case"update":case"counter":return f.returning&&f.returning==="@@rowcount"?y[0][""]:y;default:return y}}}return Object.assign(g.prototype,{requestQueue:[],dialect:"mssql",driverName:"mssql"}),ji=g,ji}var Qi,Fu;function uI(){if(Fu)return Qi;Fu=1;var r="Expected a function";function e(t,n,i){if(typeof t!="function")throw new TypeError(r);return setTimeout(function(){t.apply(void 0,i)},n)}return Qi=e,Qi}var Di,Uu;function cI(){if(Uu)return Di;Uu=1;var r=uI(),e=ln,t=e(function(n,i){return r(n,1,i)});return Di=t,Di}var Fi,Hu;function hI(){if(Hu)return Fi;Hu=1;const r=Ce,t=ae("knex:tx");class n extends r{query(a,o,s,l){const u=this,h=this.trxClient.query(a,o).catch(c=>{if(c.errno===1305){this.trxClient.logger.warn("Transaction was implicitly committed, do not mix transactions and DDL with MySQL (#805)");return}s=2,l=c,u._completed=!0,t("%s error running transaction query",u.txid)}).then(function(c){if(s===1&&u._resolver(l),s===2){if(l===void 0){if(u.doNotRejectOnRollback&&/^ROLLBACK\b/i.test(o)){u._resolver();return}l=new Error(`Transaction rejected with non-error: ${l}`)}u._rejecter(l)}return c});return(s===1||s===2)&&(u._completed=!0),h}}return Fi=n,Fi}var Ui,Vu;function dI(){if(Vu)return Ui;Vu=1;const r=I,e=ie,t=$e,n=le,i=De,{wrapAsIdentifier:a}=je,{columnize:o,wrap:s}=K,l=h=>t(h)||Array.isArray(h);class u extends i{constructor(c,d,p){super(c,d,p);const{returning:g}=this.single;g&&this.client.logger.warn(".returning() is not supported by mysql and will not have any effect."),this._emptyInsertValue="() values ()"}insert(){let c=super.insert();if(c==="")return c;const{ignore:d,merge:p,insert:g}=this.single;if(d&&(c=c.replace("insert into","insert ignore into")),p&&(c+=this._merge(p.updates,g),this.where()))throw new Error(".onConflict().merge().where() is not supported for mysql");return c}_merge(c,d){const p=" on duplicate key update ";if(c&&Array.isArray(c))return p+c.map(g=>a(g,this.formatter.builder,this.client)).map(g=>`${g} = values(${g})`).join(", ");if(c&&typeof c=="object"){const g=this._prepUpdate(c);return p+g.join(",")}else{const g=this._prepInsert(d);if(typeof g=="string")throw new Error("If using merge with a raw insert query, then updates must be provided");return p+g.columns.map(_=>a(_,this.builder,this.client)).map(_=>`${_} = values(${_})`).join(", ")}}update(){const c=this.with(),d=this.join(),p=this._prepUpdate(this.single.update),g=this.where(),_=this.order(),f=this.limit();return c+`update ${this.tableName}`+(d?` ${d}`:"")+" set "+p.join(", ")+(g?` ${g}`:"")+(_?` ${_}`:"")+(f?` ${f}`:"")}forUpdate(){return"for update"}forShare(){return"lock in share mode"}skipLocked(){return"skip locked"}noWait(){return"nowait"}columnInfo(){const c=this.single.columnInfo;return{sql:"select * from information_schema.columns where table_name = ? and table_schema = ?",bindings:[this.client.customWrapIdentifier(this.single.table,e),this.client.database()],output(p){const g=p.reduce(function(_,f){return _[f.COLUMN_NAME]={defaultValue:f.COLUMN_DEFAULT==="NULL"?null:f.COLUMN_DEFAULT,type:f.DATA_TYPE,maxLength:f.CHARACTER_MAXIMUM_LENGTH,nullable:f.IS_NULLABLE==="YES"},_},{});return c&&g[c]||g}}}limit(){const c=!this.single.limit&&this.single.limit!==0;return c&&!this.single.offset?"":`limit ${this.single.offset&&c?"18446744073709551615":this._getValueOrParameterFromAttribute("limit")}`}whereBasic(c){return r(!l(c.value),"The values in where clause must not be object or array."),super.whereBasic(c)}whereRaw(c){return r(n(c.value.bindings)||!Object.values(c.value.bindings).some(l),"The values in where clause must not be object or array."),super.whereRaw(c)}whereLike(c){return`${this._columnClause(c)} ${this._not(c,"like ")}${this._valueClause(c)} COLLATE utf8_bin`}whereILike(c){return`${this._columnClause(c)} ${this._not(c,"like ")}${this._valueClause(c)}`}jsonExtract(c){return this._jsonExtract(["json_extract","json_unquote"],c)}jsonSet(c){return this._jsonSet("json_set",c)}jsonInsert(c){return this._jsonSet("json_insert",c)}jsonRemove(c){const d=`json_remove(${o(c.column,this.builder,this.client,this.bindingsHolder)},${this.client.parameter(c.path,this.builder,this.bindingsHolder)})`;return c.alias?this.client.alias(d,this.formatter.wrap(c.alias)):d}whereJsonObject(c){return this._not(c,`json_contains(${this._columnClause(c)}, ${this._jsonValueClause(c)})`)}whereJsonPath(c){return this._whereJsonPath("json_extract",c)}whereJsonSupersetOf(c){return this._not(c,`json_contains(${s(c.column,void 0,this.builder,this.client,this.bindingsHolder)},${this._jsonValueClause(c)})`)}whereJsonSubsetOf(c){return this._not(c,`json_contains(${this._jsonValueClause(c)},${s(c.column,void 0,this.builder,this.client,this.bindingsHolder)})`)}onJsonPathEquals(c){return this._onJsonPathEquals("json_extract",c)}}return Ui=u,Ui}var Hi,Wu;function fI(){if(Wu)return Hi;Wu=1;const r=ct;class e extends r{constructor(n,i){super(n,i)}renameTable(n,i){this.pushQuery(`rename table ${this.formatter.wrap(n)} to ${this.formatter.wrap(i)}`)}renameView(n,i){this.renameTable(n,i)}hasTable(n){let i="select * from information_schema.tables where table_name = ?";const a=[n];this.schema?(i+=" and table_schema = ?",a.push(this.schema)):i+=" and table_schema = database()",this.pushQuery({sql:i,bindings:a,output:function(s){return s.length>0}})}hasColumn(n,i){this.pushQuery({sql:`show columns from ${this.formatter.wrap(n)}`,output(a){return a.some(o=>this.client.wrapIdentifier(o.Field.toLowerCase())===this.client.wrapIdentifier(i.toLowerCase()))}})}}return Hi=e,Hi}var Vi,zu;function pI(){if(zu)return Vi;zu=1;const r=ht,{isObject:e,isString:t}=M;class n extends r{constructor(a,o){super(a,o)}createQuery(a,o,s){const l=o?"create table if not exists ":"create table ",{client:u}=this;let h={},c=" ("+a.sql.join(", ");c+=this.primaryKeys()||"",c+=this._addChecks(),c+=")";let d=l+this.tableName()+(s&&this.tableNameLike()?" like "+this.tableNameLike():c);u.connectionSettings&&(h=u.connectionSettings);const p=this.single.charset||h.charset||"",g=this.single.collate||h.collate||"",_=this.single.engine||"";if(p&&!s&&(d+=` default character set ${p}`),g&&(d+=` collate ${g}`),_&&(d+=` engine = ${_}`),this.single.comment){const f=this.single.comment||"",m=1024;f.length>m&&this.client.logger.warn(`The max length for a table comment is ${m} characters`),d+=` comment = '${f}'`}this.pushQuery(d),s&&this.addColumns(a,this.addColumnsPrefix)}comment(a){this.pushQuery(`alter table ${this.tableName()} comment = '${a}'`)}changeType(){}renameColumn(a,o){const s=this,l=this.tableName(),u=this.formatter.wrap(a)+" "+this.formatter.wrap(o);this.pushQuery({sql:`show full fields from ${l} where field = `+this.client.parameter(a,this.tableBuilder,this.bindingsHolder),output(h){const c=h[0],d=this;return s.getFKRefs(d).then(([p])=>new Promise((g,_)=>{try{p.length||g(),g(s.dropFKRefs(d,p))}catch(f){_(f)}}).then(function(){let g=`alter table ${l} change ${u} ${c.Type}`;return String(c.Null).toUpperCase()!=="YES"?g+=" NOT NULL":g+=" NULL",c.Default!==void 0&&c.Default!==null&&(g+=` DEFAULT '${c.Default}'`),c.Collation!==void 0&&c.Collation!==null&&(g+=` COLLATE '${c.Collation}'`),c.Extra=="auto_increment"&&(g+=" AUTO_INCREMENT"),d.query({sql:g})}).then(function(){if(p.length)return s.createFKRefs(d,p.map(function(g){return g.REFERENCED_COLUMN_NAME===a&&(g.REFERENCED_COLUMN_NAME=o),g.COLUMN_NAME===a&&(g.COLUMN_NAME=o),g}))}))}})}primaryKeys(){const a=(this.grouped.alterTable||[]).filter(o=>o.method==="primary");if(a.length>0&&a[0].args.length>0){const o=a[0].args[0];let s=a[0].args[1]||"";if(s&&(s=" constraint "+this.formatter.wrap(s)),this.grouped.columns){const l=this._getIncrementsColumnNames();l.length&&l.forEach(u=>{o.includes(u)||o.unshift(u)})}return`,${s} primary key (${this.formatter.columnize(o)})`}}getFKRefs(a){const o={bindings:[]},s="SELECT KCU.CONSTRAINT_NAME, KCU.TABLE_NAME, KCU.COLUMN_NAME,        KCU.REFERENCED_TABLE_NAME, KCU.REFERENCED_COLUMN_NAME,        RC.UPDATE_RULE, RC.DELETE_RULE FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE AS KCU JOIN INFORMATION_SCHEMA.REFERENTIAL_CONSTRAINTS AS RC        USING(CONSTRAINT_NAME)WHERE KCU.REFERENCED_TABLE_NAME = "+this.client.parameter(this.tableNameRaw,this.tableBuilder,o)+"   AND KCU.CONSTRAINT_SCHEMA = "+this.client.parameter(this.client.database(),this.tableBuilder,o)+"   AND RC.CONSTRAINT_SCHEMA = "+this.client.parameter(this.client.database(),this.tableBuilder,o);return a.query({sql:s,bindings:o.bindings})}dropFKRefs(a,o){const s=this.client.formatter(this.tableBuilder);return Promise.all(o.map(function(l){const u=s.wrap(l.CONSTRAINT_NAME),h=s.wrap(l.TABLE_NAME);return a.query({sql:`alter table ${h} drop foreign key ${u}`})}))}createFKRefs(a,o){const s=this.client.formatter(this.tableBuilder);return Promise.all(o.map(function(l){const u=s.wrap(l.TABLE_NAME),h=s.wrap(l.CONSTRAINT_NAME),c=s.columnize(l.COLUMN_NAME),d=s.columnize(l.REFERENCED_COLUMN_NAME),p=s.wrap(l.REFERENCED_TABLE_NAME),g=` ON UPDATE ${l.UPDATE_RULE}`,_=` ON DELETE ${l.DELETE_RULE}`;return a.query({sql:`alter table ${u} add constraint ${h} foreign key (`+c+") references "+p+" ("+d+")"+g+_})}))}index(a,o,s){let l,u;t(s)?u=s:e(s)&&({indexType:u,storageEngineIndexType:l}=s),o=o?this.formatter.wrap(o):this._indexCommand("index",this.tableNameRaw,a),l=l?` using ${l}`:"",this.pushQuery(`alter table ${this.tableName()} add${u?` ${u}`:""} index ${o}(${this.formatter.columnize(a)})${l}`)}primary(a,o){let s;e(o)&&({constraintName:o,deferrable:s}=o),s&&s!=="not deferrable"&&this.client.logger.warn(`mysql: primary key constraint \`${o}\` will not be deferrable ${s} because mysql does not support deferred constraints.`),o=o?this.formatter.wrap(o):this.formatter.wrap(`${this.tableNameRaw}_pkey`);const l=a;let u=[];this.grouped.columns&&(u=this._getIncrementsColumnNames(),u&&u.forEach(h=>{l.includes(h)||l.unshift(h)})),this.method!=="create"&&this.method!=="createIfNot"&&this.pushQuery(`alter table ${this.tableName()} add primary key ${o}(${this.formatter.columnize(l)})`),u.length&&this.pushQuery(`alter table ${this.tableName()} modify column ${this.formatter.columnize(u)} int unsigned not null auto_increment`)}unique(a,o){let s,l;e(o)&&({indexName:o,deferrable:l,storageEngineIndexType:s}=o),l&&l!=="not deferrable"&&this.client.logger.warn(`mysql: unique index \`${o}\` will not be deferrable ${l} because mysql does not support deferred constraints.`),o=o?this.formatter.wrap(o):this._indexCommand("unique",this.tableNameRaw,a),s=s?` using ${s}`:"",this.pushQuery(`alter table ${this.tableName()} add unique ${o}(${this.formatter.columnize(a)})${s}`)}dropIndex(a,o){o=o?this.formatter.wrap(o):this._indexCommand("index",this.tableNameRaw,a),this.pushQuery(`alter table ${this.tableName()} drop index ${o}`)}dropForeign(a,o){o=o?this.formatter.wrap(o):this._indexCommand("foreign",this.tableNameRaw,a),this.pushQuery(`alter table ${this.tableName()} drop foreign key ${o}`)}dropPrimary(){this.pushQuery(`alter table ${this.tableName()} drop primary key`)}dropUnique(a,o){o=o?this.formatter.wrap(o):this._indexCommand("unique",this.tableNameRaw,a),this.pushQuery(`alter table ${this.tableName()} drop index ${o}`)}}return n.prototype.addColumnsPrefix="add ",n.prototype.alterColumnsPrefix="modify ",n.prototype.dropColumnPrefix="drop ",Vi=n,Vi}var Wi,Ku;function mI(){if(Ku)return Wi;Ku=1;const r=Ue,{isObject:e}=M,{toNumber:t}=z,n=new RegExp("(?<!\\\\)'","g");class i extends r{constructor(o,s,l){super(o,s,l),this.modifiers=["unsigned","nullable","defaultTo","comment","collate","first","after"],this._addCheckModifiers()}double(o,s){return o?`double(${t(o,8)}, ${t(s,2)})`:"double"}integer(o){return o=o?`(${t(o,11)})`:"",`int${o}`}tinyint(o){return o=o?`(${t(o,1)})`:"",`tinyint${o}`}text(o){switch(o){case"medium":case"mediumtext":return"mediumtext";case"long":case"longtext":return"longtext";default:return"text"}}mediumtext(){return this.text("medium")}longtext(){return this.text("long")}enu(o){return`enum('${o.join("', '")}')`}datetime(o){return e(o)&&({precision:o}=o),typeof o=="number"?`datetime(${o})`:"datetime"}timestamp(o){return e(o)&&({precision:o}=o),typeof o=="number"?`timestamp(${o})`:"timestamp"}time(o){return e(o)&&({precision:o}=o),typeof o=="number"?`time(${o})`:"time"}bit(o){return o?`bit(${t(o)})`:"bit"}binary(o){return o?`varbinary(${t(o)})`:"blob"}json(){return"json"}jsonb(){return"json"}defaultTo(o){if(o==null)return;if((this.type==="json"||this.type==="jsonb")&&e(o))return`default ('${JSON.stringify(o)}')`;const s=super.defaultTo.apply(this,arguments);return this.type!=="blob"&&this.type.indexOf("text")===-1?s:""}unsigned(){return"unsigned"}comment(o){return o&&o.length>255&&this.client.logger.warn("Your comment is longer than the max comment length for MySQL"),o&&`comment '${o.replace(n,"\\'")}'`}first(){return"first"}after(o){return`after ${this.formatter.wrap(o)}`}collate(o){return o&&`collate '${o}'`}checkRegex(o,s){return this._check(`${this.formatter.wrap(this.getColumnName())} REGEXP ${this.client._escapeBinding(o)}`,s)}increments(o={primaryKey:!0}){return"int unsigned not null"+(this.tableCompiler._canBeAddPrimaryKey(o)?" auto_increment primary key":"")}bigincrements(o={primaryKey:!0}){return"bigint unsigned not null"+(this.tableCompiler._canBeAddPrimaryKey(o)?" auto_increment primary key":"")}}return i.prototype.bigint="bigint",i.prototype.mediumint="mediumint",i.prototype.smallint="smallint",Wi=i,Wi}var zi,Ju;function gI(){if(Ju)return zi;Ju=1;const r=ft;class e extends r{constructor(n,i){super(n,i)}createOrReplace(){this.createQuery(this.columns,this.selectQuery,!1,!0)}}return zi=e,zi}var Ki,Gu;function yI(){if(Gu)return Ki;Gu=1;const r=It;class e extends r{constructor(){super(...arguments)}checkOption(){this._single.checkOption="default_option"}localCheckOption(){this._single.checkOption="local"}cascadedCheckOption(){this._single.checkOption="cascaded"}}return Ki=e,Ki}var Ji,Yu;function Xu(){if(Yu)return Ji;Yu=1;const r=cI(),e=Qe,{promisify:t}=I,n=He,i=hI(),a=dI(),o=fI(),s=pI(),l=mI(),{makeEscape:u}=Ur,h=gI(),c=yI();class d extends n{_driver(){return I}queryCompiler(g,_){return new a(this,g,_)}schemaCompiler(){return new o(this,...arguments)}tableCompiler(){return new s(this,...arguments)}viewCompiler(){return new h(this,...arguments)}viewBuilder(){return new c(this,...arguments)}columnCompiler(){return new l(this,...arguments)}transaction(){return new i(this,...arguments)}wrapIdentifierImpl(g){return g!=="*"?`\`${g.replace(/`/g,"``")}\``:"*"}acquireRawConnection(){return new Promise((g,_)=>{const f=this.driver.createConnection(this.connectionSettings);f.on("error",m=>{f.__knex__disposed=m}),f.connect(m=>{if(m)return f.removeAllListeners(),_(m);g(f)})})}async destroyRawConnection(g){try{return await t(f=>g.end(f))()}catch(_){g.__knex__disposed=_}finally{r(()=>g.removeAllListeners())}}validateConnection(g){return g.state==="connected"||g.state==="authenticated"}_stream(g,_,f,m){if(!_.sql)throw new Error("The query is empty");m=m||{};const y=Object.assign({sql:_.sql},_.options);return new Promise((w,$)=>{f.on("error",$),f.on("end",w);const E=g.query(y,_.bindings).stream(m);E.on("error",C=>{$(C),f.emit("error",C)}),E.pipe(f)})}_query(g,_){if((!_||typeof _=="string")&&(_={sql:_}),!_.sql)throw new Error("The query is empty");return new Promise(function(f,m){if(!_.sql){f();return}const y=Object.assign({sql:_.sql},_.options);g.query(y,_.bindings,function(w,$,E){if(w)return m(w);_.response=[$,E],f(_)})})}processResponse(g,_){if(g==null)return;const{response:f}=g,{method:m}=g,y=f[0],w=f[1];if(g.output)return g.output.call(_,y,w);switch(m){case"select":return y;case"first":return y[0];case"pluck":return e(y,g.pluck);case"insert":return[y.insertId];case"del":case"update":case"counter":return y.affectedRows;default:return f}}async cancelQuery(g){const _=await this.acquireRawConnection();try{return await this._wrappedCancelQueryCall(_,g)}finally{await this.destroyRawConnection(_),_.__knex__disposed&&this.logger.warn(`Connection Error: ${_.__knex__disposed}`)}}_wrappedCancelQueryCall(g,_){return this._query(g,{sql:"KILL QUERY ?",bindings:[_.threadId],options:{}})}}return Object.assign(d.prototype,{dialect:"mysql",driverName:"mysql",_escapeBinding:u(),canCancelQuery:!0}),Ji=d,Ji}var Gi,Zu;function bI(){if(Zu)return Gi;Zu=1;const r=Ce,e=ae("knex:tx");class t extends r{query(i,a,o,s){const l=this,u=this.trxClient.query(i,a).catch(h=>{if(h.code==="ER_SP_DOES_NOT_EXIST"){this.trxClient.logger.warn("Transaction was implicitly committed, do not mix transactions and DDL with MySQL (#805)");return}o=2,s=h,l._completed=!0,e("%s error running transaction query",l.txid)}).then(function(h){if(o===1&&l._resolver(s),o===2){if(s===void 0){if(l.doNotRejectOnRollback&&/^ROLLBACK\b/i.test(a)){l._resolver();return}s=new Error(`Transaction rejected with non-error: ${s}`)}return l._rejecter(s),h}});return(o===1||o===2)&&(l._completed=!0),u}}return Gi=t,Gi}var Yi,ec;function _I(){if(ec)return Yi;ec=1;const r=Xu(),e=bI();class t extends r{transaction(){return new e(this,...arguments)}_driver(){return I}validateConnection(i){return i&&!i._fatalError&&!i._protocolError&&!i._closing&&!i.stream.destroyed}}return Object.assign(t.prototype,{driverName:"mysql2"}),Yi=t,Yi}var Xi,tc;function Ve(){if(tc)return Xi;tc=1;function r(i,a,o,s){const l=I,u=30;Array.isArray(s)||(s=s?[s]:[]);const h=o.replace(/\.|-/g,"_"),c=s.join("_");let d=`${h}_${c.length?c+"_":""}${a}`.toLowerCase();return d.length>u&&(i.warn(`Automatically generated name "${d}" exceeds ${u} character limit for Oracle. Using base64 encoded sha1 of that name instead.`),d=l.createHash("sha1").update(d).digest("base64").replace("=","")),d}function e(i,a){return`begin execute immediate '${i.replace(/'/g,"''")}'; exception when others then if sqlcode != ${a} then raise; end if; end;`}function t(i){this.columnName=i}t.prototype.toString=function(){return`[object ReturningHelper:${this.columnName}]`};function n(i){return["DPI-1010","DPI-1080","ORA-03114","ORA-03113","ORA-03135","ORA-12514","ORA-00022","ORA-00028","ORA-00031","ORA-00045","ORA-00378","ORA-00602","ORA-00603","ORA-00609","ORA-01012","ORA-01041","ORA-01043","ORA-01089","ORA-01092","ORA-02396","ORA-03122","ORA-12153","ORA-12537","ORA-12547","ORA-12570","ORA-12583","ORA-27146","ORA-28511","ORA-56600","NJS-024","NJS-003"].some(function(a){return i.message.indexOf(a)===0})}return Xi={generateCombinedName:r,isConnectionError:n,wrapSqlWithCatch:e,ReturningHelper:t},Xi}var Zi,rc;function es(){if(rc)return Zi;rc=1;const r=Ve();return Zi={renameColumnTrigger:function(t,n,i,a){const o=r.generateCombinedName(t,"autoinc_trg",n),s=r.generateCombinedName(t,"seq",n);return`DECLARE PK_NAME VARCHAR(200); IS_AUTOINC NUMBER := 0; BEGIN  EXECUTE IMMEDIATE ('ALTER TABLE "${n}" RENAME COLUMN "${i}" TO "${a}"');  SELECT COUNT(*) INTO IS_AUTOINC from "USER_TRIGGERS" where trigger_name = '${o}';  IF (IS_AUTOINC > 0) THEN    SELECT cols.column_name INTO PK_NAME    FROM all_constraints cons, all_cons_columns cols    WHERE cons.constraint_type = 'P'    AND cons.constraint_name = cols.constraint_name    AND cons.owner = cols.owner    AND cols.table_name = '${n}';    IF ('${a}' = PK_NAME) THEN      EXECUTE IMMEDIATE ('DROP TRIGGER "${o}"');      EXECUTE IMMEDIATE ('create or replace trigger "${o}"      BEFORE INSERT on "${n}" for each row        declare        checking number := 1;        begin          if (:new."${a}" is null) then            while checking >= 1 loop              select "${s}".nextval into :new."${a}" from dual;              select count("${a}") into checking from "${n}"              where "${a}" = :new."${a}";            end loop;          end if;        end;');    end if;  end if;END;`},createAutoIncrementTrigger:function(t,n,i){const a=`"${n}"`,o=n,s=i?`"${i}".`:"",l=i?`'${i}'`:"cols.owner",u=r.generateCombinedName(t,"autoinc_trg",n),c=`"${r.generateCombinedName(t,"seq",n)}"`;return`DECLARE PK_NAME VARCHAR(200); BEGIN  EXECUTE IMMEDIATE ('CREATE SEQUENCE ${s}${c}');  SELECT cols.column_name INTO PK_NAME  FROM all_constraints cons, all_cons_columns cols  WHERE cons.constraint_type = 'P'  AND cons.constraint_name = cols.constraint_name  AND cons.owner = ${l}  AND cols.table_name = '${o}';  execute immediate ('create or replace trigger ${s}"${u}"  BEFORE INSERT on ${s}${a}  for each row  declare  checking number := 1;  begin    if (:new."' || PK_NAME || '" is null) then      while checking >= 1 loop        select ${s}${c}.nextval into :new."' || PK_NAME || '" from dual;        select count("' || PK_NAME || '") into checking from ${s}${a}        where "' || PK_NAME || '" = :new."' || PK_NAME || '";      end loop;    end if;  end;'); END;`},renameTableAndAutoIncrementTrigger:function(t,n,i){const a=r.generateCombinedName(t,"autoinc_trg",n),o=r.generateCombinedName(t,"seq",n),s=r.generateCombinedName(t,"autoinc_trg",i),l=r.generateCombinedName(t,"seq",i);return`DECLARE PK_NAME VARCHAR(200); IS_AUTOINC NUMBER := 0; BEGIN  EXECUTE IMMEDIATE ('RENAME "${n}" TO "${i}"');  SELECT COUNT(*) INTO IS_AUTOINC from "USER_TRIGGERS" where trigger_name = '${a}';  IF (IS_AUTOINC > 0) THEN    EXECUTE IMMEDIATE ('DROP TRIGGER "${a}"');    EXECUTE IMMEDIATE ('RENAME "${o}" TO "${l}"');    SELECT cols.column_name INTO PK_NAME    FROM all_constraints cons, all_cons_columns cols    WHERE cons.constraint_type = 'P'    AND cons.constraint_name = cols.constraint_name    AND cons.owner = cols.owner    AND cols.table_name = '${i}';    EXECUTE IMMEDIATE ('create or replace trigger "${s}"    BEFORE INSERT on "${i}" for each row      declare      checking number := 1;      begin        if (:new."' || PK_NAME || '" is null) then          while checking >= 1 loop            select "${l}".nextval into :new."' || PK_NAME || '" from dual;            select count("' || PK_NAME || '") into checking from "${i}"            where "' || PK_NAME || '" = :new."' || PK_NAME || '";          end loop;        end if;      end;');  end if;END;`}},Zi}var ts,nc;function wI(){if(nc)return ts;nc=1;const r=ct,e=Ve(),t=es();class n extends r{constructor(){super(...arguments)}renameTable(a,o){const s=t.renameTableAndAutoIncrementTrigger(this.client.logger,a,o);this.pushQuery(s)}hasTable(a){this.pushQuery({sql:"select TABLE_NAME from USER_TABLES where TABLE_NAME = "+this.client.parameter(a,this.builder,this.bindingsHolder),output(o){return o.length>0}})}hasColumn(a,o){const s=`select COLUMN_NAME from ALL_TAB_COLUMNS where TABLE_NAME = ${this.client.parameter(a,this.builder,this.bindingsHolder)} and COLUMN_NAME = ${this.client.parameter(o,this.builder,this.bindingsHolder)}`;this.pushQuery({sql:s,output:l=>l.length>0})}dropSequenceIfExists(a){const o=this.schema?`"${this.schema}".`:"";this.pushQuery(e.wrapSqlWithCatch(`drop sequence ${o}${this.formatter.wrap(a)}`,-2289))}_dropRelatedSequenceIfExists(a){const o=e.generateCombinedName(this.client.logger,"seq",a);this.dropSequenceIfExists(o)}dropTable(a){const o=this.schema?`"${this.schema}".`:"";this.pushQuery(`drop table ${o}${this.formatter.wrap(a)}`),this._dropRelatedSequenceIfExists(a)}dropTableIfExists(a){this.dropObject(a,"table")}dropViewIfExists(a){this.dropObject(a,"view")}dropObject(a,o){const s=this.schema?`"${this.schema}".`:"";let l=-942;o==="materialized view"&&(l=-12003),this.pushQuery(e.wrapSqlWithCatch(`drop ${o} ${s}${this.formatter.wrap(a)}`,l)),this._dropRelatedSequenceIfExists(a)}refreshMaterializedView(a){return this.pushQuery({sql:`BEGIN DBMS_MVIEW.REFRESH('${this.schemaNameRaw?this.schemaNameRaw+".":""}${a}'); END;`})}dropMaterializedView(a){this._dropView(a,!1,!0)}dropMaterializedViewIfExists(a){this.dropObject(a,"materialized view")}}return ts=n,ts}var rs,ic;function $I(){if(ic)return rs;ic=1;const r=qr,e=Ct;class t extends r{constructor(){super(...arguments)}checkIn(){return this._modifiers.checkIn=e(arguments),this}}return rs=t,rs}var ns,sc;function CI(){if(sc)return ns;sc=1;var r=kl;function e(t,n){var i=t==null?0:t.length;return!!i&&r(t,n,0)>-1}return ns=e,ns}var is,oc;function vI(){if(oc)return is;oc=1;function r(e,t,n){for(var i=-1,a=e==null?0:e.length;++i<a;)if(n(t,e[i]))return!0;return!1}return is=r,is}var ss,ac;function EI(){if(ac)return ss;ac=1;function r(){}return ss=r,ss}var os,lc;function TI(){if(lc)return os;lc=1;var r=bo,e=EI(),t=cr,n=1/0,i=r&&1/t(new r([,-0]))[1]==n?function(a){return new r(a)}:e;return os=i,os}var as,uc;function AI(){if(uc)return as;uc=1;var r=ja(),e=CI(),t=vI(),n=Ua(),i=TI(),a=cr,o=200;function s(l,u,h){var c=-1,d=e,p=l.length,g=!0,_=[],f=_;if(h)g=!1,d=t;else if(p>=o){var m=u?null:i(l);if(m)return a(m);g=!1,d=n,f=new r}else f=u?[]:_;e:for(;++c<p;){var y=l[c],w=u?u(y):y;if(y=h||y!==0?y:0,g&&w===w){for(var $=f.length;$--;)if(f[$]===w)continue e;u&&f.push(w),_.push(y)}else d(f,w,h)||(f!==_&&f.push(w),_.push(y))}return _}return as=s,as}var ls,cc;function OI(){if(cc)return ls;cc=1;var r=AI();function e(t){return t&&t.length?r(t):[]}return ls=e,ls}var us,hc;function NI(){if(hc)return us;hc=1;const r=es();function e(t){t.pushAdditional(function(){const n=this.tableCompiler.tableNameRaw,i=this.tableCompiler.schemaNameRaw,a=r.createAutoIncrementTrigger(this.client.logger,n,i);this.pushQuery(a)})}return us={createAutoIncrementTriggerAndSequence:e},us}var cs,dc;function fc(){if(dc)return cs;dc=1;const r=OI(),e=at,t=Ue,{createAutoIncrementTriggerAndSequence:n}=NI(),{toNumber:i}=z;class a extends t{constructor(){super(...arguments),this.modifiers=["defaultTo","checkIn","nullable","comment"]}increments(s={primaryKey:!0}){return n(this),"integer not null"+(this.tableCompiler._canBeAddPrimaryKey(s)?" primary key":"")}bigincrements(s={primaryKey:!0}){return n(this),"number(20, 0) not null"+(this.tableCompiler._canBeAddPrimaryKey(s)?" primary key":"")}floating(s){const l=i(s,0);return`float${l?`(${l})`:""}`}double(s,l){return`number(${i(s,8)}, ${i(l,2)})`}decimal(s,l){return s===null?"decimal":`decimal(${i(s,8)}, ${i(l,2)})`}integer(s){return s?`number(${i(s,11)})`:"integer"}enu(s){s=r(s);const l=(s||[]).reduce((u,h)=>Math.max(u,String(h).length),1);return this.columnBuilder._modifiers.checkIn=[s],`varchar2(${l})`}datetime(s){return s?"timestamp":"timestamp with time zone"}timestamp(s){return s?"timestamp":"timestamp with time zone"}bool(){return this.columnBuilder._modifiers.checkIn=[[0,1]],"number(1, 0)"}varchar(s){return`varchar2(${i(s,255)})`}comment(s){const l=this.args[0]||this.defaults("columnName");this.pushAdditional(function(){this.pushQuery(`comment on column ${this.tableCompiler.tableName()}.`+this.formatter.wrap(l)+" is '"+(s||"")+"'")},s)}checkIn(s){return s===void 0?"":(s instanceof e?s=s.toQuery():Array.isArray(s)?s=s.map(l=>`'${l}'`).join(", "):s=`'${s}'`,`check (${this.formatter.wrap(this.args[0])} in (${s}))`)}}return a.prototype.tinyint="smallint",a.prototype.smallint="smallint",a.prototype.mediumint="integer",a.prototype.biginteger="number(20, 0)",a.prototype.text="clob",a.prototype.time="timestamp with time zone",a.prototype.bit="clob",a.prototype.json="clob",cs=a,cs}var hs,pc;function mc(){if(pc)return hs;pc=1;const r=Ve(),e=ht,t=z,n=es(),{isObject:i}=M;class a extends e{constructor(){super(...arguments)}addColumns(s,l){if(s.sql.length>0){l=l||this.addColumnsPrefix;const u=s.sql;let c=`${this.lowerCase?"alter table ":"ALTER TABLE "}${this.tableName()} ${l}`;s.sql.length>1?c+=`(${u.join(", ")})`:c+=u.join(", "),this.pushQuery({sql:c,bindings:s.bindings})}}renameColumn(s,l){const u=this.tableName().slice(1,-1);return this.pushQuery(n.renameColumnTrigger(this.client.logger,u,s,l))}compileAdd(s){const l=this.formatter.wrap(s),u=this.prefixArray("add column",this.getColumns(s));return this.pushQuery({sql:`alter table ${l} ${u.join(", ")}`})}createQuery(s,l,u){const h=u&&this.tableNameLike()?" as (select * from "+this.tableNameLike()+" where 0=1)":" ("+s.sql.join(", ")+this._addChecks()+")",c=`create table ${this.tableName()}${h}`;this.pushQuery({sql:l?r.wrapSqlWithCatch(c,-955):c,bindings:s.bindings}),this.single.comment&&this.comment(this.single.comment),u&&this.addColumns(s,this.addColumnsPrefix)}comment(s){this.pushQuery(`comment on table ${this.tableName()} is '${s}'`)}dropColumn(){const s=t.normalizeArr.apply(null,arguments);this.pushQuery(`alter table ${this.tableName()} drop (${this.formatter.columnize(s)})`)}_indexCommand(s,l,u){return this.formatter.wrap(r.generateCombinedName(this.client.logger,s,l,u))}primary(s,l){let u;i(l)&&({constraintName:l,deferrable:u}=l),u=u?` deferrable initially ${u}`:"",l=l?this.formatter.wrap(l):this.formatter.wrap(`${this.tableNameRaw}_pkey`);const h=s;let c=[];this.grouped.columns&&(c=this._getIncrementsColumnNames(),c&&c.forEach(d=>{h.includes(d)||h.unshift(d)})),this.pushQuery(`alter table ${this.tableName()} add constraint ${l} primary key (${this.formatter.columnize(h)})${u}`)}dropPrimary(s){s=s?this.formatter.wrap(s):this.formatter.wrap(this.tableNameRaw+"_pkey"),this.pushQuery(`alter table ${this.tableName()} drop constraint ${s}`)}index(s,l){l=l?this.formatter.wrap(l):this._indexCommand("index",this.tableNameRaw,s),this.pushQuery(`create index ${l} on ${this.tableName()} (`+this.formatter.columnize(s)+")")}dropIndex(s,l){l=l?this.formatter.wrap(l):this._indexCommand("index",this.tableNameRaw,s),this.pushQuery(`drop index ${l}`)}unique(s,l){let u;i(l)&&({indexName:l,deferrable:u}=l),u=u?` deferrable initially ${u}`:"",l=l?this.formatter.wrap(l):this._indexCommand("unique",this.tableNameRaw,s),this.pushQuery(`alter table ${this.tableName()} add constraint ${l} unique (`+this.formatter.columnize(s)+")"+u)}dropUnique(s,l){l=l?this.formatter.wrap(l):this._indexCommand("unique",this.tableNameRaw,s),this.pushQuery(`alter table ${this.tableName()} drop constraint ${l}`)}dropForeign(s,l){l=l?this.formatter.wrap(l):this._indexCommand("foreign",this.tableNameRaw,s),this.pushQuery(`alter table ${this.tableName()} drop constraint ${l}`)}}return a.prototype.addColumnsPrefix="add ",a.prototype.alterColumnsPrefix="modify ",hs=a,hs}var ds,gc;function yc(){if(gc)return ds;gc=1;const{ReturningHelper:r}=Ve(),{isConnectionError:e}=Ve(),t=He,n=wI(),i=$I(),a=fc(),o=mc();class s extends t{schemaCompiler(){return new n(this,...arguments)}columnBuilder(){return new i(this,...arguments)}columnCompiler(){return new a(this,...arguments)}tableCompiler(){return new o(this,...arguments)}database(){return this.connectionSettings.database}positionBindings(u){let h=0;return u.replace(/\?/g,function(){return h+=1,`:${h}`})}_stream(u,h,c,d){if(!h.sql)throw new Error("The query is empty");return new Promise(function(p,g){c.on("error",f=>{e(f)&&(u.__knex__disposed=f),g(f)}),c.on("end",p);const _=u.queryStream(h.sql,h.bindings,d);_.pipe(c),_.on("error",function(f){g(f),c.emit("error",f)})})}alias(u,h){return u+" "+h}parameter(u,h,c){return u instanceof r&&this.driver?u=new this.driver.OutParam(this.driver.OCCISTRING):typeof u=="boolean"&&(u=u?1:0),super.parameter(u,h,c)}}return Object.assign(s.prototype,{dialect:"oracle",driverName:"oracle"}),ds=s,ds}var fs,bc;function qI(){if(bc)return fs;bc=1;const r=Ln,e=ie,t=le,n=$e,i=At,a=De,{ReturningHelper:o}=Ve(),{isString:s}=M,l=["columns","join","where","union","group","having","order","lock"];class u extends a{constructor(c,d,p){super(c,d,p);const{onConflict:g}=this.single;if(g)throw new Error(".onConflict() is not supported for oracledb.");this.first=this.select}insert(){let c=this.single.insert||[],{returning:d}=this.single;if(!Array.isArray(c)&&n(this.single.insert)&&(c=[this.single.insert]),d&&!Array.isArray(d)&&(d=[d]),Array.isArray(c)&&c.length===1&&t(c[0]))return this._addReturningToSqlAndConvert(`insert into ${this.tableName} (${this.formatter.wrap(this.single.returning)}) values (default)`,d,this.tableName);if(t(this.single.insert)&&typeof this.single.insert!="function")return"";const p=this._prepInsert(c),g={};if(s(p))return this._addReturningToSqlAndConvert(`insert into ${this.tableName} ${p}`,d);if(p.values.length===1)return this._addReturningToSqlAndConvert(`insert into ${this.tableName} (${this.formatter.columnize(p.columns)}) values (${this.client.parameterize(p.values[0],void 0,this.builder,this.bindingsHolder)})`,d,this.tableName);const _=p.columns.length===0;return g.sql="begin "+p.values.map(f=>{let m;const y=_?"":this.client.parameterize(f,this.client.valueForUndefined,this.builder,this.bindingsHolder),w=Array.isArray(d)?d:[d];let $=`insert into ${this.tableName} `;d&&(m=new o(w.join(":")),g.outParams=(g.outParams||[]).concat(m)),_?$+=`(${this.formatter.wrap(this.single.returning)}) values (default)`:$+=`(${this.formatter.columnize(p.columns)}) values (${y})`,$+=d?` returning ROWID into ${this.client.parameter(m,this.builder,this.bindingsHolder)}`:"",$=this.formatter.client.positionBindings($);const E=y.replace("DEFAULT, ","").replace(", DEFAULT","");return`execute immediate '${$.replace(/'/g,"''")}`+(E||d?"' using ":"")+E+(E&&d?", ":"")+(d?"out ?":"")+";"}).join(" ")+"end;",d&&(g.returning=d,g.returningSql=`select ${this.formatter.columnize(d)} from `+this.tableName+" where ROWID in ("+g.outParams.map((f,m)=>`:${m+1}`).join(", ")+") order by case ROWID "+g.outParams.map((f,m)=>`when CHARTOROWID(:${m+1}) then ${m}`).join(" ")+" end"),g}update(){const c=this._prepUpdate(this.single.update),d=this.where();let{returning:p}=this.single;const g=`update ${this.tableName} set `+c.join(", ")+(d?` ${d}`:"");return p?(Array.isArray(p)||(p=[p]),this._addReturningToSqlAndConvert(g,p,this.tableName)):g}truncate(){return`truncate table ${this.tableName}`}forUpdate(){return"for update"}forShare(){return this.client.logger.warn("lock for share is not supported by oracle dialect"),""}columnInfo(){const c=this.single.columnInfo;return{sql:`select * from xmltable( '/ROWSET/ROW'
      passing dbms_xmlgen.getXMLType('
      select char_col_decl_length, column_name, data_type, data_default, nullable
      from all_tab_columns where table_name = ''${this.client.customWrapIdentifier(this.single.table,e)}'' ')
      columns
      CHAR_COL_DECL_LENGTH number, COLUMN_NAME varchar2(200), DATA_TYPE varchar2(106),
      DATA_DEFAULT clob, NULLABLE varchar2(1))`,output(g){const _=i(g,function(f,m){return f[m.COLUMN_NAME]={type:m.DATA_TYPE,defaultValue:m.DATA_DEFAULT,maxLength:m.CHAR_COL_DECL_LENGTH,nullable:m.NULLABLE==="Y"},f},{});return c&&_[c]||_}}}select(){let c=this.with();const d=l.map(p=>this[p]());return c+=r(d).join(" "),this._surroundQueryWithLimitAndOffset(c)}aggregate(c){return this._aggregate(c,{aliasSeparator:" "})}_addReturningToSqlAndConvert(c,d,p){const g={sql:c};if(!d)return g;const _=Array.isArray(d)?d:[d],f=new o(_.join(":"));return g.sql=c+" returning ROWID into "+this.client.parameter(f,this.builder,this.bindingsHolder),g.returningSql=`select ${this.formatter.columnize(d)} from ${p} where ROWID = :1`,g.outParams=[f],g.returning=d,g}_surroundQueryWithLimitAndOffset(c){let{limit:d}=this.single;const{offset:p}=this.single,g=d||d===0||d==="0";if(d=+d,!g&&!p)return c;if(c=c||"",g&&!p)return`select * from (${c}) where rownum <= ${this._getValueOrParameterFromAttribute("limit",d)}`;const _=+p+(g?d:1e13);return"select * from (select row_.*, ROWNUM rownum_ from ("+c+") row_ where rownum <= "+(this.single.skipBinding.offset?_:this.client.parameter(_,this.builder,this.bindingsHolder))+") where rownum_ > "+this._getValueOrParameterFromAttribute("offset",p)}}return fs=u,fs}var ps,_c;function ms(){if(_c)return ps;_c=1;const r=Ve(),{promisify:e}=I,t=I;function n(s,l){this.columnName=s,this.value=l,this.returning=!1}n.prototype.toString=function(){return"[object BlobHelper:"+this.columnName+"]"};function i(s,l){return new Promise((u,h)=>{let c=l==="string"?"":Buffer.alloc(0);s.on("error",function(d){h(d)}),s.on("data",function(d){l==="string"?c+=d:c=Buffer.concat([c,d])}),s.on("end",function(){u(c)})})}const a=function(s){const l=I;let u;if(s.type)s.type===l.BLOB?u="buffer":s.type===l.CLOB&&(u="string");else if(s.iLob)s.iLob.type===l.CLOB?u="string":s.iLob.type===l.BLOB&&(u="buffer");else throw new Error("Unrecognized oracledb lob stream type");return u==="string"&&s.setEncoding("utf-8"),i(s,u)};function o(s,l){if(s.executeAsync)return;s.commitAsync=function(){return new Promise((h,c)=>{this.commit(function(d){if(d)return c(d);h()})})},s.rollbackAsync=function(){return new Promise((h,c)=>{this.rollback(function(d){if(d)return c(d);h()})})};const u=e(function(h,c,d,p){if(d=d||{},d.outFormat=l.driver.OUT_FORMAT_OBJECT||l.driver.OBJECT,!d.outFormat)throw new Error("not found oracledb.outFormat constants");d.resultSet?s.execute(h,c||[],d,function(g,_){if(g)return r.isConnectionError(g)&&(s.close().catch(function(w){}),s.__knex__disposed=g),p(g);const f={rows:[],resultSet:_.resultSet},m=100,y=function(w,$,E){$.getRows(E,function(C,T){if(C)r.isConnectionError(C)&&(w.close().catch(function(N){}),w.__knex__disposed=C),$.close(function(){return p(C)});else{if(T.length===0)return p(null,f);if(T.length>0)if(T.length===E)f.rows=f.rows.concat(T),y(w,$,E);else return f.rows=f.rows.concat(T),p(null,f)}})};y(s,_.resultSet,m)}):s.execute(h,c||[],d,function(g,_){return g?(r.isConnectionError(g)&&(s.close().catch(function(f){}),s.__knex__disposed=g),p(g)):p(null,_)})});s.executeAsync=function(h,c,d){return u(h,c,d).then(async p=>{const g=()=>p.resultSet?e(p.resultSet.close).call(p.resultSet):Promise.resolve(),_=[];if(p.rows&&Array.isArray(p.rows))for(let f=0;f<p.rows.length;f++){const m=p.rows[f];for(const y in m)m[y]instanceof t.Readable&&_.push({index:f,key:y,stream:m[y]})}try{for(const f of _)p.rows[f.index][f.key]=await a(f.stream)}catch(f){throw await g().catch(()=>{}),f}return await g(),p})}}return r.BlobHelper=n,r.monkeyPatchConnection=o,ps=r,ps}var gs,wc;function RI(){if(wc)return gs;wc=1;const r=fn,e=wt,t=le,n=$e,i=qI(),a=ms().ReturningHelper,o=ms().BlobHelper,{isString:s}=M,{columnize:l}=K;class u extends i{insert(){const c=this,d=this._prepOutbindings(this.single.insert,this.single.returning),p=d.outBinding,g=d.returning,_=d.values;if(Array.isArray(_)&&_.length===1&&t(_[0])){const w=this.single.returning?" ("+this.formatter.wrap(this.single.returning)+")":"";return this._addReturningToSqlAndConvert("insert into "+this.tableName+w+" values (default)",p[0],this.tableName,g)}if(t(this.single.insert)&&typeof this.single.insert!="function")return"";const f=this._prepInsert(_),m={};if(s(f))return this._addReturningToSqlAndConvert("insert into "+this.tableName+" "+f,p[0],this.tableName,g);if(f.values.length===1)return this._addReturningToSqlAndConvert("insert into "+this.tableName+" ("+this.formatter.columnize(f.columns)+") values ("+this.client.parameterize(f.values[0],void 0,this.builder,this.bindingsHolder)+")",p[0],this.tableName,g);const y=f.columns.length===0;return m.returning=g,m.sql="begin "+f.values.map(function(w,$){const E=y?"":c.client.parameterize(w,c.client.valueForUndefined,c.builder,c.bindingsHolder);let C="insert into "+c.tableName;y?C+=" ("+c.formatter.wrap(c.single.returning)+") values (default)":C+=" ("+c.formatter.columnize(f.columns)+") values ("+E+")";let T="",N="",P="",L="";e(w,function(H){H instanceof o||(P+=" ?,")}),P=P.slice(0,-1),p[$].forEach(function(H){const Q=H.columnName||H;if(T+=c.formatter.wrap(Q)+",",N+=" ?,",L+=" out ?,",H instanceof o)return c.formatter.bindings.push(H);c.formatter.bindings.push(new a(Q))}),T=T.slice(0,-1),N=N.slice(0,-1),L=L.slice(0,-1),T&&N&&(C+=" returning "+T+" into"+N),C=c.formatter.client.positionBindings(C);const G=E.replace(/DEFAULT, /g,"").replace(/, DEFAULT/g,"").replace("EMPTY_BLOB(), ","").replace(", EMPTY_BLOB()","");return"execute immediate '"+C.replace(/'/g,"''")+(G||w?"' using ":"")+G+(G&&L?",":"")+L+";"}).join(" ")+"end;",m.outBinding=p,g[0]==="*"&&(m.returningSql=function(){return"select * from "+c.tableName+" where ROWID in ("+this.outBinding.map(function(w,$){return":"+($+1)}).join(", ")+") order by case ROWID "+this.outBinding.map(function(w,$){return"when CHARTOROWID(:"+($+1)+") then "+$}).join(" ")+" end"}),m}with(){const c=[];if(this.grouped.with)for(const p of this.grouped.with)p.recursive&&(c.push(p),p.recursive=!1);const d=super.with();for(const p of c)p.recursive=!0;return d}_addReturningToSqlAndConvert(c,d,p,g){const _=this,f={sql:c};if(!d)return f;const m=Array.isArray(d)?d:[d];let y="",w="";return m.forEach(function($){const E=$.columnName||$;if(y+=_.formatter.wrap(E)+",",w+="?,",$ instanceof o)return _.formatter.bindings.push($);_.formatter.bindings.push(new a(E))}),f.sql=c,y=y.slice(0,-1),w=w.slice(0,-1),y&&w&&(f.sql+=" returning "+y+" into "+w),f.outBinding=[d],g[0]==="*"&&(f.returningSql=function(){return"select * from "+_.tableName+" where ROWID = :1"}),f.returning=g,f}_prepOutbindings(c,d){const p={};let g=c||[],_=d||[];!Array.isArray(g)&&n(c)&&(g=[g]),_&&!Array.isArray(_)&&(_=[_]);const f=[];return e(g,function(m,y){_[0]==="*"?f[y]=["ROWID"]:f[y]=r(_),e(m,function(w,$){if(w instanceof Buffer){m[$]=new o($,w);const E=f[y].indexOf($);E>=0&&(f[y].splice(E,1),m[$].returning=!0),f[y].push(m[$])}w===void 0&&delete g[y][$]})}),p.returning=_,p.outBinding=f,p.values=g,p}_groupOrder(c,d){return super._groupOrderNulls(c,d)}update(){const c=this,d={},p=this._prepOutbindings(this.single.update||this.single.counter,this.single.returning),g=p.outBinding,_=p.returning,f=this._prepUpdate(this.single.update),m=this.where();let y="",w="";return t(f)&&typeof this.single.update!="function"?"":(g.forEach(function($){$.forEach(function(E){const C=E.columnName||E;if(y+=c.formatter.wrap(C)+",",w+=" ?,",E instanceof o)return c.formatter.bindings.push(E);c.formatter.bindings.push(new a(C))})}),y=y.slice(0,-1),w=w.slice(0,-1),d.outBinding=g,d.returning=_,d.sql="update "+this.tableName+" set "+f.join(", ")+(m?" "+m:""),g.length&&!t(g[0])&&(d.sql+=" returning "+y+" into"+w),_[0]==="*"&&(d.returningSql=function(){let $="select * from "+c.tableName;const E=this.rowsAffected.length||this.rowsAffected;let C=" where ROWID in (",T=") order by case ROWID ";for(let N=0;N<E;N++)this.returning[0]==="*"&&(C+=":"+(N+1)+", ",T+="when CHARTOROWID(:"+(N+1)+") then "+N+" ");return this.returning[0]==="*"&&(this.returning=this.returning.slice(0,-1),C=C.slice(0,-2),T=T.slice(0,-1)),$+=C+T+" end"}),d)}_jsonPathWrap(c){return`'${c.path||c[1]}'`}jsonExtract(c){return this._jsonExtract(c.singleValue?"json_value":"json_query",c)}jsonSet(c){return`json_transform(${l(c.column,this.builder,this.client,this.bindingsHolder)}, set ${this.client.parameter(c.path,this.builder,this.bindingsHolder)} = ${this.client.parameter(c.value,this.builder,this.bindingsHolder)})`}jsonInsert(c){return`json_transform(${l(c.column,this.builder,this.client,this.bindingsHolder)}, insert ${this.client.parameter(c.path,this.builder,this.bindingsHolder)} = ${this.client.parameter(c.value,this.builder,this.bindingsHolder)})`}jsonRemove(c){const d=`json_transform(${l(c.column,this.builder,this.client,this.bindingsHolder)}, remove ${this.client.parameter(c.path,this.builder,this.bindingsHolder)})`;return c.alias?this.client.alias(d,this.formatter.wrap(c.alias)):d}whereJsonPath(c){return this._whereJsonPath("json_value",c)}whereJsonSupersetOf(c){throw new Error("Json superset where clause not actually supported by Oracle")}whereJsonSubsetOf(c){throw new Error("Json subset where clause not actually supported by Oracle")}onJsonPathEquals(c){return this._onJsonPathEquals("json_value",c)}}return gs=u,gs}var ys,$c;function SI(){if($c)return ys;$c=1;const r=mc();class e extends r{constructor(n,i){super(n,i)}_setNullableState(n,i){const a=i?"NULL":"NOT NULL",o=`alter table ${this.tableName()} modify (${this.formatter.wrap(n)} ${a})`;return this.pushQuery({sql:o})}}return ys=e,ys}var bs,Cc;function xI(){if(Cc)return bs;Cc=1;const r=fc(),{isObject:e}=M;class t extends r{constructor(){super(...arguments),this.modifiers=["defaultTo","nullable","comment"],this._addCheckModifiers()}datetime(i){let a;return e(i)?{useTz:a}=i:a=!i,a?"timestamp with local time zone":"timestamp"}timestamp(i){let a;return e(i)?{useTz:a}=i:a=!i,a?"timestamp with local time zone":"timestamp"}checkRegex(i,a){return this._check(`REGEXP_LIKE(${this.formatter.wrap(this.getColumnName())},${this.client._escapeBinding(i)})`,a)}json(){return`varchar2(4000) check (${this.formatter.columnize(this.getColumnName())} is json)`}jsonb(){return this.json()}}return t.prototype.time="timestamp with local time zone",t.prototype.uuid=({useBinaryUuid:n=!1}={})=>n?"raw(16)":"char(36)",bs=t,bs}var _s,vc;function II(){if(vc)return _s;vc=1;const r=ft;class e extends r{constructor(n,i){super(n,i)}createOrReplace(){this.createQuery(this.columns,this.selectQuery,!1,!0)}createMaterializedView(){this.createQuery(this.columns,this.selectQuery,!0)}}return _s=e,_s}var ws,Ec;function PI(){if(Ec)return ws;Ec=1;const r=It;class e extends r{constructor(){super(...arguments)}checkOption(){this._single.checkOption="default_option"}}return ws=e,ws}var $s,Tc;function LI(){if(Tc)return $s;Tc=1;const r=Ce,{timeout:e,KnexTimeoutError:t}=we,n=ae("knex:tx");return $s=class extends r{begin(a){return this.isolationLevel&&this.client.logger.warn("Transaction isolation is not currently supported for Oracle"),Promise.resolve()}async commit(a,o){this._completed=!0;try{await a.commitAsync(),this._resolver(o)}catch(s){this._rejecter(s)}}release(a,o){return this._resolver(o)}rollback(a,o){return this._completed=!0,n("%s: rolling back",this.txid),e(a.rollbackAsync(),5e3).catch(s=>{if(!(s instanceof t))return Promise.reject(s);this._rejecter(s)}).then(()=>{if(o===void 0){if(this.doNotRejectOnRollback){this._resolver();return}o=new Error(`Transaction rejected with non-error: ${o}`)}this._rejecter(o)})}savepoint(a){return this.query(a,`SAVEPOINT ${this.txid}`)}async acquireConnection(a,o){const s=a&&a.connection,l=s||await this.client.acquireConnection();try{return l.__knexTxId=this.txid,l.isTransaction=!0,await o(l)}finally{n("%s: releasing connection",this.txid),l.isTransaction=!1;try{await l.commitAsync()}catch(u){this._rejecter(u)}finally{s?n("%s: not releasing external connection",this.txid):await this.client.releaseConnection(l)}}}},$s}var Cs,Ac;function BI(){if(Ac)return Cs;Ac=1;const r=wt,e=wa,t=le,n=Qe,i=Rr,a=RI(),o=SI(),s=xI(),{BlobHelper:l,ReturningHelper:u,monkeyPatchConnection:h}=ms(),c=II(),d=PI(),p=LI(),g=yc(),{isString:_}=M,{outputQuery:f,unwrapRaw:m}=K,{compileCallback:y}=je;class w extends g{constructor(C){super(C),this.driver&&(process.env.UV_THREADPOOL_SIZE=process.env.UV_THREADPOOL_SIZE||1,process.env.UV_THREADPOOL_SIZE=parseInt(process.env.UV_THREADPOOL_SIZE)+this.driver.poolMax)}_driver(){const C=this,T=I;return C.fetchAsString=[],this.config.fetchAsString&&Array.isArray(this.config.fetchAsString)&&this.config.fetchAsString.forEach(function(N){_(N)&&(N=N.toUpperCase(),T[N]&&(N!=="NUMBER"&&N!=="DATE"&&N!=="CLOB"&&N!=="BUFFER"&&this.logger.warn('Only "date", "number", "clob" and "buffer" are supported for fetchAsString'),C.fetchAsString.push(T[N])))}),T}queryCompiler(C,T){return new a(this,C,T)}tableCompiler(){return new o(this,...arguments)}columnCompiler(){return new s(this,...arguments)}viewBuilder(){return new d(this,...arguments)}viewCompiler(){return new c(this,...arguments)}formatter(C){return new i(this,C)}transaction(){return new p(this,...arguments)}prepBindings(C){return n(C,T=>T instanceof l&&this.driver?{type:this.driver.BLOB,dir:this.driver.BIND_OUT}:T instanceof u&&this.driver?{type:this.driver.STRING,dir:this.driver.BIND_OUT}:typeof T=="boolean"?T?1:0:T)}parameter(C,T,N){return typeof C=="function"?f(y(C,void 0,this,N),!0,T,this):C instanceof l?(N.bindings.push(C.value),"?"):m(C,!0,T,this,N)||"?"}acquireRawConnection(){const C=this;return new Promise(function(N,P){const L=C.connectionSettings.externalAuth?{externalAuth:C.connectionSettings.externalAuth}:{user:C.connectionSettings.user,password:C.connectionSettings.password};L.connectString=$(C.connectionSettings),C.connectionSettings.prefetchRowCount&&(L.prefetchRows=C.connectionSettings.prefetchRowCount),C.connectionSettings.stmtCacheSize!==void 0&&(L.stmtCacheSize=C.connectionSettings.stmtCacheSize),C.driver.fetchAsString=C.fetchAsString,C.driver.getConnection(L,function(G,H){if(G)return P(G);h(H,C),N(H)})})}destroyRawConnection(C){return C.release()}_query(C,T){if(!T.sql)throw new Error("The query is empty");const N={autoCommit:!1};return T.method==="select"&&(N.resultSet=!0),C.executeAsync(T.sql,T.bindings,N).then(async function(P){let L=e(P.outBinds);if(T.response=P.rows||[],T.rowsAffected=P.rows?P.rows.rowsAffected:P.rowsAffected,T.method==="raw"&&L.length>0)return{response:L};if(T.method==="update"){const Q=T.rowsAffected.length||T.rowsAffected,_e=[],ee=[],se=te=>function(W,Z){const We=Z*Q;ee.push(L[te+We])};for(let te=0;te<Q;te++)_e.push(T.outBinding[0]),r(T.outBinding[0],se(te));L=ee,T.outBinding=_e}if(!T.returning&&L.length===0)return C.isTransaction||await C.commitAsync(),T;const G=[];let H=0;for(let Q=0;Q<T.outBinding.length;Q++){const _e=T.outBinding[Q];H=H+(T.outBinding[Q-1]?T.outBinding[Q-1].length:0);for(let ee=0;ee<_e.length;ee++){const se=_e[ee];await new Promise(function(te,W){if(se instanceof l){const Z=L[ee+H];se.returning&&(T.response[Q]=T.response[Q]||{},T.response[Q][se.columnName]=se.value),Z.on("error",function(We){W(We)}),Z.on("finish",function(){te()}),Z.write(se.value),Z.end()}else T.outBinding[Q][ee]==="ROWID"?(G.push(L[ee+H]),te()):(T.response[Q]=T.response[Q]||{},T.response[Q][se]=L[ee+H],te())})}}if(C.isTransaction)return T;if(await C.commitAsync(),T.returningSql){const Q=await C.executeAsync(T.returningSql(),G,{resultSet:!0});T.response=Q.rows}return T})}processResponse(C,T){const{response:N}=C;if(C.output)return C.output.call(T,N);switch(C.method){case"select":return N;case"first":return N[0];case"pluck":return n(N,C.pluck);case"insert":case"del":case"update":case"counter":return C.returning&&!t(C.returning)?N:C.rowsAffected!==void 0?C.rowsAffected:1;default:return N}}processPassedConnection(C){h(C,this)}}w.prototype.driverName="oracledb";function $(E){return E.connectString?E.connectString:E.port?E.host+":"+E.port+"/"+E.database:E.host+"/"+E.database}return Cs=w,Cs}var vs,Oc;function kI(){if(Oc)return vs;Oc=1;const r=xr();class e extends r{constructor(...n){super(...n),this.driverName="pgnative",this.canCancelQuery=!0}_driver(){return I.native}_stream(n,i,a,o){if(!i.sql)throw new Error("The query is empty");const s=this;return new Promise((l,u)=>(a.on("error",u),a.on("end",l),s._query(n,i).then(h=>h.response).then(({rows:h})=>h.forEach(c=>a.write(c))).catch(function(h){a.emit("error",h)}).then(function(){a.end()})))}async cancelQuery(n){try{return await this._wrappedCancelQueryCall(null,n)}catch(i){throw this.logger.warn(`Connection Error: ${i}`),i}}_wrappedCancelQueryCall(n,i){return new Promise(function(a,o){i.native.cancel(function(s){if(s){o(s);return}a(!0)})})}}return vs=e,vs}var Es,Nc;function MI(){if(Nc)return Es;Nc=1;const r=Ce;return Es=class extends r{begin(t){return this.isolationLevel?this.query(t,`BEGIN ISOLATION LEVEL ${this.isolationLevel};`):this.query(t,"BEGIN;")}savepoint(t){return this.trxClient.logger("Redshift does not support savepoints."),Promise.resolve()}release(t,n){return this.trxClient.logger("Redshift does not support savepoints."),Promise.resolve()}rollbackTo(t,n){return this.trxClient.logger("Redshift does not support savepoints."),Promise.resolve()}},Es}var Ts,qc;function jI(){if(qc)return Ts;qc=1;const r=De,e=pi(),t=ie,{columnize:n}=K;class i extends e{truncate(){return`truncate ${this.tableName.toLowerCase()}`}insert(){const o=r.prototype.insert.apply(this,arguments);return o===""?o:(this._slightReturn(),{sql:o})}update(){const o=r.prototype.update.apply(this,arguments);return this._slightReturn(),{sql:o}}del(){const o=r.prototype.del.apply(this,arguments);return this._slightReturn(),{sql:o}}_slightReturn(){this.single.isReturning&&this.client.logger.warn("insert/update/delete returning is not supported by redshift dialect")}forUpdate(){return this.client.logger.warn("table lock is not supported by redshift dialect"),""}forShare(){return this.client.logger.warn("lock for share is not supported by redshift dialect"),""}forNoKeyUpdate(){return this.client.logger.warn("table lock is not supported by redshift dialect"),""}forKeyShare(){return this.client.logger.warn("lock for share is not supported by redshift dialect"),""}columnInfo(){const o=this.single.columnInfo;let s=this.single.schema;const l=this.client.customWrapIdentifier(this.single.table,t);s&&(s=this.client.customWrapIdentifier(s,t));const u="select * from information_schema.columns where table_name = ? and table_catalog = ?",h=[l.toLowerCase(),this.client.database().toLowerCase()];return this._buildColumnInfoQuery(s,u,h,o)}jsonExtract(o){let s;return Array.isArray(o.column)?s=o.column:s=[o],s.map(l=>{const u=`json_extract_path_text(${n(l.column||l[0],this.builder,this.client,this.bindingsHolder)}, ${this.client.toPathForJson(o.path||l[1],this.builder,this.bindingsHolder)})`,h=l.alias||l[2];return h?this.client.alias(u,this.formatter.wrap(h)):u}).join(", ")}jsonSet(o){throw new Error("Json set is not supported by Redshift")}jsonInsert(o){throw new Error("Json insert is not supported by Redshift")}jsonRemove(o){throw new Error("Json remove is not supported by Redshift")}whereJsonPath(o){return this._whereJsonPath("json_extract_path_text",Object.assign({},o,{path:this.client.toPathForJson(o.path)}))}whereJsonSupersetOf(o){throw new Error("Json superset is not supported by Redshift")}whereJsonSubsetOf(o){throw new Error("Json subset is not supported by Redshift")}onJsonPathEquals(o){return this._onJsonPathEquals("json_extract_path_text",o)}}return Ts=i,Ts}var As,Rc;function QI(){if(Rc)return As;Rc=1;const r=qr;class e extends r{constructor(){super(...arguments)}primary(){return this.notNullable(),super.primary(...arguments)}index(){return this.client.logger.warn("Redshift does not support the creation of indexes."),this}}return As=e,As}var Os,Sc;function DI(){if(Sc)return Os;Sc=1;const r=yi(),e=Ue;class t extends r{constructor(){super(...arguments)}bit(i){return i.length!==!1?`char(${i.length})`:"char(1)"}datetime(i){return i?"timestamp":"timestamptz"}timestamp(i){return i?"timestamp":"timestamptz"}comment(i){this.pushAdditional(function(){this.pushQuery(`comment on column ${this.tableCompiler.tableName()}.`+this.formatter.wrap(this.args[0])+" is "+(i?`'${i}'`:"NULL"))},i)}}return t.prototype.increments=({primaryKey:n=!0}={})=>"integer identity(1,1)"+(n?" primary key":"")+" not null",t.prototype.bigincrements=({primaryKey:n=!0}={})=>"bigint identity(1,1)"+(n?" primary key":"")+" not null",t.prototype.binary="varchar(max)",t.prototype.blob="varchar(max)",t.prototype.enu="varchar(255)",t.prototype.enum="varchar(255)",t.prototype.json="varchar(max)",t.prototype.jsonb="varchar(max)",t.prototype.longblob="varchar(max)",t.prototype.mediumblob="varchar(16777218)",t.prototype.set="text",t.prototype.text="varchar(max)",t.prototype.tinyblob="varchar(256)",t.prototype.uuid=e.prototype.uuid,t.prototype.varbinary="varchar(max)",t.prototype.bigint="bigint",t.prototype.bool="boolean",t.prototype.double="double precision",t.prototype.floating="real",t.prototype.smallint="smallint",t.prototype.tinyint="smallint",Os=t,Os}var Ns,xc;function FI(){if(xc)return Ns;xc=1;const r=wr,e=_i();class t extends e{constructor(){super(...arguments)}index(i,a,o){this.client.logger.warn("Redshift does not support the creation of indexes.")}dropIndex(i,a){this.client.logger.warn("Redshift does not support the deletion of indexes.")}createQuery(i,a,o){const s=a?"create table if not exists ":"create table ",l=" ("+i.sql.join(", ")+this._addChecks()+")";let u=s+this.tableName()+(o&&this.tableNameLike()?" (like "+this.tableNameLike()+")":l);this.single.inherits&&(u+=` like (${this.formatter.wrap(this.single.inherits)})`),this.pushQuery({sql:u,bindings:i.bindings}),r(this.single,"comment")&&this.comment(this.single.comment),o&&this.addColumns(i,this.addColumnsPrefix)}primary(i,a){const o=this;a=a?o.formatter.wrap(a):o.formatter.wrap(`${this.tableNameRaw}_pkey`),i.constructor!==Array&&(i=[i]);const s=o.grouped.columns;if(s)for(let l=0;l<i.length;l++){let u=s.find(c=>c.grouping==="columns"&&c.builder&&c.builder._method==="add"&&c.builder._args&&c.builder._args.indexOf(i[l])>-1);if(u&&(u=u.builder),!(u&&u._modifiers&&u._modifiers.nullable&&u._modifiers.nullable[0]===!1))return u?this.client.logger.warn("Redshift does not allow primary keys to contain nullable columns."):this.client.logger.warn("Redshift does not allow primary keys to contain nonexistent columns.")}return o.pushQuery(`alter table ${o.tableName()} add constraint ${a} primary key (${o.formatter.columnize(i)})`)}addColumns(i,a,o){if(a===this.alterColumnsPrefix)super.addColumns(i,a,o);else{a=a||this.addColumnsPrefix,o=o||this.getColumns();for(const s of o){const l=this.tableName(),u=s.compileColumn();this.pushQuery({sql:`alter table ${l} ${a}${u}`,bindings:[]})}}}}return Ns=t,Ns}var qs,Ic;function UI(){if(Ic)return qs;Ic=1;const r=Tu();class e extends r{constructor(){super(...arguments)}}return qs=e,qs}var Rs,Pc;function HI(){if(Pc)return Rs;Pc=1;const r=$i();class e extends r{constructor(n,i){super(n,i)}}return Rs=e,Rs}var Ss,Lc;function VI(){if(Lc)return Ss;Lc=1;const r=xr(),e=Qe,t=MI(),n=jI(),i=QI(),a=DI(),o=FI(),s=UI(),l=HI();class u extends r{transaction(){return new t(this,...arguments)}queryCompiler(c,d){return new n(this,c,d)}columnBuilder(){return new i(this,...arguments)}columnCompiler(){return new a(this,...arguments)}tableCompiler(){return new o(this,...arguments)}schemaCompiler(){return new s(this,...arguments)}viewCompiler(){return new l(this,...arguments)}_driver(){return I}processResponse(c,d){const p=c.response;return c.output?c.output.call(d,p):c.method==="raw"?p:p.command==="SELECT"?c.method==="first"?p.rows[0]:c.method==="pluck"?e(p.rows,c.pluck):p.rows:p.command==="INSERT"||p.command==="UPDATE"||p.command==="DELETE"?p.rowCount:p}toPathForJson(c,d,p){return c.replace(/^(\$\.)/,"").split(".").map((function(g){return this.parameter(g,d,p)}).bind(this)).join(", ")}}return Object.assign(u.prototype,{dialect:"redshift",driverName:"pg-redshift"}),Ss=u,Ss}Object.defineProperty(Sr,"__esModule",{value:!0}),Sr.getDialectByNameOrAlias=void 0;const{resolveClientNameWithAliases:WI}=z,zI=Object.freeze({"better-sqlite3":()=>Vx(),cockroachdb:()=>Zx(),mssql:()=>lI(),mysql:()=>Xu(),mysql2:()=>_I(),oracle:()=>yc(),oracledb:()=>BI(),pgnative:()=>kI(),postgres:()=>xr(),redshift:()=>VI(),sqlite3:()=>pu()});function KI(r){const e=WI(r),t=zI[e];if(!t)throw new Error(`Invalid clientName given: ${r}`);return t()}Sr.getDialectByNameOrAlias=KI;const JI=He,{SUPPORTED_CLIENTS:GI}=On,Bc=Ax,{getDialectByNameOrAlias:YI}=Sr;function XI(r){let e,t;const n=typeof r=="string"?Object.assign(Bc(r),arguments[2]):r;if(arguments.length===0||!n.client&&!n.dialect)e=JI;else if(typeof n.client=="function")e=n.client;else{const i=n.client||n.dialect;if(!GI.includes(i))throw new Error(`knex: Unknown configuration option 'client' value ${i}. Note that it is case-sensitive, check documentation for supported values.`);e=YI(i)}return typeof n.connection=="string"?t=Object.assign({},n,{connection:Bc(n.connection).connection}):t=Object.assign({},n),{resolvedConfig:t,Dialect:e}}var ZI={resolveConfig:XI};const e0=He,t0=Ee,r0=ra,n0=Ta,{KnexTimeoutError:i0}=we,{resolveConfig:s0}=ZI,o0=Il,a0=It,l0=qr,u0=Bl;function Ne(r){const{resolvedConfig:e,Dialect:t}=s0(...arguments),n=n0(new t(e));return e.userParams&&(n.userParams=e.userParams),n}Ne.Client=e0,Ne.KnexTimeoutError=i0,Ne.QueryBuilder={extend:function(r,e){t0.extend(r,e),r0.push(r)}},Ne.SchemaBuilder={extend:function(r,e){o0.extend(r,e)}},Ne.ViewBuilder={extend:function(r,e){a0.extend(r,e)}},Ne.ColumnBuilder={extend:function(r,e){l0.extend(r,e)}},Ne.TableBuilder={extend:function(r,e){u0.extend(r,e)}};var c0=Ne,h0=c0;const Pt=h0;Pt.knex=Pt,Pt.default=Pt;var d0=Pt;class f0 extends d0.knex.Client{constructor(e={}){super(e),this.driverName="odbc",this.driverName&&e.connection&&(this.initializeDriver(),(!e.pool||e.pool&&e.pool.max!==0)&&this.initializePool(e))}_driver(){return require("odbc")}wrapIdentifierImpl(e){return e}printDebug(e){(void 0).DEBUG}async acquireRawConnection(){this.printDebug("acquiring raw connection");const e=this.config.connection;return await this.driver.connect(this._getConnectionString(e))}async destroyRawConnection(e){return await e.close()}_getConnectionString(e={}){const t=e.connectionStringParams||{},n=Object.keys(t).reduce((i,a)=>{const o=t[a];return`${i}${a}=${o};`},"");return`${`DRIVER=${e.driver};SYSTEM=${e.host};HOSTNAME=${e.host};PORT=${e.port};DATABASE=${e.database};UID=${e.user};PWD=${e.password};`}${n}`}async _query(e,t){(!t||typeof t=="string")&&(t={sql:t});const n=(t.method!=="raw"?t.method:t.sql.split(" ")[0]).toLowerCase();if(t.sqlMethod=n,n==="select"||n==="first"||n==="pluck"){const a=await e.query(t.sql,t.bindings);return a&&(t.response={rows:a,rowCount:a.length}),t}const i=await e.createStatement();return await i.prepare(t.sql),await i.bind(t.bindings),t.response=await i.execute(),t}processResponse(e,t){if(e===null)return null;const n=e.response,i=e.sqlMethod,{rows:a}=n;if(e.output)return e.output.call(t,n);switch(i){case"select":case"pluck":case"first":return i==="pluck"?a.map(e.pluck):i==="first"?a[0]:a;case"insert":case"del":case"delete":case"update":case"counter":return n.rowCount;default:return n}}}return f0});
//# sourceMappingURL=index.umd.js.map
